<h1 id="十一、后台-其他管理"><a class="header-anchor" href="#十一、后台-其他管理">¶</a>十一、后台-其他管理</h1>
<h2 id="1、后台其他页面"><a class="header-anchor" href="#1、后台其他页面">¶</a>1、后台其他页面</h2>
<p>在[后台-分类管理]里把设计思路，用到的设计模式，静态资源，JSP包含关系, 分页，增删改查典型操作等每个详细的操作都掰的很细了。 后台的其他管理页面，比如产品管理，订单管理等也有相近的功能，就不用讲解的那么细的，所以其他的管理页面，就每个页面放在一个知识点里讲解，这样大家学习起来更加紧凑。</p>
<h2 id="2、属性管理"><a class="header-anchor" href="#2、属性管理">¶</a>2、属性管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错"><a class="header-anchor" href="#步骤-2-模仿和排错">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面截图"><a class="header-anchor" href="#步骤-3-页面截图">¶</a>步骤 3 : 页面截图</h3>
<p>重启tomcat,通过访问地址</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_property_list?cid=12
</code></pre>
<p>可以看到属性管理的界面</p>
<p>注： 这cid=12是分类的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="3781.png" alt=""></p>
<h3 id="步骤-4-在分类管理页面上添加属性管理的超链"><a class="header-anchor" href="#步骤-4-在分类管理页面上添加属性管理的超链">¶</a>步骤 4 : 在分类管理页面上添加属性管理的超链</h3>
<p>接下来讲， 基于 [分类管理可运行项目 ]做了哪些工作以支持属性管理的操作。</p>
<p>首先，在listCategory.jsp里，加上属性管理这一列<br>
分别处于37行和51行</p>
<pre><code class="language-html">&lt;th&gt;属性管理&lt;/th&gt;
</code></pre>
<pre><code class="language-html">&lt;td&gt;&lt;a href=&quot;admin_property_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
</code></pre>
<p><img src="3783.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
$(function(){
     
    $(&quot;#addForm&quot;).submit(function(){
        if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;))
            return false;
        if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;))
            return false;
        return true;
    });
});
 
&lt;/script&gt;
 
&lt;title&gt;分类管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;h1 class=&quot;label label-info&quot; &gt;分类管理&lt;/h1&gt;
    &lt;br&gt;
    &lt;br&gt;
     
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;图片&lt;/th&gt;
                    &lt;th&gt;分类名称&lt;/th&gt;
                    &lt;th&gt;属性管理&lt;/th&gt;
&lt;!--                     &lt;th&gt;产品管理&lt;/th&gt; --&gt;
                    &lt;th&gt;编辑&lt;/th&gt;
                    &lt;th&gt;删除&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${thecs}&quot; var=&quot;c&quot;&gt;
                 
                &lt;tr&gt;
                    &lt;td&gt;${c.id}&lt;/td&gt;
                    &lt;td&gt;&lt;img height=&quot;40px&quot; src=&quot;img/category/${c.id}.jpg&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;${c.name}&lt;/td&gt;
                         
                    &lt;td&gt;&lt;a href=&quot;admin_property_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                   
&lt;%--                     &lt;td&gt;&lt;a href=&quot;admin_product_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                    --%&gt;
                    &lt;td&gt;&lt;a href=&quot;admin_category_edit?id=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=${c.id}&quot;&gt;&lt;span class=&quot;   glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
     
                &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;panel panel-warning addDiv&quot;&gt;
      &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt;
      &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
                &lt;table class=&quot;addTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;分类名称&lt;/td&gt;
                        &lt;td&gt;&lt;input  id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;分类圖片&lt;/td&gt;
                        &lt;td&gt;
                            &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;filepath&quot; /&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
     
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<h3 id="步骤-5-PropertyServlet类"><a class="header-anchor" href="#步骤-5-PropertyServlet类">¶</a>步骤 5 : PropertyServlet类</h3>
<p>准备PropertyServlet类</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Category;
import tmall.bean.Property;
import tmall.util.Page;
 
public class PropertyServlet extends BaseBackServlet {
 
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
         
        String name= request.getParameter(&quot;name&quot;);
        Property p = new Property();
        p.setCategory(c);
        p.setName(name);
        propertyDAO.add(p);
        return &quot;@admin_property_list?cid=&quot;+cid;
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Property p = propertyDAO.get(id);
        propertyDAO.delete(id);
        return &quot;@admin_property_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Property p = propertyDAO.get(id);
        request.setAttribute(&quot;p&quot;, p);
        return &quot;admin/editProperty.jsp&quot;;       
    }
 
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
 
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        String name= request.getParameter(&quot;name&quot;);
        Property p = new Property();
        p.setCategory(c);
        p.setId(id);
        p.setName(name);
        propertyDAO.update(p);
        return &quot;@admin_property_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
        List&lt;Property&gt; ps = propertyDAO.list(cid, page.getStart(),page.getCount());
        int total = propertyDAO.getTotal(cid);
        page.setTotal(total);
        page.setParam(&quot;&amp;cid=&quot;+c.getId());
         
        request.setAttribute(&quot;ps&quot;, ps);
        request.setAttribute(&quot;c&quot;, c);
        request.setAttribute(&quot;page&quot;, page);
         
        return &quot;admin/listProperty.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-6-web-xml"><a class="header-anchor" href="#步骤-6-web-xml">¶</a>步骤 6 : web.xml</h3>
<p>接着在web.xml中配置/propertyServlet 路径</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.CategoryServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/categoryServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.PropertyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/propertyServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;filter&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.EncodingFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;   
     
    &lt;filter&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.BackServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<h3 id="步骤-7-listProperty-jsp-editProperty-jsp"><a class="header-anchor" href="#步骤-7-listProperty-jsp-editProperty-jsp">¶</a>步骤 7 : listProperty.jsp+editProperty.jsp</h3>
<p>然后是查询和编辑的jsp页面</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
    $(function() {
 
        $(&quot;#addForm&quot;).submit(function() {
            if (checkEmpty(&quot;name&quot;, &quot;属性名称&quot;))
                return true;
            return false;
        });
    });
&lt;/script&gt;
 
&lt;title&gt;属性管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
 
    &lt;ol class=&quot;breadcrumb&quot;&gt;
      &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;admin_property_list?cid=${c.id}&quot;&gt;${c.name}&lt;/a&gt;&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;属性管理&lt;/li&gt;
    &lt;/ol&gt;
 
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table
            class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;属性名称&lt;/th&gt;
                    &lt;th&gt;编辑&lt;/th&gt;
                    &lt;th&gt;删除&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${ps}&quot; var=&quot;p&quot;&gt;
 
                    &lt;tr&gt;
                        &lt;td&gt;${p.id}&lt;/td&gt;
                        &lt;td&gt;${p.name}&lt;/td&gt;
                        &lt;td&gt;&lt;a href=&quot;admin_property_edit?id=${p.id}&quot;&gt;&lt;span
                                class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
                            href=&quot;admin_property_delete?id=${p.id}&quot;&gt;&lt;span
                                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
                    &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
 
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot;%&gt;
    &lt;/div&gt;
 
    &lt;div class=&quot;panel panel-warning addDiv&quot;&gt;
        &lt;div class=&quot;panel-heading&quot;&gt;新增属性&lt;/div&gt;
        &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_property_add&quot;&gt;
                &lt;table class=&quot;addTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;属性名称&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                            &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${c.id}&quot;&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
 
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;title&gt;编辑属性&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;ol class=&quot;breadcrumb&quot;&gt;
      &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;admin_property_list?cid=${p.category.id}&quot;&gt;${p.category.name}&lt;/a&gt;&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;编辑属性&lt;/li&gt;
    &lt;/ol&gt;
 
    &lt;div class=&quot;panel panel-warning editDiv&quot;&gt;
        &lt;div class=&quot;panel-heading&quot;&gt;编辑属性&lt;/div&gt;
        &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_property_update&quot;&gt;
                &lt;table class=&quot;editTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;属性名称&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; value=&quot;${p.name}&quot;
                            type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
                        &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 id="步骤-8-查询功能讲解"><a class="header-anchor" href="#步骤-8-查询功能讲解">¶</a>步骤 8 : 查询功能讲解</h3>
<p>查询访问的是PropertyServlet的list()方法</p>
<ol>
<li>获取分类 cid</li>
<li>基于cid，获取当前分类下的属性集合</li>
<li>获取当前分类下的属性总数，并且设置给分页page对象</li>
<li>拼接字符串&quot;&amp;cid=&quot;+c.getId()，设置给page对象的Param值。 因为属性分页都是基于当前分类下的分页，所以分页的时候需要传递这个cid</li>
<li>把属性集合设置到 request的 “ps” 属性上</li>
<li>把分类对象设置到 request的 “c” 属性上</li>
<li>把分页对象设置到 request的 “page” 对象上</li>
<li>服务端跳转到admin/listProperty.jsp页面</li>
<li>在listProperty.jsp页面上使用c:forEach 遍历ps集合，并显示</li>
</ol>
<p><img src="3787.png" alt=""></p>
<pre><code class="language-java">public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
    List&lt;Property&gt; ps = propertyDAO.list(cid, page.getStart(),page.getCount());
    int total = propertyDAO.getTotal(cid);
    page.setTotal(total);
    page.setParam(&quot;&amp;cid=&quot;+c.getId());
     
    request.setAttribute(&quot;ps&quot;, ps);
    request.setAttribute(&quot;c&quot;, c);
    request.setAttribute(&quot;page&quot;, page);
     
    return &quot;admin/listProperty.jsp&quot;;
}
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${ps}&quot; var=&quot;p&quot;&gt;
 
    &lt;tr&gt;
        &lt;td&gt;${p.id}&lt;/td&gt;
        &lt;td&gt;${p.name}&lt;/td&gt;
        &lt;td&gt;&lt;a href=&quot;admin_property_edit?id=${p.id}&quot;&gt;&lt;span
                class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
            href=&quot;admin_property_delete?id=${p.id}&quot;&gt;&lt;span
                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
    &lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<h3 id="步骤-9-增加功能讲解"><a class="header-anchor" href="#步骤-9-增加功能讲解">¶</a>步骤 9 : 增加功能讲解</h3>
<ol>
<li>在listProperty.jsp页面提交数据的时候，除了提交属性名称，还会提交cid</li>
<li>在PropertyServlet中根据获取到的cid,name参数，创建新的Property对象，并插入到数据库</li>
<li>客户端跳转到admin_property_list,并带上参数cid</li>
</ol>
<p><img src="3788.png" alt=""></p>
<pre><code class="language-jsp">&lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_property_add&quot;&gt;
                &lt;table class=&quot;addTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;属性名称&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                            &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${c.id}&quot;&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
</code></pre>
<pre><code class="language-java">public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
     
    String name= request.getParameter(&quot;name&quot;);
    Property p = new Property();
    p.setCategory(c);
    p.setName(name);
    propertyDAO.add(p);
    return &quot;@admin_property_list?cid=&quot;+cid;
}
</code></pre>
<h3 id="步骤-10-编辑功能讲解"><a class="header-anchor" href="#步骤-10-编辑功能讲解">¶</a>步骤 10 : 编辑功能讲解</h3>
<ol>
<li>在PropertyServlet的edit方法中，根据id获取Property对象</li>
<li>把Property对象放在request的 “p” 属性中</li>
<li>服务端跳转到admin/editProperty.jsp</li>
<li>在editProperty.jsp中显示属性名称</li>
<li>在editProperty.jsp中隐式提供id和cid</li>
</ol>
<pre><code class="language-jsp">&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
</code></pre>
<p><img src="3789.png" alt=""></p>
<pre><code class="language-java">public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Property p = propertyDAO.get(id);
    request.setAttribute(&quot;p&quot;, p);
    return &quot;admin/editProperty.jsp&quot;;       
}
</code></pre>
<pre><code class="language-jsp">&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
</code></pre>
<h3 id="步骤-11-修改功能讲解"><a class="header-anchor" href="#步骤-11-修改功能讲解">¶</a>步骤 11 : 修改功能讲解</h3>
<ol>
<li>在PropertyServlet的update方法中获取cid，id, name等参数</li>
<li>根据这些参数创建Property对象</li>
<li>借助propertyDAO更新这个对象到数据库</li>
<li>客户端跳转到admin_property_list，并带上参数cid</li>
</ol>
<p><img src="3790.png" alt=""></p>
<pre><code class="language-java">public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
     
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    String name= request.getParameter(&quot;name&quot;);
    Property p = new Property();
    p.setCategory(c);
    p.setId(id);
    p.setName(name);
    propertyDAO.update(p);
    return &quot;@admin_property_list?cid=&quot;+p.getCategory().getId();
}
</code></pre>
<h3 id="步骤-12-删除功能讲解"><a class="header-anchor" href="#步骤-12-删除功能讲解">¶</a>步骤 12 : 删除功能讲解</h3>
<ol>
<li>在PropertyServlet的delete方法中获取id</li>
<li>根据id获取Property对象</li>
<li>借助propertyDAO删除这个对象对应的数据</li>
<li>客户端跳转到admin_property_list，并带上参数cid</li>
</ol>
<p><img src="3791.png" alt=""></p>
<pre><code class="language-java">public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Property p = propertyDAO.get(id);
    propertyDAO.delete(id);
    return &quot;@admin_property_list?cid=&quot;+p.getCategory().getId();
}
</code></pre>
<h3 id="步骤-13-其他-面包屑导航"><a class="header-anchor" href="#步骤-13-其他-面包屑导航">¶</a>步骤 13 : 其他-面包屑导航</h3>
<p>在属性管理页面的页头，有一个面包屑导航<br>
第一个连接跳转到admin_category_list<br>
第二个连接跳转到admin_property_list?cid=</p>
<p>样式用的是[Bootstrap面包屑导航]</p>
<p><img src="3792.png" alt=""></p>
<pre><code class="language-jsp">&lt;ol class=&quot;breadcrumb&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;admin_property_list?cid=${c.id}&quot;&gt;${c.name}&lt;/a&gt;&lt;/li&gt;
  &lt;li class=&quot;active&quot;&gt;属性管理&lt;/li&gt;
&lt;/ol&gt;
</code></pre>
<h3 id="步骤-14-其他-分页"><a class="header-anchor" href="#步骤-14-其他-分页">¶</a>步骤 14 : 其他-分页</h3>
<p>这里的分页比起[分类管理中的分页]多了一个参数cid</p>
<ol>
<li>在PropertyServlet.list() 方法中，把&amp;cid= 参数设置到在page对象的param属性上</li>
</ol>
<pre><code class="language-java">page.setParam(&quot;&amp;cid=&quot;+c.getId());
</code></pre>
<ol start="2">
<li>在adminPage.jsp页面中通过${page.param}取出这个参数</li>
</ol>
<p><img src="3793.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;script&gt;
$(function(){
    $(&quot;ul.pagination li.disabled a&quot;).click(function(){
        return false;
    });
});
 
&lt;/script&gt;
 
&lt;nav&gt;
  &lt;ul class=&quot;pagination&quot;&gt;
    &lt;li &lt;c:if test=&quot;${!page.hasPreviouse}&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt;
      &lt;a  href=&quot;?page.start=0${page.param}&quot; aria-label=&quot;Previous&quot; &gt;
        &lt;span aria-hidden=&quot;true&quot;&gt;«&lt;/span&gt;
      &lt;/a&gt;
    &lt;/li&gt;
 
    &lt;li &lt;c:if test=&quot;${!page.hasPreviouse}&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt;
      &lt;a  href=&quot;?page.start=${page.start-page.count}${page.param}&quot; aria-label=&quot;Previous&quot; &gt;
        &lt;span aria-hidden=&quot;true&quot;&gt;‹&lt;/span&gt;
      &lt;/a&gt;
    &lt;/li&gt;   
 
    &lt;c:forEach begin=&quot;0&quot; end=&quot;${page.totalPage-1}&quot; varStatus=&quot;status&quot;&gt;
     
            &lt;li &lt;c:if test=&quot;${status.index*page.count==page.start}&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt;
                &lt;a 
                href=&quot;?page.start=${status.index*page.count}${page.param}&quot;
                &lt;c:if test=&quot;${status.index*page.count==page.start}&quot;&gt;class=&quot;current&quot;&lt;/c:if&gt;
                &gt;${status.count}&lt;/a&gt;
            &lt;/li&gt;
         
    &lt;/c:forEach&gt;
 
    &lt;li &lt;c:if test=&quot;${!page.hasNext}&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt;
      &lt;a href=&quot;?page.start=${page.start+page.count}${page.param}&quot; aria-label=&quot;Next&quot;&gt;
        &lt;span aria-hidden=&quot;true&quot;&gt;›&lt;/span&gt;
      &lt;/a&gt;
    &lt;/li&gt;
    &lt;li &lt;c:if test=&quot;${!page.hasNext}&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt;
      &lt;a href=&quot;?page.start=${page.last}${page.param}&quot; aria-label=&quot;Next&quot;&gt;
        &lt;span aria-hidden=&quot;true&quot;&gt;»&lt;/span&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/nav&gt;
</code></pre>
<h3 id="步骤-15-自己做一遍"><a class="header-anchor" href="#步骤-15-自己做一遍">¶</a>步骤 15 : 自己做一遍</h3>
<p>关于属性管理这一块的学习，推荐如下思路：</p>
<ol>
<li>
<p>先下载[可运行项目]，配置好了跑一边</p>
</li>
<li>
<p>根据接着的讲解，把里面的每一块代码的逻辑，思路，设计思想搞明白，不明不白的在对应页面下提问</p>
</li>
<li>
<p>都理清楚之后，把[可运行项目] 删掉，按照：查询，增加，删除，编辑，修改的顺序自己从头到尾做一遍</p>
</li>
</ol>
<p>只有，能够独立的做出来，才叫做把这些知识点的内容转化为自己的技能</p>
<h2 id="3、产品管理"><a class="header-anchor" href="#3、产品管理">¶</a>3、产品管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v2">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v2"><a class="header-anchor" href="#步骤-2-模仿和排错-v2">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面截图-v2"><a class="header-anchor" href="#步骤-3-页面截图-v2">¶</a>步骤 3 : 页面截图</h3>
<p>重启tomcat,通过访问地址</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_product_list?cid=12
</code></pre>
<p>可以看到产品管理的界面<br>
<strong>注：</strong> 这cid=12是分类的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="3796.png" alt=""></p>
<h3 id="步骤-4-在分类管理页面上添加产品管理的超链"><a class="header-anchor" href="#步骤-4-在分类管理页面上添加产品管理的超链">¶</a>步骤 4 : 在分类管理页面上添加产品管理的超链</h3>
<p>接下来讲， 接着上一步 [属性管理可运行项目] 做了哪些工作以支持产品管理的操作。</p>
<p>首先，在listCategory.jsp里，加上产品管理这一列<br>
分别处于37行和51行</p>
<pre><code class="language-jsp">&lt;th&gt;产品管理&lt;/th&gt;
</code></pre>
<pre><code class="language-jsp">&lt;td&gt;&lt;a href=&quot;admin_product_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
</code></pre>
<p><img src="3797.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
$(function(){
     
    $(&quot;#addForm&quot;).submit(function(){
        if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;))
            return false;
        if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;))
            return false;
        return true;
    });
});
 
&lt;/script&gt;
 
&lt;title&gt;分类管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;h1 class=&quot;label label-info&quot; &gt;分类管理&lt;/h1&gt;
    &lt;br&gt;
    &lt;br&gt;
     
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;图片&lt;/th&gt;
                    &lt;th&gt;分类名称&lt;/th&gt;
                    &lt;th&gt;属性管理&lt;/th&gt;
                    &lt;th&gt;产品管理&lt;/th&gt;
                    &lt;th&gt;编辑&lt;/th&gt;
                    &lt;th&gt;删除&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${thecs}&quot; var=&quot;c&quot;&gt;
                 
                &lt;tr&gt;
                    &lt;td&gt;${c.id}&lt;/td&gt;
                    &lt;td&gt;&lt;img height=&quot;40px&quot; src=&quot;img/category/${c.id}.jpg&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;${c.name}&lt;/td&gt;
                         
                    &lt;td&gt;&lt;a href=&quot;admin_property_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                   
                    &lt;td&gt;&lt;a href=&quot;admin_product_list?cid=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                  
                    &lt;td&gt;&lt;a href=&quot;admin_category_edit?id=${c.id}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=${c.id}&quot;&gt;&lt;span class=&quot;   glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
     
                &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;panel panel-warning addDiv&quot;&gt;
      &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt;
      &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
                &lt;table class=&quot;addTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;分类名称&lt;/td&gt;
                        &lt;td&gt;&lt;input  id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;分类圖片&lt;/td&gt;
                        &lt;td&gt;
                            &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;filepath&quot; /&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
     
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<h3 id="步骤-5-ProductServlet类"><a class="header-anchor" href="#步骤-5-ProductServlet类">¶</a>步骤 5 : ProductServlet类</h3>
<p>准备ProductServlet类</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.Date;
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Category;
import tmall.bean.Product;
import tmall.bean.Property;
import tmall.bean.PropertyValue;
import tmall.util.Page;
 
public class ProductServlet extends BaseBackServlet {
 
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
         
        String name= request.getParameter(&quot;name&quot;);
        String subTitle= request.getParameter(&quot;subTitle&quot;);
        float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
        float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
        int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
 
        Product p = new Product();
 
        p.setCategory(c);
        p.setName(name);
        p.setSubTitle(subTitle);
        p.setOrignalPrice(orignalPrice);
        p.setPromotePrice(promotePrice);
        p.setStock(stock);
        p.setCreateDate(new Date());
 
        productDAO.add(p);
        return &quot;@admin_product_list?cid=&quot;+cid;
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        productDAO.delete(id);
        return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        request.setAttribute(&quot;p&quot;, p);
        return &quot;admin/editProduct.jsp&quot;;    
    }
     
    public String editPropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        request.setAttribute(&quot;p&quot;, p);
         
        List&lt;Property&gt; pts= propertyDAO.list(p.getCategory().getId());
        propertyValueDAO.init(p);
         
        List&lt;PropertyValue&gt; pvs = propertyValueDAO.list(p.getId());
         
        request.setAttribute(&quot;pvs&quot;, pvs);
         
        return &quot;admin/editProductValue.jsp&quot;;       
    }
 
    public String updatePropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
        int pvid = Integer.parseInt(request.getParameter(&quot;pvid&quot;));
        String value = request.getParameter(&quot;value&quot;);
         
        PropertyValue pv =propertyValueDAO.get(pvid);
        pv.setValue(value);
        propertyValueDAO.update(pv);
        return &quot;%success&quot;;
    }
     
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
 
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
        float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
        float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
        String subTitle= request.getParameter(&quot;subTitle&quot;);
        String name= request.getParameter(&quot;name&quot;);
         
        Product p = new Product();
 
        p.setName(name);
        p.setSubTitle(subTitle);
        p.setOrignalPrice(orignalPrice);
        p.setPromotePrice(promotePrice);
        p.setStock(stock);
        p.setId(id);
        p.setCategory(c);      
 
        productDAO.update(p);
        return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
         
        List&lt;Product&gt; ps = productDAO.list(cid, page.getStart(),page.getCount());
         
        int total = productDAO.getTotal(cid);
        page.setTotal(total);
        page.setParam(&quot;&amp;cid=&quot;+c.getId());
         
        request.setAttribute(&quot;ps&quot;, ps);
        request.setAttribute(&quot;c&quot;, c);
        request.setAttribute(&quot;page&quot;, page);
         
        return &quot;admin/listProduct.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-6-web-xml-v2"><a class="header-anchor" href="#步骤-6-web-xml-v2">¶</a>步骤 6 : web.xml</h3>
<p>接着在web.xml中配置/productServlet 路径</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.CategoryServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
      
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/categoryServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.PropertyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/propertyServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;filter&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.EncodingFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;   
     
    &lt;filter&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.BackServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<h3 id="步骤-7-listProduct-jsp-editProduct-jsp"><a class="header-anchor" href="#步骤-7-listProduct-jsp-editProduct-jsp">¶</a>步骤 7 : listProduct.jsp+editProduct.jsp</h3>
<p>然后是查询和编辑的jsp页面</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
    $(function() {
        $(&quot;#addForm&quot;).submit(function() {
            if (!checkEmpty(&quot;name&quot;, &quot;产品名称&quot;))
                return false;
//          if (!checkEmpty(&quot;subTitle&quot;, &quot;小标题&quot;))
//              return false;
            if (!checkNumber(&quot;orignalPrice&quot;, &quot;原价格&quot;))
                return false;
            if (!checkNumber(&quot;promotePrice&quot;, &quot;优惠价格&quot;))
                return false;
            if (!checkInt(&quot;stock&quot;, &quot;库存&quot;))
                return false;
            return true;
        });
    });
&lt;/script&gt;
 
&lt;title&gt;产品管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
 
    &lt;ol class=&quot;breadcrumb&quot;&gt;
      &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=${c.id}&quot;&gt;${c.name}&lt;/a&gt;&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;产品管理&lt;/li&gt;
    &lt;/ol&gt;
 
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table
            class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;图片&lt;/th&gt;
                    &lt;th&gt;产品名称&lt;/th&gt;
                    &lt;th&gt;产品小标题&lt;/th&gt;
                    &lt;th width=&quot;53px&quot;&gt;原价格&lt;/th&gt;
                    &lt;th width=&quot;80px&quot;&gt;优惠价格&lt;/th&gt;
                    &lt;th width=&quot;80px&quot;&gt;库存数量&lt;/th&gt;
                    &lt;th width=&quot;80px&quot;&gt;图片管理&lt;/th&gt;
                    &lt;th width=&quot;80px&quot;&gt;设置属性&lt;/th&gt;
                    &lt;th width=&quot;42px&quot;&gt;编辑&lt;/th&gt;
                    &lt;th width=&quot;42px&quot;&gt;删除&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${ps}&quot; var=&quot;p&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;${p.id}&lt;/td&gt;
                        &lt;td&gt;
                         
                        &lt;c:if test=&quot;${!empty p.firstProductImage}&quot;&gt;
                            &lt;img width=&quot;40px&quot; src=&quot;img/productSingle/${p.firstProductImage.id}.jpg&quot;&gt;
                        &lt;/c:if&gt;
                         
                        &lt;/td&gt;
                        &lt;td&gt;${p.name}&lt;/td&gt;
                        &lt;td&gt;${p.subTitle}&lt;/td&gt;
                        &lt;td&gt;${p.orignalPrice}&lt;/td&gt;
                        &lt;td&gt;${p.promotePrice}&lt;/td&gt;
                        &lt;td&gt;${p.stock}&lt;/td&gt;
                        &lt;td&gt;&lt;a href=&quot;admin_productImage_list?pid=${p.id}&quot;&gt;&lt;span
                                class=&quot;glyphicon glyphicon-picture&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;a href=&quot;admin_product_editPropertyValue?id=${p.id}&quot;&gt;&lt;span
                                class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                         
                        &lt;td&gt;&lt;a href=&quot;admin_product_edit?id=${p.id}&quot;&gt;&lt;span
                                class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
                            href=&quot;admin_product_delete?id=${p.id}&quot;&gt;&lt;span
                                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
                    &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
 
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot;%&gt;
    &lt;/div&gt;
 
    &lt;div class=&quot;panel panel-warning addDiv&quot;&gt;
        &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;/div&gt;
        &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_product_add&quot;&gt;
                &lt;table class=&quot;addTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;产品名称&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;产品小标题&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;subTitle&quot; name=&quot;subTitle&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;原价格&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;orignalPrice&quot; value=&quot;99.98&quot; name=&quot;orignalPrice&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;优惠价格&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;promotePrice&quot;  value=&quot;19.98&quot; name=&quot;promotePrice&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;库存&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;stock&quot;  value=&quot;99&quot; name=&quot;stock&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                            &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${c.id}&quot;&gt;
                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
 
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;title&gt;编辑产品&lt;/title&gt;
 
&lt;script&gt;
$(function() {
    $(&quot;#editForm&quot;).submit(function() {
        if (!checkEmpty(&quot;name&quot;, &quot;产品名称&quot;))
            return false;
//          if (!checkEmpty(&quot;subTitle&quot;, &quot;小标题&quot;))
//              return false;
        if (!checkNumber(&quot;orignalPrice&quot;, &quot;原价格&quot;))
            return false;
        if (!checkNumber(&quot;promotePrice&quot;, &quot;优惠价格&quot;))
            return false;
        if (!checkInt(&quot;stock&quot;, &quot;库存&quot;))
            return false;
        return true;
    });
});
&lt;/script&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;ol class=&quot;breadcrumb&quot;&gt;
      &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=${p.category.id}&quot;&gt;${p.category.name}&lt;/a&gt;&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;${p.name}&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;编辑产品&lt;/li&gt;
    &lt;/ol&gt;
     
    &lt;div class=&quot;panel panel-warning editDiv&quot;&gt;
        &lt;div class=&quot;panel-heading&quot;&gt;编辑产品&lt;/div&gt;
        &lt;div class=&quot;panel-body&quot;&gt;
            &lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_product_update&quot;&gt;
                &lt;table class=&quot;editTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;产品名称&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; value=&quot;${p.name}&quot;
                            type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;产品小标题&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;subTitle&quot; name=&quot;subTitle&quot; type=&quot;text&quot;
                        value=&quot;${p.subTitle}&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;原价格&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;orignalPrice&quot; value=&quot;${p.orignalPrice}&quot; name=&quot;orignalPrice&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;优惠价格&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;promotePrice&quot;  value=&quot;${p.promotePrice}&quot; name=&quot;promotePrice&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;库存&lt;/td&gt;
                        &lt;td&gt;&lt;input id=&quot;stock&quot;  value=&quot;${p.stock}&quot; name=&quot;stock&quot; type=&quot;text&quot;
                            class=&quot;form-control&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                                         
                    &lt;tr class=&quot;submitTR&quot;&gt;
                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
                        &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 id="步骤-8-查询功能讲解-v2"><a class="header-anchor" href="#步骤-8-查询功能讲解-v2">¶</a>步骤 8 : 查询功能讲解</h3>
<p>查询访问的是ProductServlet的list()方法</p>
<ol>
<li>获取分类 cid</li>
<li>基于cid，获取当前分类下的产品集合</li>
<li>获取当前分类下的产品总数，并且设置给分页page对象</li>
<li>拼接字符串&quot;&amp;cid=&quot;+c.getId()，设置给page对象的Param值。 因为产品分页都是基于当前分类下的分页，所以分页的时候需要传递这个cid</li>
<li>把产品集合设置到 request的 “ps” 属性上</li>
<li>把分类对象设置到 request的 “c” 属性上</li>
<li>把分页对象设置到 request的 “page” 对象上</li>
<li>服务端跳转到admin/listProduct.jsp页面</li>
<li>在listProduct.jsp页面上使用c:forEach 遍历ps集合，并显示</li>
</ol>
<p><img src="3801.png" alt=""></p>
<pre><code class="language-java">public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
     
    List&lt;Product&gt; ps = productDAO.list(cid, page.getStart(),page.getCount());
     
    int total = productDAO.getTotal(cid);
    page.setTotal(total);
    page.setParam(&quot;&amp;cid=&quot;+c.getId());
     
    request.setAttribute(&quot;ps&quot;, ps);
    request.setAttribute(&quot;c&quot;, c);
    request.setAttribute(&quot;page&quot;, page);
     
    return &quot;admin/listProduct.jsp&quot;;
}
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${ps}&quot; var=&quot;p&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;${p.id}&lt;/td&gt;
        &lt;td&gt;
         
        &lt;c:if test=&quot;${!empty p.firstProductImage}&quot;&gt;
            &lt;img width=&quot;40px&quot; src=&quot;img/productSingle/${p.firstProductImage.id}.jpg&quot;&gt;
        &lt;/c:if&gt;
         
        &lt;/td&gt;
        &lt;td&gt;${p.name}&lt;/td&gt;
        &lt;td&gt;${p.subTitle}&lt;/td&gt;
        &lt;td&gt;${p.orignalPrice}&lt;/td&gt;
        &lt;td&gt;${p.promotePrice}&lt;/td&gt;
        &lt;td&gt;${p.stock}&lt;/td&gt;
        &lt;td&gt;&lt;a href=&quot;admin_productImage_list?pid=${p.id}&quot;&gt;&lt;span
                class=&quot;glyphicon glyphicon-picture&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=&quot;admin_product_editPropertyValue?id=${p.id}&quot;&gt;&lt;span
                class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
         
        &lt;td&gt;&lt;a href=&quot;admin_product_edit?id=${p.id}&quot;&gt;&lt;span
                class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
            href=&quot;admin_product_delete?id=${p.id}&quot;&gt;&lt;span
                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
    &lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<h3 id="步骤-9-增加功能讲解-v2"><a class="header-anchor" href="#步骤-9-增加功能讲解-v2">¶</a>步骤 9 : 增加功能讲解</h3>
<ol>
<li>在listProduct.jsp提交数据的时候，除了提交产品名称，小标题，原价格，优惠价格，库存外还会提交cid</li>
<li>在ProductServlet中根据获取到的cid,name,subTitle,等参数，创建新的Product对象，并插入到数据库</li>
<li>客户端跳转到admin_product_list,并带上参数cid</li>
</ol>
<p><img src="3802.png" alt=""></p>
<pre><code class="language-jsp">&lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_product_add&quot;&gt;
    &lt;table class=&quot;addTable&quot;&gt;
        &lt;tr&gt;
            &lt;td&gt;产品名称&lt;/td&gt;
            &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot;
                class=&quot;form-control&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;产品小标题&lt;/td&gt;
            &lt;td&gt;&lt;input id=&quot;subTitle&quot; name=&quot;subTitle&quot; type=&quot;text&quot;
                class=&quot;form-control&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;原价格&lt;/td&gt;
            &lt;td&gt;&lt;input id=&quot;orignalPrice&quot; value=&quot;99.98&quot; name=&quot;orignalPrice&quot; type=&quot;text&quot;
                class=&quot;form-control&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;优惠价格&lt;/td&gt;
            &lt;td&gt;&lt;input id=&quot;promotePrice&quot;  value=&quot;19.98&quot; name=&quot;promotePrice&quot; type=&quot;text&quot;
                class=&quot;form-control&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;库存&lt;/td&gt;
            &lt;td&gt;&lt;input id=&quot;stock&quot;  value=&quot;99&quot; name=&quot;stock&quot; type=&quot;text&quot;
                class=&quot;form-control&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr class=&quot;submitTR&quot;&gt;
            &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${c.id}&quot;&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;
</code></pre>
<pre><code class="language-java">public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
     
    String name= request.getParameter(&quot;name&quot;);
    String subTitle= request.getParameter(&quot;subTitle&quot;);
    float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
    float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
    int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
 
    Product p = new Product();
 
    p.setCategory(c);
    p.setName(name);
    p.setSubTitle(subTitle);
    p.setOrignalPrice(orignalPrice);
    p.setPromotePrice(promotePrice);
    p.setStock(stock);
    productDAO.add(p);
    return &quot;@admin_product_list?cid=&quot;+cid;
}
</code></pre>
<h3 id="步骤-10-编辑功能讲解-v2"><a class="header-anchor" href="#步骤-10-编辑功能讲解-v2">¶</a>步骤 10 : 编辑功能讲解</h3>
<ol>
<li>在ProductServlet的edit方法中，根据id获取Product对象</li>
<li>把Product对象放在request的 “p” 属性中</li>
<li>服务端跳转到admin/editProduct.jsp</li>
<li>在editProduct.jsp中显示属性名称</li>
<li>在editProduct.jsp中隐式提供id和cid</li>
</ol>
<pre><code class="language-jsp">&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
</code></pre>
<p><img src="3803.png" alt=""></p>
<pre><code class="language-java">public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Product p = productDAO.get(id);
    request.setAttribute(&quot;p&quot;, p);
    return &quot;admin/editProduct.jsp&quot;;    
}
</code></pre>
<pre><code class="language-jsp">&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${p.id}&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;${p.category.id}&quot;&gt;
</code></pre>
<h3 id="步骤-11-修改功能讲解-v2"><a class="header-anchor" href="#步骤-11-修改功能讲解-v2">¶</a>步骤 11 : 修改功能讲解</h3>
<ol>
<li>在ProductServlet的update方法中获取cid，id, name,subTitle,price等参数</li>
<li>根据这些参数创建Product对象</li>
<li>借助productDAO更新这个对象到数据库</li>
<li>客户端跳转到admin_product_list，并带上参数cid</li>
</ol>
<p><img src="3804.png" alt=""></p>
<pre><code class="language-java">public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
    int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
    Category c = categoryDAO.get(cid);
 
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
    float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
    float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
    String subTitle= request.getParameter(&quot;subTitle&quot;);
    String name= request.getParameter(&quot;name&quot;);
     
    Product p = new Product();
 
    p.setName(name);
    p.setSubTitle(subTitle);
    p.setOrignalPrice(orignalPrice);
    p.setPromotePrice(promotePrice);
    p.setStock(stock);
    p.setId(id);
    p.setCategory(c);      
 
    productDAO.update(p);
    return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
}
</code></pre>
<h3 id="步骤-12-删除功能讲解-v2"><a class="header-anchor" href="#步骤-12-删除功能讲解-v2">¶</a>步骤 12 : 删除功能讲解</h3>
<ol>
<li>在ProductServlet的delete方法中获取id</li>
<li>根据id获取Product对象</li>
<li>借助productDAO删除这个对象对应的数据</li>
<li>客户端跳转到admin_product_list，并带上参数cid</li>
</ol>
<p><img src="3805.png" alt=""></p>
<pre><code class="language-java">public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Product p = productDAO.get(id);
    productDAO.delete(id);
    return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
}
</code></pre>
<h3 id="步骤-13-自己做一遍"><a class="header-anchor" href="#步骤-13-自己做一遍">¶</a>步骤 13 : 自己做一遍</h3>
<p>关于产品管理这一块的学习，推荐如下思路：</p>
<ol>
<li>
<p>先下载[可运行项目] ，配置好了跑一边</p>
</li>
<li>
<p>根据接着的讲解，把里面的每一块代码的逻辑，思路，设计思想搞明白，不明不白的在对应页面下提问</p>
</li>
<li>
<p>都理清楚之后，把[可运行项目] 删掉，按照：查询，增加，删除，编辑，修改的顺序自己从头到尾做一遍</p>
</li>
</ol>
<p>只有，能够独立的做出来，才叫做把这些知识点的内容转化为自己的技能</p>
<h2 id="4、产品图片管理"><a class="header-anchor" href="#4、产品图片管理">¶</a>4、产品图片管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v3">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v3"><a class="header-anchor" href="#步骤-2-模仿和排错-v3">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面截图-v3"><a class="header-anchor" href="#步骤-3-页面截图-v3">¶</a>步骤 3 : 页面截图</h3>
<p>重启tomcat,通过访问地址</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_productImage_list?pid=4
</code></pre>
<p>可以看到产品图片管理的界面<br>
<strong>注：</strong> 这pid=4是产品的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="3810.png" alt=""></p>
<h3 id="步骤-4-ProductImageServlet类"><a class="header-anchor" href="#步骤-4-ProductImageServlet类">¶</a>步骤 4 : ProductImageServlet类</h3>
<p>ProductImageServlet提供了list,add和delete方法。 edit和update方法直接返回null. 因为界面上没有修改功能</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
 
import javax.imageio.ImageIO;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Product;
import tmall.bean.ProductImage;
import tmall.dao.ProductImageDAO;
import tmall.util.ImageUtil;
import tmall.util.Page;
 
public class ProductImageServlet extends BaseBackServlet {
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        //上传文件的输入流
        InputStream is = null;
        //提交上传文件时的其他参数
        Map&lt;String,String&gt; params = new HashMap&lt;&gt;();
 
        //解析上传
        is = parseUpload(request, params);     
         
        //根据上传的参数生成productImage对象
        String type= params.get(&quot;type&quot;);
        int pid = Integer.parseInt(params.get(&quot;pid&quot;));
        Product p =productDAO.get(pid);
         
        ProductImage pi = new ProductImage();      
        pi.setType(type);
        pi.setProduct(p);
        productImageDAO.add(pi);
         
        //生成文件
        String fileName = pi.getId()+ &quot;.jpg&quot;;
        String imageFolder;
        String imageFolder_small=null;
        String imageFolder_middle=null;
        if(ProductImageDAO.type_single.equals(pi.getType())){
            imageFolder= request.getSession().getServletContext().getRealPath(&quot;img/productSingle&quot;);
            imageFolder_small= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_small&quot;);
            imageFolder_middle= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_middle&quot;);
        }
             
        else
            imageFolder= request.getSession().getServletContext().getRealPath(&quot;img/productDetail&quot;);
        File f = new File(imageFolder, fileName);
        f.getParentFile().mkdirs();
         
        // 复制文件
        try {
            if(null!=is &amp;&amp; 0!=is.available()){
                try(FileOutputStream fos = new FileOutputStream(f)){
                    byte b[] = new byte[1024 * 1024];
                    int length = 0;
                    while (-1 != (length = is.read(b))) {
                        fos.write(b, 0, length);
                    }
                    fos.flush();
                    //通过如下代码，把文件保存为jpg格式
                    BufferedImage img = ImageUtil.change2jpg(f);
                    ImageIO.write(img, &quot;jpg&quot;, f);      
                     
                    if(ProductImageDAO.type_single.equals(pi.getType())){
                        File f_small = new File(imageFolder_small, fileName);
                        File f_middle = new File(imageFolder_middle, fileName);
 
                        ImageUtil.resizeImage(f, 56, 56, f_small);
                        ImageUtil.resizeImage(f, 217, 190, f_middle);
                    }
                         
                }
                catch(Exception e){
                    e.printStackTrace();
                }
            }
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
 
        return &quot;@admin_productImage_list?pid=&quot;+p.getId();
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        ProductImage pi = productImageDAO.get(id);
        productImageDAO.delete(id);
         
        if(ProductImageDAO.type_single.equals(pi.getType())){
            String imageFolder_single= request.getSession().getServletContext().getRealPath(&quot;img/productSingle&quot;);
            String imageFolder_small= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_small&quot;);
            String imageFolder_middle= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_middle&quot;);
             
            File f_single =new File(imageFolder_single,pi.getId()+&quot;.jpg&quot;);
            f_single.delete();
            File f_small =new File(imageFolder_small,pi.getId()+&quot;.jpg&quot;);
            f_small.delete();
            File f_middle =new File(imageFolder_middle,pi.getId()+&quot;.jpg&quot;);
            f_middle.delete();
             
        }
 
        else{
            String imageFolder_detail= request.getSession().getServletContext().getRealPath(&quot;img/productDetail&quot;);
            File f_detail =new File(imageFolder_detail,pi.getId()+&quot;.jpg&quot;);
            f_detail.delete();         
        }
        return &quot;@admin_productImage_list?pid=&quot;+pi.getProduct().getId();
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;       
    }
 
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;   
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        int pid = Integer.parseInt(request.getParameter(&quot;pid&quot;));
        Product p =productDAO.get(pid);
        List&lt;ProductImage&gt; pisSingle = productImageDAO.list(p, ProductImageDAO.type_single);
        List&lt;ProductImage&gt; pisDetail = productImageDAO.list(p, ProductImageDAO.type_detail);
         
        request.setAttribute(&quot;p&quot;, p);
        request.setAttribute(&quot;pisSingle&quot;, pisSingle);
        request.setAttribute(&quot;pisDetail&quot;, pisDetail);
         
        return &quot;admin/listProductImage.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-5-web-xml"><a class="header-anchor" href="#步骤-5-web-xml">¶</a>步骤 5 : web.xml</h3>
<p>增加了对/productImageServlet的映射</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductImageServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productImageServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.CategoryServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
      
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/categoryServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.PropertyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/propertyServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;filter&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.EncodingFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;   
     
    &lt;filter&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.BackServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<h3 id="步骤-6-listProductImage-jsp"><a class="header-anchor" href="#步骤-6-listProductImage-jsp">¶</a>步骤 6 : listProductImage.jsp</h3>
<p>增加listProductImage.jsp</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
$(function(){
    $(&quot;.addFormSingle&quot;).submit(function(){
        if(checkEmpty(&quot;filepathSingle&quot;,&quot;图片文件&quot;)){
            $(&quot;#filepathSingle&quot;).value(&quot;&quot;);
            return true;
        }
        return false;
    });
    $(&quot;.addFormDetail&quot;).submit(function(){
        if(checkEmpty(&quot;filepathDetail&quot;,&quot;图片文件&quot;))
            return true;
        return false;
    });
});
 
&lt;/script&gt;
 
&lt;title&gt;产品图片管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
        &lt;ol class=&quot;breadcrumb&quot;&gt;
          &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=${p.category.id}&quot;&gt;${p.category.name}&lt;/a&gt;&lt;/li&gt;
          &lt;li class=&quot;active&quot;&gt;${p.name}&lt;/li&gt;
          &lt;li class=&quot;active&quot;&gt;产品图片管理&lt;/li&gt;
        &lt;/ol&gt;
 
    &lt;table class=&quot;addPictureTable&quot; align=&quot;center&quot;&gt;
        &lt;tr&gt;
            &lt;td class=&quot;addPictureTableTD&quot;&gt;
              &lt;div&gt;
                &lt;div class=&quot;panel panel-warning addPictureDiv&quot;&gt;
                    &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;b class=&quot;text-primary&quot;&gt; 单个 &lt;/b&gt;图片&lt;/div&gt;
                      &lt;div class=&quot;panel-body&quot;&gt;
                            &lt;form method=&quot;post&quot; class=&quot;addFormSingle&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
                                &lt;table class=&quot;addTable&quot;&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;请选择本地图片 尺寸400X400 为佳&lt;/td&gt;
                                    &lt;/tr&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;
                                            &lt;input id=&quot;filepathSingle&quot; type=&quot;file&quot; name=&quot;filepath&quot; /&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                    &lt;tr class=&quot;submitTR&quot;&gt;
                                        &lt;td align=&quot;center&quot;&gt;
                                            &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;type_single&quot; /&gt;
                                            &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;${p.id}&quot; /&gt;
                                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/table&gt;
                            &lt;/form&gt;
                      &lt;/div&gt;
                  &lt;/div&gt;           
                &lt;table class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
                    &lt;thead&gt;
                        &lt;tr class=&quot;success&quot;&gt;
                            &lt;th&gt;ID&lt;/th&gt;
                            &lt;th&gt;产品单个图片缩略图&lt;/th&gt;
                            &lt;th&gt;删除&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;c:forEach items=&quot;${pisSingle}&quot; var=&quot;pi&quot;&gt;
                            &lt;tr&gt;
                                &lt;td&gt;${pi.id}&lt;/td&gt;
                                &lt;td&gt;
                                &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productSingle/${pi.id}.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productSingle/${pi.id}.jpg&quot;&gt;&lt;/a&gt; 
                                &lt;/td&gt;
                                &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
                                    href=&quot;admin_productImage_delete?id=${pi.id}&quot;&gt;&lt;span
                                        class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
         
                            &lt;/tr&gt;
                        &lt;/c:forEach&gt;
                    &lt;/tbody&gt;   
                &lt;/table&gt; 
                         
              &lt;/div&gt;         
            &lt;/td&gt;
            &lt;td class=&quot;addPictureTableTD&quot;&gt;
              &lt;div&gt;
                 
                &lt;div class=&quot;panel panel-warning addPictureDiv&quot;&gt;
                    &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;b class=&quot;text-primary&quot;&gt; 详情 &lt;/b&gt;图片&lt;/div&gt;
                      &lt;div class=&quot;panel-body&quot;&gt;
                            &lt;form method=&quot;post&quot; class=&quot;addFormDetail&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
                                &lt;table class=&quot;addTable&quot;&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;请选择本地图片 宽度790  为佳&lt;/td&gt;
                                    &lt;/tr&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;
                                            &lt;input id=&quot;filepathDetail&quot;  type=&quot;file&quot; name=&quot;filepath&quot; /&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                    &lt;tr class=&quot;submitTR&quot;&gt;
                                        &lt;td align=&quot;center&quot;&gt;
                                            &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;type_detail&quot; /&gt;
                                            &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;${p.id}&quot; /&gt;
                                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/table&gt;
                            &lt;/form&gt;
                      &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;table class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
                        &lt;thead&gt;
                            &lt;tr class=&quot;success&quot;&gt;
                                &lt;th&gt;ID&lt;/th&gt;
                                &lt;th&gt;产品详情图片缩略图&lt;/th&gt;
                                &lt;th&gt;删除&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody&gt;
                            &lt;c:forEach items=&quot;${pisDetail}&quot; var=&quot;pi&quot;&gt;
                                &lt;tr&gt;
                                    &lt;td&gt;${pi.id}&lt;/td&gt;
                                    &lt;td&gt;
                                        &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productDetail/${pi.id}.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productDetail/${pi.id}.jpg&quot;&gt;&lt;/a&gt;
                                    &lt;/td&gt;
                                    &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
                                        href=&quot;admin_productImage_delete?id=${pi.id}&quot;&gt;&lt;span
                                            class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
             
                                &lt;/tr&gt;
                            &lt;/c:forEach&gt;
                        &lt;/tbody&gt;   
                    &lt;/table&gt;                         
              &lt;/div&gt;         
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
 
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<h3 id="步骤-7-查询功能讲解"><a class="header-anchor" href="#步骤-7-查询功能讲解">¶</a>步骤 7 : 查询功能讲解</h3>
<p>通过产品页面的图片管理访问ProductImageServlet的list()方法</p>
<ol>
<li>获取参数pid</li>
<li>根据pid获取Product对象</li>
<li>根据product对象获取单个图片的集合pisSingle</li>
<li>根据product对象获取详情图片的集合pisDetail</li>
<li>把product 对象，pisSingle ，pisDetail放在request上</li>
<li>服务端跳转到admin/listProductImage.jsp页面</li>
<li>在listProductImage.jsp，使用c:forEach 遍历pisSingle</li>
<li>在listProductImage.jsp，使用c:forEach 遍历pisDetail</li>
</ol>
<p><img src="3811.png" alt=""></p>
<pre><code class="language-java">public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
    int pid = Integer.parseInt(request.getParameter(&quot;pid&quot;));
    Product p =productDAO.get(pid);
    List&lt;ProductImage&gt; pisSingle = productImageDAO.list(p, ProductImageDAO.type_single);
    List&lt;ProductImage&gt; pisDetail = productImageDAO.list(p, ProductImageDAO.type_detail);
     
    request.setAttribute(&quot;p&quot;, p);
    request.setAttribute(&quot;pisSingle&quot;, pisSingle);
    request.setAttribute(&quot;pisDetail&quot;, pisDetail);
     
    return &quot;admin/listProductImage.jsp&quot;;
}
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${pisSingle}&quot; var=&quot;pi&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;${pi.id}&lt;/td&gt;
        &lt;td&gt;
        &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productSingle/${pi.id}.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productSingle/${pi.id}.jpg&quot;&gt;&lt;/a&gt; 
        &lt;/td&gt;
        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
            href=&quot;admin_productImage_delete?id=${pi.id}&quot;&gt;&lt;span
                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
    &lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${pisDetail}&quot; var=&quot;pi&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;${pi.id}&lt;/td&gt;
        &lt;td&gt;
            &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productDetail/${pi.id}.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productDetail/${pi.id}.jpg&quot;&gt;&lt;/a&gt;
        &lt;/td&gt;
        &lt;td&gt;&lt;a deleteLink=&quot;true&quot;
            href=&quot;admin_productImage_delete?id=${pi.id}&quot;&gt;&lt;span
                class=&quot;     glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
 
    &lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<h3 id="步骤-8-增加功能讲解"><a class="header-anchor" href="#步骤-8-增加功能讲解">¶</a>步骤 8 : 增加功能讲解</h3>
<p>增加产品图片分单个和详情两种，其区别在于增加的提交的type类型不一样。<br>
这里就对单个的进行讲解，详情图片的处理同理。<br>
首先， 在listProductImage.jsp准备一个form，提交到admin_productImage_add</p>
<pre><code class="language-jsp">&lt;form method=&quot;post&quot; class=&quot;addFormSingle&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
</code></pre>
<p>接着在ProductImageServlet的add()方法中进行处理</p>
<ol>
<li>parseUpload 获取上传文件的输入流</li>
<li>parseUpload 方法会修改params 参数，并且把浏览器提交的type,pid信息放在其中</li>
<li>从params 中取出type,pid信息，并根据这个type,pid，借助productImageDAO，向数据库中插入数据。</li>
<li>根据request.getSession().getServletContext().getRealPath( “img/productSingle”)，定位到存放分类图片的目录<br>
除了productSingle，还有productSingle_middle和productSingle_small。 因为每上传一张图片，都会有对应的正常，中等和小的三种大小图片，并且放在3个不同的目录下</li>
<li>文件命名以保存到数据库的分类对象的id+&quot;.jpg&quot;的格式命名</li>
<li>根据步骤1获取的输入流，把浏览器提交的文件，复制到目标文件</li>
<li>借助ImageUtil.change2jpg()方法把格式真正转化为jpg，而不仅仅是后缀名为.jpg</li>
<li>再借助ImageUtil.resizeImage把正常大小的图片，改变大小之后，分别复制到productSingle_middle和productSingle_small目录下。</li>
<li>处理完毕之后，客户端条跳转到admin_productImage_list?pid=，并带上pid。</li>
</ol>
<p>详情图片做的是一样的事情，区别在于复制到目录productDetail下，并且不需要改变大小。</p>
<p><img src="3812.png" alt=""></p>
<pre><code class="language-jsp">&lt;form method=&quot;post&quot; class=&quot;addFormSingle&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;table class=&quot;addTable&quot;&gt;
        &lt;tr&gt;
            &lt;td&gt;请选择本地图片 尺寸400X400 为佳&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;input id=&quot;filepathSingle&quot; type=&quot;file&quot; name=&quot;filepath&quot; /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr class=&quot;submitTR&quot;&gt;
            &lt;td align=&quot;center&quot;&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;type_single&quot; /&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;${p.id}&quot; /&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;
</code></pre>
<pre><code class="language-java">public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        //上传文件的输入流
        InputStream is = null;
        //提交上传文件时的其他参数
        Map&lt;String,String&gt; params = new HashMap&lt;&gt;();
 
        //解析上传
        is = parseUpload(request, params);     
         
        //根据上传的参数生成productImage对象
        String type= params.get(&quot;type&quot;);
        int pid = Integer.parseInt(params.get(&quot;pid&quot;));
        Product p =productDAO.get(pid);
         
        ProductImage pi = new ProductImage();      
        pi.setType(type);
        pi.setProduct(p);
        productImageDAO.add(pi);
         
        //生成文件
        String fileName = pi.getId()+ &quot;.jpg&quot;;
        String imageFolder;
        String imageFolder_small=null;
        String imageFolder_middle=null;
        if(ProductImageDAO.type_single.equals(pi.getType())){
            imageFolder= request.getSession().getServletContext().getRealPath(&quot;img/productSingle&quot;);
            imageFolder_small= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_small&quot;);
            imageFolder_middle= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_middle&quot;);
        }
             
        else
            imageFolder= request.getSession().getServletContext().getRealPath(&quot;img/productDetail&quot;);
        File f = new File(imageFolder, fileName);
        f.getParentFile().mkdirs();
         
        // 复制文件
        try {
            if(null!=is &amp;&amp; 0!=is.available()){
                try(FileOutputStream fos = new FileOutputStream(f)){
                    byte b[] = new byte[1024 * 1024];
                    int length = 0;
                    while (-1 != (length = is.read(b))) {
                        fos.write(b, 0, length);
                    }
                    fos.flush();
                    //通过如下代码，把文件保存为jpg格式
                    BufferedImage img = ImageUtil.change2jpg(f);
                    ImageIO.write(img, &quot;jpg&quot;, f);      
                     
                    if(ProductImageDAO.type_single.equals(pi.getType())){
                        File f_small = new File(imageFolder_small, fileName);
                        File f_middle = new File(imageFolder_middle, fileName);
 
                        ImageUtil.resizeImage(f, 56, 56, f_small);
                        ImageUtil.resizeImage(f, 217, 190, f_middle);
                    }
                         
                }
                catch(Exception e){
                    e.printStackTrace();
                }
            }
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
 
        return &quot;@admin_productImage_list?pid=&quot;+p.getId();
    }
</code></pre>
<h3 id="步骤-9-删除功能讲解"><a class="header-anchor" href="#步骤-9-删除功能讲解">¶</a>步骤 9 : 删除功能讲解</h3>
<p>点击删除超链，进入ProductImageServlet的delete方法</p>
<ol>
<li>获取id</li>
<li>根据id获取ProductImage 对象pi</li>
<li>借助productImageDAO，删除数据</li>
<li>如果是单个图片，那么删除3张正常，中等，小号图片</li>
<li>如果是详情图片，那么删除一张图片</li>
<li>客户端跳转到admin_productImage_list地址</li>
</ol>
<p><img src="3813.png" alt=""></p>
<pre><code class="language-java">public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        ProductImage pi = productImageDAO.get(id);
        productImageDAO.delete(id);
         
        if(ProductImageDAO.type_single.equals(pi.getType())){
            String imageFolder_single= request.getSession().getServletContext().getRealPath(&quot;img/productSingle&quot;);
            String imageFolder_small= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_small&quot;);
            String imageFolder_middle= request.getSession().getServletContext().getRealPath(&quot;img/productSingle_middle&quot;);
             
            File f_single =new File(imageFolder_single,pi.getId()+&quot;.jpg&quot;);
            f_single.delete();
            File f_small =new File(imageFolder_small,pi.getId()+&quot;.jpg&quot;);
            f_small.delete();
            File f_middle =new File(imageFolder_middle,pi.getId()+&quot;.jpg&quot;);
            f_middle.delete();
             
        }
 
        else{
            String imageFolder_detail= request.getSession().getServletContext().getRealPath(&quot;img/productDetail&quot;);
            File f_detail =new File(imageFolder_detail,pi.getId()+&quot;.jpg&quot;);
            f_detail.delete();         
        }
        return &quot;@admin_productImage_list?pid=&quot;+pi.getProduct().getId();
    }
</code></pre>
<h3 id="步骤-10-编辑和修改"><a class="header-anchor" href="#步骤-10-编辑和修改">¶</a>步骤 10 : 编辑和修改</h3>
<p>因为只有图片，就不提供编辑和修改功能。 要做修改，先删除，再增加即可</p>
<h2 id="5、产品属性值设置"><a class="header-anchor" href="#5、产品属性值设置">¶</a>5、产品属性值设置</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v4">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v4"><a class="header-anchor" href="#步骤-2-模仿和排错-v4">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面截图-v4"><a class="header-anchor" href="#步骤-3-页面截图-v4">¶</a>步骤 3 : 页面截图</h3>
<p>重启tomcat后访问地址：</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_product_editPropertyValue?id=4
</code></pre>
<p>可以看到产品属性设置的界面<br>
<strong>注：</strong> 这pid=4是产品的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="3820.png" alt=""></p>
<h3 id="步骤-4-PropertyValueServlet"><a class="header-anchor" href="#步骤-4-PropertyValueServlet">¶</a>步骤 4 : PropertyValueServlet</h3>
<p>并没有PropertyValueServlet类，对于PropertyValue编辑和修改的支持放了在ProductServlet中进行：<br>
主要是editPropertyValue、updatePropertyValue这两个方法</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import tmall.bean.Category;
import tmall.bean.Product;
import tmall.bean.Property;
import tmall.bean.PropertyValue;
import tmall.util.Page;
 
public class ProductServlet extends BaseBackServlet {
 
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
         
        String name= request.getParameter(&quot;name&quot;);
        String subTitle= request.getParameter(&quot;subTitle&quot;);
        float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
        float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
        int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
 
        Product p = new Product();
 
        p.setCategory(c);
        p.setName(name);
        p.setSubTitle(subTitle);
        p.setOrignalPrice(orignalPrice);
        p.setPromotePrice(promotePrice);
        p.setStock(stock);
         
        productDAO.add(p);
        return &quot;@admin_product_list?cid=&quot;+cid;
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        productDAO.delete(id);
        return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        request.setAttribute(&quot;p&quot;, p);
        return &quot;admin/editProduct.jsp&quot;;    
    }
     
    public String editPropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Product p = productDAO.get(id);
        request.setAttribute(&quot;p&quot;, p);
         
        propertyValueDAO.init(p);
         
        List&lt;PropertyValue&gt; pvs = propertyValueDAO.list(p.getId());
         
        request.setAttribute(&quot;pvs&quot;, pvs);
         
        return &quot;admin/editProductValue.jsp&quot;;       
    }
 
    public String updatePropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
        int pvid = Integer.parseInt(request.getParameter(&quot;pvid&quot;));
        String value = request.getParameter(&quot;value&quot;);
         
        PropertyValue pv =propertyValueDAO.get(pvid);
        pv.setValue(value);
        propertyValueDAO.update(pv);
        return &quot;%success&quot;;
    }
     
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
 
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        int stock = Integer.parseInt(request.getParameter(&quot;stock&quot;));
        float orignalPrice = Float.parseFloat(request.getParameter(&quot;orignalPrice&quot;));
        float promotePrice = Float.parseFloat(request.getParameter(&quot;promotePrice&quot;));
        String subTitle= request.getParameter(&quot;subTitle&quot;);
        String name= request.getParameter(&quot;name&quot;);
         
        Product p = new Product();
 
        p.setName(name);
        p.setSubTitle(subTitle);
        p.setOrignalPrice(orignalPrice);
        p.setPromotePrice(promotePrice);
        p.setStock(stock);
        p.setId(id);
        p.setCategory(c);      
 
        productDAO.update(p);
        return &quot;@admin_product_list?cid=&quot;+p.getCategory().getId();
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        int cid = Integer.parseInt(request.getParameter(&quot;cid&quot;));
        Category c = categoryDAO.get(cid);
         
        List&lt;Product&gt; ps = productDAO.list(cid, page.getStart(),page.getCount());
         
        int total = productDAO.getTotal(cid);
        page.setTotal(total);
        page.setParam(&quot;&amp;cid=&quot;+c.getId());
         
        request.setAttribute(&quot;ps&quot;, ps);
        request.setAttribute(&quot;c&quot;, c);
        request.setAttribute(&quot;page&quot;, page);
         
        return &quot;admin/listProduct.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-5-web-xml-v2"><a class="header-anchor" href="#步骤-5-web-xml-v2">¶</a>步骤 5 : web.xml</h3>
<p>因为没有ProductValueServlet类，所以就没有新增加映射</p>
<h3 id="步骤-6-editProductValue-jsp"><a class="header-anchor" href="#步骤-6-editProductValue-jsp">¶</a>步骤 6 : editProductValue.jsp</h3>
<p>增加editProductValue.jsp</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;title&gt;编辑产品属性值&lt;/title&gt;
 
&lt;script&gt;
$(function() {
    $(&quot;input.pvValue&quot;).keyup(function(){
        var value = $(this).val();
        var page = &quot;admin_product_updatePropertyValue&quot;;
        var pvid = $(this).attr(&quot;pvid&quot;);
        var parentSpan = $(this).parent(&quot;span&quot;);
        parentSpan.css(&quot;border&quot;,&quot;1px solid yellow&quot;);
        $.post(
                page,
                {&quot;value&quot;:value,&quot;pvid&quot;:pvid},
                function(result){
                    if(&quot;success&quot;==result)
                        parentSpan.css(&quot;border&quot;,&quot;1px solid green&quot;);
                    else
                        parentSpan.css(&quot;border&quot;,&quot;1px solid red&quot;);
                }
            );     
    });
});
&lt;/script&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;ol class=&quot;breadcrumb&quot;&gt;
      &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=${p.category.id}&quot;&gt;${p.category.name}&lt;/a&gt;&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;${p.name}&lt;/li&gt;
      &lt;li class=&quot;active&quot;&gt;编辑产品属性&lt;/li&gt;
    &lt;/ol&gt;
     
    &lt;div class=&quot;editPVDiv&quot;&gt;
        &lt;c:forEach items=&quot;${pvs}&quot; var=&quot;pv&quot;&gt;
            &lt;div class=&quot;eachPV&quot;&gt;
                &lt;span class=&quot;pvName&quot; &gt;${pv.property.name}&lt;/span&gt;
                &lt;span class=&quot;pvValue&quot;&gt;&lt;input class=&quot;pvValue&quot; pvid=&quot;${pv.id}&quot; type=&quot;text&quot; value=&quot;${pv.value}&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;/c:forEach&gt;
    &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; 
    &lt;/div&gt;
     
&lt;/div&gt;
</code></pre>
<h3 id="步骤-7-编辑功能讲解"><a class="header-anchor" href="#步骤-7-编辑功能讲解">¶</a>步骤 7 : 编辑功能讲解</h3>
<p>通过产品管理界面的设置属性，跳到编辑页面<br>
调用ProductServlet的editPropertyValue方法：</p>
<ol>
<li>获取参数id</li>
<li>根据id获取Product对象p</li>
<li>初始化属性值： propertyValueDAO.init§。 因为如果是第一次访问，这些属性值是不存在的。</li>
<li>根据Product的id，获取产品对应的属性值集合</li>
<li>属性值集合放在request的 “pvs” 属性上</li>
<li>服务端跳转到admin/editProductValue.jsp 上</li>
<li>在editProductValue.jsp上，用c:forEach遍历出这些属性值</li>
</ol>
<p><img src="3824.png" alt=""></p>
<pre><code class="language-java">public String editPropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Product p = productDAO.get(id);
    request.setAttribute(&quot;p&quot;, p);
     
    List&lt;Property&gt; pts= propertyDAO.list(p.getCategory().getId());
    propertyValueDAO.init(p);
     
    List&lt;PropertyValue&gt; pvs = propertyValueDAO.list(p.getId());
     
    request.setAttribute(&quot;pvs&quot;, pvs);
     
    return &quot;admin/editProductValue.jsp&quot;;       
}
</code></pre>
<h3 id="步骤-8-修改功能讲解"><a class="header-anchor" href="#步骤-8-修改功能讲解">¶</a>步骤 8 : 修改功能讲解</h3>
<p>修改功能采用的是[使用post方式提交ajax]的异步调用方式</p>
<ol>
<li>是监听输入框上的keyup事件</li>
<li>获取输入框里的值</li>
<li>获取输入框上的自定义属性pvid，这就是当前PropertyValue对应的id</li>
<li>把边框的颜色修改为黄色，表示正在修改的意思</li>
<li>借助JQuery的ajax函数 $.post，把id和值，提交到admin_product_updatePropertyValue</li>
<li>admin_product_updatePropertyValue导致ProductServlet的updatePropertyValue方法被调用<br>
6.1 获取pvid<br>
6.2 获取value<br>
6.3 基于pvid和value,更新PropertyValue对象<br>
6.4 返回&quot;%success&quot;</li>
<li>BaseBackServlet根据返回值&quot;%success&quot;，直接输出字符串&quot;success&quot; 到浏览器</li>
<li>浏览器判断如果返回值是&quot;success&quot;,那么就把边框设置为绿色，表示修改成功，否则设置为红色，表示修改失败</li>
</ol>
<p><img src="3825.png" alt=""></p>
<pre><code class="language-java">$(&quot;input.pvValue&quot;).keyup(function(){
    var value = $(this).val();
    var page = &quot;admin_product_updatePropertyValue&quot;;
    var pvid = $(this).attr(&quot;pvid&quot;);
    var parentSpan = $(this).parent(&quot;span&quot;);
    parentSpan.css(&quot;border&quot;,&quot;1px solid yellow&quot;);
    $.post(
            page,
            {&quot;value&quot;:value,&quot;pvid&quot;:pvid},
            function(result){
                if(&quot;success&quot;==result)
                    parentSpan.css(&quot;border&quot;,&quot;1px solid green&quot;);
                else
                    parentSpan.css(&quot;border&quot;,&quot;1px solid red&quot;);
            }
        );     
});
</code></pre>
<pre><code class="language-java">public String updatePropertyValue(HttpServletRequest request, HttpServletResponse response, Page page) {
    int pvid = Integer.parseInt(request.getParameter(&quot;pvid&quot;));
    String value = request.getParameter(&quot;value&quot;);
     
    PropertyValue pv =propertyValueDAO.get(pvid);
    pv.setValue(value);
    propertyValueDAO.update(pv);
    return &quot;%success&quot;;
}
</code></pre>
<h3 id="步骤-9-删除，增加功能不需要"><a class="header-anchor" href="#步骤-9-删除，增加功能不需要">¶</a>步骤 9 : 删除，增加功能不需要</h3>
<p>属性的维护是在分类中进行，这里仅仅做值的设置。 不提供删除和增加功能</p>
<h2 id="6、用户管理"><a class="header-anchor" href="#6、用户管理">¶</a>6、用户管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v5"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v5">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v5"><a class="header-anchor" href="#步骤-2-模仿和排错-v5">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-准备数据"><a class="header-anchor" href="#步骤-3-准备数据">¶</a>步骤 3 : 准备数据</h3>
<p>因为用户信息是前台注册的时候增加的，截至目前为止，还没有讲到前台的功能。所以需要手动在数据库中增加数据，以便于观察运行的效果</p>
<pre><code class="language-mysql">insert into user values(null,'测试用户1','password1');
insert into user values(null,'测试用户2','password2');
insert into user values(null,'测试用户3','password3');
insert into user values(null,'测试用户4','password4');
insert into user values(null,'测试用户5','password5');
</code></pre>
<h3 id="步骤-4-页面截图"><a class="header-anchor" href="#步骤-4-页面截图">¶</a>步骤 4 : 页面截图</h3>
<p>用户这部分做的比较简单，只有查询，为什么呢？</p>
<ol>
<li>用户的增加，是交由前台注册行为产生的，后台不需要自己进行增加</li>
<li>用户信息不能删除。 用户信息是最重要的业务信息，不可以删除</li>
<li>用户资料的修改，也应该有前台用户自己进行，而不是后台操作。比如修改密码</li>
</ol>
<p><img src="3828.png" alt=""></p>
<h3 id="步骤-5-UserServlet"><a class="header-anchor" href="#步骤-5-UserServlet">¶</a>步骤 5 : UserServlet</h3>
<p>UserServlet类</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import org.springframework.web.util.HtmlUtils;
 
import tmall.bean.User;
import tmall.util.Page;
 
public class UserServlet extends BaseBackServlet {
 
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
 
        return null;
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;       
    }
 
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        List&lt;User&gt; us = userDAO.list(page.getStart(),page.getCount());
        int total = userDAO.getTotal();
        page.setTotal(total);
         
        request.setAttribute(&quot;us&quot;, us);
        request.setAttribute(&quot;page&quot;, page);
         
        return &quot;admin/listUser.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-6-web-xml-v3"><a class="header-anchor" href="#步骤-6-web-xml-v3">¶</a>步骤 6 : web.xml</h3>
<p>增加对/userServlet的配置</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.UserServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/userServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductImageServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productImageServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.CategoryServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
      
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/categoryServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.PropertyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/propertyServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;filter&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.EncodingFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;   
     
    &lt;filter&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.BackServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<h3 id="步骤-7-listUser-jsp"><a class="header-anchor" href="#步骤-7-listUser-jsp">¶</a>步骤 7 : listUser.jsp</h3>
<p>listUser.jsp页面</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
&lt;/script&gt;
 
&lt;title&gt;用户管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;h1 class=&quot;label label-info&quot; &gt;用户管理&lt;/h1&gt;
 
    &lt;br&gt;
    &lt;br&gt;
     
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table class=&quot;table table-striped table-bordered table-hover  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;用户名称&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${us}&quot; var=&quot;u&quot;&gt;
                 
                &lt;tr&gt;
                    &lt;td&gt;${u.id}&lt;/td&gt;
                    &lt;td&gt;${u.name}&lt;/td&gt;
                &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt;
    &lt;/div&gt;
     
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<h3 id="步骤-8-查询功能讲解-v3"><a class="header-anchor" href="#步骤-8-查询功能讲解-v3">¶</a>步骤 8 : 查询功能讲解</h3>
<p>点击后台管理上方导航中的 用户管理，进入用户查询界面</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_user_list
</code></pre>
<p>UserServlet的list方法被调用</p>
<ol>
<li>借助userDAO查询用户集合</li>
<li>设置分页信息</li>
<li>把用户集合设置到request的&quot;us&quot;属性上</li>
<li>把分页对象设置到request的&quot;page&quot;属性上</li>
<li>服务端跳转到admin/listUser.jsp页面</li>
<li>在listUser.jsp用c:forEach遍历&quot;us&quot;集合</li>
</ol>
<p><img src="3832.png" alt=""></p>
<pre><code class="language-java">public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
    List&lt;User&gt; us = userDAO.list(page.getStart(),page.getCount());
    int total = userDAO.getTotal();
    page.setTotal(total);
     
    request.setAttribute(&quot;us&quot;, us);
    request.setAttribute(&quot;page&quot;, page);
     
    return &quot;admin/listUser.jsp&quot;;
}
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${us}&quot; var=&quot;u&quot;&gt;
&lt;tr&gt;
    &lt;td&gt;${u.id}&lt;/td&gt;
    &lt;td&gt;${u.name}&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<h3 id="步骤-9-增加，删除，修改功能"><a class="header-anchor" href="#步骤-9-增加，删除，修改功能">¶</a>步骤 9 : 增加，删除，修改功能</h3>
<p>增加交由前台用户注册功能<br>
删除不提供（用户信息是最重要的资料）<br>
修改不提供，应该由前台用户自己完成</p>
<h2 id="7、订单管理"><a class="header-anchor" href="#7、订单管理">¶</a>7、订单管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v6"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v6">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v6"><a class="header-anchor" href="#步骤-2-模仿和排错-v6">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-准备数据SQL"><a class="header-anchor" href="#步骤-3-准备数据SQL">¶</a>步骤 3 : 准备数据SQL</h3>
<p>订单数据，以及其赌赢的订单项数据，都是由前台功能增加的。<br>
为了在后台演示效果，需要自己在数据库中插入数据</p>
<ol>
<li>订单：</li>
</ol>
<pre><code class="language-mysql">insert INTO order_ VALUES (1,'201608241638122609867','某某市，某某区，某某街道，某某号 ','610000','某某某','15111111111',NULL,'2016-12-30',NULL,NULL,NULL,14,'waitDelivery');
</code></pre>
<p><strong>注：</strong> 倒数第二个参数<strong>14</strong>是对应的用户id，需要在数据库中存在，请根据自己的数据信息自行修改。</p>
<ol start="2">
<li>订单项</li>
</ol>
<pre><code class="language-mysql">insert INTO orderitem VALUES (1,2,1,14,2);
insert INTO orderitem VALUES (2,3,1,14,2);
</code></pre>
<p>注： 第二个参数2、3分别对应的产品id，需要在数据库中存在，请根据自己的数据信息自行修改。</p>
<h3 id="步骤-4-页面截图-v2"><a class="header-anchor" href="#步骤-4-页面截图-v2">¶</a>步骤 4 : 页面截图</h3>
<p><img src="3837.png" alt=""></p>
<h3 id="步骤-5-OrderServlet-java"><a class="header-anchor" href="#步骤-5-OrderServlet-java">¶</a>步骤 5 : OrderServlet.java</h3>
<p>因为订单的增加和删除，都是在前台进行的。 所以OrderServlet提供的是list方法和delivery(发货)方法</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.Date;
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Order;
import tmall.dao.OrderDAO;
import tmall.util.Page;
 
public class OrderServlet extends BaseBackServlet {
 
    public String add(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;
    }
 
    public String delete(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;
    }
    public String delivery(HttpServletRequest request, HttpServletResponse response, Page page) {
        int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
        Order o = orderDAO.get(id);
        o.setDeliveryDate(new Date());
        o.setStatus(OrderDAO.waitConfirm);
        orderDAO.update(o);
        return &quot;@admin_order_list&quot;;
    }
 
    public String edit(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;   
    }
 
    public String update(HttpServletRequest request, HttpServletResponse response, Page page) {
        return null;
    }
 
    public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
        List&lt;Order&gt; os = orderDAO.list(page.getStart(),page.getCount());
        orderItemDAO.fill(os);
        int total = orderDAO.getTotal();
        page.setTotal(total);
         
        request.setAttribute(&quot;os&quot;, os);
        request.setAttribute(&quot;page&quot;, page);
         
        return &quot;admin/listOrder.jsp&quot;;
    }
}
</code></pre>
<h3 id="步骤-6-Order-java"><a class="header-anchor" href="#步骤-6-Order-java">¶</a>步骤 6 : Order.java</h3>
<p>为了显示订单状态，就需要把[Order]类的getStatusDesc方法从注释中释放出来。</p>
<p><img src="3839.png" alt=""></p>
<pre><code class="language-java">package tmall.bean;
 
import java.util.Date;
import java.util.List;
//import tmall.dao.OrderDAO;
 
import tmall.dao.OrderDAO;
 
public class Order {
    private String orderCode;
    private String address;
    private String post;
    private String receiver;
    private String mobile;
    private String userMessage;
    private Date createDate;
    private Date payDate;
    private Date deliveryDate;
    private Date confirmDate;
    private User user;
    private int id;
    private List&lt;OrderItem&gt; orderItems;
    private float total;
    private int totalNumber;
    private String status;
     
    public String getStatusDesc(){
        String desc =&quot;未知&quot;;
        switch(status){
            case OrderDAO.waitPay:
                desc=&quot;待付款&quot;;
                break;
            case OrderDAO.waitDelivery:
                desc=&quot;待发货&quot;;
                break;
            case OrderDAO.waitConfirm:
                desc=&quot;待收货&quot;;
                break;
            case OrderDAO.waitReview:
                desc=&quot;等评价&quot;;
                break;
            case OrderDAO.finish:
                desc=&quot;完成&quot;;
                break;
            case OrderDAO.delete:
                desc=&quot;刪除&quot;;
                break;
            default:
                desc=&quot;未知&quot;;
        }
        return desc;
    }
     
    public int getId() {
        return id;
    }
 
    public void setId(int id) {
        this.id = id;
    }
    public String getAddress() {
        return address;
    }
    public void setAddress(String address) {
        this.address = address;
    }
    public String getPost() {
        return post;
    }
    public void setPost(String post) {
        this.post = post;
    }
 
    public String getMobile() {
        return mobile;
    }
    public void setMobile(String mobile) {
        this.mobile = mobile;
    }
    public String getUserMessage() {
        return userMessage;
    }
    public void setUserMessage(String userMessage) {
        this.userMessage = userMessage;
    }
    public Date getCreateDate() {
        return createDate;
    }
    public void setCreateDate(Date createDate) {
        this.createDate = createDate;
    }
    public Date getPayDate() {
        return payDate;
    }
    public void setPayDate(Date payDate) {
        this.payDate = payDate;
    }
    public Date getDeliveryDate() {
        return deliveryDate;
    }
    public void setDeliveryDate(Date deliveryDate) {
        this.deliveryDate = deliveryDate;
    }
    public Date getConfirmDate() {
        return confirmDate;
    }
    public void setConfirmDate(Date confirmDate) {
        this.confirmDate = confirmDate;
    }
 
    public String getReceiver() {
        return receiver;
    }
 
    public void setReceiver(String receiver) {
        this.receiver = receiver;
    }
 
    public String getOrderCode() {
        return orderCode;
    }
 
    public void setOrderCode(String orderCode) {
        this.orderCode = orderCode;
    }
 
    public User getUser() {
        return user;
    }
 
    public void setUser(User user) {
        this.user = user;
    }
 
    public List&lt;OrderItem&gt; getOrderItems() {
        return orderItems;
    }
 
    public void setOrderItems(List&lt;OrderItem&gt; orderItems) {
        this.orderItems = orderItems;
    }
 
    public float getTotal() {
        return total;
    }
 
    public void setTotal(float total) {
        this.total = total;
    }
 
    public String getStatus() {
        return status;
    }
 
    public void setStatus(String status) {
        this.status = status;
    }
 
    public int getTotalNumber() {
        return totalNumber;
    }
 
    public void setTotalNumber(int totalNumber) {
        this.totalNumber = totalNumber;
    }
     
}
</code></pre>
<h3 id="步骤-7-web-xml"><a class="header-anchor" href="#步骤-7-web-xml">¶</a>步骤 7 : web.xml</h3>
<p>在web.xml中配置/orderServlet</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;OrderServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.OrderServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;OrderServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/orderServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.UserServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/userServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductImageServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductImageServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productImageServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
     
    &lt;servlet&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.CategoryServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ProductServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ProductServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/productServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
      
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;CategoryServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/categoryServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;servlet&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.PropertyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
  
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;PropertyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/propertyServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
 
    &lt;filter&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.EncodingFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;EncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;   
     
    &lt;filter&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;tmall.filter.BackServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
  
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BackServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<h3 id="步骤-8-listOrder-jsp"><a class="header-anchor" href="#步骤-8-listOrder-jsp">¶</a>步骤 8 : listOrder.jsp</h3>
<p>增加listOrder.jsp</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;
&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;
 
&lt;script&gt;
$(function(){
    $(&quot;button.orderPageCheckOrderItems&quot;).click(function(){
        var oid = $(this).attr(&quot;oid&quot;);
        $(&quot;tr.orderPageOrderItemTR[oid=&quot;+oid+&quot;]&quot;).toggle();
    });
});
 
&lt;/script&gt;
 
&lt;title&gt;订单管理&lt;/title&gt;
 
&lt;div class=&quot;workingArea&quot;&gt;
    &lt;h1 class=&quot;label label-info&quot; &gt;订单管理&lt;/h1&gt;
    &lt;br&gt;
    &lt;br&gt;
     
    &lt;div class=&quot;listDataTableDiv&quot;&gt;
        &lt;table class=&quot;table table-striped table-bordered table-hover1  table-condensed&quot;&gt;
            &lt;thead&gt;
                &lt;tr class=&quot;success&quot;&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;状态&lt;/th&gt;
                    &lt;th&gt;金额&lt;/th&gt;
                    &lt;th width=&quot;100px&quot;&gt;商品数量&lt;/th&gt;
                    &lt;th width=&quot;100px&quot;&gt;买家名称&lt;/th&gt;
                    &lt;th&gt;创建时间&lt;/th&gt;
                    &lt;th&gt;支付时间&lt;/th&gt;
                    &lt;th&gt;发货时间&lt;/th&gt;
                    &lt;th&gt;确认收货时间&lt;/th&gt;
                    &lt;th width=&quot;120px&quot;&gt;操作&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach items=&quot;${os}&quot; var=&quot;o&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;${o.id}&lt;/td&gt;
                        &lt;td&gt;${o.statusDesc}&lt;/td&gt;
                        &lt;td&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;${o.total}&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/td&gt;
                        &lt;td align=&quot;center&quot;&gt;${o.totalNumber}&lt;/td&gt;
                        &lt;td align=&quot;center&quot;&gt;${o.user.name}&lt;/td&gt;
                         
                        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.createDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.payDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.deliveryDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.confirmDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
 
                        &lt;td&gt;
                            &lt;button oid=${o.id} class=&quot;orderPageCheckOrderItems btn btn-primary btn-xs&quot;&gt;查看详情&lt;/button&gt;
                             
                            &lt;c:if test=&quot;${o.status=='waitDelivery'}&quot;&gt;
                                &lt;a href=&quot;admin_order_delivery?id=${o.id}&quot;&gt;
                                    &lt;button class=&quot;btn btn-primary btn-xs&quot;&gt;发货&lt;/button&gt;
                                &lt;/a&gt;                         
                            &lt;/c:if&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr class=&quot;orderPageOrderItemTR&quot;  oid=${o.id}&gt;
                        &lt;td colspan=&quot;10&quot; align=&quot;center&quot;&gt;
                             
                            &lt;div  class=&quot;orderPageOrderItem&quot;&gt;
                                &lt;table width=&quot;800px&quot; align=&quot;center&quot; class=&quot;orderPageOrderItemTable&quot;&gt;
                                    &lt;c:forEach items=&quot;${o.orderItems}&quot; var=&quot;oi&quot;&gt;
                                        &lt;tr&gt;
                                            &lt;td align=&quot;left&quot;&gt;
                                                &lt;img width=&quot;40px&quot; height=&quot;40px&quot; src=&quot;img/productSingle/${oi.product.firstProductImage.id}.jpg&quot;&gt;
                                            &lt;/td&gt;
                                             
                                            &lt;td&gt;
                                                &lt;a href=&quot;foreproduct?pid=${oi.product.id}&quot;&gt;
                                                    &lt;span&gt;${oi.product.name}&lt;/span&gt;
                                                &lt;/a&gt;                                         
                                            &lt;/td&gt;
                                            &lt;td align=&quot;right&quot;&gt;
                                             
                                                &lt;span class=&quot;text-muted&quot;&gt;${oi.number}个&lt;/span&gt;                                              
                                            &lt;/td&gt;
                                            &lt;td align=&quot;right&quot;&gt;
                                             
                                                &lt;span class=&quot;text-muted&quot;&gt;单价：￥${oi.product.promotePrice}&lt;/span&gt;                                             
                                            &lt;/td&gt;
 
                                        &lt;/tr&gt;
                                    &lt;/c:forEach&gt;
                                 
                                &lt;/table&gt;
                            &lt;/div&gt;
                         
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
     
    &lt;div class=&quot;pageDiv&quot;&gt;
        &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt;
    &lt;/div&gt;
     
&lt;/div&gt;
 
&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;
</code></pre>
<h3 id="步骤-9-查询功能讲解"><a class="header-anchor" href="#步骤-9-查询功能讲解">¶</a>步骤 9 : 查询功能讲解</h3>
<p>访问地址：</p>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/admin_order_list
</code></pre>
<p>即可看到订单查询界面。<br>
admin_order_list 导致OrderServlet.list()方法被调用</p>
<ol>
<li>分页查询订单信息</li>
<li>借助orderItemDAO.fill()方法为这些订单填充上orderItems信息</li>
<li>服务端跳转到admin/listOrder.jsp页面</li>
<li>在listOrder.jsp借助c:forEach把订单集合遍历出来</li>
<li>遍历订单的时候，再把当前订单的orderItem订单项集合遍历出来</li>
</ol>
<p><img src="3842.png" alt=""></p>
<pre><code class="language-java">public String list(HttpServletRequest request, HttpServletResponse response, Page page) {
    List&lt;Order&gt; os = orderDAO.list(page.getStart(),page.getCount());
    orderItemDAO.fill(os);
    int total = orderDAO.getTotal();
    page.setTotal(total);
     
    request.setAttribute(&quot;os&quot;, os);
    request.setAttribute(&quot;page&quot;, page);
     
    return &quot;admin/listOrder.jsp&quot;;
}
</code></pre>
<pre><code class="language-jsp">&lt;c:forEach items=&quot;${os}&quot; var=&quot;o&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;${o.id}&lt;/td&gt;
        &lt;td&gt;${o.statusDesc}&lt;/td&gt;
        &lt;td&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;${o.total}&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/td&gt;
        &lt;td align=&quot;center&quot;&gt;${o.totalNumber}&lt;/td&gt;
        &lt;td align=&quot;center&quot;&gt;${o.user.name}&lt;/td&gt;
         
        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.createDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.payDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.deliveryDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
        &lt;td&gt;&lt;fmt:formatDate value=&quot;${o.confirmDate}&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;
 
        &lt;td&gt;
            &lt;button oid=${o.id} class=&quot;orderPageCheckOrderItems btn btn-primary btn-xs&quot;&gt;查看详情&lt;/button&gt;
             
            &lt;c:if test=&quot;${o.status=='waitDelivery'}&quot;&gt;
                &lt;a href=&quot;admin_order_delivery?id=${o.id}&quot;&gt;
                    &lt;button class=&quot;btn btn-primary btn-xs&quot;&gt;发货&lt;/button&gt;
                &lt;/a&gt;                         
            &lt;/c:if&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr class=&quot;orderPageOrderItemTR&quot;  oid=${o.id}&gt;
        &lt;td colspan=&quot;10&quot; align=&quot;center&quot;&gt;
             
            &lt;div  class=&quot;orderPageOrderItem&quot;&gt;
                &lt;table width=&quot;800px&quot; align=&quot;center&quot; class=&quot;orderPageOrderItemTable&quot;&gt;
                    &lt;c:forEach items=&quot;${o.orderItems}&quot; var=&quot;oi&quot;&gt;
                        &lt;tr&gt;
                            &lt;td align=&quot;left&quot;&gt;
                                &lt;img width=&quot;40px&quot; height=&quot;40px&quot; src=&quot;img/productSingle/${oi.product.firstProductImage.id}.jpg&quot;&gt;
                            &lt;/td&gt;
                             
                            &lt;td&gt;
                                &lt;a href=&quot;foreproduct?pid=${oi.product.id}&quot;&gt;
                                    &lt;span&gt;${oi.product.name}&lt;/span&gt;
                                &lt;/a&gt;                                         
                            &lt;/td&gt;
                            &lt;td align=&quot;right&quot;&gt;
                             
                                &lt;span class=&quot;text-muted&quot;&gt;${oi.number}个&lt;/span&gt;                                              
                            &lt;/td&gt;
                            &lt;td align=&quot;right&quot;&gt;
                             
                                &lt;span class=&quot;text-muted&quot;&gt;单价：￥${oi.product.promotePrice}&lt;/span&gt;                                             
                            &lt;/td&gt;
 
                        &lt;/tr&gt;
                    &lt;/c:forEach&gt;
                 
                &lt;/table&gt;
            &lt;/div&gt;
         
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;
</code></pre>
<h3 id="步骤-10-发货功能讲解"><a class="header-anchor" href="#步骤-10-发货功能讲解">¶</a>步骤 10 : 发货功能讲解</h3>
<p>当订单状态是waitDelivery的时候，就会出现发货按钮</p>
<ol>
<li>发货按钮链接跳转到admin_order_delivery</li>
<li>OrderServlet.delivery()方法被调用<br>
2.1 根据id获取Order对象<br>
2.2 修改发货时间，设置发货状态<br>
2.3 更新到数据库<br>
2.4 客户端跳转到admin_order_list页面</li>
</ol>
<p><img src="3843.png" alt=""></p>
<pre><code class="language-java">public String delivery(HttpServletRequest request, HttpServletResponse response, Page page) {
    int id = Integer.parseInt(request.getParameter(&quot;id&quot;));
    Order o = orderDAO.get(id);
    o.setDeliveryDate(new Date());
    o.setStatus(OrderDAO.waitConfirm);
    orderDAO.update(o);
    return &quot;@admin_order_list&quot;;
}
</code></pre>
<h3 id="步骤-11-增加，修改，删除功能"><a class="header-anchor" href="#步骤-11-增加，修改，删除功能">¶</a>步骤 11 : 增加，修改，删除功能</h3>
<p>订单的增加和删除功能交由前台完成，后台不提供</p>
<h1 id="十二、原型-前端"><a class="header-anchor" href="#十二、原型-前端">¶</a>十二、原型-前端</h1>
<h2 id="1、概述"><a class="header-anchor" href="#1、概述">¶</a>1、概述</h2>
<p>在开发功能之前，都会先有原型界面。 通常原型界面的数据不是真实的，是临时写在页面上，为用户提供一个直观的界面感受的。</p>
<p>原型的目的通常有两个：</p>
<ol>
<li>
<p>用于和客户沟通交流，一图胜千言，哪里可以保留，哪里需要修改，在原型界面的基础上，就可以高效率的沟通了。</p>
</li>
<li>
<p>指导功能开发，有可视的原型界面，开发人员可以更准确的设计系统和功能，同时在设计系统的过程中，又能反过来验证是否支持这些界面上的功能。</p>
</li>
</ol>
<p>本章节开始，列罗出了主要的前端原型界面。 因为是模仿天猫官网，所以这些前端原型本身的设计和开发就有相当的难度， 如何从零开始设计和制作这些前端页面请在[模仿天猫前端教程]中学习，就不在[本天猫整站教程]中展开了。</p>
<p>[本天猫整站教程]中关于前端的关注点，着重落在如何获取服务端的数据，显示在页面上，以及前端页面与服务端的同步/异步数据交互上。</p>
<h3 id="步骤-1-真正开发的时候会直接使用这些前端页面吗？"><a class="header-anchor" href="#步骤-1-真正开发的时候会直接使用这些前端页面吗？">¶</a>步骤 1 : 真正开发的时候会直接使用这些前端页面吗？</h3>
<p>事实上，这些前端页面都是相当复杂的，真正开发的时候，也不会完全在这些页面上进行，而是把一个复杂的前端页面拆成了多个便于维护与理解的小的jsp文件。<br>
比如首页[home.jsp]就是由多个[home.jsp 公共文件]和一个[homePage.jsp]组成。</p>
<p><img src="4003.png" alt=""></p>
<h3 id="步骤-2-homePage-jsp-又由多个子jsp文件组成"><a class="header-anchor" href="#步骤-2-homePage-jsp-又由多个子jsp文件组成">¶</a>步骤 2 : homePage.jsp 又由多个子jsp文件组成</h3>
<p>[homePage.jsp ]又由多个子jsp文件组成，这样每个文件就相对于整篇的前端页面来讲，简单了不少，更加利于理解与消化</p>
<p><img src="4004.png" alt=""></p>
<h3 id="步骤-3-这些前端原型的作用"><a class="header-anchor" href="#步骤-3-这些前端原型的作用">¶</a>步骤 3 : 这些前端原型的作用</h3>
<p>这些前端原型的作用，主要还是用于和客户沟通，让大家对工作的真正状态有一定的模拟。 如果对前端页面本身的布局，样式十分感兴趣，请跳转到[模仿天猫前端教程]</p>
<h2 id="2、首页"><a class="header-anchor" href="#2、首页">¶</a>2、首页</h2>
<p><strong>说明</strong> 这些是前端页面原型的整合代码，在实际开发中是不会像这样把那么多的标签，元素，样式，js放在一个页面里的。 在本教程中会把大的页面拆分成为容易理解，维护的小文件，在后续的章节会讲解到。</p>
<h3 id="步骤-1-效果"><a class="header-anchor" href="#步骤-1-效果">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="3、分类页"><a class="header-anchor" href="#3、分类页">¶</a>3、分类页</h2>
<h3 id="步骤-1-效果-v2"><a class="header-anchor" href="#步骤-1-效果-v2">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="4、产品页面"><a class="header-anchor" href="#4、产品页面">¶</a>4、产品页面</h2>
<h3 id="步骤-1-效果-v3"><a class="header-anchor" href="#步骤-1-效果-v3">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="5、购物车页面"><a class="header-anchor" href="#5、购物车页面">¶</a>5、购物车页面</h2>
<h3 id="步骤-1-效果-v4"><a class="header-anchor" href="#步骤-1-效果-v4">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="6、我的订单页面"><a class="header-anchor" href="#6、我的订单页面">¶</a>6、我的订单页面</h2>
<h3 id="步骤-1-效果-v5"><a class="header-anchor" href="#步骤-1-效果-v5">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="7、结算页面"><a class="header-anchor" href="#7、结算页面">¶</a>7、结算页面</h2>
<h3 id="步骤-1-效果-v6"><a class="header-anchor" href="#步骤-1-效果-v6">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="8、查询结果页"><a class="header-anchor" href="#8、查询结果页">¶</a>8、查询结果页</h2>
<h3 id="步骤-1-效果-v7"><a class="header-anchor" href="#步骤-1-效果-v7">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="9、支付页面"><a class="header-anchor" href="#9、支付页面">¶</a>9、支付页面</h2>
<h3 id="步骤-1-效果-v8"><a class="header-anchor" href="#步骤-1-效果-v8">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="10、支付成功页面"><a class="header-anchor" href="#10、支付成功页面">¶</a>10、支付成功页面</h2>
<h3 id="步骤-1-效果-v9"><a class="header-anchor" href="#步骤-1-效果-v9">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="11、确认收货页面"><a class="header-anchor" href="#11、确认收货页面">¶</a>11、确认收货页面</h2>
<h3 id="步骤-1-效果-v10"><a class="header-anchor" href="#步骤-1-效果-v10">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="12、收货成功页面"><a class="header-anchor" href="#12、收货成功页面">¶</a>12、收货成功页面</h2>
<h3 id="步骤-1-效果-v11"><a class="header-anchor" href="#步骤-1-效果-v11">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="13、评价页面"><a class="header-anchor" href="#13、评价页面">¶</a>13、评价页面</h2>
<h3 id="步骤-1-效果-v12"><a class="header-anchor" href="#步骤-1-效果-v12">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="14、登录页面"><a class="header-anchor" href="#14、登录页面">¶</a>14、登录页面</h2>
<h3 id="步骤-1-效果-v13"><a class="header-anchor" href="#步骤-1-效果-v13">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h1 id="十三、前台-首页"><a class="header-anchor" href="#十三、前台-首页">¶</a>十三、前台-首页</h1>
<h2 id="1、概述-v2"><a class="header-anchor" href="#1、概述-v2">¶</a>1、概述</h2>
<p>前台也包括许多功能， 与[后台-分类管理]类似的，首先把[前台-首页]这个功能单独拿出来，进行精讲。[前台-首页] 消化吸收好之后，再进行其他前台功能的开发。</p>
<ol>
<li>
<p>前台无需登录<br>
从前台模块之间的依赖性，以及开发顺序的合理性来考虑，把前台功能分为了 [无需登录] 即可使用的功能，和[需要登录] 才能访问的功能。 建立在前一步[前台-首页]的基础之上，开始进行一系列的[无需登录]功能开发。</p>
</li>
<li>
<p>前台需要登录<br>
接着是[需要登录的前台功能]。 这部分功能基本上都是和购物相关的。 因此，一开始先把[购物流程] 单独拿出来捋清楚，其中还特别注明了[购物流程环节与表关系]，这样能够更好的建立对前端购物功能的理解。随着这部分功能的开发，就会进入订单生成部分，在此之前，先准备了一个 [订单状态图]，在理解了这个图之后，可以更好的进行订单相关功能的开发。</p>
</li>
</ol>
<h2 id="2、可运行项目"><a class="header-anchor" href="#2、可运行项目">¶</a>2、可运行项目</h2>
<h3 id="步骤-1-先看效果"><a class="header-anchor" href="#步骤-1-先看效果">¶</a>步骤 1 : 先看效果</h3>
<p><img src="3853.png" alt=""></p>
<h3 id="步骤-2-可运行项目"><a class="header-anchor" href="#步骤-2-可运行项目">¶</a>步骤 2 : 可运行项目</h3>
<ol>
<li>
<p>首先下载右边的tmall.rar</p>
</li>
<li>
<p>解压到e:/project/tmall</p>
</li>
<li>
<p>使用下个步骤的[导入SQL语句]</p>
</li>
<li>
<p>然后重启tomcat</p>
</li>
<li>
<p>访问页面</p>
</li>
</ol>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/
</code></pre>
<p><strong>注：</strong><br>
<a href="http://127.0.0.1:8080/tmall/" target="_blank" rel="noopener">http://127.0.0.1:8080/tmall/</a> 跳转到了地址 <a href="http://127.0.0.1:8080/tmall/forehome" target="_blank" rel="noopener">http://127.0.0.1:8080/tmall/forehome</a></p>
<h3 id="步骤-3-导入SQL语句"><a class="header-anchor" href="#步骤-3-导入SQL语句">¶</a>步骤 3 : 导入SQL语句</h3>
<p>tmall.rar只包含了项目必须的代码，但是没有数据，为了看到首页的运行效果，还必须导入数据。</p>
<p>在右侧下载 sql 文件，然后使用如下的 命令行方式导入。如果没有安装mysql,可以参考[安装mysql-server]<br>
<strong>注：</strong> 不要用 navicat,mysql-front 等工具导入，因为数据量大，这些工具处理不了，会报奇奇怪怪的错误。</p>
<pre><code class="language-mysql">&quot;D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe&quot; -u root -padmin --default-character-set=utf8 tmall &lt; d:\tmall.sql
</code></pre>
<p><strong>注:</strong> D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe 这个路径是我的mysql.exe的路径，根据实际情况换成自己的mysql运行路径<br>
<strong>注:</strong> tmall.sql下载后，放在 d:\tmall.sql 这个位置</p>
<h3 id="步骤-4-限制性"><a class="header-anchor" href="#步骤-4-限制性">¶</a>步骤 4 : 限制性</h3>
<p>为了正常显示这个首页效果，包含了17种分类，每种分类下有5种商品，每个商品下大约又有大小不同，单个和详情总供10张左右图片。这样累计下来图片文件就有1777张。</p>
<p>仅仅每个分类下5种商品，项目文件压缩包tmall.rar的大小就是200多M了，完整的[模仿天猫]下每个分类下平均有60个产品，总计2个G左右，考虑到学习需要下那么大的文件很不方便，就不提供了。</p>
<p>因为每个分类下只有5种产品，所有在推荐产品列表里看到的数据就有限，只能看到5种，而不是[模仿天猫]上看到的比较丰富的内容。</p>
<p>如果为了看到更多的内容，需要自己在后台手动增加新的产品</p>
<p><img src="3854.png" alt=""></p>
<h2 id="3、静态资源"><a class="header-anchor" href="#3、静态资源">¶</a>3、静态资源</h2>
<h3 id="步骤-1-图片资源-site目录"><a class="header-anchor" href="#步骤-1-图片资源-site目录">¶</a>步骤 1 : 图片资源-site目录</h3>
<p>和[分类管理中讲到的图片资源]一样，在img目录下的site目录放着所有要用到的静态图片，如猫耳朵什么的</p>
<p><img src="3855.png" alt=""></p>
<h3 id="步骤-2-图片资源-轮播图片"><a class="header-anchor" href="#步骤-2-图片资源-轮播图片">¶</a>步骤 2 : 图片资源-轮播图片</h3>
<p>除了[图片资源-site目录]之外，还有轮播用的图片资源</p>
<p><img src="3858.png" alt=""></p>
<h3 id="步骤-3-图片资源-分类图片"><a class="header-anchor" href="#步骤-3-图片资源-分类图片">¶</a>步骤 3 : 图片资源-分类图片</h3>
<p><img src="3859.png" alt=""></p>
<h3 id="步骤-4-图片资源-产品图片"><a class="header-anchor" href="#步骤-4-图片资源-产品图片">¶</a>步骤 4 : 图片资源-产品图片</h3>
<p>产品对应的图片有4个目录，分别是</p>
<ol>
<li>productSingle<br>
产品正常尺寸图片</li>
<li>productSingle_middle<br>
产品中等尺寸图片</li>
<li>productSingle_small<br>
产品小号尺寸图片</li>
<li>productDetail<br>
产品详情图片</li>
</ol>
<p><img src="3860.png" alt=""></p>
<h3 id="步骤-5-css"><a class="header-anchor" href="#步骤-5-css">¶</a>步骤 5 : css</h3>
<p>在css目录里有3个子目录</p>
<ol>
<li>back<br>
这个目录里有一个style.css,这是后台界面用到的样式</li>
<li>bootstrap<br>
这里存放的是bootstrap的css样式文件</li>
<li>fore<br>
这个目录里也有一个style.css,这是前台界面用到的样式</li>
</ol>
<p><img src="3856.png" alt=""></p>
<h3 id="步骤-6-js"><a class="header-anchor" href="#步骤-6-js">¶</a>步骤 6 : js</h3>
<p>js目录下有两个子目录<br>
/bootstrap<br>
bootstrap用到的js文件<br>
/jquery<br>
jquery用到的js文件</p>
<p><img src="3857.png" alt=""></p>
<h3 id="步骤-7-img-rar"><a class="header-anchor" href="#步骤-7-img-rar">¶</a>步骤 7 : img.rar</h3>
<p>这1777张产品图片就统一放在右侧的img.rar下载，后续学习要用到的时候，就在这里下载.</p>
<p>因为图片很多，在后续学习的每个知识点里的可运行项目下载里就不再提供图片下载了，否则每个都需要200M大小，给学习带来不便。</p>
<h2 id="4、FILTER配合SERVLET"><a class="header-anchor" href="#4、FILTER配合SERVLET">¶</a>4、FILTER配合SERVLET</h2>
<h3 id="步骤-1-一个路径对应一个Servlet的弊端"><a class="header-anchor" href="#步骤-1-一个路径对应一个Servlet的弊端">¶</a>步骤 1 : 一个路径对应一个Servlet的弊端</h3>
<p>与后台管理类似的，前台也存在按照传统方式一个路径对应一个Servlet的冗长的web.xml配置以及大量servlet类的问题。</p>
<p>与后台管理同样的，采用[Filter配合Servlet的设计模式]来大大简化这么一个配置问题。</p>
<h3 id="步骤-2-简化之后的效果"><a class="header-anchor" href="#步骤-2-简化之后的效果">¶</a>步骤 2 : 简化之后的效果</h3>
<p>采用了[Filter配合Servlet的设计模式]之后，web.xml配置文件里对于前端值需要一个配置：</p>
<pre><code class="language-xml">  &lt;servlet&gt;
        &lt;servlet-name&gt;ForeServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;tmall.servlet.ForeServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
 
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ForeServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/foreServlet&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</code></pre>
<p>在这么一个ForeServlet类里，就提供了所有前端需要用到的业务方法</p>
<p><img src="3863.png" alt=""></p>
<h3 id="步骤-3-原理流程图"><a class="header-anchor" href="#步骤-3-原理流程图">¶</a>步骤 3 : 原理流程图</h3>
<p>那么是如何做到一个ForeServlet类，就能完成本来需要n个Servlet类才能完成的功能的呢？</p>
<p>让我们借助流程图来分析，为什么访问forehome的时候，ForeServlet的home()方法会被调用</p>
<p>1.现在访问路径是 <a href="http://127.0.0.1:8080/tmall/forehome" target="_blank" rel="noopener">http://127.0.0.1:8080/tmall/forehome</a><br>
2. 过滤器ForeServletFilter进行拦截，判断访问的地址是否以/fore开头,并且不以/foreServlet开头. 为什么要排除/foreServlet呢？ 因为/foreServlet是web.xml中实际配置的Servlet，filter需要对这个路径访问放行。 各位可以试试不要这句话会有什么效果<br>
3. 如果是，那么做如下操作<br>
3.1 取出fore之后的值home<br>
3.2 服务端跳转到foreServlet，并且把home这个值传递过去<br>
4. foreServlet 继承了BaseForeServlet，其service方法会被调用。 在service中，借助反射技术，根据传递过来的值 home，调用对应foreServlet 中的方法home()<br>
5. 这样就实现了当访问的路径是 forehome的时候，就会调用foreServlet.home()方法这样一个效果</p>
<p>换句话说:<br>
如果访问的路径是forecategory，就会调用foreServlet.category()方法<br>
如果访问的路径是forecart，就会调用foreServlet.cart()方法<br>
如果访问的路径是foresearch，就会调用foreServlet.search()方法<br>
。。。</p>
<p>如此这般，一个foreServlet类，就完成了本来需要n个Servlet类才能完成的功能。</p>
<p><img src="3864.png" alt=""></p>
<h3 id="步骤-4-代码讲解-ForeServletFilter"><a class="header-anchor" href="#步骤-4-代码讲解-ForeServletFilter">¶</a>步骤 4 : 代码讲解 - ForeServletFilter</h3>
<p>那么ForeServletFilter类到底是如何工作的呢？ 接下来我们此类进行代码讲解。</p>
<ol>
<li>首先在web.xml配置文件中，让所有的请求都会经过ForeServletFilter</li>
</ol>
<pre><code class="language-xml">&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>
<ol start="2">
<li>还是假设访问的路径是：</li>
</ol>
<pre><code class="language-http">http://127.0.0.1:8080/tmall/forehome
</code></pre>
<ol start="3">
<li>在ForeServletFilter 中通过request.getRequestURI()取出访问的uri: /tmall/forehome</li>
<li>然后截掉/tmall，得到路径/forehome</li>
<li>判断其是否以/fore开头,并且不是/foreServlet开头</li>
<li>如果是，取出fore之后的值home，并且服务端跳转到foreServlet</li>
<li>在跳转之前，还取出了home字符串，然后通过request.setAttribute的方式，借助服务端跳转，传递到foreServlet里去</li>
</ol>
<p><strong>注：</strong> 关于36-44行，是用于当用户登录之后，从session中获取用户对象，并根据这个用户对象获取购物车中的物品总数。 关于这块内容，在后续讲到页头信息展示的时候，会再详细讲解，这里一笔带过。</p>
<p><strong>注：</strong> 关于48-52行，是用于在[simpleSearch.jsp] 简单搜索栏下显示分类链接用的，学到那个地方的时候，会再拿出来讲解</p>
<pre><code class="language-java">package tmall.filter;
 
import java.io.IOException;
import java.util.List;
 
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import org.apache.commons.lang.StringUtils;
 
import tmall.bean.Category;
import tmall.bean.OrderItem;
import tmall.bean.User;
import tmall.dao.CategoryDAO;
import tmall.dao.OrderItemDAO;
 
public class ForeServletFilter implements Filter{
     
    @Override
    public void destroy() {
         
    }
 
    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain)
            throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) res;
        String contextPath=request.getServletContext().getContextPath();
        request.getServletContext().setAttribute(&quot;contextPath&quot;, contextPath);
         
        User user =(User) request.getSession().getAttribute(&quot;user&quot;);
        int cartTotalItemNumber= 0;
        if(null!=user){
            List&lt;OrderItem&gt; ois = new OrderItemDAO().listByUser(user.getId());
            for (OrderItem oi : ois) {
                cartTotalItemNumber+=oi.getNumber();
            }
        }
        request.setAttribute(&quot;cartTotalItemNumber&quot;, cartTotalItemNumber);
         
        List&lt;Category&gt; cs=(List&lt;Category&gt;) request.getAttribute(&quot;cs&quot;);
        if(null==cs){
            cs=new CategoryDAO().list();
            request.setAttribute(&quot;cs&quot;, cs);        
        }
         
        String uri = request.getRequestURI();
        uri =StringUtils.remove(uri, contextPath);
        if(uri.startsWith(&quot;/fore&quot;)&amp;&amp;!uri.startsWith(&quot;/foreServlet&quot;)){
            String method = StringUtils.substringAfterLast(uri,&quot;/fore&quot; );
            request.setAttribute(&quot;method&quot;, method);
            req.getRequestDispatcher(&quot;/foreServlet&quot;).forward(request, response);
            return;
        }
         
        chain.doFilter(request, response);
    }
 
    @Override
    public void init(FilterConfig arg0) throws ServletException {
         
    }
     
}
</code></pre>
<h3 id="步骤-5-代码讲解-ForeServlet和BaseForeServlet"><a class="header-anchor" href="#步骤-5-代码讲解-ForeServlet和BaseForeServlet">¶</a>步骤 5 : 代码讲解 - ForeServlet和BaseForeServlet</h3>
<p>接着流程就到了foreServlet这里。<br>
根据web.xml中的配置</p>
<pre><code class="language-xml">&lt;servlet-name&gt;ForeServlet&lt;/servlet-name&gt;
&lt;url-pattern&gt;/foreServlet&lt;/url-pattern&gt;
</code></pre>
<p>服务端跳转/foreServlet就到了ForeServlet这个类里</p>
<ol>
<li>首先ForeServlet继承了BaseForeServlet，而BaseForeServlet又继承了HttpServlet</li>
<li>服务端跳转过来之后，会访问ForeServlet的doGet()或者doPost()方法</li>
<li>在访问doGet()或者doPost()之前，会访问service()方法</li>
<li>BaseForeServlet中重写了service() 方法，所以流程就进入到了service()中</li>
<li>在service()方法中有三块内容<br>
5.1 第一块是获取分页信息<br>
5.2 第二块是根据反射访问对应的方法<br>
5.3 第三块是根据对应方法的返回值，进行服务端跳转、客户端跳转、或者直接输出字符串。</li>
<li>第一块：分页信息实际上在前台并没有用到，目前前台并没有提供分页功能。</li>
<li>第二块：取到从ForeServletFilter中request.setAttribute()传递过来的值 home，<br>
根据这个值home，借助反射机制调用ForeServlet类中的home()方法<br>
这样就达到了ForeServlet.home()方法被调用的效果</li>
<li>第三块： 判断根据home的返回值&quot;home.jsp&quot;，即没有&quot;%“开头，也没有”@&quot;,那么就调用request.getRequestDispatcher(redirect).forward(request, response);进行服务端跳转到 “home.jsp” 页面</li>
</ol>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Category;
import tmall.dao.CategoryDAO;
import tmall.dao.ProductDAO;
import tmall.util.Page;
 
public class ForeServlet extends BaseForeServlet {
    public String home(HttpServletRequest request, HttpServletResponse response, Page page) {
        List&lt;Category&gt; cs= new CategoryDAO().list();
        new ProductDAO().fill(cs);
        new ProductDAO().fillByRow(cs);
        request.setAttribute(&quot;cs&quot;, cs);
        return &quot;home.jsp&quot;;
    }
}
</code></pre>
<pre><code class="language-java">package tmall.servlet;
 
import java.lang.reflect.Method;
 
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.dao.CategoryDAO;
import tmall.dao.OrderDAO;
import tmall.dao.OrderItemDAO;
import tmall.dao.ProductDAO;
import tmall.dao.ProductImageDAO;
import tmall.dao.PropertyDAO;
import tmall.dao.PropertyValueDAO;
import tmall.dao.ReviewDAO;
import tmall.dao.UserDAO;
import tmall.util.Page;
 
public class BaseForeServlet extends HttpServlet{
 
    protected CategoryDAO categoryDAO = new CategoryDAO();
    protected OrderDAO orderDAO = new OrderDAO();
    protected OrderItemDAO orderItemDAO = new OrderItemDAO();
    protected ProductDAO productDAO = new ProductDAO();
    protected ProductImageDAO productImageDAO = new ProductImageDAO();
    protected PropertyDAO propertyDAO = new PropertyDAO();
    protected PropertyValueDAO propertyValueDAO = new PropertyValueDAO();
    protected ReviewDAO reviewDAO = new ReviewDAO();
    protected UserDAO userDAO = new UserDAO();
     
    public void service(HttpServletRequest request, HttpServletResponse response) {
        try {
             
            int start= 0;
            int count = 10;
            try {
                start = Integer.parseInt(request.getParameter(&quot;page.start&quot;));
            } catch (Exception e) {
                 
            }
             
            try {
                count = Integer.parseInt(request.getParameter(&quot;page.count&quot;));
            } catch (Exception e) {
            }
             
            Page page = new Page(start,count);
             
            String method = (String) request.getAttribute(&quot;method&quot;);
 
            Method m = this.getClass().getMethod(method, javax.servlet.http.HttpServletRequest.class,
                    javax.servlet.http.HttpServletResponse.class,Page.class);
             
            String redirect = m.invoke(this,request, response,page).toString();
             
            if(redirect.startsWith(&quot;@&quot;))
                response.sendRedirect(redirect.substring(1));
            else if(redirect.startsWith(&quot;%&quot;))
                response.getWriter().print(redirect.substring(1));
            else
                request.getRequestDispatcher(redirect).forward(request, response);
             
        } catch (Exception e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
            throw new RuntimeException(e);
        }
    }
}
</code></pre>
<pre><code class="language-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;ForeServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;tmall.servlet.ForeServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
 
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ForeServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/foreServlet&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>
<h3 id="步骤-6-一个Servlet类就能满足所有前端业务要求"><a class="header-anchor" href="#步骤-6-一个Servlet类就能满足所有前端业务要求">¶</a>步骤 6 : 一个Servlet类就能满足所有前端业务要求</h3>
<p>通过这样一种模式，一个Servlet类就能满足所有前端业务要求，这就为代码的维护带来的极大的便利性</p>
<ol>
<li>不需要写大量的Servlet类</li>
<li>不需要在web.xml中维护大量的映射关系</li>
<li>当有扩展需求的时候，在ForeServlet中增加一个方法即可。</li>
</ol>
<p><img src="3867.png" alt=""></p>
<h2 id="5、HOME方法"><a class="header-anchor" href="#5、HOME方法">¶</a>5、HOME方法</h2>
<h3 id="步骤-1-MVC-设计思想"><a class="header-anchor" href="#步骤-1-MVC-设计思想">¶</a>步骤 1 : MVC 设计思想</h3>
<p>根据 [MVC设计模式]的思想，做J2EE web应用，从MVC的角度来看，就是把不同的数据显示在不同的页面上。</p>
<p>数据就是 <strong>模型</strong> ( bean, dao )<br>
页面就是 <strong>视图</strong> ( jsp )<br>
控制不同的模型显示在不同的视图上，这件事，就是由控制器来完成 ( servlet )</p>
<p>所以分类管理，从MVC的角度来看，就是把多条分类Category数据放在一个集合里， 让listCategory.jsp 这个视图去显示出来。</p>
<p><img src="3868.png" alt=""></p>
<h3 id="步骤-2-首页需要什么数据？"><a class="header-anchor" href="#步骤-2-首页需要什么数据？">¶</a>步骤 2 : 首页需要什么数据？</h3>
<p>那么首页需要什么数据呢？ 从 [首页展示需求分析]上来看：</p>
<ol>
<li>
<p>在横向导航栏上提供4个分类连接</p>
</li>
<li>
<p>在纵向导航栏上提供全部17个分类连接</p>
</li>
<li>
<p>当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</p>
</li>
<li>
<p>按照每种分类显示5个商品的方式，显示所有17种分类</p>
</li>
</ol>
<h3 id="步骤-3-home方法"><a class="header-anchor" href="#步骤-3-home方法">¶</a>步骤 3 : home方法</h3>
<p>为了提供[首页需要的数据]，home()方法进行了如下操作：<br>
获取所有17种分类</p>
<pre><code class="language-java">List&lt;Category&gt; cs= new CategoryDAO().list();
</code></pre>
<p>为这些分类填充<strong>产品集合</strong>，即为每个Category对象，设置products属性</p>
<pre><code class="language-java">new ProductDAO().fill(cs);
</code></pre>
<p>为这些分类填充<strong>推荐产品集合</strong>，即为每个Category对象，设置productsByRow属性</p>
<pre><code class="language-java">new ProductDAO().fillByRow(cs);
</code></pre>
<p>把分类集合设置在request的&quot;cs&quot;属性上</p>
<pre><code class="language-java">request.setAttribute(&quot;cs&quot;, cs);
</code></pre>
<p>服务端跳转到home.jsp</p>
<pre><code class="language-java">return &quot;home.jsp&quot;;
</code></pre>
<p>参考：[Category] ，[ProductDAO非CRUD方法]</p>
<pre><code class="language-java">package tmall.servlet;
 
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
 
import tmall.bean.Category;
import tmall.dao.CategoryDAO;
import tmall.dao.ProductDAO;
import tmall.util.Page;
 
public class ForeServlet extends BaseForeServlet {
    public String home(HttpServletRequest request, HttpServletResponse response, Page page) {
        List&lt;Category&gt; cs= new CategoryDAO().list();
        new ProductDAO().fill(cs);
        new ProductDAO().fillByRow(cs);
        request.setAttribute(&quot;cs&quot;, cs);
        return &quot;home.jsp&quot;;
    }
}
</code></pre>
<h2 id="6、HOME-JSP"><a class="header-anchor" href="#6、HOME-JSP">¶</a>6、HOME.JSP</h2>
<h3 id="步骤-1-前台页面的特点"><a class="header-anchor" href="#步骤-1-前台页面的特点">¶</a>步骤 1 : 前台页面的特点</h3>
<p>观察[模仿天猫前端]，可以发现前台页面有如下特点：</p>
<ol>
<li>有共同的置顶导航</li>
<li>有共同的搜索栏</li>
<li>有共同的页脚</li>
</ol>
<p>根据这样的特点，在设计前台jsp页面的时候，就制作了很多公共页面，其他前台页面就共享这些公共页面，使得开发和维护成本降低不少</p>
<h3 id="步骤-2-home-jsp-所包含页面"><a class="header-anchor" href="#步骤-2-home-jsp-所包含页面">¶</a>步骤 2 : home.jsp 所包含页面</h3>
<p>根据前台页面的特点，我们把home.jsp设计成如代码所示。</p>
<ol>
<li>header.jsp<br>
引入标准标签库，js,css，自定义javascript函数等</li>
<li>top.jsp<br>
置顶导航</li>
<li>search.jsp<br>
搜索栏</li>
<li>homePage.jsp<br>
首页业务页面</li>
<li>footer.jsp<br>
页脚</li>
</ol>
<p><img src="3872.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
&lt;%@include file=&quot;include/header.jsp&quot;%&gt;
&lt;%@include file=&quot;include/top.jsp&quot;%&gt;
&lt;%@include file=&quot;include/search.jsp&quot;%&gt;
&lt;%@include file=&quot;include/home/homePage.jsp&quot;%&gt;
&lt;%@include file=&quot;include/footer.jsp&quot;%&gt;   
    
</code></pre>
<h3 id="步骤-3-header-jsp"><a class="header-anchor" href="#步骤-3-header-jsp">¶</a>步骤 3 : header.jsp</h3>
<p>header.jsp 做了如下工作</p>
<ol>
<li>声明为html5格式</li>
</ol>
<pre><code class="language-java">&lt;!DOCTYPE html&gt; 
</code></pre>
<p>2.让浏览器以UTF显示中文，本页面的中文文字采用UTF-8编码，启动EL表达式</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
	pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
</code></pre>
<ol start="3">
<li>引入标准标签库</li>
</ol>
<pre><code class="language-jsp">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix='fmt' %&gt;
&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt; 
</code></pre>
<p>c通常用于条件判断和遍历<br>
fmt用于格式化日期和货币<br>
fn用于校验长度<br>
更多的关于JSTL的查看[这里]</p>
<ol start="4">
<li>引入bootstrap和jquery</li>
</ol>
<pre><code class="language-jsp">&lt;script src=&quot;js/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;link href=&quot;css/bootstrap/3.3.6/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;script src=&quot;js/bootstrap/3.3.6/bootstrap.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<ol start="5">
<li>自定义前端样式</li>
</ol>
<pre><code class="language-jsp">&lt;link href=&quot;css/fore/style.css&quot; rel=&quot;stylesheet&quot;&gt;
</code></pre>
<p>除了轮播和图标，前端几乎没用Bootstrap中的样式，所有的自定义样式都在这个文件里。</p>
<ol start="6">
<li>各种自定义函数和事件监听。</li>
</ol>
<p>这些内容在[模仿天猫前端教程]中详细讲解，本项目专注于服务端的内容，就不一一展开了</p>
<pre><code class="language-jsp">&lt;!DOCTYPE html&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix='fmt' %&gt;
&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt;
 
&lt;html&gt;
 
&lt;head&gt;
    &lt;script src=&quot;js/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;link href=&quot;css/bootstrap/3.3.6/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;script src=&quot;js/bootstrap/3.3.6/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;link href=&quot;css/fore/style.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;script&gt;
function formatMoney(num){
    num = num.toString().replace(/\$|\,/g,''); 
    if(isNaN(num)) 
        num = &quot;0&quot;; 
    sign = (num == (num = Math.abs(num))); 
    num = Math.floor(num*100+0.50000000001); 
    cents = num%100; 
    num = Math.floor(num/100).toString(); 
    if(cents&lt;10) 
    cents = &quot;0&quot; + cents; 
    for (var i = 0; i &lt; Math.floor((num.length-(1+i))/3); i++) 
    num = num.substring(0,num.length-(4*i+3))+','+ 
    num.substring(num.length-(4*i+3)); 
    return (((sign)?'':'-') + num + '.' + cents); 
}
function checkEmpty(id, name){
    var value = $(&quot;#&quot;+id).val();
    if(value.length==0){
         
        $(&quot;#&quot;+id)[0].focus();
        return false;
    }
    return true;
}
 
$(function(){
 
    $(&quot;a.productDetailTopReviewLink&quot;).click(function(){
        $(&quot;div.productReviewDiv&quot;).show();
        $(&quot;div.productDetailDiv&quot;).hide();
    });
    $(&quot;a.productReviewTopPartSelectedLink&quot;).click(function(){
        $(&quot;div.productReviewDiv&quot;).hide();
        $(&quot;div.productDetailDiv&quot;).show();      
    });
     
    $(&quot;span.leaveMessageTextareaSpan&quot;).hide();
    $(&quot;img.leaveMessageImg&quot;).click(function(){
         
        $(this).hide();
        $(&quot;span.leaveMessageTextareaSpan&quot;).show();
        $(&quot;div.orderItemSumDiv&quot;).css(&quot;height&quot;,&quot;100px&quot;);
    });
     
    $(&quot;div#footer a[href$=#nowhere]&quot;).click(function(){
        alert(&quot;模仿天猫的连接，并没有跳转到实际的页面&quot;);
    });
     
    $(&quot;a.wangwanglink&quot;).click(function(){
        alert(&quot;模仿旺旺的图标，并不会打开旺旺&quot;);
    });
    $(&quot;a.notImplementLink&quot;).click(function(){
        alert(&quot;这个功能没做，蛤蛤~&quot;);
    });
     
});
 
&lt;/script&gt;
&lt;/head&gt;
 
&lt;body&gt;
</code></pre>
<h3 id="步骤-4-top-jsp"><a class="header-anchor" href="#步骤-4-top-jsp">¶</a>步骤 4 : top.jsp</h3>
<p>置顶导航页面<br>
这里会根据用户是否登录，决定是否显示退出按钮，或者登录注册按钮，以及购物车中的商品数量</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;nav class=&quot;top &quot;&gt;
        &lt;a href=&quot;${contextPath}&quot;&gt;
            &lt;span style=&quot;color:#C40000;margin:0px&quot; class=&quot; glyphicon glyphicon-home redColor&quot;&gt;&lt;/span&gt;
            天猫首页
        &lt;/a&gt; 
         
        &lt;span&gt;喵，欢迎来天猫&lt;/span&gt;
         
        &lt;c:if test=&quot;${!empty user}&quot;&gt;
            &lt;a href=&quot;login.jsp&quot;&gt;${user.name}&lt;/a&gt;
            &lt;a href=&quot;forelogout&quot;&gt;退出&lt;/a&gt;    
        &lt;/c:if&gt;
         
        &lt;c:if test=&quot;${empty user}&quot;&gt;
            &lt;a href=&quot;login.jsp&quot;&gt;请登录&lt;/a&gt;
            &lt;a href=&quot;register.jsp&quot;&gt;免费注册&lt;/a&gt;    
        &lt;/c:if&gt;
 
        &lt;span class=&quot;pull-right&quot;&gt;
            &lt;a href=&quot;forebought&quot;&gt;我的订单&lt;/a&gt;
            &lt;a href=&quot;forecart&quot;&gt;
            &lt;span style=&quot;color:#C40000;margin:0px&quot; class=&quot; glyphicon glyphicon-shopping-cart redColor&quot;&gt;&lt;/span&gt;
            购物车&lt;strong&gt;${cartTotalItemNumber}&lt;/strong&gt;件&lt;/a&gt;      
        &lt;/span&gt;
         
&lt;/nav&gt;
</code></pre>
<h3 id="步骤-5-search-jsp"><a class="header-anchor" href="#步骤-5-search-jsp">¶</a>步骤 5 : search.jsp</h3>
<p>这里会从request的属性&quot;cs&quot; 中获取到分类集合，并取第5个到第8个，一共4个来显示。</p>
<p><img src="3878.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
    &lt;a href=&quot;${contextPath}&quot;&gt;
        &lt;img id=&quot;logo&quot; src=&quot;img/site/logo.gif&quot; class=&quot;logo&quot;&gt;
    &lt;/a&gt;
     
    &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt;
        &lt;div class=&quot;searchDiv&quot;&gt;
            &lt;input name=&quot;keyword&quot; type=&quot;text&quot; placeholder=&quot;时尚男鞋  太阳镜 &quot;&gt;
            &lt;button  type=&quot;submit&quot; class=&quot;searchButton&quot;&gt;搜索&lt;/button&gt;
            &lt;div class=&quot;searchBelow&quot;&gt;
                &lt;c:forEach items=&quot;${cs}&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt;
                    &lt;c:if test=&quot;${st.count&gt;=5 and st.count&lt;=8}&quot;&gt;
                        &lt;span&gt;
                            &lt;a href=&quot;forecategory?cid=${c.id}&quot;&gt;
                                ${c.name}
                            &lt;/a&gt;
                            &lt;c:if test=&quot;${st.count!=8}&quot;&gt;             
                                &lt;span&gt;|&lt;/span&gt;             
                            &lt;/c:if&gt;
                        &lt;/span&gt;          
                    &lt;/c:if&gt;
                &lt;/c:forEach&gt;     
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/form&gt;  
</code></pre>
<h3 id="步骤-6-homePage-jsp"><a class="header-anchor" href="#步骤-6-homePage-jsp">¶</a>步骤 6 : homePage.jsp</h3>
<p>这是首页业务页面，将在[homePage.jsp]中详细讲解，在此就不展开了。</p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;title&gt;模仿天猫官网&lt;/title&gt;
 
&lt;div class=&quot;homepageDiv&quot;&gt;
    &lt;%@include file=&quot;categoryAndcarousel.jsp&quot;%&gt;
    &lt;%@include file=&quot;homepageCategoryProducts.jsp&quot;%&gt; 
&lt;/div&gt;
</code></pre>
<h3 id="步骤-7-footer-jsp"><a class="header-anchor" href="#步骤-7-footer-jsp">¶</a>步骤 7 : footer.jsp</h3>
<p>页脚部分,除了显示页脚的静态信息外，还包含了modal.jsp<br>
这个modal.jsp里提供了两个模态窗口</p>
<ol>
<li>登录模态窗口<br>
当用户在未登录状态，于产品页点击购买的时候会弹出</li>
<li>删除模态窗口<br>
当用户在我的订单页面,和购物车页面进行删除操作的时候，就会弹出模态删除窗口。</li>
</ol>
<p><img src="3880.png" alt=""></p>
<pre><code class="language-jsp">//footer.jsp
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;%@include file=&quot;modal.jsp&quot; %&gt;
 
&lt;div id=&quot;footer&quot;  class=&quot;footer&quot; style=&quot;display: block;&quot;&gt;
     
    &lt;div id=&quot;footer_ensure&quot; class=&quot;footer_ensure&quot;&gt;
            &lt;a href=&quot;#nowhere&quot;&gt;
                &lt;img src=&quot;img/site/ensure.png&quot;&gt;
            &lt;/a&gt;
    &lt;/div&gt;
     
    &lt;div id=&quot;footer_desc&quot; class=&quot;footer_desc&quot;&gt;
            &lt;div class=&quot;descColumn&quot;&gt;
                &lt;span class=&quot;descColumnTitle&quot;&gt;购物指南&lt;/span&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;免费注册&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;开通支付宝&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;支付宝充值&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;descColumn&quot;&gt;
                &lt;span class=&quot;descColumnTitle&quot;&gt;天猫保障&lt;/span&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;发票保障&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;售后规则&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;缺货赔付&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;descColumn&quot;&gt;
                &lt;span class=&quot;descColumnTitle&quot;&gt;支付方式&lt;/span&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;快捷支付&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;信用卡&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;蚂蚁花呗&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;货到付款&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;descColumn&quot;&gt;
                &lt;span class=&quot;descColumnTitle&quot;&gt;商家服务&lt;/span&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;商家入驻&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;商家中心&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;天猫智库&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;天猫规则&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;物流服务&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;喵言喵语&lt;/a&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;运营服务&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;descColumn&quot;&gt;
                &lt;span class=&quot;descColumnTitle&quot;&gt;手机天猫&lt;/span&gt;
                &lt;a href=&quot;#nowhere&quot; &gt;&lt;img src=&quot;img/site/ma.png&quot;&gt;&lt;/a&gt;
            &lt;/div&gt;
             
    &lt;/div&gt;
     
    &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
     
    &lt;img id=&quot;cateye&quot; class=&quot;cateye&quot; src=&quot;img/site/cateye.png&quot;&gt;
     
    &lt;div id=&quot;copyright&quot; class=&quot;copyright&quot;&gt;
        &lt;div class=&quot;white_link&quot; &gt;
            &lt;a href=&quot;#nowhere&quot; &gt;关于天猫&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt; 帮助中心&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;开放平台&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  诚聘英才&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;联系我们&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;网站合作&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;法律声明&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;知识产权&lt;/a&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  廉正举报    &lt;/a&gt;
        &lt;/div&gt;
        &lt;div class=&quot;white_link&quot; &gt;
            &lt;a href=&quot;#nowhere&quot; &gt; 阿里巴巴集团&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt; 淘宝网&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;天猫 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  聚划算&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;全球速卖通&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;阿里巴巴国际交易市场&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;1688&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;阿里妈妈&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  阿里旅行·去啊 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  阿里云计算   &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  阿里通信    &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  YunOS   &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  阿里旅行·去啊 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;   万网 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  高德  &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt; 优视   &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  友盟  &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  虾米  &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  天天动听    &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  来往  &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  钉钉  &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt;
            &lt;a href=&quot;#nowhere&quot; &gt;  支付宝         &lt;/a&gt;
        &lt;/div&gt;
     
        &lt;div class=&quot;license&quot;&gt;
            &lt;span&gt;增值电信业务经营许可证： 浙B2-20110446&lt;/span&gt;
            &lt;span&gt;网络文化经营许可证：浙网文[2015]0295-065号&lt;/span&gt;
            &lt;span&gt;互联网医疗保健信息服务 审核同意书 浙卫网审【2014】6号 &lt;/span&gt;
            &lt;span&gt;互联网药品信息服务资质证书编号：浙-（经营性）-2012-0005&lt;/span&gt;
            &lt;div class=&quot;copyRightYear&quot;&gt;© 2003-2016 TMALL.COM 版权所有&lt;/div&gt;
            &lt;div&gt;
                &lt;img src=&quot;img/site/copyRight1.jpg&quot;&gt;
                &lt;img src=&quot;img/site/copyRight2.jpg&quot;&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="language-jsp">//modal.jsp
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;div class=&quot;modal &quot; id=&quot;loginModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt;
    &lt;div class=&quot;modal-dialog loginDivInProductPageModalDiv&quot;&gt;
            &lt;div class=&quot;modal-content&quot;&gt;
                    &lt;div class=&quot;loginDivInProductPage&quot;&gt;
                        &lt;div class=&quot;loginErrorMessageDiv&quot;&gt;
                            &lt;div class=&quot;alert alert-danger&quot; &gt;
                              &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;
                                &lt;span class=&quot;errorMessage&quot;&gt;&lt;/span&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                             
                        &lt;div class=&quot;login_acount_text&quot;&gt;账户登录&lt;/div&gt;
                        &lt;div class=&quot;loginInput &quot; &gt;
                            &lt;span class=&quot;loginInputIcon &quot;&gt;
                                &lt;span class=&quot; glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;
                            &lt;/span&gt;
                            &lt;input id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;手机/会员名/邮箱&quot; type=&quot;text&quot;&gt;        
                        &lt;/div&gt;
                         
                        &lt;div class=&quot;loginInput &quot; &gt;
                            &lt;span class=&quot;loginInputIcon &quot;&gt;
                                &lt;span class=&quot; glyphicon glyphicon-lock&quot;&gt;&lt;/span&gt;
                            &lt;/span&gt;
                            &lt;input id=&quot;password&quot; name=&quot;password&quot;  type=&quot;password&quot; placeholder=&quot;密码&quot; type=&quot;text&quot;&gt;          
                        &lt;/div&gt;
                                    &lt;span class=&quot;text-danger&quot;&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt;
                        &lt;div&gt;
                            &lt;a href=&quot;#nowhere&quot;&gt;忘记登录密码&lt;/a&gt;
                            &lt;a href=&quot;register.jsp&quot; class=&quot;pull-right&quot;&gt;免费注册&lt;/a&gt;
                        &lt;/div&gt;
                        &lt;div style=&quot;margin-top:20px&quot;&gt;
                            &lt;button class=&quot;btn btn-block redButton loginSubmitButton&quot; type=&quot;submit&quot;&gt;登录&lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;   
          &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
 
&lt;div class=&quot;modal&quot; id=&quot;deleteConfirmModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt;
    &lt;div class=&quot;modal-dialog deleteConfirmModalDiv&quot;&gt;
       &lt;div class=&quot;modal-content&quot;&gt;
          &lt;div class=&quot;modal-header&quot;&gt;
            &lt;button data-dismiss=&quot;modal&quot; class=&quot;close&quot; type=&quot;button&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Close&lt;/span&gt;&lt;/button&gt;
            &lt;h4 class=&quot;modal-title&quot;&gt;确认删除？&lt;/h4&gt;
          &lt;/div&gt;
          &lt;div class=&quot;modal-footer&quot;&gt;
            &lt;button data-dismiss=&quot;modal&quot; class=&quot;btn btn-default&quot; type=&quot;button&quot;&gt;关闭&lt;/button&gt;
            &lt;button class=&quot;btn btn-primary deleteConfirmButton&quot; id=&quot;submit&quot; type=&quot;button&quot;&gt;确认&lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h2 id="7、HOMEPAGE-JSP"><a class="header-anchor" href="#7、HOMEPAGE-JSP">¶</a>7、HOMEPAGE.JSP</h2>
<h3 id="步骤-1-homePage-jsp-的复杂性"><a class="header-anchor" href="#步骤-1-homePage-jsp-的复杂性">¶</a>步骤 1 : homePage.jsp 的复杂性</h3>
<p>在homePage中要显示如下内容<br>
1 天猫超市连接右侧有4个分类数据<br>
2 竖状导航栏显示17个分类数据<br>
3 每个分类又再对应不同的推荐产品集合<br>
4 中部会显示17个分类<br>
5 每个分类又显示前5款产品<br>
6 每款产品又会显示第一张图片，标题，价格等信息</p>
<p>倘若把这些功能都在一个jsp中开发出来看，那么这个jsp就会变得非常的长，并且难以维护和扩展。在这里，就可以借鉴[home.jsp]的思路，把一个大的页面，拆成各个小的jsp，这样维护起来就相对容易了</p>
<h3 id="步骤-2-homePage-jsp-所包含页面关系"><a class="header-anchor" href="#步骤-2-homePage-jsp-所包含页面关系">¶</a>步骤 2 : homePage.jsp 所包含页面关系</h3>
<ol>
<li>categoryAndcarousel.jsp<br>
分类和轮播<br>
1.1 categoryMenu.jsp<br>
竖状分类菜单<br>
1.2 productsAsideCategorys.jsp<br>
竖状分类菜单右侧的推荐产品列表<br>
1.3 carousel.jsp<br>
轮播</li>
<li>homepageCategoryProducts.jsp<br>
主题的17种分类以及每种分类对应的5个产品</li>
</ol>
<p><img src="3882.png" alt=""></p>
<h3 id="步骤-3-categoryAndcarousel-jsp"><a class="header-anchor" href="#步骤-3-categoryAndcarousel-jsp">¶</a>步骤 3 : categoryAndcarousel.jsp</h3>
<p>categoryAndcarousel.jsp 页面利用ForeServlet传递过来的数据，天猫国际几个字旁边显示4个分类超链<br>
另外包含了其他3个页面：<br>
categoryMenu.jsp<br>
productsAsideCategorys.jsp<br>
carousel.jsp<br>
这3个页面在接下来的步骤就会讲到</p>
<p><img src="3883.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;script&gt;
function showProductsAsideCategorys(cid){
    $(&quot;div.eachCategory[cid=&quot;+cid+&quot;]&quot;).css(&quot;background-color&quot;,&quot;white&quot;);
    $(&quot;div.eachCategory[cid=&quot;+cid+&quot;] a&quot;).css(&quot;color&quot;,&quot;#87CEFA&quot;);
    $(&quot;div.productsAsideCategorys[cid=&quot;+cid+&quot;]&quot;).show();
}
 
function hideProductsAsideCategorys(cid){
    $(&quot;div.eachCategory[cid=&quot;+cid+&quot;]&quot;).css(&quot;background-color&quot;,&quot;#e2e2e3&quot;);
    $(&quot;div.eachCategory[cid=&quot;+cid+&quot;] a&quot;).css(&quot;color&quot;,&quot;#000&quot;);
    $(&quot;div.productsAsideCategorys[cid=&quot;+cid+&quot;]&quot;).hide();
}
$(function(){
    $(&quot;div.eachCategory&quot;).mouseenter(function(){
        var cid = $(this).attr(&quot;cid&quot;);
        showProductsAsideCategorys(cid);
    });
    $(&quot;div.eachCategory&quot;).mouseleave(function(){
        var cid = $(this).attr(&quot;cid&quot;);
        hideProductsAsideCategorys(cid);
    });
    $(&quot;div.productsAsideCategorys&quot;).mouseenter(function(){
        var cid = $(this).attr(&quot;cid&quot;);
        showProductsAsideCategorys(cid);
    });
    $(&quot;div.productsAsideCategorys&quot;).mouseleave(function(){
        var cid = $(this).attr(&quot;cid&quot;);
        hideProductsAsideCategorys(cid);
    });
     
    $(&quot;div.rightMenu span&quot;).mouseenter(function(){
        var left = $(this).position().left;
        var top = $(this).position().top;
        var width = $(this).css(&quot;width&quot;);
        var destLeft = parseInt(left) + parseInt(width)/2;
        $(&quot;img#catear&quot;).css(&quot;left&quot;,destLeft);
        $(&quot;img#catear&quot;).css(&quot;top&quot;,top-20);
        $(&quot;img#catear&quot;).fadeIn(500);
                 
    });
    $(&quot;div.rightMenu span&quot;).mouseleave(function(){
        $(&quot;img#catear&quot;).hide();
    });
     
    var left = $(&quot;div#carousel-of-product&quot;).offset().left;
    $(&quot;div.categoryMenu&quot;).css(&quot;left&quot;,left-20);
    $(&quot;div.categoryWithCarousel div.head&quot;).css(&quot;margin-left&quot;,left);
    $(&quot;div.productsAsideCategorys&quot;).css(&quot;left&quot;,left-20);
     
});
&lt;/script&gt;
 
&lt;img src=&quot;img/site/catear.png&quot; id=&quot;catear&quot; class=&quot;catear&quot;/&gt;
     
&lt;div class=&quot;categoryWithCarousel&quot;&gt;
 
&lt;div class=&quot;headbar show1&quot;&gt;
    &lt;div class=&quot;head &quot;&gt;
     
        &lt;span style=&quot;margin-left:10px&quot; class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;
        &lt;span style=&quot;margin-left:10px&quot; &gt;商品分类&lt;/span&gt;
         
    &lt;/div&gt;
     
    &lt;div class=&quot;rightMenu&quot;&gt;
        &lt;span&gt;&lt;a href=&quot;&quot;&gt;&lt;img src=&quot;img/site/chaoshi.png&quot;/&gt;&lt;/a&gt;&lt;/span&gt;
        &lt;span&gt;&lt;a href=&quot;&quot;&gt;&lt;img src=&quot;img/site/guoji.png&quot;/&gt;&lt;/a&gt;&lt;/span&gt;
 
        &lt;c:forEach items=&quot;${cs}&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt;
            &lt;c:if test=&quot;${st.count&lt;=4}&quot;&gt;
                &lt;span&gt;
                &lt;a href=&quot;forecategory?cid=${c.id}&quot;&gt;
                    ${c.name}
                &lt;/a&gt;&lt;/span&gt;        
            &lt;/c:if&gt;
        &lt;/c:forEach&gt;
    &lt;/div&gt;
     
&lt;/div&gt;
 
&lt;div style=&quot;position: relative&quot;&gt;
    &lt;%@include file=&quot;categoryMenu.jsp&quot; %&gt;
&lt;/div&gt;
 
&lt;div style=&quot;position: relative;left: 0;top: 0;&quot;&gt;
    &lt;%@include file=&quot;productsAsideCategorys.jsp&quot; %&gt;
&lt;/div&gt;
 
&lt;%@include file=&quot;carousel.jsp&quot; %&gt;
 
&lt;div class=&quot;carouselBackgroundDiv&quot;&gt;
&lt;/div&gt;
 
&lt;/div&gt;
</code></pre>
<h3 id="步骤-4-categoryMenu-jsp"><a class="header-anchor" href="#步骤-4-categoryMenu-jsp">¶</a>步骤 4 : categoryMenu.jsp</h3>
<p>categoryMenu.jsp 显示左侧的竖状分类导航</p>
<p><img src="3884.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
     
&lt;div class=&quot;categoryMenu&quot;&gt;
        &lt;c:forEach items=&quot;${cs}&quot; var=&quot;c&quot;&gt;
            &lt;div cid=&quot;${c.id}&quot; class=&quot;eachCategory&quot;&gt;
                &lt;span class=&quot;glyphicon glyphicon-link&quot;&gt;&lt;/span&gt;
                &lt;a href=&quot;forecategory?cid=${c.id}&quot;&gt;
                    ${c.name}
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/c:forEach&gt;
    &lt;/div&gt; 
</code></pre>
<h3 id="步骤-5-productsAsideCategorys-jsp"><a class="header-anchor" href="#步骤-5-productsAsideCategorys-jsp">¶</a>步骤 5 : productsAsideCategorys.jsp</h3>
<p>productsAsideCategorys.jsp 进行了三层遍历</p>
<ol>
<li>先取出每个分类</li>
<li>然后取出每个分类的productsByRow集合</li>
<li>根据productsByRow集合，取出每个产品，把产品的subTitle信息里的第一个单词取出来显示。</li>
</ol>
<p>JQuery代码解释：</p>
<pre><code class="language-java">这个是用于随机挑选一个产品作为推荐产品，来进行高亮显示。 严格的说，应该是后台设置那个产品是推荐产品，不过这里偷懒了，直接在前端按照20%的概率，随机挑选了一个产品。
$(&quot;div.productsAsideCategorys div.row a&quot;).each(function(){
	var v = Math.round(Math.random() *6);
	if(v == 1)
		$(this).css(&quot;color&quot;,&quot;#87CEFA&quot;);
});
</code></pre>
<p><img src="3885.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;script&gt;
$(function(){
    $(&quot;div.productsAsideCategorys div.row a&quot;).each(function(){
        var v = Math.round(Math.random() *6);
        if(v == 1)
            $(this).css(&quot;color&quot;,&quot;#87CEFA&quot;);
    });
});
 
&lt;/script&gt;
&lt;c:forEach items=&quot;${cs}&quot; var=&quot;c&quot;&gt;
    &lt;div cid=&quot;${c.id}&quot; class=&quot;productsAsideCategorys&quot;&gt;
      
        &lt;c:forEach items=&quot;${c.productsByRow}&quot; var=&quot;ps&quot;&gt;
            &lt;div class=&quot;row show1&quot;&gt;
                &lt;c:forEach items=&quot;${ps}&quot; var=&quot;p&quot;&gt;
                    &lt;c:if test=&quot;${!empty p.subTitle}&quot;&gt;
                        &lt;a href=&quot;foreproduct?pid=${p.id}&quot;&gt;
                            &lt;c:forEach items=&quot;${fn:split(p.subTitle, ' ')}&quot; var=&quot;title&quot; varStatus=&quot;st&quot;&gt;
                                &lt;c:if test=&quot;${st.index==0}&quot;&gt;
                                    ${title}
                                &lt;/c:if&gt;
                            &lt;/c:forEach&gt;
                        &lt;/a&gt;
                    &lt;/c:if&gt;
                &lt;/c:forEach&gt;
                &lt;div class=&quot;seperator&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;       
        &lt;/c:forEach&gt;
    &lt;/div&gt;           
&lt;/c:forEach&gt;
    
</code></pre>
<h3 id="步骤-6-carousel-jsp"><a class="header-anchor" href="#步骤-6-carousel-jsp">¶</a>步骤 6 : carousel.jsp</h3>
<p>轮播部分，都是静态的页面，没有用到服务端数据</p>
<p><img src="3886.png" alt=""></p>
<pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
     
&lt;div id=&quot;carousel-of-product&quot;  class=&quot;carousel-of-product carousel slide1&quot; data-ride=&quot;carousel&quot;&gt;
  &lt;!-- Indicators --&gt;
  &lt;ol class=&quot;carousel-indicators&quot;&gt;
    &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;0&quot; class=&quot;active&quot;&gt;&lt;/li&gt;
    &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;1&quot;&gt;&lt;/li&gt;
    &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;2&quot;&gt;&lt;/li&gt;
    &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;3&quot;&gt;&lt;/li&gt;
  &lt;/ol&gt;
 
  &lt;!-- Wrapper for slides --&gt;
  &lt;div class=&quot;carousel-inner&quot; role=&quot;listbox&quot;&gt;
    &lt;div class=&quot;item active&quot;&gt;
      &lt;img class=&quot;carousel carouselImage&quot; src=&quot;img/lunbo/1.jpg&quot; &gt;
    &lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;
      &lt;img  class=&quot;carouselImage&quot; src=&quot;img/lunbo/2.jpg&quot; &gt;
    &lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;
        &lt;img  class=&quot;carouselImage&quot; src=&quot;img/lunbo/3.jpg&quot; &gt;
    &lt;/div&gt;
 
    &lt;div class=&quot;item&quot;&gt;
        &lt;img  class=&quot;carouselImage&quot; src=&quot;img/lunbo/4.jpg&quot; &gt;
    &lt;/div&gt;
 
  &lt;/div&gt;
 
  &lt;!-- Controls --&gt;
&lt;!--   &lt;a class=&quot;left carousel-control&quot; href=&quot;#carousel-of-product&quot; role=&quot;button&quot; data-slide=&quot;prev&quot;&gt; --&gt;
&lt;!--     &lt;span class=&quot;glyphicon glyphicon-chevron-left&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; --&gt;
 
&lt;!--   &lt;/a&gt; --&gt;
&lt;!--   &lt;a class=&quot;right carousel-control&quot; href=&quot;#carousel-of-product&quot; role=&quot;button&quot; data-slide=&quot;next&quot;&gt; --&gt;
&lt;!--     &lt;span class=&quot;glyphicon glyphicon-chevron-right&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; --&gt;
 
&lt;!--   &lt;/a&gt; --&gt;
 
&lt;/div&gt;   
</code></pre>
<h3 id="步骤-7-homepageCategoryProducts-jsp"><a class="header-anchor" href="#步骤-7-homepageCategoryProducts-jsp">¶</a>步骤 7 : homepageCategoryProducts.jsp</h3>
<p>homepageCategoryProducts.jsp 进行了2次遍历</p>
<ol>
<li>遍历所有的分类，取出每个分类对象</li>
<li>遍历分类对象的products集合，取出每个产品，然后显示该产品的标题，图片，价格等信息</li>
</ol>
<p><img src="3887.png" alt=""></p>
<pre><code class="language-jsp">&lt;!DOCTYPE html&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
&lt;c:if test=&quot;${empty param.categorycount}&quot;&gt;
    &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;100&quot;/&gt;
&lt;/c:if&gt;
 
&lt;c:if test=&quot;${!empty param.categorycount}&quot;&gt;
    &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;${param.categorycount}&quot;/&gt;
&lt;/c:if&gt;
 
&lt;div class=&quot;homepageCategoryProducts&quot;&gt;
    &lt;c:forEach items=&quot;${cs}&quot; var=&quot;c&quot; varStatus=&quot;stc&quot;&gt;
        &lt;c:if test=&quot;${stc.count&lt;=categorycount}&quot;&gt;
            &lt;div class=&quot;eachHomepageCategoryProducts&quot;&gt;
                &lt;div class=&quot;left-mark&quot;&gt;&lt;/div&gt;
                &lt;span class=&quot;categoryTitle&quot;&gt;${c.name}&lt;/span&gt;
                &lt;br&gt;
                &lt;c:forEach items=&quot;${c.products}&quot; var=&quot;p&quot; varStatus=&quot;st&quot;&gt;
                    &lt;c:if test=&quot;${st.count&lt;=5}&quot;&gt;
                        &lt;div class=&quot;productItem&quot; &gt;
                            &lt;a href=&quot;foreproduct?pid=${p.id}&quot;&gt;&lt;img width=&quot;100px&quot; src=&quot;img/productSingle_middle/${p.firstProductImage.id}.jpg&quot;&gt;&lt;/a&gt;
                            &lt;a class=&quot;productItemDescLink&quot; href=&quot;foreproduct?pid=${p.id}&quot;&gt;
                                &lt;span class=&quot;productItemDesc&quot;&gt;[热销]
                                ${fn:substring(p.name, 0, 20)}
                                &lt;/span&gt;
                            &lt;/a&gt;
                            &lt;span class=&quot;productPrice&quot;&gt;
                                &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;${p.promotePrice}&quot; minFractionDigits=&quot;2&quot;/&gt;
                            &lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/c:if&gt;              
                &lt;/c:forEach&gt;
                &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/c:if&gt;
    &lt;/c:forEach&gt;
     
    &lt;img id=&quot;endpng&quot; class=&quot;endpng&quot; src=&quot;img/site/end.png&quot;&gt;
 
&lt;/div&gt;
</code></pre>
<h3 id="步骤-8-总结"><a class="header-anchor" href="#步骤-8-总结">¶</a>步骤 8 : 总结</h3>
<p>虽然首页显示的内容非常多，可以说是前端里最复杂的一个展示页面，但是通过这种拆成小块jsp的思路，每个jsp页面的功能就相对单一了。 可以更好的帮助大家理解。</p>
