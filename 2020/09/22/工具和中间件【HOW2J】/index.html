<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,编程,源代码,Java实践," />










<meta name="description" content="https:&#x2F;&#x2F;how2j.cn&#x2F;stage&#x2F;43.html">
<meta property="og:type" content="article">
<meta property="og:title" content="工具和中间件【HOW2J】">
<meta property="og:url" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/index.html">
<meta property="og:site_name" content="伶仃浩瀚">
<meta property="og:description" content="https:&#x2F;&#x2F;how2j.cn&#x2F;stage&#x2F;43.html">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5562.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5563.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5565.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5566.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5572.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5574.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5575.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5578.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5576.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5577.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5580.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5581.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5583.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5584.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5585.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5586.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5587.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5589.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5590.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5591.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5592.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5595.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5597.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5598.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5599.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5600.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5601.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5602.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5603.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5604.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5606.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5607.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5914.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5915.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5916.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5917.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5918.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5919.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5920.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5921.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5923.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5924.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5925.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5926.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5927.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5929.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5933.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5936.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9271.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9272.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9273.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9275.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9276.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9277.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9279.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9280.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9283.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5609.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5610.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5611.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5612.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5613.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5614.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5615.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5616.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5625.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5618.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5619.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5620.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5621.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5622.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5624.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7496.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7497.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7498.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7499.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7500.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7501.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5820.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5821.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5822.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5823.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5824.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5827.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5829.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5830.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5831.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5832.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5835.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7525.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8051.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8053.png">
<meta property="og:image" content="http://yoursite.com/2020/09/Blog-Hexo/source/_posts/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8054.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6633.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6634.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6640.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6641.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6642.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6644.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6645.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6648.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6649.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6651.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6653.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6654.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6655.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6658.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6657.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6659.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6660.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6661.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6663.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6664.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6667.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6668.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7292.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7303.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7305.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7307.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7308.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7311.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7312.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7315.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7325.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7326.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7328.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7332.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7333.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7336.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7337.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7338.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7339.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7341.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7342.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7343.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7344.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7347.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7349.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7351.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7352.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7354.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7359.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7362.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7363.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7367.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7371.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7374.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7383.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7384.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7385.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7375.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7387.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7388.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7391.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7392.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7393.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7395.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7396.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7398.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7402.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7399.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7400.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7401.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7403.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7405.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7407.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7409.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7410.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7408.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7412.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7413.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7414.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7415.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7417.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7423.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7426.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7430.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7432.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7437.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8072.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8073.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8074.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8082.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8084.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8085.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8086.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8087.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8088.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8089.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7531.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7549.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7545.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7551.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7553.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7554.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7561.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7560.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7563.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7564.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7566.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7569.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7570.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7575.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7576.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7579.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7577.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7586.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7589.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7590.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7616.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7617.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7618.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7620.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7622.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7624.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7633.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7640.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7663.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7672.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7664.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7665.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7667.png">
<meta property="og:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7668.png">
<meta property="article:published_time" content="2020-09-22T09:22:10.000Z">
<meta property="article:modified_time" content="2021-04-19T04:03:37.988Z">
<meta property="article:author" content="潇 卟 甸">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="源代码">
<meta property="article:tag" content="Java实践">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5562.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/09/22/工具和中间件【HOW2J】/"/>







<script>
    (function(){
        if('224694'){
            if (prompt('请输入文章密码') !== '224694'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>

  <title>工具和中间件【HOW2J】 | 伶仃浩瀚</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://xbd224694.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">伶仃浩瀚</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潇 卟 甸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/picture.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="伶仃浩瀚">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">工具和中间件【HOW2J】</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建时间" itemprop="dateCreated datePublished" datetime="2020-09-22T17:22:10+08:00">
                2020-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/How2j/" itemprop="url" rel="index">
                    <span itemprop="name">How2j</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/" class="leancloud_visitors" data-flag-title="工具和中间件【HOW2J】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度 </span>
               
                 <span class="leancloud-visitors-count"></span>
	 <span> ℃ </span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  91.4k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  453 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://how2j.cn/stage/43.html" target="_blank" rel="noopener">https://how2j.cn/stage/43.html</a></p>
<a id="more"></a>
<h1 id="一、Maven"><a class="header-anchor" href="#一、Maven">¶</a>一、Maven</h1>
<h2 id="1、什么是MAVEN"><a class="header-anchor" href="#1、什么是MAVEN">¶</a>1、什么是MAVEN</h2>
<h3 id="步骤-1-什么是Maven"><a class="header-anchor" href="#步骤-1-什么是Maven">¶</a>步骤 1 : 什么是Maven</h3>
<p>Maven 是专门用于构建和管理Java相关项目的工具。</p>
<p>Maven是意第绪语，依地语（犹太人使用的国际语），表示专家的意思。</p>
<p>所以用Maven管理Java 项目，你就是专家了 -_-!</p>
<h3 id="步骤-2-Maven-主要用处一：相同的项目结构"><a class="header-anchor" href="#步骤-2-Maven-主要用处一：相同的项目结构">¶</a>步骤 2 : Maven 主要用处一：相同的项目结构</h3>
<p>使用Maven管理的Java 项目都有着相同的项目结构</p>
<ol>
<li>有一个pom.xml 用于维护当前项目都用了哪些jar包</li>
<li>所有的java代码都放在 src/main/java 下面</li>
<li>所有的测试代码都放在src/test/java 下面</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5562.png" alt></p>
<h3 id="步骤-3-Maven-主要用处二：统一维护jar包"><a class="header-anchor" href="#步骤-3-Maven-主要用处二：统一维护jar包">¶</a>步骤 3 : Maven 主要用处二：统一维护jar包</h3>
<p>比如说有3个Java 项目，这些项目都不是maven风格。那么这3个项目，就会各自维护一套jar包。 而其中有些jar包是相同的。</p>
<p>而maven风格的项目，首先把所有的jar包都放在&quot;[仓库]“ 里，然后哪个项目需要用到这个jar包，只需要给出jar包的名称和版本号就行了。 这样<strong>jar包就实现了共享</strong></p>
<p>如图所示，在pom.xml里，表示用到了mysql 的jar包，版本号是5.1.30。</p>
<p>那么仓库在哪里？ 怎么建设呢？ 在后续教程会讲到： [仓库]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5563.png" alt></p>
<h2 id="2、下载与配置MAVEN"><a class="header-anchor" href="#2、下载与配置MAVEN">¶</a>2、下载与配置MAVEN</h2>
<h3 id="步骤-1-下载"><a class="header-anchor" href="#步骤-1-下载">¶</a>步骤 1 : 下载</h3>
<p>右上角可以下载 apache-maven-3.5.0-bin.zip, 版本是3.5.0，当前是(2017.7.21)最新版本</p>
<p>官方最新版下载地址：<a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">http://maven.apache.org/download.cgi</a></p>
<h3 id="步骤-2-配置环境变量"><a class="header-anchor" href="#步骤-2-配置环境变量">¶</a>步骤 2 : 配置环境变量</h3>
<p>右键我的电脑-属性-高级系统设置-环境变量-系统变量-Path</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5565.png" alt></p>
<h3 id="步骤-3-检验版本"><a class="header-anchor" href="#步骤-3-检验版本">¶</a>步骤 3 : 检验版本</h3>
<p>使用win+r, 然后输入cmd 打开命令行，输入如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>
<p>倘若出现如图所示的截图，即表示配置成功了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5566.png" alt></p>
<h2 id="3、仓库概念，下载与配置"><a class="header-anchor" href="#3、仓库概念，下载与配置">¶</a>3、仓库概念，下载与配置</h2>
<h3 id="步骤-1-仓库概念"><a class="header-anchor" href="#步骤-1-仓库概念">¶</a>步骤 1 : 仓库概念</h3>
<p>所谓的仓库就是用于存放项目需要的jar包的。<br>
maven采用一个仓库，多个项目的方式，让多个项目共享一个仓库里的相同jar包。</p>
<h3 id="步骤-2-仓库默认位置"><a class="header-anchor" href="#步骤-2-仓库默认位置">¶</a>步骤 2 : 仓库默认位置</h3>
<p>打开</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\apache-maven-<span class="number">3.5</span><span class="number">.0</span>\conf\settings.xml</span><br></pre></td></tr></table></figure>
<p>可以看到，在52行指定了仓库的位置是${user.home}/.m2/repository。<br>
对应我的机器就是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\.m2\repository</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment">distributed with this work for additional information</span></span><br><span class="line"><span class="comment">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment">"License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | This is the configuration file for Maven. It can be specified at two levels:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  1. User Level. This settings.xml file provides configuration for a single user,</span></span><br><span class="line"><span class="comment"> |                 and is normally provided in $&#123;user.home&#125;/.m2/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -s /path/to/user/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  2. Global Level. This settings.xml file provides configuration for all Maven</span></span><br><span class="line"><span class="comment"> |                 users on a machine (assuming they're all using the same Maven</span></span><br><span class="line"><span class="comment"> |                 installation). It's normally provided in</span></span><br><span class="line"><span class="comment"> |                 $&#123;maven.conf&#125;/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -gs /path/to/global/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> | The sections in this sample file are intended to give you a running start at</span></span><br><span class="line"><span class="comment"> | getting the most out of your Maven installation. Where appropriate, the default</span></span><br><span class="line"><span class="comment"> | values (values used when the setting is not specified) are provided.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">。。。略</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-默认下载路径"><a class="header-anchor" href="#步骤-3-默认下载路径">¶</a>步骤 3 : 默认下载路径</h3>
<p>maven 会默认从maven官方提供的服务器下载jar包。<br>
而官方服务器在国外，因为大家都知道的原因，网速很慢，而且容易卡断。 为了便于快速下载相关jar包，可以使用国内maven 阿里云的下载地址：[使用阿里云下载路径]</p>
<h3 id="步骤-4-使用阿里云下载路径"><a class="header-anchor" href="#步骤-4-使用阿里云下载路径">¶</a>步骤 4 : 使用阿里云下载路径</h3>
<p>打开</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\apache-maven-<span class="number">3.5</span><span class="number">.0</span>\conf\settings.xml</span><br></pre></td></tr></table></figure>
<p>修改在mirrors下新加一个阿里云的镜像地址：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以直接复制粘贴即可，修改位置是160-165行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment">distributed with this work for additional information</span></span><br><span class="line"><span class="comment">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment">"License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | This is the configuration file for Maven. It can be specified at two levels:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  1. User Level. This settings.xml file provides configuration for a single user,</span></span><br><span class="line"><span class="comment"> |                 and is normally provided in $&#123;user.home&#125;/.m2/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -s /path/to/user/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  2. Global Level. This settings.xml file provides configuration for all Maven</span></span><br><span class="line"><span class="comment"> |                 users on a machine (assuming they're all using the same Maven</span></span><br><span class="line"><span class="comment"> |                 installation). It's normally provided in</span></span><br><span class="line"><span class="comment"> |                 $&#123;maven.conf&#125;/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -gs /path/to/global/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> | The sections in this sample file are intended to give you a running start at</span></span><br><span class="line"><span class="comment"> | getting the most out of your Maven installation. Where appropriate, the default</span></span><br><span class="line"><span class="comment"> | values (values used when the setting is not specified) are provided.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>d:/maven/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like "mvn prefix:goal". Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | "org.apache.maven.plugins" and "org.codehaus.mojo" if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the 'id' attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id's for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property 'target-env' with a value of 'dev',</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set 'target-env' to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-修改仓库位置"><a class="header-anchor" href="#步骤-5-修改仓库位置">¶</a>步骤 5 : 修改仓库位置</h3>
<p>[仓库默认位置] 是 C:\Users\X7TI.m2\repository，放在C盘有一点不好，重装系统就都没有了。所以通常我会把仓库的位置修改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d:/maven/repository</span><br></pre></td></tr></table></figure>
<p>配置文件的第55行，复制粘贴即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment">distributed with this work for additional information</span></span><br><span class="line"><span class="comment">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment">"License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | This is the configuration file for Maven. It can be specified at two levels:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  1. User Level. This settings.xml file provides configuration for a single user,</span></span><br><span class="line"><span class="comment"> |                 and is normally provided in $&#123;user.home&#125;/.m2/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -s /path/to/user/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  2. Global Level. This settings.xml file provides configuration for all Maven</span></span><br><span class="line"><span class="comment"> |                 users on a machine (assuming they're all using the same Maven</span></span><br><span class="line"><span class="comment"> |                 installation). It's normally provided in</span></span><br><span class="line"><span class="comment"> |                 $&#123;maven.conf&#125;/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -gs /path/to/global/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> | The sections in this sample file are intended to give you a running start at</span></span><br><span class="line"><span class="comment"> | getting the most out of your Maven installation. Where appropriate, the default</span></span><br><span class="line"><span class="comment"> | values (values used when the setting is not specified) are provided.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>d:/maven/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like "mvn prefix:goal". Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | "org.apache.maven.plugins" and "org.codehaus.mojo" if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the 'id' attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id's for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property 'target-env' with a value of 'dev',</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set 'target-env' to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-使用现成的仓库"><a class="header-anchor" href="#步骤-6-使用现成的仓库">¶</a>步骤 6 : 使用现成的仓库</h3>
<p>在右上角有我目前使用的maven仓库，虽不能说齐全，但是相当一部分常用的已经有了。 可以直接下载并解压在</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d:/maven/repository</span><br></pre></td></tr></table></figure>
<p>这样就不需要自己下载了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5572.png" alt></p>
<h2 id="4、通过命令行创建MAVEN风格的JAVA项目"><a class="header-anchor" href="#4、通过命令行创建MAVEN风格的JAVA项目">¶</a>4、通过命令行创建MAVEN风格的JAVA项目</h2>
<h3 id="步骤-1-关于Maven风格的Java项目"><a class="header-anchor" href="#步骤-1-关于Maven风格的Java项目">¶</a>步骤 1 : 关于Maven风格的Java项目</h3>
<p>Maven作为一种工具，可以创建标准化的Maven风格Java项目。 但是在实际工作中，很少有机会直接通过Maven 命令行来做到这一点。 通常都是在Eclipse或者IDEA中，通过集成Maven的方式来创建Java 项目。</p>
<p>本知识点会演示这种做法，目的是为了方便理解在IDE中对Maven的运用</p>
<h3 id="步骤-2-切换到项目目录"><a class="header-anchor" href="#步骤-2-切换到项目目录">¶</a>步骤 2 : 切换到项目目录</h3>
<p>按下win+r，然后输入cmd，接着输入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e:</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd e:\projecte:</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5574.png" alt></p>
<h3 id="步骤-3-创建maven项目"><a class="header-anchor" href="#步骤-3-创建maven项目">¶</a>步骤 3 : 创建maven项目</h3>
<p>首先确保e:\project目录下没有j2se文件夹，否则会报错<br>
然后执行命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=com.how2java -DartifactId=j2se -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=<span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<p><strong>archetype:generate</strong> 表示创建个项目<br>
<strong>-DgroupId</strong> 项目包名: com.how2java<br>
<strong>-DartifactId</strong> 项目名称: j2se<br>
<strong>-DarchetypeArtifactId</strong> 项目类型: maven-archetype-quickstart<br>
<strong>-DinteractiveMode:false</strong> 表示前面参数都给了，就不用一个一个地输入了</p>
<p>运行成功会看到绿色的BUILD SUCCESS</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5575.png" alt></p>
<h3 id="步骤-4-项目结构"><a class="header-anchor" href="#步骤-4-项目结构">¶</a>步骤 4 : 项目结构</h3>
<p>如图所示，会创建一个标准结构的maven 项目，不仅如此还送了一个App.java。里面输出了一个Hello World!</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5578.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println( <span class="string">"Hello World!"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-运行package命令"><a class="header-anchor" href="#步骤-5-运行package命令">¶</a>步骤 5 : 运行package命令</h3>
<p>然后运行package命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn <span class="keyword">package</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 运行这个命令之前要先把当前路径切换到 j2se来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd j2se</span><br></pre></td></tr></table></figure>
<p>最后会看到一个绿色的BUILD SUCCESS</p>
<p>package做了很多事情，编译，测试，打包，最后生成了一个<strong>j2se-1.0-SNAPSHOT.jar</strong>包，里面放了APP这个类</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5576.png" alt></p>
<h3 id="步骤-6-执行Jar"><a class="header-anchor" href="#步骤-6-执行Jar">¶</a>步骤 6 : 执行Jar</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target/j2se-<span class="number">1.0</span>-SNAPSHOT.jar com.how2java.App</span><br></pre></td></tr></table></figure>
<p>如图所示，会创建一个标准结构的maven 项目，不仅如此还送了一个App.java。里面输出了一个Hello World!</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5577.png" alt></p>
<h2 id="5、ECLIPSE中的MAVEN设置"><a class="header-anchor" href="#5、ECLIPSE中的MAVEN设置">¶</a>5、ECLIPSE中的MAVEN设置</h2>
<h3 id="步骤-1-集成MAVEN"><a class="header-anchor" href="#步骤-1-集成MAVEN">¶</a>步骤 1 : 集成MAVEN</h3>
<p>Eclipse EE版本是已经集成好MAVEN的了，无需额外手动集成。<br>
没有的同学可以在这里下载：[下载 Eclipse]</p>
<h3 id="步骤-2-设置MAVEN路径"><a class="header-anchor" href="#步骤-2-设置MAVEN路径">¶</a>步骤 2 : 设置MAVEN路径</h3>
<p>菜单-&gt;Window-&gt;Preferences-&gt;Maven-&gt;Installations-&gt; 指定 <strong>d:\software\apache-maven-3.5.0</strong></p>
<p><strong>注：</strong> 把原来的那个低版本maven删除掉，如果有的话</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5580.png" alt></p>
<h3 id="步骤-3-设置仓库路径"><a class="header-anchor" href="#步骤-3-设置仓库路径">¶</a>步骤 3 : 设置仓库路径</h3>
<p>菜单-&gt;Window-&gt;Preferences-&gt;Maven-&gt;User Settings-&gt;<br>
Global Settings 和 User Settings都使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\apache-maven-<span class="number">3.5</span><span class="number">.0</span>\conf\settings.xml</span><br></pre></td></tr></table></figure>
<p>点击一下Reindex,确保 local Repository为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d:/maven/repository</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5581.png" alt></p>
<h2 id="6、ECLIPSE下创建MAVEN风格的JAVA项目"><a class="header-anchor" href="#6、ECLIPSE下创建MAVEN风格的JAVA项目">¶</a>6、ECLIPSE下创建MAVEN风格的JAVA项目</h2>
<h3 id="步骤-1-删除j2se目录"><a class="header-anchor" href="#步骤-1-删除j2se目录">¶</a>步骤 1 : 删除j2se目录</h3>
<p>按照前面的学习流程，已经存在一个j2se目录，为避免干扰因素，先把这个目录删除掉</p>
<h3 id="步骤-2-新建Maven-项目"><a class="header-anchor" href="#步骤-2-新建Maven-项目">¶</a>步骤 2 : 新建Maven 项目</h3>
<p>菜单-&gt;File-&gt;New-&gt;Other-&gt;Maven-&gt;Maven Project</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5583.png" alt></p>
<h3 id="步骤-3-这个界面点下一步"><a class="header-anchor" href="#步骤-3-这个界面点下一步">¶</a>步骤 3 : 这个界面点下一步</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5584.png" alt></p>
<h3 id="步骤-4-这个界面使用默认的选项，点下一步"><a class="header-anchor" href="#步骤-4-这个界面使用默认的选项，点下一步">¶</a>步骤 4 : 这个界面使用默认的选项，点下一步</h3>
<p>这里选择默认的maven-archetype-quickstart, 和[命令行创建maven项目]中的项目类型一致的</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5585.png" alt></p>
<h3 id="步骤-5-这一步填写如图所示的信息"><a class="header-anchor" href="#步骤-5-这一步填写如图所示的信息">¶</a>步骤 5 : 这一步填写如图所示的信息</h3>
<p>Group Id： 填写包名<br>
Artifact Id: 填写j2se<br>
然后点击Finish</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5586.png" alt></p>
<h3 id="步骤-6-运行App"><a class="header-anchor" href="#步骤-6-运行App">¶</a>步骤 6 : 运行App</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5587.png" alt></p>
<h2 id="7、如何添加第三方JAR包"><a class="header-anchor" href="#7、如何添加第三方JAR包">¶</a>7、如何添加第三方JAR包</h2>
<h3 id="步骤-1-Maven项目用到第三方jar"><a class="header-anchor" href="#步骤-1-Maven项目用到第三方jar">¶</a>步骤 1 : Maven项目用到第三方jar</h3>
<p>当一个Maven项目需要用到第三方jar的时候，就需要添加对应的jar包。<br>
本例演示如何添加一个jdbc的jar包</p>
<h3 id="步骤-2-修改App"><a class="header-anchor" href="#步骤-2-修改App">¶</a>步骤 2 : 修改App</h3>
<p>修改App.class,故意写一段需要依赖jar包才可以成功执行的代码： 初始化mysql驱动</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5589.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.j2se;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        System.out.println(<span class="string">"初始化驱动成功"</span>);</span><br><span class="line">        System.out.println( <span class="string">"Hello World!"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-给maven项目添加jar"><a class="header-anchor" href="#步骤-3-给maven项目添加jar">¶</a>步骤 3 : 给maven项目添加jar</h3>
<p>双击pom.xml，出现pom专有的编辑页面。<br>
点击OverView右边的Dependencies可以看到里面有一个默认存在的junit<br>
然后点击Add，弹出选择窗口<br>
在中间 Enter GroupId, artifactId or sha1 prefix or pattern(*)… 这个地方输入mysql，下面就会出来被搜索到的mysql-connector-java<br>
选中它，并点击ok</p>
<p><strong>注:</strong> Scope要选择compile，表示编译期间要用到。<br>
<strong>注:</strong> 如果输入了mysql下面没有自动显示搜索结果怎么办？点击 [重建本地仓库]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5590.png" alt></p>
<h3 id="步骤-4-保存再执行"><a class="header-anchor" href="#步骤-4-保存再执行">¶</a>步骤 4 : 保存再执行</h3>
<p>点击保存，<strong>一定要记得保存</strong>，保存才能使得pom.xml中的jar包依赖起作用，接着再运行APP</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5591.png" alt></p>
<h3 id="步骤-5-重建本地仓库"><a class="header-anchor" href="#步骤-5-重建本地仓库">¶</a>步骤 5 : 重建本地仓库</h3>
<p>倘若在[给maven项目添加jar]中无法搜索到mysql jar包，那么可以按照如下行为操作一遍<br>
菜单-&gt;Window-&gt;Show View-&gt;Other-&gt;Maven-&gt;Maven Repositories-&gt;Local Repository-&gt;Rebuild Index</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5592.png" alt></p>
<h2 id="8、用命令行创建MAVEN风格的JAVA-WEB项目"><a class="header-anchor" href="#8、用命令行创建MAVEN风格的JAVA-WEB项目">¶</a>8、用命令行创建MAVEN风格的JAVA WEB项目</h2>
<h3 id="步骤-1-关于Maven风格的Web项目"><a class="header-anchor" href="#步骤-1-关于Maven风格的Web项目">¶</a>步骤 1 : 关于Maven风格的Web项目</h3>
<p>与[创建Maven项目]类似的，还可以创建web 项目<br>
同样的，这种事情，几乎不会用命令行来做，都是用IDE来做的，比如[Eclipse Web 项目]</p>
<p>所以本知识点也就演示一下，实际工作一般不这么干</p>
<h3 id="步骤-2-创建命令"><a class="header-anchor" href="#步骤-2-创建命令">¶</a>步骤 2 : 创建命令</h3>
<ol>
<li>首先切换目录</li>
<li>切换盘符</li>
<li>执行命令（确保e:\project下没有j2ee目录）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DgroupId=com.how2java -DartifactId=j2ee -DinteractiveMode=<span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<p>这个命令和[创建maven java项目]中的命令一样，不过类型是从<br>
maven-archetype-quickstart 改成了 maven-archetype-webapp<br>
项目名称从 j2se改成了j2ee而已</p>
<h3 id="步骤-3-目录结构"><a class="header-anchor" href="#步骤-3-目录结构">¶</a>步骤 3 : 目录结构</h3>
<p>与[maven创建的java项目结构]类似，不过没有java目录，需要自己手动创建。 所以命令行方式的maven web项目很少用到</p>
<p>​	<img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5595.png" alt></p>
<h2 id="9、在ECLIPSE中创建MAVEN风格的JAVA-WEB项目"><a class="header-anchor" href="#9、在ECLIPSE中创建MAVEN风格的JAVA-WEB项目">¶</a>9、在ECLIPSE中创建MAVEN风格的JAVA WEB项目</h2>
<h3 id="步骤-1-删除j2ee目录"><a class="header-anchor" href="#步骤-1-删除j2ee目录">¶</a>步骤 1 : 删除j2ee目录</h3>
<p>删除[创建Web项目]步骤创建的j2ee目录</p>
<h3 id="步骤-2-新建Maven-项目-v2"><a class="header-anchor" href="#步骤-2-新建Maven-项目-v2">¶</a>步骤 2 : 新建Maven 项目</h3>
<p>菜单-&gt;File-&gt;New-&gt;Other-&gt;Maven-&gt;Maven Project</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5597.png" alt></p>
<h3 id="步骤-3-这个界面点下一步-v2"><a class="header-anchor" href="#步骤-3-这个界面点下一步-v2">¶</a>步骤 3 : 这个界面点下一步</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5598.png" alt></p>
<h3 id="步骤-4-这个界面使用webapp，点下一步"><a class="header-anchor" href="#步骤-4-这个界面使用webapp，点下一步">¶</a>步骤 4 : 这个界面使用webapp，点下一步</h3>
<p>默认选中的是maven-archetype-quickstart, 请修改为: maven-archetype-webapp</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5599.png" alt></p>
<h3 id="步骤-5-这一步填写如图所示的信息-v2"><a class="header-anchor" href="#步骤-5-这一步填写如图所示的信息-v2">¶</a>步骤 5 : 这一步填写如图所示的信息</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5600.png" alt></p>
<h3 id="步骤-6-此时得到的maven-web-项目的问题"><a class="header-anchor" href="#步骤-6-此时得到的maven-web-项目的问题">¶</a>步骤 6 : 此时得到的maven web 项目的问题</h3>
<p>此时能得到的maven web 项目，不过有两个问题</p>
<ol>
<li>没有java源代码目录</li>
<li>index.jsp报错</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5601.png" alt></p>
<h3 id="步骤-7-创建java-源代码目录"><a class="header-anchor" href="#步骤-7-创建java-源代码目录">¶</a>步骤 7 : 创建java 源代码目录</h3>
<p>在上一步的截图中可以发现，没有地方存放java源文件，这个时候就需要按照如下步骤做：<br>
右键项目-&gt;属性-&gt;Java Build Path-&gt;Libraries-&gt;Edit-&gt;Workspace default<br>
JRE(jdk8)-&gt;Finish</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5602.png" alt></p>
<h3 id="步骤-8-java源文件目录创建好了"><a class="header-anchor" href="#步骤-8-java源文件目录创建好了">¶</a>步骤 8 : java源文件目录创建好了</h3>
<p>如图所示，java源文件目录创建好了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5603.png" alt></p>
<h3 id="步骤-9-通过pom-xml添加servlet-jar包"><a class="header-anchor" href="#步骤-9-通过pom-xml添加servlet-jar包">¶</a>步骤 9 : 通过pom.xml添加servlet jar包</h3>
<p>这个时候，还存在index.jsp会 报错的问题。 这个问题的解决办法是添加servlet.jar包。<br>
做法参考：[给maven项目添加jar]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5604.png" alt></p>
<h3 id="步骤-10-添加好之后，index-jsp也不报错了"><a class="header-anchor" href="#步骤-10-添加好之后，index-jsp也不报错了">¶</a>步骤 10 : 添加好之后，index.jsp也不报错了</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5606.png" alt></p>
<h3 id="步骤-11-通过eclipse内置tomcat启动"><a class="header-anchor" href="#步骤-11-通过eclipse内置tomcat启动">¶</a>步骤 11 : 通过eclipse内置tomcat启动</h3>
<p>maven web-app 项目就像[动态web项目]那样，是支持通过eclipse 内置tomcat启动的</p>
<p>右键点击项目j2ee，点击Run As -&gt; Run on Server ，成功之后就会看到如图所示的Hello World!</p>
<p>如果对于Eclipse内置Tomcat配置方式不熟悉，请参考教程：[通过Eclipse启动Tomcat-Run On Server]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5607.png" alt></p>
<h2 id="10、使用ECLIPSE创建一个MAVEN风格的SSM项目"><a class="header-anchor" href="#10、使用ECLIPSE创建一个MAVEN风格的SSM项目">¶</a>10、使用ECLIPSE创建一个MAVEN风格的SSM项目</h2>
<h3 id="步骤-1-基于前面的知识点"><a class="header-anchor" href="#步骤-1-基于前面的知识点">¶</a>步骤 1 : 基于前面的知识点</h3>
<p>本知识点在[SSM 的PageHelper]的基础上进行，所以要先到[SSM 的PageHelper]去下载可运行的项目，并解压。</p>
<p><strong>注:</strong> 不要下载到当前知识点的可运行项目了哦，当前的是已经完成了目前的步骤流程后完成的项目</p>
<h3 id="步骤-2-创建maven-web项目"><a class="header-anchor" href="#步骤-2-创建maven-web项目">¶</a>步骤 2 : 创建maven web项目</h3>
<p>File-&gt;New-&gt;Other-&gt;Maven-&gt;Maven Project</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5914.png" alt></p>
<h3 id="步骤-3-设置项目目录"><a class="header-anchor" href="#步骤-3-设置项目目录">¶</a>步骤 3 : 设置项目目录</h3>
<p>默认即可</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5915.png" alt></p>
<h3 id="步骤-4-选择Archetype"><a class="header-anchor" href="#步骤-4-选择Archetype">¶</a>步骤 4 : 选择Archetype</h3>
<p>选择 maven-archetype-webapp</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5916.png" alt></p>
<h3 id="步骤-5-设置GroupId和Artifact-Id"><a class="header-anchor" href="#步骤-5-设置GroupId和Artifact-Id">¶</a>步骤 5 : 设置GroupId和Artifact Id</h3>
<p>设置GroupId和Artifact Id,分别是<strong>com.how2java</strong>和<strong>ssm</strong>。<br>
后续配置也是用的这个，所以照着做，别自作聪明改其他的，不然后面走不通</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5917.png" alt></p>
<h3 id="步骤-6-项目截图"><a class="header-anchor" href="#步骤-6-项目截图">¶</a>步骤 6 : 项目截图</h3>
<p>此时项目就创建好了，不过还会报错，接着做后续的一系列操作</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5918.png" alt></p>
<p>​</p>
<h3 id="步骤-7-创建java-源代码目录-v2"><a class="header-anchor" href="#步骤-7-创建java-源代码目录-v2">¶</a>步骤 7 : 创建java 源代码目录</h3>
<p>在上一步的截图中可以发现，没有地方存放java源文件，这个时候就需要按照如下步骤做：<br>
右键项目-&gt;属性-&gt;Java Build Path-&gt;Libraries-&gt;Edit-&gt;Workspace default<br>
JRE(jdk8)-&gt;Finish</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5919.png" alt></p>
<h3 id="步骤-8-java源文件目录创建好了-v2"><a class="header-anchor" href="#步骤-8-java源文件目录创建好了-v2">¶</a>步骤 8 : java源文件目录创建好了</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5920.png" alt></p>
<h3 id="步骤-9-pom-xml"><a class="header-anchor" href="#步骤-9-pom-xml">¶</a>步骤 9 : pom.xml</h3>
<p>接着复制粘贴pom.xml为下面的代码。 粘贴之后，jsp本来的报错就消失了，不过出来一个新的问题，要求通过Maven更新项目。</p>
<p>右键项目-&gt;Maven-&gt;Update Project，会弹出一个对话框，点击Ok，这个问题就消失了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5921.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.how2java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pagehelper.version</span>&gt;</span>5.1.2-beta<span class="tag">&lt;/<span class="name">pagehelper.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jstl.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsqlparser.version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">jsqlparser.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>1.2.7<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.18<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-logging.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">commons-logging.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-lang.version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">commons-lang.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aopalliance.version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">aopalliance.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-generator.version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">mybatis-generator.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JSP相关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- pageHelper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pagehelper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--jsqlparser--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jsqlparser<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsqlparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsqlparser.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-logging.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-lang.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aopalliance.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-generator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 资源文件拷贝插件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- java编译插件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置Tomcat插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.tld<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-接着复制项目文件"><a class="header-anchor" href="#步骤-10-接着复制项目文件">¶</a>步骤 10 : 接着复制项目文件</h3>
<p>首先从在[基于前面的知识点]里下载的项目里解压出来，然后按照如下顺序复制粘贴。 不要一股脑全粘贴进去，会出现无法解决的错误哦</p>
<h3 id="步骤-11-web-xml"><a class="header-anchor" href="#步骤-11-web-xml">¶</a>步骤 11 : web.xml</h3>
<p>首先覆盖web.xml<br>
把下载下来的xxx/ssm/WebContent/WEB-INF/web.xml<br>
复制到当前的 ssm/src/main/webapp/WEB-INF/web.xml这里</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5923.png" alt></p>
<h3 id="步骤-12-jsp-目录"><a class="header-anchor" href="#步骤-12-jsp-目录">¶</a>步骤 12 : jsp 目录</h3>
<p>接着复制jsp目录。<br>
<strong>千万不要复制lib目录</strong></p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5924.png" alt></p>
<h3 id="步骤-13-配置文件"><a class="header-anchor" href="#步骤-13-配置文件">¶</a>步骤 13 : 配置文件</h3>
<p>把三个配置文件复制到 ssm/src/main/resources下面</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5925.png" alt></p>
<h3 id="步骤-14-java源代码"><a class="header-anchor" href="#步骤-14-java源代码">¶</a>步骤 14 : java源代码</h3>
<p>把java源代码复制到src/main/java下</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5926.png" alt></p>
<h3 id="步骤-15-关于Category-xml"><a class="header-anchor" href="#步骤-15-关于Category-xml">¶</a>步骤 15 : 关于Category.xml</h3>
<p>按照maven ssm项目风格来说，这个文件本应该放在Resource目录的mapper文件夹下，但是这么做还要修改配置信息，为了避免问题复杂化，而且考虑到即使放在当前位置也是可以正常工作的，所以就暂时不修改它的位置了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5927.png" alt></p>
<h3 id="步骤-16-启动Tomcat"><a class="header-anchor" href="#步骤-16-启动Tomcat">¶</a>步骤 16 : 启动Tomcat</h3>
<p>右键点击项目，点击Run As -&gt; Run on Server 启动Tomcat</p>
<p>如果对于Eclipse内置Tomcat配置方式不熟悉，请参考教程：[通过Eclipse启动Tomcat-Run On Server]</p>
<h3 id="步骤-17-访问测试地址"><a class="header-anchor" href="#步骤-17-访问测试地址">¶</a>步骤 17 : 访问测试地址</h3>
<p>访问如下测试地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/ssm/listCategory</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5929.png" alt></p>
<h3 id="步骤-18-可运行项目"><a class="header-anchor" href="#步骤-18-可运行项目">¶</a>步骤 18 : 可运行项目</h3>
<p>在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<p>**注:**不要和[基于前面的知识点]里的下载搞混了哦</p>
<h2 id="11、使用ECLIPSE导入一个MAVEN风格的SSM项目"><a class="header-anchor" href="#11、使用ECLIPSE导入一个MAVEN风格的SSM项目">¶</a>11、使用ECLIPSE导入一个MAVEN风格的SSM项目</h2>
<h3 id="步骤-1-介绍"><a class="header-anchor" href="#步骤-1-介绍">¶</a>步骤 1 : 介绍</h3>
<p>上一个知识点[创建 SSM 项目]是讲解如何从0创建一个maven风格的ssm项目。 而大部分ssm项目都是现成的，不需要自己从头创建，所以本知识点演示如何把现成maven风格的ssm项目导入到Eclipse中去。</p>
<h3 id="步骤-2-下载右上角的可运行项目"><a class="header-anchor" href="#步骤-2-下载右上角的可运行项目">¶</a>步骤 2 : 下载右上角的可运行项目</h3>
<p>首先下载右上角的可运行项目，并解压到</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\ssm</span><br></pre></td></tr></table></figure>
<p>目录随便，根据自己计算机环境调整就是了</p>
<h3 id="步骤-3-导入项目"><a class="header-anchor" href="#步骤-3-导入项目">¶</a>步骤 3 : 导入项目</h3>
<p>File-&gt;Import-&gt;Maven-&gt;Existing Maven Projects 然后输入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\ssm</span><br></pre></td></tr></table></figure>
<p>此时不能点击Finish,点击Refresh就可以点击Finish了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5933.png" alt></p>
<h3 id="步骤-4-启动Tomcat"><a class="header-anchor" href="#步骤-4-启动Tomcat">¶</a>步骤 4 : 启动Tomcat</h3>
<p>右键点击项目，点击Run As -&gt; Run on Server 启动Tomcat</p>
<p>如果对于Eclipse内置Tomcat配置方式不熟悉，请参考教程：[通过Eclipse启动Tomcat-Run On Server]</p>
<h3 id="步骤-5-测试"><a class="header-anchor" href="#步骤-5-测试">¶</a>步骤 5 : 测试</h3>
<p>访问如下测试地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/ssm/listCategory</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5936.png" alt></p>
<h2 id="12、INTELLIJ-IDEA"><a class="header-anchor" href="#12、INTELLIJ-IDEA">¶</a>12、INTELLIJ IDEA</h2>
<h3 id="步骤-1-Intellij-IDEA"><a class="header-anchor" href="#步骤-1-Intellij-IDEA">¶</a>步骤 1 : Intellij IDEA</h3>
<p>Maven 项目以及Maven Web项目在Intellij IDEA中的运用，请跳转到 [Intellij IDEA Maven教程]</p>
<h2 id="13、ECLIPSE-中创建父子-聚合项目"><a class="header-anchor" href="#13、ECLIPSE-中创建父子-聚合项目">¶</a>13、ECLIPSE 中创建父子-聚合项目</h2>
<h3 id="步骤-1-父子-聚合项目"><a class="header-anchor" href="#步骤-1-父子-聚合项目">¶</a>步骤 1 : 父子-聚合项目</h3>
<p>通过 maven 可以创建父子-聚合项目。 所谓的父子项目，即有一个父项目，有多个子项目。<br>
这些子项目，在业务逻辑上，都归纳在这个父项目下，并且一般来说，都会有重复的jar包共享。<br>
所以常用的做法会把重复的 jar 包都放在父项目下进行依赖，那么子项目就无需再去依赖这些重复的 jar 包了。</p>
<h3 id="步骤-2-创建父项目"><a class="header-anchor" href="#步骤-2-创建父项目">¶</a>步骤 2 : 创建父项目</h3>
<p>菜单-&gt;File-&gt;New-&gt;Other-&gt;maven-Maven Project-&gt;Next</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9271.png" alt></p>
<h3 id="步骤-3-选择简单项目"><a class="header-anchor" href="#步骤-3-选择简单项目">¶</a>步骤 3 : 选择简单项目</h3>
<p>选择 Create a simple project. 这一步不是必须，只是简单一点。<br>
然后点击Next</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9272.png" alt></p>
<h3 id="步骤-4-输入参数"><a class="header-anchor" href="#步骤-4-输入参数">¶</a>步骤 4 : 输入参数</h3>
<p>输入参数，主要是项目名称： parentMavenProject， 然后点击 Next</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9273.png" alt></p>
<h3 id="步骤-5-parentMavenProject-的-pom-xml"><a class="header-anchor" href="#步骤-5-parentMavenProject-的-pom-xml">¶</a>步骤 5 : parentMavenProject 的 pom.xml</h3>
<p>修改pom，主要两点：</p>
<ol>
<li>默认是 jar, 修改为pom。 这样才可以作为父项目存在。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>增加 hutool jar 包的依赖，用于后来子项目里观察对其的调用。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.how2j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-update-maven"><a class="header-anchor" href="#步骤-6-update-maven">¶</a>步骤 6 : update maven</h3>
<p>修改 pom.xml 之后， 右键点击项目 -&gt; Maven -&gt; Update Project -&gt; OK 进行更新。 否则项目会有红点~</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9275.png" alt></p>
<h3 id="步骤-7-创建子项目"><a class="header-anchor" href="#步骤-7-创建子项目">¶</a>步骤 7 : 创建子项目</h3>
<p>接下来创建maven 子项目。 maven 子项目有叫做模块 module.<br>
为了能够在 parentMavenProject 的基础上创建其子项目，首先右键点击 parentMavenProject， 然后点击 New -&gt; Other -&gt; Maven -Maven Module -&gt; Next</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9276.png" alt></p>
<h3 id="步骤-8-简单项目"><a class="header-anchor" href="#步骤-8-简单项目">¶</a>步骤 8 : 简单项目</h3>
<p>和父项目一样，这里也勾选 Craete a simple project ( 非必须 )，然后点 Next</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9277.png" alt></p>
<h3 id="步骤-9-项目参数"><a class="header-anchor" href="#步骤-9-项目参数">¶</a>步骤 9 : 项目参数</h3>
<p>接着点 Finish</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9279.png" alt></p>
<h3 id="步骤-10-TestHutool"><a class="header-anchor" href="#步骤-10-TestHutool">¶</a>步骤 10 : TestHutool</h3>
<p>运行，现在看到运行效果。<br>
就表示子项目虽然没有依赖jar包，但是通过 父项目达到了依赖的效果。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9280.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> childMavenProject;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHutool</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String dateStr = <span class="string">"2012-12-12 12:12:12"</span>;</span><br><span class="line">        Date date = DateUtil.parse(dateStr);</span><br><span class="line">        System.out.println(date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-子项目的pom-xml"><a class="header-anchor" href="#步骤-11-子项目的pom-xml">¶</a>步骤 11 : 子项目的pom.xml</h3>
<p>这里仅仅是展示出来，可以看到其中有如下parent，就表示是引用父项目 parentMavenProject。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.how2j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.how2j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>childMavenProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>childMavenProject<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>childMavenProject<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-父项目的pom-xml"><a class="header-anchor" href="#步骤-12-父项目的pom-xml">¶</a>步骤 12 : 父项目的pom.xml</h3>
<p>再次打开父项目的pom.xml, 会发现其多了一个：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>childMavenProject<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表示其子模块是 childMavenProject</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.how2j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>parentMavenProject<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>childMavenProject<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-目录结构"><a class="header-anchor" href="#步骤-13-目录结构">¶</a>步骤 13 : 目录结构</h3>
<p>观察目录结构，可以发现 childMavenProject 是位于 parentMavenProject下面的。 所以如果将来有 childMavenProject1, childMavenProject2, childMavenProject3 也会放在这么一个目录下，就方便管理了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/9283.png" alt></p>
<h3 id="步骤-14-可运行项目"><a class="header-anchor" href="#步骤-14-可运行项目">¶</a>步骤 14 : 可运行项目</h3>
<p>在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h1 id="二、调试"><a class="header-anchor" href="#二、调试">¶</a>二、调试</h1>
<h2 id="1、如何在ECLIPSE中调试JAVA程序"><a class="header-anchor" href="#1、如何在ECLIPSE中调试JAVA程序">¶</a>1、如何在ECLIPSE中调试JAVA程序</h2>
<h3 id="步骤-1-准备一段Java代码"><a class="header-anchor" href="#步骤-1-准备一段Java代码">¶</a>步骤 1 : 准备一段Java代码</h3>
<p>这是一个有for循环的Java代码，利于观察设置断点的效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">int</span> moneyEachDay = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> day = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= day; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span>==moneyEachDay)</span><br><span class="line">                moneyEachDay = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                moneyEachDay *= <span class="number">2</span>;</span><br><span class="line">              </span><br><span class="line">            sum+=moneyEachDay;</span><br><span class="line">              </span><br><span class="line">            System.out.println(i + <span class="string">" 天之后，洪帮主手中的钱总数是: "</span> + sum );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-设置断点"><a class="header-anchor" href="#步骤-2-设置断点">¶</a>步骤 2 : 设置断点</h3>
<p>断点概念： 断点就是指在调试模式下，当代码运行到断点这个位置的时候，就会停下来，便于开发者观察相关数据，进行代码逻辑的分析，排错。</p>
<p>设置断点有几种方式，比如要在第八行设置断点</p>
<ol>
<li>在行号8那个位置，右键点击鼠标，然后选择Toggle Breakpoint就可以添加或者删除断点了</li>
<li>在行号8那个位置， 双击鼠标左键也可以添加或者删除断点。</li>
<li>菜单-&gt;Run也可以，不常用，没有鼠标方便。</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5609.png" alt></p>
<h3 id="步骤-3-点击调试按钮"><a class="header-anchor" href="#步骤-3-点击调试按钮">¶</a>步骤 3 : 点击调试按钮</h3>
<p>在平时用运行按钮左边， 有个虫子按钮，就是debug按钮。<br>
点击进行调试。<br>
<strong>注：</strong> 需要注意的是，当前类，一定要有主方法，否则就会调试到 <strong>上一次成功运行的程序</strong></p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5610.png" alt></p>
<h3 id="步骤-4-确认切换到调试Perspective"><a class="header-anchor" href="#步骤-4-确认切换到调试Perspective">¶</a>步骤 4 : 确认切换到调试Perspective</h3>
<p>如果是第一次运行，会弹出一个对话框询问是否要切换到调试视觉, 点击YES。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5611.png" alt></p>
<h3 id="步骤-5-切换回开发Java代码的Perspective"><a class="header-anchor" href="#步骤-5-切换回开发Java代码的Perspective">¶</a>步骤 5 : 切换回开发Java代码的Perspective</h3>
<p>点击右上角的Debug旁边的 Java，就可以切换回原来熟悉的Java 开发环境了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5612.png" alt></p>
<h3 id="步骤-6-调试Perspective"><a class="header-anchor" href="#步骤-6-调试Perspective">¶</a>步骤 6 : 调试Perspective</h3>
<p>在调试视觉，需要关注的是这么4个区域</p>
<ol>
<li>当前是哪个线程，因为是非多线程程序，所以就是主线程</li>
<li>对第八行运行有影响的几个变量的值，这个就是调试的主要作用，观察这些值的多少，进行分析问题所在或者理解代码逻辑</li>
<li>当前代码，表示<strong>马上就要运行第八行</strong>，但是还没有来得及运行第八行</li>
<li>控制台输出</li>
</ol>
<p>其他还有些区域，不常用</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5613.png" alt></p>
<h3 id="步骤-7-单步运行"><a class="header-anchor" href="#步骤-7-单步运行">¶</a>步骤 7 : 单步运行</h3>
<p>点击这个按钮，就可以一行一行的执行了，或者用快捷键F6</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5614.png" alt></p>
<h3 id="步骤-8-观察右上角-Variables的变化"><a class="header-anchor" href="#步骤-8-观察右上角-Variables的变化">¶</a>步骤 8 : 观察右上角 Variables的变化</h3>
<p>这是调试期间主要需要注意的区域，通过观察，分析，理解这些值的变化来加强对代码的理解，或者寻找代码的错误所在</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5615.png" alt></p>
<h3 id="步骤-9-退出"><a class="header-anchor" href="#步骤-9-退出">¶</a>步骤 9 : 退出</h3>
<p>红色按钮，点击退出</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5616.png" alt></p>
<h2 id="2、如何在ECLIPSE中调试JAVA-WEB程序"><a class="header-anchor" href="#2、如何在ECLIPSE中调试JAVA-WEB程序">¶</a>2、如何在ECLIPSE中调试JAVA WEB程序</h2>
<h3 id="步骤-1-动态Web项目"><a class="header-anchor" href="#步骤-1-动态Web项目">¶</a>步骤 1 : 动态Web项目</h3>
<p>本教材讲解如何对在Eclipse中运行的Tomcat进行单步调试。<br>
要通过Eclipse内置Tomcat运行一个项目，这个项目需要是一个动态Web项目。<br>
对动态Web项目不熟悉的同学，请先掌握 [创建]</p>
<h3 id="步骤-2-下载j2ee项目"><a class="header-anchor" href="#步骤-2-下载j2ee项目">¶</a>步骤 2 : 下载j2ee项目</h3>
<p>这个项目使用 [创建] 中右上角的j2ee.rar 项目来进行演示，请前往下载： [创建]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5625.png" alt></p>
<h3 id="步骤-3-设置断点"><a class="header-anchor" href="#步骤-3-设置断点">¶</a>步骤 3 : 设置断点</h3>
<p>打开文件 HelloServlet 对第13行进行断点设置.<br>
断点概念： 断点就是指在调试模式下，当代码运行到断点这个位置的时候，就会停下来，便于开发者观察相关数据，进行代码逻辑的分析，排错。</p>
<p>设置断点有几种方式，比如要在第13行设置断点</p>
<ol>
<li>在行号13那个位置，右键点击鼠标，然后选择Toggle Breakpoint就可以添加或者删除断点了</li>
<li>在行号13那个位置， 双击鼠标左键也可以添加或者删除断点。</li>
<li>菜单-&gt;Run也可以，不常用，没有鼠标方便。</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5618.png" alt></p>
<h3 id="步骤-4-点击调试按钮"><a class="header-anchor" href="#步骤-4-点击调试按钮">¶</a>步骤 4 : 点击调试按钮</h3>
<p>在平时用运行按钮左边， 有个虫子按钮，就是debug按钮。<br>
点击按钮旁边的向下箭头，然后点击出现的 Tomcat v7.0 Server at localhost</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5619.png" alt></p>
<h3 id="步骤-5-确认切换到调试Perspective"><a class="header-anchor" href="#步骤-5-确认切换到调试Perspective">¶</a>步骤 5 : 确认切换到调试Perspective</h3>
<p>如果是第一次运行，会弹出一个对话框询问是否要切换到调试视觉, 点击YES。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5620.png" alt></p>
<h3 id="步骤-6-调试Perspective-v2"><a class="header-anchor" href="#步骤-6-调试Perspective-v2">¶</a>步骤 6 : 调试Perspective</h3>
<p>在调试视觉，需要关注的是这么4个区域</p>
<ol>
<li>当前是哪个线程，Tomcat里有个线程池，所以会有多个线程，而当前线程是 :http-bio-8080=exec-3。</li>
<li>对第13行运行有影响的几个变量的值，比如request和response对象。</li>
<li>当前代码，表示<strong>马上就要运行第13行</strong>，但是还没有来得及运行第13行</li>
<li>控制台输出</li>
</ol>
<p>其他还有些区域，不常用</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5621.png" alt></p>
<h3 id="步骤-7-单步运行-v2"><a class="header-anchor" href="#步骤-7-单步运行-v2">¶</a>步骤 7 : 单步运行</h3>
<p>点击这个按钮，就可以一行一行的执行了，或者用快捷键F6</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5622.png" alt></p>
<h3 id="步骤-8-退出"><a class="header-anchor" href="#步骤-8-退出">¶</a>步骤 8 : 退出</h3>
<p>点击红色按钮退出</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5624.png" alt></p>
<h2 id="3、多控制台显示"><a class="header-anchor" href="#3、多控制台显示">¶</a>3、多控制台显示</h2>
<h3 id="步骤-1-单控制台"><a class="header-anchor" href="#步骤-1-单控制台">¶</a>步骤 1 : 单控制台</h3>
<p>默认情况下，Eclipse的输出是只有一个控制台可以看到的，如图所示</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7496.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-多控制台需求"><a class="header-anchor" href="#步骤-2-多控制台需求">¶</a>步骤 2 : 多控制台需求</h3>
<p>但是有时候，需要启动两个进程，并且两个进程的控制台都能同时看到，以便于观察和比较。<br>
如图所示，左边一个控制台，已经跑到200多了，右边的控制台还在8，要达到这样的效果请看后面步骤</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7497.png" alt></p>
<h3 id="步骤-3-启动多个控制台"><a class="header-anchor" href="#步骤-3-启动多个控制台">¶</a>步骤 3 : 启动多个控制台</h3>
<p>如图所示，先点击1那个位置，会出现一个下拉，然后选择2 New Console View，这样就会多出一个控制台了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7498.png" alt></p>
<h3 id="步骤-4-拖动新的控制台"><a class="header-anchor" href="#步骤-4-拖动新的控制台">¶</a>步骤 4 : 拖动新的控制台</h3>
<p>虽然有了新的控制台，但是它和旧的控制台还是在同一个tab下，同一时间只能看到一个。<br>
此时，点住新的控制台标签，然后向右边拖动，这样两个控制台就都能同时显示了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7499.png" alt></p>
<h3 id="步骤-5-不同控制台显示不同进程"><a class="header-anchor" href="#步骤-5-不同控制台显示不同进程">¶</a>步骤 5 : 不同控制台显示不同进程</h3>
<p>此时虽然两个控制台都同时看到了，但是启动两次 [单控制台] 里的Test 代码，会发现两个控制台都显示的是一个进程的，这个时候再选中任意控制台里的如图所示红色箭头所指的小屏幕，通过下拉切换到另一个进程。 这样两个控制台就各自显示各自进程的打印信息了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7500.png" alt></p>
<h3 id="步骤-6-注意"><a class="header-anchor" href="#步骤-6-注意">¶</a>步骤 6 : 注意</h3>
<p>最后需要注意的是，红色箭头指向的这个按钮 叫做 ： show Console When Standard Out Changes. 它应该处于 <strong>非选中状态</strong><br>
否则只要任意进程有新的输出，所有控制台都会显示那个进程，而放弃原有的进程了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7501.png" alt></p>
<h1 id="五、REDIS"><a class="header-anchor" href="#五、REDIS">¶</a>五、REDIS</h1>
<h2 id="1、下载安装"><a class="header-anchor" href="#1、下载安装">¶</a>1、下载安装</h2>
<h3 id="步骤-1-关于JDK版本"><a class="header-anchor" href="#步骤-1-关于JDK版本">¶</a>步骤 1 : 关于JDK版本</h3>
<p>至少使用JDK8版本，请下载JDK8或者更高版本： [下载以及配置JDK环境]</p>
<h3 id="步骤-2-什么是Redis"><a class="header-anchor" href="#步骤-2-什么是Redis">¶</a>步骤 2 : 什么是Redis</h3>
<p>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>
<p>换句话说，Redis就像是一个HashMap，不过不是在JVM中运行，而是以一个独立进程的形式运行。</p>
<p>一般说来，会被当作缓存使用。 因为它比数据库(mysql)快，所以常用的数据，可以考虑放在这里，这样就提高了性能。</p>
<h3 id="步骤-3-Redis官网"><a class="header-anchor" href="#步骤-3-Redis官网">¶</a>步骤 3 : Redis官网</h3>
<p>本教程讲解如何在Windows上安装Redis<br>
redis官网：<a href="http://redis.io/" target="_blank" rel="noopener">http://redis.io</a><br>
windows版本的下载地址是： <a href="http://redis.io/download" target="_blank" rel="noopener">http://redis.io/download</a><br>
点击进去之后会跳转到： <a href="https://github.com/mythz/redis-windows" target="_blank" rel="noopener">https://github.com/mythz/redis-windows</a></p>
<p>是一个开源项目，所以从github上下载后，需要自己编译生成exe文件，但是为了编译生成exe文件，又需要用到Visual Studio一套，很是麻烦。<br>
所以我把编译好之后打了个压缩包，放在右上角redis-64.3.0.503.zip，方便大家下载。</p>
<p>只有64位的，32位的没有，找来找去，只找到了一个redis2.4 的32位的，不过用法都一样，大家凑活着用吧</p>
<h3 id="步骤-4-下载并解压"><a class="header-anchor" href="#步骤-4-下载并解压">¶</a>步骤 4 : 下载并解压</h3>
<p>如图所示，右上角下载并解压就得到了客户端和服务端~<br>
注意自己的操作系统是32还是64，要使用匹配的才行</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5820.png" alt></p>
<h2 id="2、运行"><a class="header-anchor" href="#2、运行">¶</a>2、运行</h2>
<h3 id="步骤-1-运行位置"><a class="header-anchor" href="#步骤-1-运行位置">¶</a>步骤 1 : 运行位置</h3>
<p>我把Redis解压在了d:\software下，后续的讲解都基于这个位置</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5821.png" alt></p>
<h3 id="步骤-2-启动服务端"><a class="header-anchor" href="#步骤-2-启动服务端">¶</a>步骤 2 : 启动服务端</h3>
<p>通过win+r,cmd 运行命令行<br>
然后输入如下指令：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">d:</span></span><br><span class="line">cd software</span><br><span class="line">cd D:\software\redis-64.3.0.503</span><br><span class="line"><span class="attribute">redis-server.exe</span></span><br></pre></td></tr></table></figure>
<p>这样就启动了服务端</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5822.png" alt></p>
<h3 id="步骤-3-启动客户端"><a class="header-anchor" href="#步骤-3-启动客户端">¶</a>步骤 3 : 启动客户端</h3>
<p>通过win+r,cmd 运行命令行<br>
然后输入如下指令：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">d:</span></span><br><span class="line">cd software</span><br><span class="line">cd D:\software\redis-64.3.0.503</span><br><span class="line"><span class="attribute">redis-cli.exe</span></span><br></pre></td></tr></table></figure>
<p>这样就会如图所示通过客户端访问 redis 服务器</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5823.png" alt></p>
<h3 id="步骤-4-简单运用"><a class="header-anchor" href="#步骤-4-简单运用">¶</a>步骤 4 : 简单运用</h3>
<p>输入指令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set hero gareen</span><br><span class="line">get hero</span><br></pre></td></tr></table></figure>
<p>如此就实现了向服务器设置 hero 这个键值，并从服务器获取hero对应的值</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5824.png" alt></p>
<h2 id="3、常见命令"><a class="header-anchor" href="#3、常见命令">¶</a>3、常见命令</h2>
<h3 id="步骤-1-5种数据类型"><a class="header-anchor" href="#步骤-1-5种数据类型">¶</a>步骤 1 : 5种数据类型</h3>
<p>Redis目前有5种数据类型，分别是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String（字符串）</span><br><span class="line">List（列表）</span><br><span class="line">Hash（字典）</span><br><span class="line">Set（集合）</span><br><span class="line">Sorted Set（有序集合）</span><br></pre></td></tr></table></figure>
<p>不同的数据类型，有不同的命令方式，接下来根据不同的数据类型对常用命令做一些演示：</p>
<h3 id="步骤-2-String-字符串"><a class="header-anchor" href="#步骤-2-String-字符串">¶</a>步骤 2 : String 字符串</h3>
<p>按照如图所示，挨个挨个敲入如下命令，自然就知道什么用处啦。。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">set google http://www.google</span><br><span class="line">append google .com</span><br><span class="line">get google</span><br><span class="line">set visitors 0</span><br><span class="line">incr visitors</span><br><span class="line">incr visitors</span><br><span class="line">get visitors</span><br><span class="line">incrby visitors 100</span><br><span class="line">get visitors</span><br><span class="line">type google</span><br><span class="line">type visitors</span><br><span class="line">ttl google</span><br><span class="line">rename google google-site</span><br><span class="line">get google</span><br><span class="line">get google-site</span><br></pre></td></tr></table></figure>
<p>对于个别命令不明白的，还可以查阅如下手册，单独了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">SET key value                   设置key=value</span><br><span class="line">GET key                         获得键key对应的值</span><br><span class="line">GETRANGE key start end          得到字符串的子字符串存放在一个键</span><br><span class="line">GETSET key value                设置键的字符串值，并返回旧值</span><br><span class="line">GETBIT key offset               返回存储在键位值的字符串值的偏移</span><br><span class="line">MGET key1 [key2..]              得到所有的给定键的值</span><br><span class="line">SETBIT key offset value         设置或清除该位在存储在键的字符串值偏移</span><br><span class="line">SETEX key seconds value         键到期时设置值</span><br><span class="line">SETNX key value                 设置键的值，只有当该键不存在</span><br><span class="line">SETRANGE key offset value       覆盖字符串的一部分从指定键的偏移</span><br><span class="line">STRLEN key                      得到存储在键的值的长度</span><br><span class="line">MSET key value [key value...]   设置多个键和多个值</span><br><span class="line">MSETNX key value [key value...] 设置多个键多个值，只有在当没有按键的存在时</span><br><span class="line">PSETEX key milliseconds value   设置键的毫秒值和到期时间</span><br><span class="line">INCR key                        增加键的整数值一次</span><br><span class="line">INCRBY key increment            由给定的数量递增键的整数值</span><br><span class="line">INCRBYFLOAT key increment       由给定的数量递增键的浮点值</span><br><span class="line">DECR key                        递减键一次的整数值</span><br><span class="line">DECRBY key decrement            由给定数目递减键的整数值</span><br><span class="line">APPEND key value                追加值到一个键</span><br><span class="line">DEL key                         如果存在删除键</span><br><span class="line">DUMP key                        返回存储在指定键的值的序列化版本</span><br><span class="line">EXISTS key                      此命令检查该键是否存在</span><br><span class="line">EXPIRE key seconds              指定键的过期时间</span><br><span class="line">EXPIREAT key timestamp          指定的键过期时间。在这里，时间是在Unix时间戳格式</span><br><span class="line">PEXPIRE key milliseconds        设置键以毫秒为单位到期</span><br><span class="line">PEXPIREAT key milliseconds-timestamp        设置键在Unix时间戳指定为毫秒到期</span><br><span class="line">KEYS pattern                    查找与指定模式匹配的所有键</span><br><span class="line">MOVE key db                     移动键到另一个数据库</span><br><span class="line">PERSIST key                     移除过期的键</span><br><span class="line">PTTL key                        以毫秒为单位获取剩余时间的到期键。</span><br><span class="line">TTL key                         获取键到期的剩余时间。</span><br><span class="line">RANDOMKEY                       从Redis返回随机键</span><br><span class="line">RENAME key newkey               更改键的名称</span><br><span class="line">RENAMENX key newkey             重命名键，如果新的键不存在</span><br><span class="line">TYPE key                        返回存储在键的数据类型的值。</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5827.png" alt></p>
<h3 id="步骤-3-List-列表"><a class="header-anchor" href="#步骤-3-List-列表">¶</a>步骤 3 : List 列表</h3>
<p>按照如图所示，挨个挨个敲入如下命令，自然就知道什么用处啦。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lpush list1 redis</span><br><span class="line">lpush list1 hello</span><br><span class="line">rpush list1 world</span><br><span class="line">llen list1</span><br><span class="line">lrange list1 <span class="number">0</span> <span class="number">3</span></span><br><span class="line">lpop list1</span><br><span class="line">rpop list1</span><br><span class="line">lrange list1 <span class="number">0</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>对于个别命令不明白的，还可以查阅如下手册，单独了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BLPOP key1 [key2 ] timeout 取出并获取列表中的第一个元素，或阻塞，直到有可用</span><br><span class="line">BRPOP key1 [key2 ] timeout 取出并获取列表中的最后一个元素，或阻塞，直到有可用</span><br><span class="line">BRPOPLPUSH source destination timeout 从列表中弹出一个值，它推到另一个列表并返回它;或阻塞，直到有可用</span><br><span class="line">LINDEX key index 从一个列表其索引获取对应的元素</span><br><span class="line">LINSERT key BEFORE|AFTER pivot value 在列表中的其他元素之后或之前插入一个元素</span><br><span class="line">LLEN key 获取列表的长度</span><br><span class="line">LPOP key 获取并取出列表中的第一个元素</span><br><span class="line">LPUSH key value1 [value2] 在前面加上一个或多个值的列表</span><br><span class="line">LPUSHX key value 在前面加上一个值列表，仅当列表中存在</span><br><span class="line">LRANGE key start stop 从一个列表获取各种元素</span><br><span class="line">LREM key count value 从列表中删除元素</span><br><span class="line">LSET key index value 在列表中的索引设置一个元素的值</span><br><span class="line">LTRIM key start stop 修剪列表到指定的范围内</span><br><span class="line">RPOP key 取出并获取列表中的最后一个元素</span><br><span class="line">RPOPLPUSH source destination 删除最后一个元素的列表，将其附加到另一个列表并返回它</span><br><span class="line">RPUSH key value1 [value2] 添加一个或多个值到列表</span><br><span class="line">RPUSHX key value 添加一个值列表，仅当列表中存在</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5829.png" alt></p>
<h3 id="步骤-4-Hash-字典，哈希表"><a class="header-anchor" href="#步骤-4-Hash-字典，哈希表">¶</a>步骤 4 : Hash 字典，哈希表</h3>
<p>按照如图所示，挨个挨个敲入如下命令，自然就知道什么用处啦。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hset person name jack</span><br><span class="line">hset person age <span class="number">20</span></span><br><span class="line">hset person sex female</span><br><span class="line">hgetall person</span><br><span class="line">hkeys person</span><br><span class="line">hvals person</span><br></pre></td></tr></table></figure>
<p>对于个别命令不明白的，还可以查阅如下手册，单独了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">HDEL key field[field...] 删除对象的一个或几个属性域，不存在的属性将被忽略</span><br><span class="line">HEXISTS key field 查看对象是否存在该属性域</span><br><span class="line">HGET key field 获取对象中该field属性域的值</span><br><span class="line">HGETALL key 获取对象的所有属性域和值</span><br><span class="line">HINCRBY key field value 将该对象中指定域的值增加给定的value，原子自增操作，只能是integer的属性值可以使用</span><br><span class="line">HINCRBYFLOAT key field increment 将该对象中指定域的值增加给定的浮点数</span><br><span class="line">HKEYS key 获取对象的所有属性字段</span><br><span class="line">HVALS key 获取对象的所有属性值</span><br><span class="line">HLEN key 获取对象的所有属性字段的总数</span><br><span class="line">HMGET key field[field...] 获取对象的一个或多个指定字段的值</span><br><span class="line">HSET key field value 设置对象指定字段的值</span><br><span class="line">HMSET key field value [field value ...] 同时设置对象中一个或多个字段的值</span><br><span class="line">HSETNX key field value 只在对象不存在指定的字段时才设置字段的值</span><br><span class="line">HSTRLEN key field 返回对象指定field的value的字符串长度，如果该对象或者field不存在，返回<span class="number">0</span>.</span><br><span class="line">HSCAN key cursor [MATCH pattern] [COUNT count] 类似SCAN命令</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5830.png" alt></p>
<h3 id="步骤-5-Set-集合"><a class="header-anchor" href="#步骤-5-Set-集合">¶</a>步骤 5 : Set 集合</h3>
<p>按照如图所示，挨个挨个敲入如下命令，自然就知道什么用处啦。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SADD myset <span class="string">"Hello"</span></span><br><span class="line">SADD myset <span class="string">"World"</span></span><br><span class="line">SMEMBERS myset</span><br><span class="line">SADD myset <span class="string">"one"</span></span><br><span class="line">SISMEMBER myset <span class="string">"one"</span></span><br><span class="line">SISMEMBER myset <span class="string">"two"</span></span><br></pre></td></tr></table></figure>
<p>对于个别命令不明白的，还可以查阅如下手册，单独了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SADD key member [member ...] 添加一个或者多个元素到集合(set)里</span><br><span class="line">SCARD key 获取集合里面的元素数量</span><br><span class="line">SDIFF key [key ...] 获得队列不存在的元素</span><br><span class="line">SDIFFSTORE destination key [key ...] 获得队列不存在的元素，并存储在一个关键的结果集</span><br><span class="line">SINTER key [key ...] 获得两个集合的交集</span><br><span class="line">SINTERSTORE destination key [key ...] 获得两个集合的交集，并存储在一个集合中</span><br><span class="line">SISMEMBER key member 确定一个给定的值是一个集合的成员</span><br><span class="line">SMEMBERS key 获取集合里面的所有key</span><br><span class="line">SMOVE source destination member 移动集合里面的一个key到另一个集合</span><br><span class="line">SPOP key [count] 获取并删除一个集合里面的元素</span><br><span class="line">SRANDMEMBER key [count] 从集合里面随机获取一个元素</span><br><span class="line">SREM key member [member ...] 从集合里删除一个或多个元素，不存在的元素会被忽略</span><br><span class="line">SUNION key [key ...] 添加多个set元素</span><br><span class="line">SUNIONSTORE destination key [key ...] 合并set元素，并将结果存入新的set里面</span><br><span class="line">SSCAN key cursor [MATCH pattern] [COUNT count] 迭代set里面的元素</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5831.png" alt></p>
<h3 id="步骤-6-Sorted-Set-有序集合"><a class="header-anchor" href="#步骤-6-Sorted-Set-有序集合">¶</a>步骤 6 : Sorted Set 有序集合</h3>
<p>按照如图所示，挨个挨个敲入如下命令，自然就知道什么用处啦。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zadd dbs <span class="number">100</span> redis</span><br><span class="line">zadd dbs <span class="number">98</span> memcached</span><br><span class="line">zadd dbs <span class="number">99</span> mongodb</span><br><span class="line">zadd dbs <span class="number">99</span> leveldb</span><br><span class="line">zcard dbs</span><br><span class="line">zcount dbs <span class="number">10</span> <span class="number">99</span></span><br><span class="line">zrank dbs leveldb</span><br><span class="line">zrank dbs other</span><br><span class="line">zrangebyscore dbs <span class="number">98</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>对于个别命令不明白的，还可以查阅如下手册，单独了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ZADD key score1 member1 [score2 member2] 添加一个或多个成员到有序集合，或者如果它已经存在更新其分数</span><br><span class="line">ZCARD key 得到的有序集合成员的数量</span><br><span class="line">ZCOUNT key min max 计算一个有序集合成员与给定值范围内的分数</span><br><span class="line">ZINCRBY key increment member 在有序集合增加成员的分数</span><br><span class="line">ZINTERSTORE destination numkeys key [key ...] 多重交叉排序集合，并存储生成一个新的键有序集合。</span><br><span class="line">ZLEXCOUNT key min max 计算一个给定的字典范围之间的有序集合成员的数量</span><br><span class="line">ZRANGE key start stop [WITHSCORES] 由索引返回一个成员范围的有序集合（从低到高）</span><br><span class="line">ZRANGEBYLEX key min max [LIMIT offset count]返回一个成员范围的有序集合（由字典范围）</span><br><span class="line">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] 返回有序集key中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员，有序集成员按 score 值递增(从小到大)次序排列</span><br><span class="line">ZRANK key member 确定成员的索引中有序集合</span><br><span class="line">ZREM key member [member ...] 从有序集合中删除一个或多个成员，不存在的成员将被忽略</span><br><span class="line">ZREMRANGEBYLEX key min max 删除所有成员在给定的字典范围之间的有序集合</span><br><span class="line">ZREMRANGEBYRANK key start stop 在给定的索引之内删除所有成员的有序集合</span><br><span class="line">ZREMRANGEBYSCORE key min max 在给定的分数之内删除所有成员的有序集合</span><br><span class="line">ZREVRANGE key start stop [WITHSCORES] 返回一个成员范围的有序集合，通过索引，以分数排序，从高分到低分</span><br><span class="line">ZREVRANGEBYSCORE key max min [WITHSCORES] 返回一个成员范围的有序集合，以socre排序从高到低</span><br><span class="line">ZREVRANK key member 确定一个有序集合成员的索引，以分数排序，从高分到低分</span><br><span class="line">ZSCORE key member 获取给定成员相关联的分数在一个有序集合</span><br><span class="line">ZUNIONSTORE destination numkeys key [key ...] 添加多个集排序，所得排序集合存储在一个新的键</span><br><span class="line">ZSCAN key cursor [MATCH pattern] [COUNT count] 增量迭代排序元素集和相关的分数</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5832.png" alt></p>
<h3 id="步骤-7-官方命令手册"><a class="header-anchor" href="#步骤-7-官方命令手册">¶</a>步骤 7 : 官方命令手册</h3>
<p>如果还想查询每个命令的详细用法，请到redis官方命令手册：<br>
<a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener">http://www.redis.cn/commands.html</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">指令都是基<span class="number">0</span>的；</span><br><span class="line">分割操作和Java中一般的左闭右开不同，是全闭的；</span><br><span class="line">有序集合的成员是唯一的,但分数(score)却可以重复,若向其中加入相同名称的成员，集合中该成员的score会更新为新加入成员的score;</span><br></pre></td></tr></table></figure>
<h2 id="4、JEDIS-教程"><a class="header-anchor" href="#4、JEDIS-教程">¶</a>4、JEDIS 教程</h2>
<h3 id="步骤-1-什么是Jedis"><a class="header-anchor" href="#步骤-1-什么是Jedis">¶</a>步骤 1 : 什么是Jedis</h3>
<p>在[常见命令]中，使用各种Redis自带客户端的命令行方式访问Redis服务。 而在实际工作中却需要用到Java代码才能访问，使用第三方jar包 ：Jedis就能方便地访问Redis的各种服务了。</p>
<h3 id="步骤-2-jar包"><a class="header-anchor" href="#步骤-2-jar包">¶</a>步骤 2 : jar包</h3>
<p>jedis jar包在上角可以下载</p>
<h3 id="步骤-3-TestJedis"><a class="header-anchor" href="#步骤-3-TestJedis">¶</a>步骤 3 : TestJedis</h3>
<p>这是一个很简单的Jedis应用，就是set 和get，可以看到如图所示的效果，取出了foo的值。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/5835.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRedis</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>);</span><br><span class="line">        jedis.set(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span><br><span class="line">        String value = jedis.get(<span class="string">"foo"</span>);</span><br><span class="line">        System.out.println(value);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-TestRedisManyCommands"><a class="header-anchor" href="#步骤-4-TestRedisManyCommands">¶</a>步骤 4 : TestRedisManyCommands</h3>
<p>这是一个较为丰富的运用，演示了各种不同数据类型的运用方式。<br>
为了运行，需要用到junit的jar包，在右上角的可运行项目 jedis.rar里包含了有。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redis;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRedisManyCommands</span> </span>&#123; </span><br><span class="line">    JedisPool pool; </span><br><span class="line">    Jedis jedis; </span><br><span class="line">    <span class="meta">@Before</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123; </span><br><span class="line">   </span><br><span class="line">        jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>); </span><br><span class="line">           </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Redis存储初级的字符串</span></span><br><span class="line"><span class="comment">     * CRUD</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBasicString</span><span class="params">()</span></span>&#123; </span><br><span class="line">        <span class="comment">//-----添加数据---------- </span></span><br><span class="line">        jedis.set(<span class="string">"name"</span>,<span class="string">"meepo"</span>);<span class="comment">//向key--&gt;name中放入了value--&gt;meepo </span></span><br><span class="line">        System.out.println(jedis.get(<span class="string">"name"</span>));<span class="comment">//执行结果：meepo </span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//-----修改数据----------- </span></span><br><span class="line">        <span class="comment">//1、在原来基础上修改 </span></span><br><span class="line">        jedis.append(<span class="string">"name"</span>,<span class="string">"dota"</span>);   <span class="comment">//很直观，类似map 将dota append到已经有的value之后 </span></span><br><span class="line">        System.out.println(jedis.get(<span class="string">"name"</span>));<span class="comment">//执行结果:meepodota </span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//2、直接覆盖原来的数据 </span></span><br><span class="line">        jedis.set(<span class="string">"name"</span>,<span class="string">"poofu"</span>); </span><br><span class="line">        System.out.println(jedis.get(<span class="string">"name"</span>));<span class="comment">//执行结果：poofu </span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//删除key对应的记录 </span></span><br><span class="line">        jedis.del(<span class="string">"name"</span>); </span><br><span class="line">        System.out.println(jedis.get(<span class="string">"name"</span>));<span class="comment">//执行结果：null </span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * mset相当于</span></span><br><span class="line"><span class="comment">         * jedis.set("name","meepo");</span></span><br><span class="line"><span class="comment">         * jedis.set("dota","poofu");</span></span><br><span class="line"><span class="comment">         */</span> </span><br><span class="line">        jedis.mset(<span class="string">"name"</span>,<span class="string">"meepo"</span>,<span class="string">"dota"</span>,<span class="string">"poofu"</span>); </span><br><span class="line">        System.out.println(jedis.mget(<span class="string">"name"</span>,<span class="string">"dota"</span>)); </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jedis操作Map</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMap</span><span class="params">()</span></span>&#123; </span><br><span class="line">        Map&lt;String,String&gt; user=<span class="keyword">new</span> HashMap&lt;String,String&gt;(); </span><br><span class="line">        user.put(<span class="string">"name"</span>,<span class="string">"meepo"</span>); </span><br><span class="line">        user.put(<span class="string">"pwd"</span>,<span class="string">"password"</span>); </span><br><span class="line">        jedis.hmset(<span class="string">"user"</span>,user); </span><br><span class="line">        <span class="comment">//取出user中的name，执行结果:[meepo]--&gt;注意结果是一个泛型的List </span></span><br><span class="line">        <span class="comment">//第一个参数是存入redis中map对象的key，后面跟的是放入map中的对象的key，后面的key可以跟多个，是可变参数 </span></span><br><span class="line">        List&lt;String&gt; rsmap = jedis.hmget(<span class="string">"user"</span>, <span class="string">"name"</span>); </span><br><span class="line">        System.out.println(rsmap); </span><br><span class="line"> </span><br><span class="line">        <span class="comment">//删除map中的某个键值 </span></span><br><span class="line"><span class="comment">//        jedis.hdel("user","pwd"); </span></span><br><span class="line">        System.out.println(jedis.hmget(<span class="string">"user"</span>, <span class="string">"pwd"</span>)); <span class="comment">//因为删除了，所以返回的是null </span></span><br><span class="line">        System.out.println(jedis.hlen(<span class="string">"user"</span>)); <span class="comment">//返回key为user的键中存放的值的个数1 </span></span><br><span class="line">        System.out.println(jedis.exists(<span class="string">"user"</span>));<span class="comment">//是否存在key为user的记录 返回true </span></span><br><span class="line">        System.out.println(jedis.hkeys(<span class="string">"user"</span>));<span class="comment">//返回map对象中的所有key  [pwd, name] </span></span><br><span class="line">        System.out.println(jedis.hvals(<span class="string">"user"</span>));<span class="comment">//返回map对象中的所有value  [meepo, password] </span></span><br><span class="line"> </span><br><span class="line">        Iterator&lt;String&gt; iter=jedis.hkeys(<span class="string">"user"</span>).iterator(); </span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext())&#123; </span><br><span class="line">            String key = iter.next(); </span><br><span class="line">            System.out.println(key+<span class="string">":"</span>+jedis.hmget(<span class="string">"user"</span>,key)); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jedis操作List</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span></span>&#123; </span><br><span class="line">        <span class="comment">//开始前，先移除所有的内容 </span></span><br><span class="line">        jedis.del(<span class="string">"java framework"</span>); </span><br><span class="line">        <span class="comment">// 第一个是key，第二个是起始位置，第三个是结束位置，jedis.llen获取长度 -1表示取得所有</span></span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"java framework"</span>,<span class="number">0</span>,-<span class="number">1</span>)); </span><br><span class="line">       <span class="comment">//先向key java framework中存放三条数据 </span></span><br><span class="line">       jedis.lpush(<span class="string">"java framework"</span>,<span class="string">"spring"</span>); </span><br><span class="line">       jedis.lpush(<span class="string">"java framework"</span>,<span class="string">"struts"</span>); </span><br><span class="line">       jedis.lpush(<span class="string">"java framework"</span>,<span class="string">"hibernate"</span>); </span><br><span class="line">       <span class="comment">//再取出所有数据jedis.lrange是按范围取出， </span></span><br><span class="line">       <span class="comment">// 第一个是key，第二个是起始位置，第三个是结束位置，jedis.llen获取长度 -1表示取得所有 </span></span><br><span class="line">       System.out.println(jedis.lrange(<span class="string">"java framework"</span>,<span class="number">0</span>,-<span class="number">1</span>)); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jedis操作Set</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSet</span><span class="params">()</span></span>&#123; </span><br><span class="line">        <span class="comment">//添加 </span></span><br><span class="line">        jedis.sadd(<span class="string">"sname"</span>,<span class="string">"meepo"</span>); </span><br><span class="line">        jedis.sadd(<span class="string">"sname"</span>,<span class="string">"dota"</span>); </span><br><span class="line">        jedis.sadd(<span class="string">"sname"</span>,<span class="string">"poofu"</span>); </span><br><span class="line">        jedis.sadd(<span class="string">"sname"</span>,<span class="string">"noname"</span>);</span><br><span class="line">        <span class="comment">//移除noname </span></span><br><span class="line">        jedis.srem(<span class="string">"sname"</span>,<span class="string">"noname"</span>); </span><br><span class="line">        System.out.println(jedis.smembers(<span class="string">"sname"</span>));<span class="comment">//获取所有加入的value </span></span><br><span class="line">        System.out.println(jedis.sismember(<span class="string">"sname"</span>, <span class="string">"meepo"</span>));<span class="comment">//判断 meepo 是否是sname集合的元素 </span></span><br><span class="line">        System.out.println(jedis.srandmember(<span class="string">"sname"</span>)); </span><br><span class="line">        System.out.println(jedis.scard(<span class="string">"sname"</span>));<span class="comment">//返回集合的元素个数 </span></span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; </span><br><span class="line">        <span class="comment">//keys中传入的可以用通配符 </span></span><br><span class="line">        System.out.println(jedis.keys(<span class="string">"*"</span>)); <span class="comment">//返回当前库中所有的key  [sose, sanme, name, dota, foo, sname, java framework, user, braand] </span></span><br><span class="line">        System.out.println(jedis.keys(<span class="string">"*name"</span>));<span class="comment">//返回的sname   [sname, name] </span></span><br><span class="line">        System.out.println(jedis.del(<span class="string">"sanmdde"</span>));<span class="comment">//删除key为sanmdde的对象  删除成功返回1 删除失败（或者不存在）返回 0 </span></span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">"sname"</span>));<span class="comment">//返回给定key的有效时间，如果是-1则表示永远有效 </span></span><br><span class="line">        jedis.setex(<span class="string">"timekey"</span>, <span class="number">10</span>, <span class="string">"min"</span>);<span class="comment">//通过此方法，可以指定key的存活（有效时间） 时间为秒 </span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);<span class="comment">//睡眠5秒后，剩余时间将为&lt;=5 </span></span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">"timekey"</span>));   <span class="comment">//输出结果为5 </span></span><br><span class="line">        jedis.setex(<span class="string">"timekey"</span>, <span class="number">1</span>, <span class="string">"min"</span>);        <span class="comment">//设为1后，下面再看剩余时间就是1了 </span></span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">"timekey"</span>));  <span class="comment">//输出结果为1 </span></span><br><span class="line">        System.out.println(jedis.exists(<span class="string">"key"</span>));<span class="comment">//检查key是否存在 </span></span><br><span class="line">        System.out.println(jedis.rename(<span class="string">"timekey"</span>,<span class="string">"time"</span>)); </span><br><span class="line">        System.out.println(jedis.get(<span class="string">"timekey"</span>));<span class="comment">//因为移除，返回为null </span></span><br><span class="line">        System.out.println(jedis.get(<span class="string">"time"</span>)); <span class="comment">//因为将timekey 重命名为time 所以可以取得值 min </span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//jedis 排序 </span></span><br><span class="line">        <span class="comment">//注意，此处的rpush和lpush是List的操作。是一个双向链表（但从表现来看的） </span></span><br><span class="line">        jedis.del(<span class="string">"a"</span>);<span class="comment">//先清除数据，再加入数据进行测试 </span></span><br><span class="line">        jedis.rpush(<span class="string">"a"</span>, <span class="string">"1"</span>); </span><br><span class="line">        jedis.lpush(<span class="string">"a"</span>,<span class="string">"6"</span>); </span><br><span class="line">        jedis.lpush(<span class="string">"a"</span>,<span class="string">"3"</span>); </span><br><span class="line">        jedis.lpush(<span class="string">"a"</span>,<span class="string">"9"</span>); </span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"a"</span>,<span class="number">0</span>,-<span class="number">1</span>));<span class="comment">// [9, 3, 6, 1] </span></span><br><span class="line">        System.out.println(jedis.sort(<span class="string">"a"</span>)); <span class="comment">//[1, 3, 6, 9]  //输入排序后结果 </span></span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"a"</span>,<span class="number">0</span>,-<span class="number">1</span>)); </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5、SPRING-DATA-REDIS-使用例子"><a class="header-anchor" href="#5、SPRING-DATA-REDIS-使用例子">¶</a>5、SPRING DATA REDIS 使用例子</h2>
<h3 id="步骤-1-Spring-对-Redis的支持"><a class="header-anchor" href="#步骤-1-Spring-对-Redis的支持">¶</a>步骤 1 : Spring 对 Redis的支持</h3>
<p>Spring 对Redis的操作也有较好的支持，本例讲解如何用Spring 来访问 Redis</p>
<h3 id="步骤-2-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-2-先运行，看到效果，再学习">¶</a>步骤 2 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestRedis ，可以看到如图所示的效果，这些值都是通过spring 放进 Redis，然后又取出来的测试</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7525.png" alt></p>
<h3 id="步骤-3-模仿和排错"><a class="header-anchor" href="#步骤-3-模仿和排错">¶</a>步骤 3 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-4-redis-properties"><a class="header-anchor" href="#步骤-4-redis-properties">¶</a>步骤 4 : redis.properties</h3>
<p>这里指定连接 Redis 服务器的相关信息</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ip地址</span></span><br><span class="line"><span class="meta">redis.hostName</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="comment">#端口号</span></span><br><span class="line"><span class="meta">redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#如果有密码</span></span><br><span class="line"><span class="meta">redis.password</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#客户端超时时间单位是毫秒 默认是2000</span></span><br><span class="line"><span class="meta">redis.timeout</span>=<span class="string">2000</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#最大空闲数</span></span><br><span class="line"><span class="meta">redis.maxIdle</span>=<span class="string">10</span></span><br><span class="line"><span class="comment">#连接池的最大数据库连接数。设为0表示无限制,如果是jedis 2.4以后用redis.maxTotal</span></span><br><span class="line"><span class="meta">redis.maxActive</span>=<span class="string">10</span></span><br><span class="line"><span class="comment">#控制一个pool可分配多少个jedis实例,用来替换上面的redis.maxActive,如果是jedis 2.4以后用该属性</span></span><br><span class="line"><span class="meta">redis.maxTotal</span>=<span class="string">10</span></span><br><span class="line"><span class="comment">#最大建立连接等待时间。如果超过此时间将接到异常。设为-1表示无限制。</span></span><br><span class="line"><span class="meta">redis.maxWaitMillis</span>=<span class="string">1000</span></span><br><span class="line"><span class="comment">#连接的最小空闲时间 默认1800000毫秒(30分钟)</span></span><br><span class="line"><span class="meta">redis.minEvictableIdleTimeMillis</span>=<span class="string">300000</span></span><br><span class="line"><span class="comment">#每次释放连接的最大数目,默认3</span></span><br><span class="line"><span class="meta">redis.numTestsPerEvictionRun</span>=<span class="string">1024</span></span><br><span class="line"><span class="comment">#逐出扫描的时间间隔(毫秒) 如果为负数,则不运行逐出线程, 默认-1</span></span><br><span class="line"><span class="meta">redis.timeBetweenEvictionRunsMillis</span>=<span class="string">30000</span></span><br><span class="line"><span class="comment">#是否在从池中取出连接前进行检验,如果检验失败,则从池中去除连接并尝试取出另一个</span></span><br><span class="line"><span class="meta">redis.testOnBorrow</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#在空闲时检查有效性, 默认false</span></span><br><span class="line"><span class="meta">redis.testWhileIdle</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-applicationContext-xml"><a class="header-anchor" href="#步骤-5-applicationContext-xml">¶</a>步骤 5 : applicationContext.xml</h3>
<p>配置连接池，连接工厂等，以上都是为了RedisTemplate 服务，这个类就提供常用的访问 Redis的方法。</p>
<p>然后又把这个 RedisTemplate 类的实例，注入到 RedisUtil 工具类里，方便调用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:cache</span>=<span class="string">"http://www.springframework.org/schema/cache"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans-4.2.xsd     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context-4.2.xsd     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc     </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/cache  </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/cache/spring-cache-4.2.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 加载配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:*.properties"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- redis连接池配置--&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span> &gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--最大空闲数--&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxIdle&#125;"</span> /&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--连接池的最大数据库连接数  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxTotal&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--最大建立连接等待时间--&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxWaitMillis&#125;"</span> /&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--逐出连接的最小空闲时间 默认1800000毫秒(30分钟)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.minEvictableIdleTimeMillis&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--每次逐出检查时 逐出的最大数目 如果为负数就是 : 1/abs(n), 默认3--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numTestsPerEvictionRun"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.numTestsPerEvictionRun&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--逐出扫描的时间间隔(毫秒) 如果为负数,则不运行逐出线程, 默认-1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.timeBetweenEvictionRunsMillis&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否在从池中取出连接前进行检验,如果检验失败,则从池中去除连接并尝试取出另一个--&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.testOnBorrow&#125;"</span> /&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--在空闲时检查有效性, 默认false  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.testWhileIdle&#125;"</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span> &gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--redis连接工厂 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--IP地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.hostName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--端口号  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.port&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如果Redis设置有密码  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.password&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--客户端超时时间单位是毫秒  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.timeout&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--redis操作模版,使用该对象可以操作redis  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:connection-factory-ref</span>=<span class="string">"jedisConnectionFactory"</span> &gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashKeySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashValueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span> &gt;</span> </span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--自定义redis工具类,在需要缓存的地方注入此类  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisUtil"</span> <span class="attr">class</span>=<span class="string">"com.how2java.RedisUtil"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"redisTemplate"</span> <span class="attr">ref</span>=<span class="string">"redisTemplate"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-RedisUtil"><a class="header-anchor" href="#步骤-6-RedisUtil">¶</a>步骤 6 : RedisUtil</h3>
<p>RedisUtil 工具类，封装了 RedisTemplate 这个类，以提供更为便利的 对于 Redis 的访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基于spring和redis的redisTemplate工具类</span></span><br><span class="line"><span class="comment"> * 针对所有的hash 都是以h开头的方法</span></span><br><span class="line"><span class="comment"> * 针对所有的Set 都是以s开头的方法                    不含通用方法</span></span><br><span class="line"><span class="comment"> * 针对所有的List 都是以l开头的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedisTemplate</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=============================common============================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key,<span class="keyword">long</span> time)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key,TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String ... key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(key!=<span class="keyword">null</span>&amp;&amp;key.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(key.length==<span class="number">1</span>)&#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//============================String=============================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key==<span class="keyword">null</span>?<span class="keyword">null</span>:redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key,Object value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key,Object value,<span class="keyword">long</span> time)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span></span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(delta&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"递增因子必须大于0"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要减少几(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span></span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(delta&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"递减因子必须大于0"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta); </span><br><span class="line">    &#125; </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//================================Map=================================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key,String item)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object,Object&gt; <span class="title">hmget</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String,Object&gt; map)</span></span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String,Object&gt; map, <span class="keyword">long</span> time)</span></span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key,String item,Object value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)  注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key,String item,Object value,<span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span></span>&#123; </span><br><span class="line">        redisTemplate.opsForHash().delete(key,item);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item,<span class="keyword">double</span> by)</span></span>&#123; </span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要减少记(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item,<span class="keyword">double</span> by)</span></span>&#123; </span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item,-by); </span><br><span class="line">    &#125; </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//============================set=============================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key,Object value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object...values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key,<span class="keyword">long</span> time,Object...values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span>(time&gt;<span class="number">0</span>) expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object ...values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//===============================list=================================</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end 结束  0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key,<span class="keyword">long</span> start, <span class="keyword">long</span> end)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引  index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key,<span class="keyword">long</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index,Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key,<span class="keyword">long</span> count,Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-TestRedis"><a class="header-anchor" href="#步骤-7-TestRedis">¶</a>步骤 7 : TestRedis</h3>
<p>测试类，做了一些简单的增加，删除，获取的例子，来测试对 Redis的访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRedis</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext.xml"</span>);</span><br><span class="line"> </span><br><span class="line">        RedisUtil redisUtil=(RedisUtil) context.getBean(<span class="string">"redisUtil"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//=====================testString======================</span></span><br><span class="line">        redisUtil.set(<span class="string">"name"</span>, <span class="string">"how2java"</span>);</span><br><span class="line">        System.out.println(redisUtil.get(<span class="string">"name"</span>));</span><br><span class="line">        redisUtil.del(<span class="string">"name"</span>);</span><br><span class="line">        System.out.println(redisUtil.get(<span class="string">"name"</span>));</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//=====================testNumber======================</span></span><br><span class="line">        <span class="keyword">long</span> incr = redisUtil.incr(<span class="string">"number"</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(incr);</span><br><span class="line">        incr =redisUtil.incr(<span class="string">"number"</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(incr);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//=====================testMap======================       </span></span><br><span class="line">        Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"name"</span>, <span class="string">"meepo"</span>);</span><br><span class="line">        map.put(<span class="string">"pwd"</span>, <span class="string">"password"</span>);</span><br><span class="line">        redisUtil.hmset(<span class="string">"user"</span>, map);</span><br><span class="line">        System.out.println(redisUtil.hget(<span class="string">"user"</span>,<span class="string">"name"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、CLIENT"><a class="header-anchor" href="#6、CLIENT">¶</a>6、CLIENT</h2>
<h3 id="步骤-1-RedisClient"><a class="header-anchor" href="#步骤-1-RedisClient">¶</a>步骤 1 : RedisClient</h3>
<p>除了使用 redis-cli.exe 可以观察服务器里面的数据外，还可以使用一款 图形化界面的工具，叫做 RedisClient</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8051.png" alt></p>
<h3 id="步骤-2-下载运行"><a class="header-anchor" href="#步骤-2-下载运行">¶</a>步骤 2 : 下载运行</h3>
<p>打包放在了右上角。<br>
直接下载运行里面的 redisclient-win32.x86.1.5.exe 就行了，无需安装</p>
<h3 id="步骤-3-登陆"><a class="header-anchor" href="#步骤-3-登陆">¶</a>步骤 3 : 登陆</h3>
<p>点击菜单 -&gt; Server -&gt; Add 就会出现这个界面。<br>
大多数时候都是链接本机，所以 Name 输入 localhost<br>
Host 输入 127.0.0.1<br>
密码默认为空，然后点击ok就行</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8053.png" alt></p>
<h3 id="步骤-4-选择数据库"><a class="header-anchor" href="#步骤-4-选择数据库">¶</a>步骤 4 : 选择数据库</h3>
<p>默认都是使用 db0 这个数据库，双击之后，右边就显示数据库里面的数据了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/../../Blog-Hexo/source/_posts/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8054.png" alt></p>
<h1 id="六、Nginx"><a class="header-anchor" href="#六、Nginx">¶</a>六、Nginx</h1>
<h2 id="1、入门"><a class="header-anchor" href="#1、入门">¶</a>1、入门</h2>
<h3 id="步骤-1-下载并解压"><a class="header-anchor" href="#步骤-1-下载并解压">¶</a>步骤 1 : 下载并解压</h3>
<p>下载右上角的 nginx.rar 并解压</p>
<h3 id="步骤-2-启动方式-直接双击"><a class="header-anchor" href="#步骤-2-启动方式-直接双击">¶</a>步骤 2 : 启动方式-直接双击</h3>
<p>启动方式一般有两种：<br>
第一种：直接双击方式<br>
直接双击nginx.exe会有个屏幕一闪而过，这个时候，其实已经启动成功了。 只需要打开访问地址，就可以看到如图所示的效果：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1</span></span><br></pre></td></tr></table></figure>
<p>关闭方式，与此配合的方式就是用任务管理器关闭了~<br>
<strong>注：</strong> nginx启动之后，在任务管理里有两个nginx进程，这个是正常的，一个是1个守护进程 1个工作进程，得手动分别关闭</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6633.png" alt></p>
<h3 id="步骤-3-启动方式-命令行"><a class="header-anchor" href="#步骤-3-启动方式-命令行">¶</a>步骤 3 : 启动方式-命令行</h3>
<p>第二种：命令行方式<br>
假设nginx在d:/software/nginx目录下，那么就需要通过如下命令启动：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmd</span><br><span class="line"></span><br><span class="line">d:</span><br><span class="line"></span><br><span class="line">cd d:/software/nginx</span><br><span class="line"></span><br><span class="line">start nginx</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-端口被占用"><a class="header-anchor" href="#步骤-4-端口被占用">¶</a>步骤 4 : 端口被占用</h3>
<p>如果启动之后，无法访问，或者访问的是其他的页面，通常都是因为端口被占用了。 端口被占用，请参考 [端口被占用了怎么办？]</p>
<h3 id="步骤-5-端口号修改"><a class="header-anchor" href="#步骤-5-端口号修改">¶</a>步骤 5 : 端口号修改</h3>
<p>可以修改为其他端口号，打开nginx目录下的conf/nginx.conf文件，然后找到listen 80,修改为9090，关闭nginx再启动，就可以通过如下地址访问了：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:9090/</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 也可以通如下命令进行重启</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6634.png" alt></p>
<h3 id="步骤-6-nginx-conf配置文件"><a class="header-anchor" href="#步骤-6-nginx-conf配置文件">¶</a>步骤 6 : nginx.conf配置文件</h3>
<p>nginx.conf 是nginx的核心配置文件，里面的内容也不少，主要有几个开发人员需要关心的：</p>
<ol>
<li>端口号</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen       <span class="number">80</span>;</span><br></pre></td></tr></table></figure>
<p>这个在[端口号修改]中已经提到了</p>
<ol start="2">
<li>页面存放位置：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root html;</span><br></pre></td></tr></table></figure>
<p>表示页面都存放在nginx的html目录下</p>
<ol start="3">
<li>欢迎页面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index  index.html index.htm;</span><br></pre></td></tr></table></figure>
<p>默认会访问index.html或者index.htm文件</p>
<h2 id="2、为NGINX准备的多个TOMCAT"><a class="header-anchor" href="#2、为NGINX准备的多个TOMCAT">¶</a>2、为NGINX准备的多个TOMCAT</h2>
<h3 id="步骤-1-为什么要提供多个Tomcat"><a class="header-anchor" href="#步骤-1-为什么要提供多个Tomcat">¶</a>步骤 1 : 为什么要提供多个Tomcat</h3>
<p>在解释为什么要提供多个Tomcat之前，首先解释一下为什么要额外提供Tomcat。</p>
<p>Nginx是一个web服务器，很快速，但是不能作为Servlet 容器独立运行，所以通常的工作方式是Nginx配合Tomcat来协同工作。 这就是为什么要单独提供Tomcat，以方便配合Nginx进行工作。</p>
<p>那么为什么要提供多个Tomcat呢？因为在后续的[负载均衡]，[session共享] 教程里需要多个Tomcat来配合演示。 右上角有两个Tomcat，下载后运行其中的startup.bat就可以启动，端口号分别是8111和8222。</p>
<h3 id="步骤-2-以8111为例，下载解压运行"><a class="header-anchor" href="#步骤-2-以8111为例，下载解压运行">¶</a>步骤 2 : 以8111为例，下载解压运行</h3>
<p>下载右上角的tomcat_8111.rar,解压并运行其中bin目录下的startup.bat</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6640.png" alt></p>
<h3 id="步骤-3-访问地址"><a class="header-anchor" href="#步骤-3-访问地址">¶</a>步骤 3 : 访问地址</h3>
<p>启动之后访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8111/</span></span><br></pre></td></tr></table></figure>
<p>会自动跳转到</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8111/login.jsp</span></span><br></pre></td></tr></table></figure>
<p>访问效果如图所示</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6641.png" alt></p>
<h3 id="步骤-4-精心设计。。。"><a class="header-anchor" href="#步骤-4-精心设计。。。">¶</a>步骤 4 : 精心设计。。。</h3>
<p>别看这个tomcat运行效果比较简单，其实是专门为了后续课程精心设计的。。。</p>
<h3 id="步骤-5-动静分离"><a class="header-anchor" href="#步骤-5-动静分离">¶</a>步骤 5 : 动静分离</h3>
<p>在login.jsp这个页面上有图片，图片是为了后续讲解[动静分离]做铺垫。 并且在tomcat里跟踪信息输出，用于观察图片静态资源的访问是否是在当前tomcat上发生。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6642.png" alt></p>
<h3 id="步骤-6-负载均衡"><a class="header-anchor" href="#步骤-6-负载均衡">¶</a>步骤 6 : 负载均衡</h3>
<p>因为要做负载均衡，所以准备里两个一模一样的tomcat,只是他们的端口号不一样</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6644.png" alt></p>
<h3 id="步骤-7-登陆之后放session"><a class="header-anchor" href="#步骤-7-登陆之后放session">¶</a>步骤 7 : 登陆之后放session</h3>
<p>登陆之后，会把登陆信息记录在session里。 这个便于后续的[session共享教程]的讲解</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6645.png" alt></p>
<h2 id="3、反向代理TOMCAT"><a class="header-anchor" href="#3、反向代理TOMCAT">¶</a>3、反向代理TOMCAT</h2>
<h3 id="步骤-1-反向代理概念"><a class="header-anchor" href="#步骤-1-反向代理概念">¶</a>步骤 1 : 反向代理概念</h3>
<p>先说正向代理，比如要访问youtube,但是不能直接访问，只能先找个翻墙软件，通过翻墙软件才能访问youtube. 翻墙软件就叫做正向代理。<br>
所谓的反向代理，指的是用户要访问youtube,但是youtube悄悄地把这个请求交给bilibili来做，那么bilibili就是反向代理了。<br>
在当前教程指的就是访问nginx,但是nginx把请求交给tomcat来做。</p>
<h3 id="步骤-2-启动tomcat"><a class="header-anchor" href="#步骤-2-启动tomcat">¶</a>步骤 2 : 启动tomcat</h3>
<p>首先启动[多个Tomcat] 中端口号是8111的tomcat</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6648.png" alt></p>
<h3 id="步骤-3-修改nginx-conf"><a class="header-anchor" href="#步骤-3-修改nginx-conf">¶</a>步骤 3 : 修改nginx.conf</h3>
<p>然后修改nginx.conf，主要是30-42行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       location / &#123;</span><br><span class="line">       	proxy_pass http:<span class="comment">//127.0.0.1:8111;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>location /</strong> 表示处理所有请求<br>
<strong>proxy_pass <a href="http://127.0.0.1:8111" target="_blank" rel="noopener">http://127.0.0.1:8111</a>;</strong> 表示把请求都交给http://127.0.0.1:8111来处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"> </span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"> </span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"> </span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"> </span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"> </span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"> </span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;</span><br><span class="line"> </span><br><span class="line">    #gzip  on;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"> </span><br><span class="line">        #charset koi8-r;</span><br><span class="line"> </span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"> </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//127.0.0.1:8111;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"> </span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"> </span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"> </span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"> </span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-重启nginx并访问"><a class="header-anchor" href="#步骤-4-重启nginx并访问">¶</a>步骤 4 : 重启nginx并访问</h3>
<p>使用如下命令重启 nginx</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>然后访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/</span></span><br></pre></td></tr></table></figure>
<p>就会观察到已经反向代理到tomcat了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6649.png" alt></p>
<h3 id="步骤-5-意义何在"><a class="header-anchor" href="#步骤-5-意义何在">¶</a>步骤 5 : 意义何在</h3>
<p>既然直接通过127.0.0.1:8111/login.jsp 可以访问，那么干嘛要通过127.0.0.1/login.jsp 去反向代理到tomcat呢？ 为什么不直接使用tomcat呢？</p>
<p>因为nginx在处理静态文件的吞吐量上面比tomcat好很多，通常他们俩配合，不会把所有的请求都如本例所示的交给tomcat, 而是把静态请求交给nginx，动态请求，如jsp, servlet,ssm， struts等请求交给tomcat. 从而达到动静分离的效果。 接下来就会讲解如何进行动静分离。</p>
<h2 id="4、和TOMCAT进行动静分离整合"><a class="header-anchor" href="#4、和TOMCAT进行动静分离整合">¶</a>4、和TOMCAT进行动静分离整合</h2>
<h3 id="步骤-1-动静分离概念"><a class="header-anchor" href="#步骤-1-动静分离概念">¶</a>步骤 1 : 动静分离概念</h3>
<p>所谓的动静分离就是指图片，css, js之类的都交给nginx来处理，nginx处理不了的，比如jsp 就交给tomcat来处理~</p>
<p>好处是nginx处理静态内容的吞吐量很高，比tomcat高多了，这样无形中提升了性能。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6651.png" alt></p>
<h3 id="步骤-2-修改nginx-conf"><a class="header-anchor" href="#步骤-2-修改nginx-conf">¶</a>步骤 2 : 修改nginx.conf</h3>
<p>在locaction下面添加一个新的location:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       location ~\.(css|js|png)$ &#123;</span><br><span class="line">       	root C:/Users/X7TI/Downloads/tomcat_8111/webapps/ROOT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这表示所有的css js png访问都由nginx来做，访问的地址是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/X7TI/Downloads/tomcat_8111/webapps/ROOT</span><br></pre></td></tr></table></figure>
<p>这里要注意，填写本地地址的时候，要用正斜杠 <strong>/</strong> 不要用反斜杠 <strong>\</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"> </span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"> </span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"> </span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"> </span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"> </span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"> </span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;</span><br><span class="line"> </span><br><span class="line">    #gzip  on;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"> </span><br><span class="line">        #charset koi8-r;</span><br><span class="line"> </span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"> </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//127.0.0.1:8111;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        location ~\.(css|js|png)$ &#123;</span><br><span class="line">            root C:/Users/X7TI/Downloads/tomcat_8111/webapps/ROOT;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"> </span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"> </span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"> </span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"> </span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-观察效果"><a class="header-anchor" href="#步骤-3-观察效果">¶</a>步骤 3 : 观察效果</h3>
<p>访问地址,观察到静动都有的效果</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/login.jsp</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6653.png" alt></p>
<h3 id="步骤-4-观察tomcat输入日志"><a class="header-anchor" href="#步骤-4-观察tomcat输入日志">¶</a>步骤 4 : 观察tomcat输入日志</h3>
<p>再到tomcat的输出日志里观察，就会发现，只访问了jsp, 所有的css,js,png都不会经过 tomcat，而是由nginx自己负责处理了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6654.png" alt></p>
<h2 id="5、和TOMCAT进行负载均衡ZHENG’HE"><a class="header-anchor" href="#5、和TOMCAT进行负载均衡ZHENG’HE">¶</a>5、和TOMCAT进行负载均衡ZHENG’HE</h2>
<h3 id="步骤-1-负载均衡的概念"><a class="header-anchor" href="#步骤-1-负载均衡的概念">¶</a>步骤 1 : 负载均衡的概念</h3>
<p>负载均衡的概念就是当访问量很大的时候，一个 Tomcat 吃不消了，这时候就准备多个 Tomcat，由Nginx按照权重来对请求进行分配，从而缓解单独一个Tomcat受到的压力</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6655.png" alt></p>
<h3 id="步骤-2-启动两个Tomcat"><a class="header-anchor" href="#步骤-2-启动两个Tomcat">¶</a>步骤 2 : 启动两个Tomcat</h3>
<p>到[多个Tomcat]下载解压8111和8222两个tomcat，并启动</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6658.png" alt></p>
<h3 id="步骤-3-修改nginx-conf-v2"><a class="header-anchor" href="#步骤-3-修改nginx-conf-v2">¶</a>步骤 3 : 修改nginx.conf</h3>
<p>首先增加一个upstream ，用来指向这两个tomcat</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   upstream tomcat_8111_8222&#123;</span><br><span class="line">server	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8111</span> weight=<span class="number">1</span>;</span><br><span class="line">server	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8222</span> weight=<span class="number">2</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>然后修改location，反向代理到上述配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       location / &#123;</span><br><span class="line">       	proxy_pass http:<span class="comment">//tomcat_8111_8222;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>weight表示权重，值越大，被分配到的几率越大。 最大多少呢？我也不知道。。。反正10以内都可以用吧，我想的话~</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"> </span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"> </span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"> </span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"> </span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"> </span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"> </span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;</span><br><span class="line"> </span><br><span class="line">    #gzip  on;</span><br><span class="line"> </span><br><span class="line">    upstream tomcat_8111_8222&#123;</span><br><span class="line">    server  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8111</span>  weight=<span class="number">1</span>;</span><br><span class="line">    server  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8222</span> weight=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"> </span><br><span class="line">        #charset koi8-r;</span><br><span class="line"> </span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"> </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//tomcat_8111_8222;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        location ~\.(css|js|png)$ &#123;</span><br><span class="line">            root C:/Users/X7TI/Downloads/tomcat_8111/webapps/ROOT;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"> </span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"> </span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"> </span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"> </span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"> </span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"> </span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-重启nginx并访问-v2"><a class="header-anchor" href="#步骤-4-重启nginx并访问-v2">¶</a>步骤 4 : 重启nginx并访问</h3>
<p>使用命令 nginx -s reload 重启，然后使劲访问</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/login.jsp</span></span><br></pre></td></tr></table></figure>
<p>此时就可以观察到对jsp的访问，被分配到了不同的 Tomcat上</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6657.png" alt></p>
<h2 id="6、借助JEDIS-对TOMCAT做SESSION共享"><a class="header-anchor" href="#6、借助JEDIS-对TOMCAT做SESSION共享">¶</a>6、借助JEDIS 对TOMCAT做SESSION共享</h2>
<h3 id="步骤-1-负载均衡-session问题"><a class="header-anchor" href="#步骤-1-负载均衡-session问题">¶</a>步骤 1 : 负载均衡 session问题</h3>
<p>通过[负载均衡]课程，我们可以把请求分发到不同的 Tomcat 来缓解服务器的压力，但是这里存在一个问题： 当同一个用户第一次访问tomcat_8111 并且登录成功， 而第二次访问却被分配到了tomcat_8222， 这里并没有记录他的登陆状态，那么就会呈现未登录状态了，严重伤害了用户体验。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6659.png" alt></p>
<h3 id="步骤-2-解决办法一-ip-hash"><a class="header-anchor" href="#步骤-2-解决办法一-ip-hash">¶</a>步骤 2 : 解决办法一: ip_hash</h3>
<p>通过ip地址标记用户，如果多次请求都是从同一个ip来的，那么就都分配到同一个tomcat.<br>
这样就不会出现[负载均衡 session问题]了. 处理手段也很简单，如图所示在upstream最后加上ip_hash;就行了。</p>
<p>不过这种方案并不完美，当如下几种情况发生时就有问题：</p>
<ol>
<li>大量请求来之某个局域网，那么相当于就没有负载均衡了</li>
<li>如果tomcat_8111 挂了，那么此时nginx只能把请求交给tomcat_8222,但是这里却没有记录session,用户体验依然受影响。</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6660.png" alt></p>
<h3 id="步骤-3-解决办法二：-redis-tomcat-sessoin-manager"><a class="header-anchor" href="#步骤-3-解决办法二：-redis-tomcat-sessoin-manager">¶</a>步骤 3 : 解决办法二： redis+tomcat-sessoin-manager</h3>
<p>既然第一种解决办法有问题，那么就采用第二种解决办法：用Redis来存取session.<br>
Redis是什么呢？说简单点就是个独立的Hashmap，用来存放键值对的。<br>
这样当tomcat1需要保存session值的时候，就可以把它放在Redis上，需要取的时候，也从Redis上取。<br>
那么考虑这个情景：</p>
<ol>
<li>用户提交账号密码的行为被分配在了tomcat8111上，登陆信息被存放在redis里。</li>
<li>当用户第二次访问的时候，被分配到了tomcat8222上</li>
<li>那么此时tomcat8222就会从redis去获取相关信息，一看有对应信息，那么就会呈现登陆状态。</li>
</ol>
<p>这样就规避了[解决办法一: ip_hash]里会出现的两种问题了。</p>
<p><strong>注：</strong> 对 redis 不熟悉的同学，请先了解下 [redis教程]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6661.png" alt></p>
<h3 id="步骤-4-接下来进行具体操作"><a class="header-anchor" href="#步骤-4-接下来进行具体操作">¶</a>步骤 4 : 接下来进行具体操作</h3>
<p>接下来进行具体操作，分几个步骤</p>
<ol>
<li>启动redis</li>
<li>给两个tomcat使用jar包</li>
<li>配置两个tomcat</li>
<li>重启两个tomcat</li>
<li>测试</li>
</ol>
<h3 id="步骤-5-启动redis"><a class="header-anchor" href="#步骤-5-启动redis">¶</a>步骤 5 : 启动redis</h3>
<p>下载右上角的redis-2.4.5-win32-win64.zip，解压后运行对应(32位或者64位)的redis-server.exe程序</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6663.png" alt></p>
<h3 id="步骤-6-jar包"><a class="header-anchor" href="#步骤-6-jar包">¶</a>步骤 6 : jar包</h3>
<p>Tomcat需要链接 redis，所以需要专门的jar包,这些包都放在了右上角的tomcat-redis.rar里。 一共有3个jar包：<br>
jedis-2.5.2.jar，<br>
commons-pool2-2.0.jar，<br>
tomcat-redis-session-manager1.2.jar。<br>
下载解压后，放在tomat8111的lib目录下。<strong>注：不要放在webapp里面去了哦</strong><br>
下载解压后，放在tomat8222的lib目录下。<strong>注：不要放在webapp里面去了哦</strong><br>
<strong>两个tomcat都要放</strong></p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6664.png" alt></p>
<h3 id="步骤-7-修改context-xml"><a class="header-anchor" href="#步骤-7-修改context-xml">¶</a>步骤 7 : 修改context.xml</h3>
<p>然后修改tomcat/conf/context.xml ，增加下面这坨东西</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionManager"</span>  </span></span><br><span class="line"><span class="tag"> <span class="attr">host</span>=<span class="string">"127.0.0.1"</span>  </span></span><br><span class="line"><span class="tag"> <span class="attr">port</span>=<span class="string">"6379"</span>  </span></span><br><span class="line"><span class="tag"> <span class="attr">database</span>=<span class="string">"0"</span>  </span></span><br><span class="line"><span class="tag"> <span class="attr">maxInactiveInterval</span>=<span class="string">"60"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>两个tomcat都要改</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment">  contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment">  this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment">  The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment">  (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment">  the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The contents of this file will be loaded for each web application --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Default set of monitored resources --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">WatchedResource</span>&gt;</span>WEB-INF/web.xml<span class="tag">&lt;/<span class="name">WatchedResource</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Uncomment this to disable session persistence across Tomcat restarts --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Manager pathname="" /&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Uncomment this to enable Comet connection tacking (provides events</span></span><br><span class="line"><span class="comment">         on session expiration as well as webapp lifecycle) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Valve className="org.apache.catalina.valves.CometConnectionManagerValve" /&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionManager"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">host</span>=<span class="string">"127.0.0.1"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">port</span>=<span class="string">"6379"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">database</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxInactiveInterval</span>=<span class="string">"60"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-重启tomcat"><a class="header-anchor" href="#步骤-8-重启tomcat">¶</a>步骤 8 : 重启tomcat</h3>
<p><strong>两个tomcat都要重启</strong></p>
<h3 id="步骤-9-测试访问tomcat8111"><a class="header-anchor" href="#步骤-9-测试访问tomcat8111">¶</a>步骤 9 : 测试访问tomcat8111</h3>
<p>Redis session共享机制和nginx其实无关，是发生在nginx之后的事情，所以直接访问login.jsp，然后登陆，并观察到已登陆状态</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8111/login.jsp</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6667.png" alt></p>
<h3 id="步骤-10-测试访问tomcat8222"><a class="header-anchor" href="#步骤-10-测试访问tomcat8222">¶</a>步骤 10 : 测试访问tomcat8222</h3>
<p>然后直接访问tomcat8222</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8222/login.jsp</span></span><br></pre></td></tr></table></figure>
<p>虽然没有在tomcat8222上登陆，但是可以观察到已经呈现为登陆状态了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/6668.png" alt></p>
<h3 id="步骤-11-下载已经配置好了的tomcat"><a class="header-anchor" href="#步骤-11-下载已经配置好了的tomcat">¶</a>步骤 11 : 下载已经配置好了的tomcat</h3>
<p>如果对上述tomcat配置办法吃不准，请直接使用右上角的已经配置好了的:tomcat-redis-8111-8222.rar</p>
<h1 id="十、搜索引擎技术"><a class="header-anchor" href="#十、搜索引擎技术">¶</a>十、搜索引擎技术</h1>
<h2 id="1、lucene"><a class="header-anchor" href="#1、lucene">¶</a>1、lucene</h2>
<h3 id="1、入门-v2"><a class="header-anchor" href="#1、入门-v2">¶</a>1、入门</h3>
<h4 id="步骤-1-关于JDK版本-v2"><a class="header-anchor" href="#步骤-1-关于JDK版本-v2">¶</a>步骤 1 : 关于JDK版本</h4>
<p>至少使用JDK8版本，请下载JDK8或者更高版本： [下载以及配置JDK环境]</p>
<h4 id="步骤-2-Lucene-概念"><a class="header-anchor" href="#步骤-2-Lucene-概念">¶</a>步骤 2 : Lucene 概念</h4>
<p>Lucene 这个开源项目，使得 Java开发人员可以很方便地得到像搜索引擎google baidu那样的搜索效果。</p>
<h4 id="步骤-3-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习">¶</a>步骤 3 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行TestLucene类，期望看到如图所示的效果。<br>
一共是10条数据，通过关键字查询出来6条命中结果，不同的命中结果有不同的匹配度得分，比如第一条，命中都就很高，既有 <strong>护眼</strong>， 也有 <strong>带光源</strong>。 其他的命中度就比较低，没有护眼关键字的匹配，只有<strong>光源</strong>关键字的匹配。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7292.png" alt></p>
<h4 id="步骤-4-模仿和排错"><a class="header-anchor" href="#步骤-4-模仿和排错">¶</a>步骤 4 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-5-Lucene-版本"><a class="header-anchor" href="#步骤-5-Lucene-版本">¶</a>步骤 5 : Lucene 版本</h4>
<p>当前使用的Lucene版本是截至2018.3.9最新版本 7.2.1</p>
<h4 id="步骤-6-jar-包"><a class="header-anchor" href="#步骤-6-jar-包">¶</a>步骤 6 : jar 包</h4>
<p>一系列需要的jar包都放在项目里了，直接使用就好了，包括兼容 lucene 7.2.1 的中文分词器</p>
<h4 id="步骤-7-TestLucene-java"><a class="header-anchor" href="#步骤-7-TestLucene-java">¶</a>步骤 7 : TestLucene.java</h4>
<p>这是TestLucene.java 的完整代码，后续会对代码详细讲解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        List&lt;String&gt; productNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led灯泡e27螺口暖白球泡灯家用照明超亮节能灯泡转色温灯泡"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led灯泡e14螺口蜡烛灯泡3W尖泡拉尾节能灯泡暖黄光源Lamp"</span>);</span><br><span class="line">        productNames.add(<span class="string">"雷士照明 LED灯泡 e27大螺口节能灯3W球泡灯 Lamp led节能灯泡"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦 led灯泡 e27螺口家用3w暖白球泡灯节能灯5W灯泡LED单灯7w"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led小球泡e14螺口4.5w透明款led节能灯泡照明光源lamp单灯"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦蒲公英护眼台灯工作学习阅读节能灯具30508带光源"</span>);</span><br><span class="line">        productNames.add(<span class="string">"欧普照明led灯泡蜡烛节能灯泡e14螺口球泡灯超亮照明单灯光源"</span>);</span><br><span class="line">        productNames.add(<span class="string">"欧普照明led灯泡节能灯泡超亮光源e14e27螺旋螺口小球泡暖黄家用"</span>);</span><br><span class="line">        productNames.add(<span class="string">"聚欧普照明led灯泡节能灯泡e27螺口球泡家用led照明单灯超亮光源"</span>);    </span><br><span class="line">        Directory index = createIndex(analyzer, productNames);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">        String keyword = <span class="string">"护眼带光源"</span>;</span><br><span class="line">        Query query = <span class="keyword">new</span> QueryParser(<span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// 4. 搜索</span></span><br><span class="line">        IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">        IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">        <span class="keyword">int</span> numberPerPage = <span class="number">1000</span>;</span><br><span class="line">        System.out.printf(<span class="string">"当前一共有%d条数据%n"</span>,productNames.size());</span><br><span class="line">        System.out.printf(<span class="string">"查询关键字是：\"%s\"%n"</span>,keyword);</span><br><span class="line">        ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">        showSearchResults(searcher, hits, query, analyzer);</span><br><span class="line">        <span class="comment">// 6. 关闭查询</span></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields = d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>));</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line">                System.out.print(<span class="string">"\t"</span> + d.get(f.name()));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer, List&lt;String&gt; products)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (String name : products) &#123;</span><br><span class="line">            addDoc(writer, name);</span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, name, Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-分词器"><a class="header-anchor" href="#步骤-8-分词器">¶</a>步骤 8 : 分词器</h4>
<p>准备中文分词器，关于分词器更多概念在[分词器概念] 中有详细讲解，这里先使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-创建索引"><a class="header-anchor" href="#步骤-9-创建索引">¶</a>步骤 9 : 创建索引</h4>
<ol>
<li>首先准备10条数据<br>
这10条数据都是字符串，相当于产品表里的数据</li>
<li>通过createIndex方法，把它加入到索引当中</li>
</ol>
<p>创建内存索引，为什么Lucene会比数据库快？因为它是从内存里查，自然就比数据库里快多了呀</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Directory index = <span class="keyword">new</span> RAMDirectory();</span><br></pre></td></tr></table></figure>
<p>根据中文分词器创建配置对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br></pre></td></tr></table></figure>
<p>创建索引 writer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br></pre></td></tr></table></figure>
<p>遍历那10条数据，把他们挨个放进索引里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (String name : products) &#123;</span><br><span class="line">    addDoc(writer, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每条数据创建一个Document，并把这个Document放进索引里。 这个Document有一个字段，叫做&quot;name&quot;。 [TestLucene.java] 第49行创建查询器，就会指定查询这个字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">	doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, name, Field.Store.YES));</span><br><span class="line">	w.addDocument(doc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 索引--准备数据</span></span><br><span class="line">List&lt;String&gt; productNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">productNames.add(<span class="string">"飞利浦led灯泡e27螺口暖白球泡灯家用照明超亮节能灯泡转色温灯泡"</span>);</span><br><span class="line">productNames.add(<span class="string">"飞利浦led灯泡e14螺口蜡烛灯泡3W尖泡拉尾节能灯泡暖黄光源Lamp"</span>);</span><br><span class="line">productNames.add(<span class="string">"雷士照明 LED灯泡 e27大螺口节能灯3W球泡灯 Lamp led节能灯泡"</span>);</span><br><span class="line">productNames.add(<span class="string">"飞利浦 led灯泡 e27螺口家用3w暖白球泡灯节能灯5W灯泡LED单灯7w"</span>);</span><br><span class="line">productNames.add(<span class="string">"飞利浦led小球泡e14螺口4.5w透明款led节能灯泡照明光源lamp单灯"</span>);</span><br><span class="line">productNames.add(<span class="string">"飞利浦蒲公英护眼台灯工作学习阅读节能灯具30508带光源"</span>);</span><br><span class="line">productNames.add(<span class="string">"欧普照明led灯泡蜡烛节能灯泡e14螺口球泡灯超亮照明单灯光源"</span>);</span><br><span class="line">productNames.add(<span class="string">"欧普照明led灯泡节能灯泡超亮光源e14e27螺旋螺口小球泡暖黄家用"</span>);</span><br><span class="line">productNames.add(<span class="string">"聚欧普照明led灯泡节能灯泡e27螺口球泡家用led照明单灯超亮光源"</span>);    </span><br><span class="line">Directory index = createIndex(analyzer, productNames);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer, List&lt;String&gt; products)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">    IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">    IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (String name : products) &#123;</span><br><span class="line">        addDoc(writer, name);</span><br><span class="line">    &#125;</span><br><span class="line">    writer.close();</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">    doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, name, Field.Store.YES));</span><br><span class="line">    w.addDocument(doc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-10-创建查询器"><a class="header-anchor" href="#步骤-10-创建查询器">¶</a>步骤 10 : 创建查询器</h4>
<p>根据关键字 <strong>护眼带光源</strong>，基于 “name” 字段进行查询。 这个 “name” 字段就是在[创建索引]步骤里每个Document的 “name” 字段，相当于表的字段名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String keyword = <span class="string">"护眼带光源"</span>;</span><br><span class="line">Query query = <span class="keyword">new</span> QueryParser(<span class="string">"name"</span>, analyzer).parse(keyword);</span><br></pre></td></tr></table></figure>
<h4 id="步骤-11-执行搜索"><a class="header-anchor" href="#步骤-11-执行搜索">¶</a>步骤 11 : 执行搜索</h4>
<p>接着就执行搜索：<br>
创建索引 reader:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexReader reader = DirectoryReader.open(index);</span><br></pre></td></tr></table></figure>
<p>基于 reader 创建搜索器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader);</span><br></pre></td></tr></table></figure>
<p>指定每页要显示多少条数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> numberPerPage = <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>
<p>执行搜索</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. 搜索</span></span><br><span class="line">IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line"><span class="keyword">int</span> numberPerPage = <span class="number">1000</span>;</span><br><span class="line">System.out.printf(<span class="string">"当前一共有%d条数据%n"</span>,productNames.size());</span><br><span class="line">System.out.printf(<span class="string">"查询关键字是：\"%s\"%n"</span>,keyword);</span><br><span class="line">ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-12-显示查询结果"><a class="header-anchor" href="#步骤-12-显示查询结果">¶</a>步骤 12 : 显示查询结果</h4>
<p>每一个ScoreDoc[] hits 就是一个搜索结果，首先把他遍历出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">ScoreDoc scoreDoc= hits[i];</span><br></pre></td></tr></table></figure>
<p>然后获取当前结果的docid, 这个docid相当于就是这个数据在索引中的主键</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> docId = scoreDoc.doc;</span><br></pre></td></tr></table></figure>
<p>再根据主键docid，通过搜索器从索引里把对应的Document取出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Document d = searcher.doc(docId);</span><br></pre></td></tr></table></figure>
<p>接着就打印出这个Document里面的数据。 虽然当前Document只有name一个字段，但是代码还是通过遍历所有字段的形式，打印出里面的值，这样当Docment有多个字段的时候，代码就不用修改了，兼容性更好点。<br>
scoreDoc.score 表示当前命中的匹配度得分，越高表示匹配程度越高</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;IndexableField&gt; fields = d.getFields();</span><br><span class="line">System.out.print((i + <span class="number">1</span>));</span><br><span class="line">System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line"><span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line">        System.out.print(<span class="string">"\t"</span> + d.get(f.name()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">    System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">        ScoreDoc scoreDoc= hits[i];</span><br><span class="line">        <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">        Document d = searcher.doc(docId);</span><br><span class="line">        List&lt;IndexableField&gt; fields = d.getFields();</span><br><span class="line">        System.out.print((i + <span class="number">1</span>));</span><br><span class="line">        System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">        <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + d.get(f.name()));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-13-运行结果"><a class="header-anchor" href="#步骤-13-运行结果">¶</a>步骤 13 : 运行结果</h4>
<p>如图所示，一共是10条数据，通过关键字查询出来6条命中结果，不同的命中结果有不同的匹配度得分，比如第一条，命中都就很高，既有 <strong>护眼</strong>， 也有 <strong>带光源</strong>。 其他的命中度就比较低，没有护眼关键字的匹配，只有<strong>光源</strong>关键字的匹配。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7303.png" alt></p>
<h4 id="步骤-14-和-like-的区别"><a class="header-anchor" href="#步骤-14-和-like-的区别">¶</a>步骤 14 : 和 like 的区别</h4>
<p>like 也可以进行查询，那么使用lucene 的方式有什么区别呢？ 主要是两点：</p>
<ol>
<li>
<p>相关度<br>
通过观察[运行结果]，可以看到不同相关度的结果都会查询出来，但是使用 like，就做不到这一点了</p>
</li>
<li>
<p>性能<br>
数据量小的时候，like 也会有很好的表现，但是数据量一大，like 的表现就差很多了。 在接下来的教程里会演示对 [14万条数据] 的查询</p>
</li>
</ol>
<h4 id="步骤-15-思路图"><a class="header-anchor" href="#步骤-15-思路图">¶</a>步骤 15 : 思路图</h4>
<p>现在通过自己做了一遍 Lucene了，有了感性的认识，接着来整理一下做 Lucene的思路。</p>
<ol>
<li>首先搜集数据<br>
数据可以是文件系统，数据库，网络上，手工输入的，或者像本例直接写在内存上的</li>
<li>通过数据创建索引</li>
<li>用户输入关键字</li>
<li>通过关键字创建查询器</li>
<li>根据查询器到索引里获取数据</li>
<li>然后把查询结果展示在用户面前</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7305.png" alt></p>
<p>**补充：**<a href="https://blog.csdn.net/weixin_42633131/article/details/82873731" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42633131/article/details/82873731</a></p>
<h3 id="2、LUCENE7可以用的中文分词器-IKANALYZER6-5-0-JAR"><a class="header-anchor" href="#2、LUCENE7可以用的中文分词器-IKANALYZER6-5-0-JAR">¶</a>2、LUCENE7可以用的中文分词器 IKANALYZER6.5.0.JAR</h3>
<h4 id="步骤-1-分词器概念"><a class="header-anchor" href="#步骤-1-分词器概念">¶</a>步骤 1 : 分词器概念</h4>
<p>分词器指的是搜索引擎如何使用关键字进行匹配，如 [入门] 中的关键字：<strong>护眼带光源</strong>。 如果使用like,那么%护眼带光源%，匹配出来的结果就是要么全匹配，要不都不匹配。<br>
而使用分词器，就会把这个关键字分为 <strong>护眼</strong>，<strong>带</strong>，<strong>光源</strong> 3个关键字，这样就可以找到不同相关程度的结果了。</p>
<h4 id="步骤-2-IKAnalyzer6-5-0-jar"><a class="header-anchor" href="#步骤-2-IKAnalyzer6-5-0-jar">¶</a>步骤 2 : IKAnalyzer6.5.0.jar</h4>
<p>IKAnalyzer 这个分词器很久都没有维护了，也不支持Lucene7。 IKAnalyzer6.5.0.jar 这个是修改之后的的，可以支持Lucene7的jar, 在右上角下载（已经包含在右上角的lucene.rar中了）。</p>
<h4 id="步骤-3-代码演示-TestAnalyzer"><a class="header-anchor" href="#步骤-3-代码演示-TestAnalyzer">¶</a>步骤 3 : 代码演示 TestAnalyzer</h4>
<p>如代码所示，使用IKAnalyzer 中文分词器就会把 护眼带光源 分为这么如图所示的3个小关键字进行匹配</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7307.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAnalyzer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         </span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        TokenStream ts= analyzer.tokenStream(<span class="string">"name"</span>, <span class="string">"护眼带光源"</span>);</span><br><span class="line">        ts.reset();</span><br><span class="line">        <span class="keyword">while</span>(ts.incrementToken())&#123;</span><br><span class="line">            System.out.println(ts.reflectAsString(<span class="keyword">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、高亮显示"><a class="header-anchor" href="#3、高亮显示">¶</a>3、高亮显示</h3>
<h4 id="步骤-1-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
如图所示，查询结果里会高亮标记关键字。第一条是匹配度最高的，所有分词都匹配到了，其他的只匹配了少部分分词。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7308.png" alt></p>
<h4 id="步骤-2-模仿和排错"><a class="header-anchor" href="#步骤-2-模仿和排错">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-TestLucene"><a class="header-anchor" href="#步骤-3-TestLucene">¶</a>步骤 3 : TestLucene</h4>
<p>70,71行 81,82行 增加高亮显示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        List&lt;String&gt; productNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led灯泡e27螺口暖白球泡灯家用照明超亮节能灯泡转色温灯泡"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led灯泡e14螺口蜡烛灯泡3W尖泡拉尾节能灯泡暖黄光源Lamp"</span>);</span><br><span class="line">        productNames.add(<span class="string">"雷士照明 LED灯泡 e27大螺口节能灯3W球泡灯 Lamp led节能灯泡"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦 led灯泡 e27螺口家用3w暖白球泡灯节能灯5W灯泡LED单灯7w"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦led小球泡e14螺口4.5w透明款led节能灯泡照明光源lamp单灯"</span>);</span><br><span class="line">        productNames.add(<span class="string">"飞利浦蒲公英护眼台灯工作学习阅读节能灯具30508带光源"</span>);</span><br><span class="line">        productNames.add(<span class="string">"欧普照明led灯泡蜡烛节能灯泡e14螺口球泡灯超亮照明单灯光源"</span>);</span><br><span class="line">        productNames.add(<span class="string">"欧普照明led灯泡节能灯泡超亮光源e14e27螺旋螺口小球泡暖黄家用"</span>);</span><br><span class="line">        productNames.add(<span class="string">"聚欧普照明led灯泡节能灯泡e27螺口球泡家用led照明单灯超亮光源"</span>);    </span><br><span class="line">        Directory index = createIndex(analyzer, productNames);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">        String keyword = <span class="string">"护眼带光源"</span>;</span><br><span class="line">        Query query = <span class="keyword">new</span> QueryParser(<span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// 4. 搜索</span></span><br><span class="line">        IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">        IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">        <span class="keyword">int</span> numberPerPage = <span class="number">1000</span>;</span><br><span class="line">        System.out.printf(<span class="string">"当前一共有%d条数据%n"</span>,productNames.size());</span><br><span class="line">        System.out.printf(<span class="string">"查询关键字是：\"%s\"%n"</span>,keyword);</span><br><span class="line">        ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">        showSearchResults(searcher, hits, query, analyzer);</span><br><span class="line">        <span class="comment">// 6. 关闭查询</span></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields = d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>));</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line">                TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));               </span><br><span class="line">                System.out.print(<span class="string">"\t"</span> + fieldContent);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer, List&lt;String&gt; products)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (String name : products) &#123;</span><br><span class="line">            addDoc(writer, name);</span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, name, Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-运行结果"><a class="header-anchor" href="#步骤-4-运行结果">¶</a>步骤 4 : 运行结果</h4>
<p>运行结果是html代码，为了正常显示，复制到一个html文件里，打开就可以看到效果了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7311.png" alt></p>
<h3 id="4、向LUCENE中导入14万条产品数据"><a class="header-anchor" href="#4、向LUCENE中导入14万条产品数据">¶</a>4、向LUCENE中导入14万条产品数据</h3>
<h4 id="步骤-1-14万条数据"><a class="header-anchor" href="#步骤-1-14万条数据">¶</a>步骤 1 : 14万条数据</h4>
<p>在前面的 [入门] 里是用了10条记录来测试，实际情况肯定是不会只有10条记录了，所以为了模仿真实环境，花了很多精力，四处搜刮来了14万条天猫的产品数据，接下来我们就会把这14万条记录加入到 Lucene,然后观察搜索效果。<br>
这14万条记录放在右上角 140k_products.rar，其解析办法在后续会讲解</p>
<h4 id="步骤-2-关于数据库"><a class="header-anchor" href="#步骤-2-关于数据库">¶</a>步骤 2 : 关于数据库</h4>
<p>本来应该先把这14万条记录保存进数据库，然后再从数据库中取出来的，不过考虑到不是每个同学都有JDBC基础，以及放进数据库的繁琐，和14万条数据从数据库里读取出来的时间消耗，就改成直接从文件里读取出来，然后转换为泛型是Product的集合的形式，相当于从数据库里读取出来了，不过会快很多。<br>
有兴趣的同学可以自己把这些数据放进数据库里，并且使用 like 的方式看看查询性能如何。</p>
<h4 id="步骤-3-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v2">¶</a>步骤 3 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
执行TestLuceue之后，会花大概20秒左右时间为这14万条记录建立索引，然后输入不同的关键字查询出不同的结果来。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7312.png" alt></p>
<h4 id="步骤-4-模仿和排错-v2"><a class="header-anchor" href="#步骤-4-模仿和排错-v2">¶</a>步骤 4 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-5-140k-products-txt"><a class="header-anchor" href="#步骤-5-140k-products-txt">¶</a>步骤 5 : 140k_products.txt</h4>
<p>首先下载 140k_products.rar,并解压为140k_products.txt， 然后放在项目目录下。 这个文件里一共有14万条产品记录。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7315.png" alt></p>
<h4 id="步骤-6-Product-java"><a class="header-anchor" href="#步骤-6-Product-java">¶</a>步骤 6 : Product.java</h4>
<p>准备实体类来存放产品信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    String category;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    String place;</span><br><span class="line"> </span><br><span class="line">    String code;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(String category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPlace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> place;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlace</span><span class="params">(String place)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.place = place;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", category="</span> + category + <span class="string">", price="</span> + price + <span class="string">", place="</span></span><br><span class="line">                + place + <span class="string">", code="</span> + code + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-ProductUtil-java"><a class="header-anchor" href="#步骤-7-ProductUtil-java">¶</a>步骤 7 : ProductUtil.java</h4>
<p>准备工具类，把[140k_products.txt] 文本文件，转换为泛型是Product的集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.AWTException;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line">     </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductUtil</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, AWTException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;Product&gt; products = file2list(fileName);</span><br><span class="line">         </span><br><span class="line">        System.out.println(products.size());</span><br><span class="line">             </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Product&gt; <span class="title">file2list</span><span class="params">(String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        List&lt;String&gt; lines = FileUtils.readLines(f,<span class="string">"UTF-8"</span>);</span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">            Product p = line2product(line);</span><br><span class="line">            products.add(p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Product <span class="title">line2product</span><span class="params">(String line)</span> </span>&#123;</span><br><span class="line">        Product p = <span class="keyword">new</span> Product();</span><br><span class="line">        String[] fields = line.split(<span class="string">","</span>);</span><br><span class="line">        p.setId(Integer.parseInt(fields[<span class="number">0</span>]));</span><br><span class="line">        p.setName(fields[<span class="number">1</span>]);</span><br><span class="line">        p.setCategory(fields[<span class="number">2</span>]);</span><br><span class="line">        p.setPrice(Float.parseFloat(fields[<span class="number">3</span>]));</span><br><span class="line">        p.setPlace(fields[<span class="number">4</span>]);</span><br><span class="line">        p.setCode(fields[<span class="number">5</span>]);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-TestLucene-java"><a class="header-anchor" href="#步骤-8-TestLucene-java">¶</a>步骤 8 : TestLucene.java</h4>
<p>在[入门]中 TestLucene.java 的基础上进行修改。 主要做了两个方面的修改：</p>
<ol>
<li>
<p>索引的增加，以前是10条数据，现在是14万条数据<br>
<strong>注：</strong> 因为数据量比较大， 所以加入到索引的时间也比较久，请耐心等待。</p>
</li>
<li>
<p>Document以前只有name字段，现在有6个字段</p>
</li>
<li>
<p>查询关键字从控制台输入，这样每次都可以输入不同的关键字进行查询。 因为索引建立时间比较久，采用这种方式，可以建立一次索引，进行多次查询，否则的话，每次使用不同的关键字，都要耗时建立索引，测试效率会比较低</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">"请输入查询关键字："</span>);</span><br><span class="line">            String keyword = s.nextLine();</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> numberPerPage = <span class="number">10</span>;</span><br><span class="line">            ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、分页查询"><a class="header-anchor" href="#5、分页查询">¶</a>5、分页查询</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v2">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v2"><a class="header-anchor" href="#步骤-2-模仿和排错-v2">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-两种方式"><a class="header-anchor" href="#步骤-3-两种方式">¶</a>步骤 3 : 两种方式</h4>
<p>分页查询是很常见的需求，比如要查询第10页，每页10条数据。<br>
Lucene 分页通常来讲有两种方式：<br>
第一种是把100条数据查出来，然后取最后10条。 优点是快，缺点是对内存消耗大。<br>
第二种是把第90条查询出来，然后基于这一条，通过searchAfter方法查询10条数据。 优点是内存消耗小，缺点是比第一种更慢</p>
<h4 id="步骤-4-第一种"><a class="header-anchor" href="#步骤-4-第一种">¶</a>步骤 4 : 第一种</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ScoreDoc[] pageSearch1(Query query, IndexSearcher searcher, <span class="keyword">int</span> pageNow, <span class="keyword">int</span> pageSize)</span><br><span class="line">		<span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	TopDocs topDocs = searcher.search(query, pageNow*pageSize);</span><br><span class="line">	 System.out.println(<span class="string">"查询到的总条数\t"</span>+topDocs.totalHits);</span><br><span class="line">	 ScoreDoc [] alllScores = topDocs.scoreDocs;</span><br><span class="line">	 List&lt;ScoreDoc&gt; hitScores = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	 </span><br><span class="line">	 <span class="keyword">int</span> start = (pageNow -<span class="number">1</span>)*pageSize ;</span><br><span class="line">	 <span class="keyword">int</span> end = pageSize*pageNow;</span><br><span class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=start;i&lt;end;i++)</span><br><span class="line">		 hitScores.add(alllScores[i]);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	 ScoreDoc[] hits = hitScores.toArray(<span class="keyword">new</span> ScoreDoc[]&#123;&#125;);</span><br><span class="line">	<span class="keyword">return</span> hits;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一共查出 pageNow*pageSize条，然后取最后pageSize条</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.TopDocs;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">            String keyword = <span class="string">"手机"</span>;</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> pageNow = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> pageSize = <span class="number">10</span>;</span><br><span class="line">             </span><br><span class="line">            ScoreDoc[] hits = pageSearch1(query, searcher, pageNow, pageSize);</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ScoreDoc[] pageSearch1(Query query, IndexSearcher searcher, <span class="keyword">int</span> pageNow, <span class="keyword">int</span> pageSize)</span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        TopDocs topDocs = searcher.search(query, pageNow*pageSize);</span><br><span class="line">         System.out.println(<span class="string">"查询到的总条数\t"</span>+topDocs.totalHits);</span><br><span class="line">         ScoreDoc [] alllScores = topDocs.scoreDocs;</span><br><span class="line"> </span><br><span class="line">         List&lt;ScoreDoc&gt; hitScores = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">int</span> start = (pageNow -<span class="number">1</span>)*pageSize ;</span><br><span class="line">         <span class="keyword">int</span> end = pageSize*pageNow;</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i=start;i&lt;end;i++)</span><br><span class="line">             hitScores.add(alllScores[i]);</span><br><span class="line">         </span><br><span class="line">         ScoreDoc[] hits = hitScores.toArray(<span class="keyword">new</span> ScoreDoc[]&#123;&#125;);</span><br><span class="line">        <span class="keyword">return</span> hits;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">if</span>(per&gt;<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-第二种"><a class="header-anchor" href="#步骤-5-第二种">¶</a>步骤 5 : 第二种</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ScoreDoc[] pageSearch2(Query query, IndexSearcher searcher, <span class="keyword">int</span> pageNow, <span class="keyword">int</span> pageSize)</span><br><span class="line">			<span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">int</span> start = (pageNow - <span class="number">1</span>) * pageSize;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==start)&#123;</span><br><span class="line">        	TopDocs topDocs = searcher.search(query, pageNow*pageSize);</span><br><span class="line">        	<span class="keyword">return</span> topDocs.scoreDocs;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询数据， 结束页面自前的数据都会查询到，但是只取本页的数据</span></span><br><span class="line">        TopDocs topDocs = searcher.search(query, start);</span><br><span class="line">        <span class="comment">//获取到上一页最后一条</span></span><br><span class="line">        </span><br><span class="line">        ScoreDoc preScore= topDocs.scoreDocs[start-<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//查询最后一条后的数据的一页数据</span></span><br><span class="line">        topDocs = searcher.searchAfter(preScore, query, pageSize);</span><br><span class="line">        <span class="keyword">return</span> topDocs.scoreDocs;</span><br><span class="line">        </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>首先是边界条件，如果是第一页，就直接查询了。<br>
如果不是第一页，那么就取start-1那一条，然后再根据它通过searchAfter 来查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.TopDocs;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">            String keyword = <span class="string">"手机"</span>;</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> pageNow = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> pageSize = <span class="number">10</span>;</span><br><span class="line">             </span><br><span class="line">            ScoreDoc[] hits = pageSearch2(query, searcher, pageNow, pageSize);</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ScoreDoc[] pageSearch1(Query query, IndexSearcher searcher, <span class="keyword">int</span> pageNow, <span class="keyword">int</span> pageSize)</span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        TopDocs topDocs = searcher.search(query, pageNow*pageSize);</span><br><span class="line">         System.out.println(<span class="string">"查询到的总条数\t"</span>+topDocs.totalHits);</span><br><span class="line">         ScoreDoc [] alllScores = topDocs.scoreDocs;</span><br><span class="line"> </span><br><span class="line">         List&lt;ScoreDoc&gt; hitScores = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">int</span> start = (pageNow -<span class="number">1</span>)*pageSize ;</span><br><span class="line">         <span class="keyword">int</span> end = pageSize*pageNow;</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i=start;i&lt;end;i++)</span><br><span class="line">             hitScores.add(alllScores[i]);</span><br><span class="line">         </span><br><span class="line">         ScoreDoc[] hits = hitScores.toArray(<span class="keyword">new</span> ScoreDoc[]&#123;&#125;);</span><br><span class="line">        <span class="keyword">return</span> hits;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ScoreDoc[] pageSearch2(Query query, IndexSearcher searcher, <span class="keyword">int</span> pageNow, <span class="keyword">int</span> pageSize)</span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">int</span> start = (pageNow - <span class="number">1</span>) * pageSize;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==start)&#123;</span><br><span class="line">            TopDocs topDocs = searcher.search(query, pageNow*pageSize);</span><br><span class="line">            <span class="keyword">return</span> topDocs.scoreDocs;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询数据， 结束页面自前的数据都会查询到，但是只取本页的数据</span></span><br><span class="line">        TopDocs topDocs = searcher.search(query, start);</span><br><span class="line">        <span class="comment">//获取到上一页最后一条</span></span><br><span class="line">         </span><br><span class="line">        ScoreDoc preScore= topDocs.scoreDocs[start-<span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//查询最后一条后的数据的一页数据</span></span><br><span class="line">        topDocs = searcher.searchAfter(preScore, query, pageSize);</span><br><span class="line">        <span class="keyword">return</span> topDocs.scoreDocs;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">if</span>(per&gt;<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、索引删除和更新"><a class="header-anchor" href="#6、索引删除和更新">¶</a>6、索引删除和更新</h3>
<h4 id="步骤-1-索引删除和更新"><a class="header-anchor" href="#步骤-1-索引删除和更新">¶</a>步骤 1 : 索引删除和更新</h4>
<p>索引建立好了之后，还是需要维护的，比如新增，删除和维护。 新增就是建立索引的过程，这里就不表了，本教材主要讲索引的删除和更新。<br>
索引里的数据，其实就是一个一个的Document 对象，那么本文就是介绍如何删除和更新这些Documen对象。</p>
<h4 id="步骤-2-先说没有删除前的情形"><a class="header-anchor" href="#步骤-2-先说没有删除前的情形">¶</a>步骤 2 : 先说没有删除前的情形</h4>
<p>直接使用[14万条数据] 里的代码，不过使用不一样的查询语句。<br>
如图所示，通过关键字 “鞭&quot; 可以查询到一条id是51173的数据。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7325.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.Term;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">"请输入查询关键字："</span>);</span><br><span class="line">            String keyword = s.nextLine();</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> numberPerPage = <span class="number">10</span>;</span><br><span class="line">            ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-删除索引"><a class="header-anchor" href="#步骤-3-删除索引">¶</a>步骤 3 : 删除索引</h4>
<p>删除id=51173的Document之后，如图所示，再搜索<strong>鞭</strong>字，就查询不到结果了。<br>
删除关键代码如下，通过 Term对象删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除id=51173的数据</span></span><br><span class="line">IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">indexWriter.deleteDocuments(<span class="keyword">new</span> Term(<span class="string">"id"</span>, <span class="string">"51173"</span>));</span><br><span class="line">indexWriter.commit();</span><br><span class="line">indexWriter.close();</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7326.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除id=51173的数据</span></span><br><span class="line">IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">indexWriter.deleteDocuments(<span class="keyword">new</span> Term(<span class="string">"id"</span>, <span class="string">"51173"</span>));</span><br><span class="line">indexWriter.commit();</span><br><span class="line">indexWriter.close();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.Term;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//删除id=51173的数据</span></span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        indexWriter.deleteDocuments(<span class="keyword">new</span> Term(<span class="string">"id"</span>, <span class="string">"51173"</span>));</span><br><span class="line">        indexWriter.commit();</span><br><span class="line">        indexWriter.close();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">"请输入查询关键字："</span>);</span><br><span class="line">            String keyword = s.nextLine();</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> numberPerPage = <span class="number">10</span>;</span><br><span class="line">            ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-更多删除"><a class="header-anchor" href="#步骤-4-更多删除">¶</a>步骤 4 : 更多删除</h4>
<p>还可以按照如下方法来删除索引，API 很明显，就不做代码示例了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DeleteDocuments(Query query):根据Query条件来删除单个或多个Document</span><br><span class="line">DeleteDocuments(Query[] queries):根据Query条件来删除单个或多个Document</span><br><span class="line">DeleteDocuments(Term term):根据Term来删除单个或多个Document</span><br><span class="line">DeleteDocuments(Term[] terms):根据Term来删除单个或多个Document</span><br><span class="line">DeleteAll():删除所有的Document</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-更新索引"><a class="header-anchor" href="#步骤-5-更新索引">¶</a>步骤 5 : 更新索引</h4>
<p>如图所示，更新索引后，再用<strong>鞭</strong>查询，得到的结果是查出了更新之后的数据。 更新的关键代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新索引</span></span><br><span class="line">IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, <span class="string">"51173"</span>, Field.Store.YES));</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, <span class="string">"神鞭，鞭没了，神还在"</span>, Field.Store.YES));</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, <span class="string">"道具"</span>, Field.Store.YES));</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, <span class="string">"998"</span>, Field.Store.YES));</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, <span class="string">"南海群岛"</span>, Field.Store.YES));</span><br><span class="line">doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, <span class="string">"888888"</span>, Field.Store.YES));</span><br><span class="line">indexWriter.updateDocument(<span class="keyword">new</span> Term(<span class="string">"id"</span>, <span class="string">"51173"</span>), doc );</span><br><span class="line">indexWriter.commit();</span><br><span class="line">indexWriter.close();</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7328.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexableField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.Term;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.Highlighter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.QueryScorer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.highlight.SimpleHTMLFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.RAMDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLucene</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 准备中文分词器</span></span><br><span class="line">        IKAnalyzer analyzer = <span class="keyword">new</span> IKAnalyzer();</span><br><span class="line">        <span class="comment">// 2. 索引</span></span><br><span class="line">        Directory index = createIndex(analyzer);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 3. 查询器</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">// 更新索引</span></span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, <span class="string">"51173"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, <span class="string">"神鞭，鞭没了，神还在"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, <span class="string">"道具"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, <span class="string">"998"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, <span class="string">"南海群岛"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, <span class="string">"888888"</span>, Field.Store.YES));</span><br><span class="line">         </span><br><span class="line">        indexWriter.updateDocument(<span class="keyword">new</span> Term(<span class="string">"id"</span>, <span class="string">"51173"</span>), doc );</span><br><span class="line">        indexWriter.commit();</span><br><span class="line">        indexWriter.close();</span><br><span class="line">         </span><br><span class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">"请输入查询关键字："</span>);</span><br><span class="line">            String keyword = s.nextLine();</span><br><span class="line">            System.out.println(<span class="string">"当前关键字是："</span>+keyword);</span><br><span class="line">            Query query = <span class="keyword">new</span> QueryParser( <span class="string">"name"</span>, analyzer).parse(keyword);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 4. 搜索</span></span><br><span class="line">            IndexReader reader = DirectoryReader.open(index);</span><br><span class="line">            IndexSearcher searcher=<span class="keyword">new</span> IndexSearcher(reader);</span><br><span class="line">            <span class="keyword">int</span> numberPerPage = <span class="number">10</span>;</span><br><span class="line">            ScoreDoc[] hits = searcher.search(query, numberPerPage).scoreDocs;</span><br><span class="line">             </span><br><span class="line">            <span class="comment">// 5. 显示查询结果</span></span><br><span class="line">            showSearchResults(searcher, hits,query,analyzer);</span><br><span class="line">            <span class="comment">// 6. 关闭查询</span></span><br><span class="line">            reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showSearchResults</span><span class="params">(IndexSearcher searcher, ScoreDoc[] hits, Query query, IKAnalyzer analyzer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line"> </span><br><span class="line">        SimpleHTMLFormatter simpleHTMLFormatter = <span class="keyword">new</span> SimpleHTMLFormatter(<span class="string">"&lt;span style='color:red'&gt;"</span>, <span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        Highlighter highlighter = <span class="keyword">new</span> Highlighter(simpleHTMLFormatter, <span class="keyword">new</span> QueryScorer(query));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"找到 "</span> + hits.length + <span class="string">" 个命中."</span>);</span><br><span class="line">        System.out.println(<span class="string">"序号\t匹配度得分\t结果"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.length; ++i) &#123;</span><br><span class="line">            ScoreDoc scoreDoc= hits[i];</span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc;</span><br><span class="line">            Document d = searcher.doc(docId);</span><br><span class="line">            List&lt;IndexableField&gt; fields= d.getFields();</span><br><span class="line">            System.out.print((i + <span class="number">1</span>) );</span><br><span class="line">            System.out.print(<span class="string">"\t"</span> + scoreDoc.score);</span><br><span class="line">            <span class="keyword">for</span> (IndexableField f : fields) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(f.name()))&#123;</span><br><span class="line">                    TokenStream tokenStream = analyzer.tokenStream(f.name(), <span class="keyword">new</span> StringReader(d.get(f.name())));</span><br><span class="line">                    String fieldContent = highlighter.getBestFragment(tokenStream, d.get(f.name()));</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+fieldContent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.print(<span class="string">"\t"</span>+d.get(f.name()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Directory <span class="title">createIndex</span><span class="params">(IKAnalyzer analyzer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Directory index = <span class="keyword">new</span> RAMDirectory();</span><br><span class="line">        IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(analyzer);</span><br><span class="line">        IndexWriter writer = <span class="keyword">new</span> IndexWriter(index, config);</span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(fileName);</span><br><span class="line">        <span class="keyword">int</span> total = products.size();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> per = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> oldPer =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Product p : products) &#123;</span><br><span class="line">            addDoc(writer, p);</span><br><span class="line">            count++;</span><br><span class="line">            per = count*<span class="number">100</span>/total;</span><br><span class="line">            <span class="keyword">if</span>(per!=oldPer)&#123;</span><br><span class="line">                oldPer = per;</span><br><span class="line">                System.out.printf(<span class="string">"索引中，总共要添加 %d 条记录，当前添加进度是： %d%% %n"</span>,total,per);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDoc</span><span class="params">(IndexWriter w, Product p)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"id"</span>, String.valueOf(p.getId()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"name"</span>, p.getName(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"category"</span>, p.getCategory(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"price"</span>, String.valueOf(p.getPrice()), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"place"</span>, p.getPlace(), Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"code"</span>, p.getCode(), Field.Store.YES));</span><br><span class="line">        w.addDocument(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7、LUCENE-进一步学习"><a class="header-anchor" href="#7、LUCENE-进一步学习">¶</a>7、LUCENE - 进一步学习</h3>
<p>以上就是 Lucene的一些常用用法。 更丰富的内容，请进入 Lucene官网展开学习：<br>
<a href="https://lucene.apache.org/" target="_blank" rel="noopener">https://lucene.apache.org/</a></p>
<h2 id="2、Solr"><a class="header-anchor" href="#2、Solr">¶</a>2、Solr</h2>
<h3 id="1、启动服务器"><a class="header-anchor" href="#1、启动服务器">¶</a>1、启动服务器</h3>
<h4 id="步骤-1-关于JDK版本-v3"><a class="header-anchor" href="#步骤-1-关于JDK版本-v3">¶</a>步骤 1 : 关于JDK版本</h4>
<p>至少使用JDK8版本，请下载JDK8或者更高版本： [下载以及配置JDK环境]</p>
<h4 id="步骤-2-什么是-Solr"><a class="header-anchor" href="#步骤-2-什么是-Solr">¶</a>步骤 2 : 什么是 Solr</h4>
<p>前面学习了Lucene, 现在开始学习Solr。<br>
以连接数据库为类比：Lucene 就相当于JDBC，是基本的用法。<br>
Solr 就相当 Mybatis， 方便开发人员配置，访问和调用。<br>
而且Solr 被做成了 webapp形式，以tomcat的应用的方式启动，提供了可视化的配置界面</p>
<h4 id="步骤-3-下载-Solr"><a class="header-anchor" href="#步骤-3-下载-Solr">¶</a>步骤 3 : 下载 Solr</h4>
<p>右上角下载 solr-7.2.1.rar 并解压。<br>
截至目前 (2018-3-10) 使用的最新版本是7.2.1</p>
<h4 id="步骤-4-启动服务器"><a class="header-anchor" href="#步骤-4-启动服务器">¶</a>步骤 4 : 启动服务器</h4>
<p>我的解压目录在 <strong>D:\software\solr-7.2.1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\bin</span><br><span class="line">d:</span><br><span class="line">solr.cmd start</span><br></pre></td></tr></table></figure>
<p>如此就启动了服务器，会占用端口8983。 倘若端口被占用，会启动失败，排查办法请看 [端口被占用]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7332.png" alt></p>
<h4 id="步骤-5-访问服务器"><a class="header-anchor" href="#步骤-5-访问服务器">¶</a>步骤 5 : 访问服务器</h4>
<p>输入地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8983/solr/#/</span></span><br></pre></td></tr></table></figure>
<p>就可以访问Solr 服务器了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7333.png" alt></p>
<h4 id="步骤-6-继续"><a class="header-anchor" href="#步骤-6-继续">¶</a>步骤 6 : 继续</h4>
<p>但是这仅仅是个开始，为了能够使用Solr服务器还需要跟多的工作，请继续往下学习</p>
<h3 id="2、创建CORE"><a class="header-anchor" href="#2、创建CORE">¶</a>2、创建CORE</h3>
<h4 id="步骤-1-Core-概念"><a class="header-anchor" href="#步骤-1-Core-概念">¶</a>步骤 1 : Core 概念</h4>
<p>如果说Solr相当于一个数据库的话，那么Core就相当于一张表</p>
<h4 id="步骤-2-不要通过图形界面创建Core"><a class="header-anchor" href="#步骤-2-不要通过图形界面创建Core">¶</a>步骤 2 : 不要通过图形界面创建Core</h4>
<p>如图所示，通过图形界面创建Core会失败，应该使用 [命令行方式创建Core]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7336.png" alt></p>
<h4 id="步骤-3-命令行方式创建Core"><a class="header-anchor" href="#步骤-3-命令行方式创建Core">¶</a>步骤 3 : 命令行方式创建Core</h4>
<p>如图所示就创建了 Core</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\bin</span><br><span class="line">d:</span><br><span class="line">solr.cmd create -c how2java</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7337.png" alt></p>
<h4 id="步骤-4-删除-new-core"><a class="header-anchor" href="#步骤-4-删除-new-core">¶</a>步骤 4 : 删除 new_core</h4>
<p>如果点击了步骤 [不要通过图形界面创建Core] 里的图形界面里的 Add Core,那么就会一直有错误提醒，那么按照如下方式删除 new_core 就不会再有错误提醒了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\bin</span><br><span class="line">d:</span><br><span class="line">solr.cmd delete -c new_core</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7338.png" alt></p>
<h3 id="3、SOLR7-2-可以用的中文分词器-IKANALYZER6-5-0-JAR"><a class="header-anchor" href="#3、SOLR7-2-可以用的中文分词器-IKANALYZER6-5-0-JAR">¶</a>3、SOLR7.2 可以用的中文分词器 IKANALYZER6.5.0.JAR</h3>
<h4 id="步骤-1-没有中文分词"><a class="header-anchor" href="#步骤-1-没有中文分词">¶</a>步骤 1 : 没有中文分词</h4>
<p>默认情况下是没有中文分词的，如图所示，通过点击左边的how2java-&gt;Analysis 然后输入 <strong>四川省成都市动物园</strong>，得到是按照每个字的分词效果</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7339.png" alt></p>
<h4 id="步骤-2-配置中文分词"><a class="header-anchor" href="#步骤-2-配置中文分词">¶</a>步骤 2 : 配置中文分词</h4>
<p>接下来为 Solr 准备中文分词</p>
<h4 id="步骤-3-下载-IKAnalyzer6-5-0-jar"><a class="header-anchor" href="#步骤-3-下载-IKAnalyzer6-5-0-jar">¶</a>步骤 3 : 下载 IKAnalyzer6.5.0.jar</h4>
<p>从右上角下载 IKAnalyzer6.5.0.jar，然后复制到如下目录：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\server\solr-webapp\webapp\WEB-INF\lib</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7341.png" alt></p>
<h4 id="步骤-4-增加新的字段类型"><a class="header-anchor" href="#步骤-4-增加新的字段类型">¶</a>步骤 4 : 增加新的字段类型</h4>
<p>修改配置文件 managed-schema：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\server\solr\how2java\conf\managed-schema</span><br></pre></td></tr></table></figure>
<p>在&lt;schema…&gt; 标签下增加如下代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"text_ik"</span>  <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>  <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面贴出来完整的修改之后的，不放心的就直接复制完整的覆盖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\server\solr\how2java\conf\managed-schema</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7342.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment"> contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment"> this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment"> The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"> (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment"> the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> limitations under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> This example schema is the recommended starting point for users.</span></span><br><span class="line"><span class="comment"> It should be kept correct and concise, usable out-of-the-box.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> For more information, on how to customize this file, please see</span></span><br><span class="line"><span class="comment"> http://lucene.apache.org/solr/guide/documents-fields-and-schema-design.html</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> PERFORMANCE <span class="doctag">NOTE:</span> this schema includes many optional features and should not</span></span><br><span class="line"><span class="comment"> be used for benchmarking.  To improve performance one could</span></span><br><span class="line"><span class="comment">  - set stored="false" for all fields possible (esp large fields) when you</span></span><br><span class="line"><span class="comment">    only need to search on the field but don't need to return the original</span></span><br><span class="line"><span class="comment">    value.</span></span><br><span class="line"><span class="comment">  - set indexed="false" if you don't need to search on the field, but only</span></span><br><span class="line"><span class="comment">    return the field as a result of searching on other indexed fields.</span></span><br><span class="line"><span class="comment">  - remove all unneeded copyField statements</span></span><br><span class="line"><span class="comment">  - for best index size and searching performance, set "index" to false</span></span><br><span class="line"><span class="comment">    for all general text fields, use copyField to copy them to the</span></span><br><span class="line"><span class="comment">    catchall "text" field, and use that for searching.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"default-config"</span> <span class="attr">version</span>=<span class="string">"1.6"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"text_ik"</span>  <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>  <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- attribute "name" is the name of this schema and is only used for display purposes.</span></span><br><span class="line"><span class="comment">       version="x.y" is Solr's version number for the schema syntax and</span></span><br><span class="line"><span class="comment">       semantics.  It should not normally be changed by applications.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">       1.0: multiValued attribute did not exist, all fields are multiValued</span></span><br><span class="line"><span class="comment">            by nature</span></span><br><span class="line"><span class="comment">       1.1: multiValued attribute introduced, false by default</span></span><br><span class="line"><span class="comment">       1.2: omitTermFreqAndPositions attribute introduced, true by default</span></span><br><span class="line"><span class="comment">            except for text fields.</span></span><br><span class="line"><span class="comment">       1.3: removed optional field compress feature</span></span><br><span class="line"><span class="comment">       1.4: autoGeneratePhraseQueries attribute introduced to drive QueryParser</span></span><br><span class="line"><span class="comment">            behavior when a single string produces multiple tokens.  Defaults</span></span><br><span class="line"><span class="comment">            to off for version &gt;= 1.4</span></span><br><span class="line"><span class="comment">       1.5: omitNorms defaults to true for primitive field types</span></span><br><span class="line"><span class="comment">            (int, float, boolean, string...)</span></span><br><span class="line"><span class="comment">       1.6: useDocValuesAsStored defaults to true.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Valid attributes for fields:</span></span><br><span class="line"><span class="comment">     name: mandatory - the name for the field</span></span><br><span class="line"><span class="comment">     type: mandatory - the name of a field type from the</span></span><br><span class="line"><span class="comment">       fieldTypes section</span></span><br><span class="line"><span class="comment">     indexed: true if this field should be indexed (searchable or sortable)</span></span><br><span class="line"><span class="comment">     stored: true if this field should be retrievable</span></span><br><span class="line"><span class="comment">     docValues: true if this field should have doc values. Doc Values is</span></span><br><span class="line"><span class="comment">       recommended (required, if you are using *Point fields) for faceting,</span></span><br><span class="line"><span class="comment">       grouping, sorting and function queries. Doc Values will make the index</span></span><br><span class="line"><span class="comment">       faster to load, more NRT-friendly and more memory-efficient.</span></span><br><span class="line"><span class="comment">       They are currently only supported by StrField, UUIDField, all</span></span><br><span class="line"><span class="comment">       *PointFields, and depending on the field type, they might require</span></span><br><span class="line"><span class="comment">       the field to be single-valued, be required or have a default value</span></span><br><span class="line"><span class="comment">       (check the documentation of the field type you're interested in for</span></span><br><span class="line"><span class="comment">       more information)</span></span><br><span class="line"><span class="comment">     multiValued: true if this field may contain multiple values per document</span></span><br><span class="line"><span class="comment">     omitNorms: (expert) set to true to omit the norms associated with</span></span><br><span class="line"><span class="comment">       this field (this disables length normalization and index-time</span></span><br><span class="line"><span class="comment">       boosting for the field, and saves some memory).  Only full-text</span></span><br><span class="line"><span class="comment">       fields or fields that need an index-time boost need norms.</span></span><br><span class="line"><span class="comment">       Norms are omitted for primitive (non-analyzed) types by default.</span></span><br><span class="line"><span class="comment">     termVectors: [false] set to true to store the term vector for a</span></span><br><span class="line"><span class="comment">       given field.</span></span><br><span class="line"><span class="comment">       When using MoreLikeThis, fields used for similarity should be</span></span><br><span class="line"><span class="comment">       stored for best performance.</span></span><br><span class="line"><span class="comment">     termPositions: Store position information with the term vector. </span></span><br><span class="line"><span class="comment">       This will increase storage costs.</span></span><br><span class="line"><span class="comment">     termOffsets: Store offset information with the term vector. This</span></span><br><span class="line"><span class="comment">       will increase storage costs.</span></span><br><span class="line"><span class="comment">     required: The field is required.  It will throw an error if the</span></span><br><span class="line"><span class="comment">       value does not exist</span></span><br><span class="line"><span class="comment">     default: a value that should be used if no value is specified</span></span><br><span class="line"><span class="comment">       when adding a document.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- field names should consist of alphanumeric or underscore characters only and</span></span><br><span class="line"><span class="comment">      not start with a digit.  This is not currently strictly enforced,</span></span><br><span class="line"><span class="comment">      but other field names will not have first class support from all components</span></span><br><span class="line"><span class="comment">      and back compatibility is not guaranteed.  Names with both leading and</span></span><br><span class="line"><span class="comment">      trailing underscores (e.g. _version_) are reserved.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- In this _default configset, only four fields are pre-declared:</span></span><br><span class="line"><span class="comment">         id, _version_, and _text_ and _root_. All other fields will be type guessed and added via the</span></span><br><span class="line"><span class="comment">         "add-unknown-fields-to-the-schema" update request processor chain declared in solrconfig.xml.</span></span><br><span class="line"><span class="comment">          </span></span><br><span class="line"><span class="comment">         Note that many dynamic fields are also defined - you can use them to specify a</span></span><br><span class="line"><span class="comment">         field's type via field naming conventions - see below.</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">         WARNING: The _text_ catch-all field will significantly increase your index size.</span></span><br><span class="line"><span class="comment">         If you don't need it, consider removing it and the corresponding copyField directive.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- docValues are enabled by default for long type so we don't need to index the version field  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"plong"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_root_"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">docValues</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_text_"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- This can be enabled, in case the client does not know what fields may be searched. It isn't enabled by default</span></span><br><span class="line"><span class="comment">         because it's very expensive to index everything twice. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;copyField source="*" dest="_text_"/&gt; --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Dynamic field definitions allow using convention over configuration</span></span><br><span class="line"><span class="comment">       for fields via the specification of patterns to match field names.</span></span><br><span class="line"><span class="comment">       EXAMPLE:  name="*_i" will match any field ending in _i (like myid_i, z_i)</span></span><br><span class="line"><span class="comment">       RESTRICTION: the glob-like pattern in the name attribute must have a "*" only at the start or the end.  --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_i"</span>  <span class="attr">type</span>=<span class="string">"pint"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_is"</span> <span class="attr">type</span>=<span class="string">"pints"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_s"</span>  <span class="attr">type</span>=<span class="string">"string"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_ss"</span> <span class="attr">type</span>=<span class="string">"strings"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_l"</span>  <span class="attr">type</span>=<span class="string">"plong"</span>   <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_ls"</span> <span class="attr">type</span>=<span class="string">"plongs"</span>   <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_b"</span>  <span class="attr">type</span>=<span class="string">"boolean"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_bs"</span> <span class="attr">type</span>=<span class="string">"booleans"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_f"</span>  <span class="attr">type</span>=<span class="string">"pfloat"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_fs"</span> <span class="attr">type</span>=<span class="string">"pfloats"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_d"</span>  <span class="attr">type</span>=<span class="string">"pdouble"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_ds"</span> <span class="attr">type</span>=<span class="string">"pdoubles"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Type used for data-driven schema, to add a string copy for each text field --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_str"</span> <span class="attr">type</span>=<span class="string">"strings"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_dt"</span>  <span class="attr">type</span>=<span class="string">"pdate"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_dts"</span> <span class="attr">type</span>=<span class="string">"pdate"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_p"</span>  <span class="attr">type</span>=<span class="string">"location"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_srpt"</span>  <span class="attr">type</span>=<span class="string">"location_rpt"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- payloaded dynamic fields --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_dpf"</span> <span class="attr">type</span>=<span class="string">"delimited_payloads_float"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_dpi"</span> <span class="attr">type</span>=<span class="string">"delimited_payloads_int"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_dps"</span> <span class="attr">type</span>=<span class="string">"delimited_payloads_string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"attr_*"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Field to use to determine and enforce document uniqueness.</span></span><br><span class="line"><span class="comment">      Unless this field is marked with required="false", it will be a required field</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uniqueKey</span>&gt;</span>id<span class="tag">&lt;/<span class="name">uniqueKey</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- copyField commands copy one field to another at the time a document</span></span><br><span class="line"><span class="comment">       is added to the index.  It's used either to index the same field differently,</span></span><br><span class="line"><span class="comment">       or to add multiple fields to the same field for easier/faster searching.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">    &lt;copyField source="sourceFieldName" dest="destinationFieldName"/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- field type definitions. The "name" attribute is</span></span><br><span class="line"><span class="comment">       just a label to be used by field definitions.  The "class"</span></span><br><span class="line"><span class="comment">       attribute and any other attributes determine the real</span></span><br><span class="line"><span class="comment">       behavior of the fieldType.</span></span><br><span class="line"><span class="comment">         Class names starting with "solr" refer to java classes in a</span></span><br><span class="line"><span class="comment">       standard package such as org.apache.solr.analysis</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- sortMissingLast and sortMissingFirst attributes are optional attributes are</span></span><br><span class="line"><span class="comment">         currently supported on types that are sorted internally as strings</span></span><br><span class="line"><span class="comment">         and on numeric types.</span></span><br><span class="line"><span class="comment">       This includes "string", "boolean", "pint", "pfloat", "plong", "pdate", "pdouble".</span></span><br><span class="line"><span class="comment">       - If sortMissingLast="true", then a sort on this field will cause documents</span></span><br><span class="line"><span class="comment">         without the field to come after documents with the field,</span></span><br><span class="line"><span class="comment">         regardless of the requested sort order (asc or desc).</span></span><br><span class="line"><span class="comment">       - If sortMissingFirst="true", then a sort on this field will cause documents</span></span><br><span class="line"><span class="comment">         without the field to come before documents with the field,</span></span><br><span class="line"><span class="comment">         regardless of the requested sort order.</span></span><br><span class="line"><span class="comment">       - If sortMissingLast="false" and sortMissingFirst="false" (the default),</span></span><br><span class="line"><span class="comment">         then default lucene sorting will be used which places docs without the</span></span><br><span class="line"><span class="comment">         field first in an ascending sort and last in a descending sort.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- The StrField type is not analyzed, but indexed/stored verbatim. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"strings"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- boolean type: "true" or "false" --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"boolean"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"booleans"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Numeric field types that index values using KD-trees.</span></span><br><span class="line"><span class="comment">      Point fields don't support FieldCache, so they must have docValues="true" if needed for sorting, faceting, functions, etc.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pint"</span> <span class="attr">class</span>=<span class="string">"solr.IntPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pfloat"</span> <span class="attr">class</span>=<span class="string">"solr.FloatPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"plong"</span> <span class="attr">class</span>=<span class="string">"solr.LongPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pdouble"</span> <span class="attr">class</span>=<span class="string">"solr.DoublePointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pints"</span> <span class="attr">class</span>=<span class="string">"solr.IntPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pfloats"</span> <span class="attr">class</span>=<span class="string">"solr.FloatPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"plongs"</span> <span class="attr">class</span>=<span class="string">"solr.LongPointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pdoubles"</span> <span class="attr">class</span>=<span class="string">"solr.DoublePointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- The format for this date field is of the form 1995-12-31T23:59:59Z, and</span></span><br><span class="line"><span class="comment">         is a more restricted form of the canonical representation of dateTime</span></span><br><span class="line"><span class="comment">         http://www.w3.org/TR/xmlschema-2/#dateTime   </span></span><br><span class="line"><span class="comment">         The trailing "Z" designates UTC time and is mandatory.</span></span><br><span class="line"><span class="comment">         Optional fractional seconds are allowed: 1995-12-31T23:59:59.999Z</span></span><br><span class="line"><span class="comment">         All other components are mandatory.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">         Expressions can also be used to denote calculations that should be</span></span><br><span class="line"><span class="comment">         performed relative to "NOW" to determine the value, ie...</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">               NOW/HOUR</span></span><br><span class="line"><span class="comment">                  ... Round to the start of the current hour</span></span><br><span class="line"><span class="comment">               NOW-1DAY</span></span><br><span class="line"><span class="comment">                  ... Exactly 1 day prior to now</span></span><br><span class="line"><span class="comment">               NOW/DAY+6MONTHS+3DAYS</span></span><br><span class="line"><span class="comment">                  ... 6 months and 3 days in the future from the start of</span></span><br><span class="line"><span class="comment">                      the current day</span></span><br><span class="line"><span class="comment">                       </span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- KD-tree versions of date fields --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pdate"</span> <span class="attr">class</span>=<span class="string">"solr.DatePointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"pdates"</span> <span class="attr">class</span>=<span class="string">"solr.DatePointField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--Binary data type. The data should be sent/retrieved in as Base64 encoded Strings --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"binary"</span> <span class="attr">class</span>=<span class="string">"solr.BinaryField"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- solr.TextField allows the specification of custom text analyzers</span></span><br><span class="line"><span class="comment">         specified as a tokenizer and a list of token filters. Different</span></span><br><span class="line"><span class="comment">         analyzers may be specified for indexing and querying.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">         The optional positionIncrementGap puts space between multiple fields of</span></span><br><span class="line"><span class="comment">         this type on the same document, with the purpose of preventing false phrase</span></span><br><span class="line"><span class="comment">         matching across fields.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">         For more info on customizing your analyzer chain, please see</span></span><br><span class="line"><span class="comment">         http://lucene.apache.org/solr/guide/understanding-analyzers-tokenizers-and-filters.html#understanding-analyzers-tokenizers-and-filters</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- One can also specify an existing Analyzer class that has a</span></span><br><span class="line"><span class="comment">         default constructor via the class attribute on the analyzer element.</span></span><br><span class="line"><span class="comment">         Example:</span></span><br><span class="line"><span class="comment">    &lt;fieldType name="text_greek" class="solr.TextField"&gt;</span></span><br><span class="line"><span class="comment">      &lt;analyzer class="org.apache.lucene.analysis.el.GreekAnalyzer"/&gt;</span></span><br><span class="line"><span class="comment">    &lt;/fieldType&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A text field that only splits on whitespace for exact matching of words --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_ws"</span> <span class="attr">type</span>=<span class="string">"text_ws"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ws"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A general text field that has reasonable, generic</span></span><br><span class="line"><span class="comment">         cross-language defaults: it tokenizes with StandardTokenizer,</span></span><br><span class="line"><span class="comment">           removes stop words from case-insensitive "stopwords.txt"</span></span><br><span class="line"><span class="comment">           (empty by default), and down cases.  At query time only, it</span></span><br><span class="line"><span class="comment">           also applies synonyms.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- in this example, we will only use synonyms at query time</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="index_synonyms.txt" ignoreCase="true" expand="false"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.FlattenGraphFilterFactory"/&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A text field with defaults appropriate for English: it tokenizes with StandardTokenizer,</span></span><br><span class="line"><span class="comment">         removes English stop words (lang/stopwords_en.txt), down cases, protects words from protwords.txt, and</span></span><br><span class="line"><span class="comment">         finally applies Porter's stemming.  The query time analyzer also applies synonyms from synonyms.txt. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_en"</span> <span class="attr">type</span>=<span class="string">"text_en"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_en"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- in this example, we will only use synonyms at query time</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="index_synonyms.txt" ignoreCase="true" expand="false"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.FlattenGraphFilterFactory"/&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Case insensitive stop word removal.</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ignoreCase</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.EnglishPossessiveFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Optionally you may want to use this less aggressive stemmer instead of PorterStemFilterFactory:</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.EnglishMinimalStemFilterFactory"/&gt;</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PorterStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ignoreCase</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.EnglishPossessiveFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Optionally you may want to use this less aggressive stemmer instead of PorterStemFilterFactory:</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.EnglishMinimalStemFilterFactory"/&gt;</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PorterStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A text field with defaults appropriate for English, plus</span></span><br><span class="line"><span class="comment">         aggressive word-splitting and autophrase features enabled.</span></span><br><span class="line"><span class="comment">         This field is just like text_en, except it adds</span></span><br><span class="line"><span class="comment">         WordDelimiterGraphFilter to enable splitting and matching of</span></span><br><span class="line"><span class="comment">         words on case-change, alpha numeric boundaries, and</span></span><br><span class="line"><span class="comment">         non-alphanumeric chars.  This means certain compound word</span></span><br><span class="line"><span class="comment">         cases will work, for example query "wi fi" will match</span></span><br><span class="line"><span class="comment">         document "WiFi" or "wi-fi".</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_en_split"</span> <span class="attr">type</span>=<span class="string">"text_en_splitting"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_en_splitting"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> <span class="attr">autoGeneratePhraseQueries</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- in this example, we will only use synonyms at query time</span></span><br><span class="line"><span class="comment">        &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="index_synonyms.txt" ignoreCase="true" expand="false"/&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Case insensitive stop word removal.</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ignoreCase</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.WordDelimiterGraphFilterFactory"</span> <span class="attr">generateWordParts</span>=<span class="string">"1"</span> <span class="attr">generateNumberParts</span>=<span class="string">"1"</span> <span class="attr">catenateWords</span>=<span class="string">"1"</span> <span class="attr">catenateNumbers</span>=<span class="string">"1"</span> <span class="attr">catenateAll</span>=<span class="string">"0"</span> <span class="attr">splitOnCaseChange</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PorterStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.FlattenGraphFilterFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ignoreCase</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.WordDelimiterGraphFilterFactory"</span> <span class="attr">generateWordParts</span>=<span class="string">"1"</span> <span class="attr">generateNumberParts</span>=<span class="string">"1"</span> <span class="attr">catenateWords</span>=<span class="string">"0"</span> <span class="attr">catenateNumbers</span>=<span class="string">"0"</span> <span class="attr">catenateAll</span>=<span class="string">"0"</span> <span class="attr">splitOnCaseChange</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PorterStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Less flexible matching, but less false matches.  Probably not ideal for product names,</span></span><br><span class="line"><span class="comment">         but may be good for SKUs.  Can insert dashes in the wrong place and still match. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_en_split_tight"</span> <span class="attr">type</span>=<span class="string">"text_en_splitting_tight"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_en_splitting_tight"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> <span class="attr">autoGeneratePhraseQueries</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.WordDelimiterGraphFilterFactory"</span> <span class="attr">generateWordParts</span>=<span class="string">"0"</span> <span class="attr">generateNumberParts</span>=<span class="string">"0"</span> <span class="attr">catenateWords</span>=<span class="string">"1"</span> <span class="attr">catenateNumbers</span>=<span class="string">"1"</span> <span class="attr">catenateAll</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.EnglishMinimalStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- this filter can remove any duplicate tokens that appear at the same position - sometimes</span></span><br><span class="line"><span class="comment">             possible with WordDelimiterGraphFilter in conjuncton with stemming. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.RemoveDuplicatesTokenFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.FlattenGraphFilterFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_en.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.WordDelimiterGraphFilterFactory"</span> <span class="attr">generateWordParts</span>=<span class="string">"0"</span> <span class="attr">generateNumberParts</span>=<span class="string">"0"</span> <span class="attr">catenateWords</span>=<span class="string">"1"</span> <span class="attr">catenateNumbers</span>=<span class="string">"1"</span> <span class="attr">catenateAll</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.KeywordMarkerFilterFactory"</span> <span class="attr">protected</span>=<span class="string">"protwords.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.EnglishMinimalStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- this filter can remove any duplicate tokens that appear at the same position - sometimes</span></span><br><span class="line"><span class="comment">             possible with WordDelimiterGraphFilter in conjuncton with stemming. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.RemoveDuplicatesTokenFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Just like text_general except it reverses the characters of</span></span><br><span class="line"><span class="comment">           each token, to enable more efficient leading wildcard queries.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_rev"</span> <span class="attr">type</span>=<span class="string">"text_general_rev"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general_rev"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ReversedWildcardFilterFactory"</span> <span class="attr">withOriginal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">maxPosAsterisk</span>=<span class="string">"3"</span> <span class="attr">maxPosQuestion</span>=<span class="string">"2"</span> <span class="attr">maxFractionAsterisk</span>=<span class="string">"0.33"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymGraphFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_phon_en"</span> <span class="attr">type</span>=<span class="string">"phonetic_en"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"phonetic_en"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.DoubleMetaphoneFilterFactory"</span> <span class="attr">inject</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- lowercases the entire field value, keeping it as a single token.  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_s_lower"</span> <span class="attr">type</span>=<span class="string">"lowercase"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"lowercase"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.KeywordTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Example of using PathHierarchyTokenizerFactory at index time, so</span></span><br><span class="line"><span class="comment">      queries for paths match documents at that path, or in descendent paths</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_descendent_path"</span> <span class="attr">type</span>=<span class="string">"descendent_path"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"descendent_path"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.PathHierarchyTokenizerFactory"</span> <span class="attr">delimiter</span>=<span class="string">"/"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.KeywordTokenizerFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Example of using PathHierarchyTokenizerFactory at query time, so</span></span><br><span class="line"><span class="comment">      queries for paths match documents at that path, or in ancestor paths</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_ancestor_path"</span> <span class="attr">type</span>=<span class="string">"ancestor_path"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"ancestor_path"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.KeywordTokenizerFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.PathHierarchyTokenizerFactory"</span> <span class="attr">delimiter</span>=<span class="string">"/"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- This point type indexes the coordinates as separate fields (subFields)</span></span><br><span class="line"><span class="comment">      If subFieldType is defined, it references a type, and a dynamic field</span></span><br><span class="line"><span class="comment">      definition is created matching *___&lt;typename&gt;.  Alternately, if</span></span><br><span class="line"><span class="comment">      subFieldSuffix is defined, that is used to create the subFields.</span></span><br><span class="line"><span class="comment">      Example: if subFieldType="double", then the coordinates would be</span></span><br><span class="line"><span class="comment">        indexed in fields myloc_0___double,myloc_1___double.</span></span><br><span class="line"><span class="comment">      Example: if subFieldSuffix="_d" then the coordinates would be indexed</span></span><br><span class="line"><span class="comment">        in fields myloc_0_d,myloc_1_d</span></span><br><span class="line"><span class="comment">      The subFields are an implementation detail of the fieldType, and end</span></span><br><span class="line"><span class="comment">      users normally should not need to know about them.</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_point"</span> <span class="attr">type</span>=<span class="string">"point"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"point"</span> <span class="attr">class</span>=<span class="string">"solr.PointType"</span> <span class="attr">dimension</span>=<span class="string">"2"</span> <span class="attr">subFieldSuffix</span>=<span class="string">"_d"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A specialized field for geospatial search filters and distance sorting. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"location"</span> <span class="attr">class</span>=<span class="string">"solr.LatLonPointSpatialField"</span> <span class="attr">docValues</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- A geospatial field type that supports multiValued and polygon shapes.</span></span><br><span class="line"><span class="comment">      For more information about this and other spatial fields see:</span></span><br><span class="line"><span class="comment">      http://lucene.apache.org/solr/guide/spatial-search.html</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"location_rpt"</span> <span class="attr">class</span>=<span class="string">"solr.SpatialRecursivePrefixTreeFieldType"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">geo</span>=<span class="string">"true"</span> <span class="attr">distErrPct</span>=<span class="string">"0.025"</span> <span class="attr">maxDistErr</span>=<span class="string">"0.001"</span> <span class="attr">distanceUnits</span>=<span class="string">"kilometers"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Payloaded field types --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"delimited_payloads_float"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.DelimitedPayloadTokenFilterFactory"</span> <span class="attr">encoder</span>=<span class="string">"float"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"delimited_payloads_int"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.DelimitedPayloadTokenFilterFactory"</span> <span class="attr">encoder</span>=<span class="string">"integer"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"delimited_payloads_string"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.WhitespaceTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.DelimitedPayloadTokenFilterFactory"</span> <span class="attr">encoder</span>=<span class="string">"identity"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- some examples for different languages (generally ordered by ISO code) --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Arabic --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ar"</span> <span class="attr">type</span>=<span class="string">"text_ar"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ar"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- for any non-arabic --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ar.txt"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- normalizes ﻯ to ﻱ, etc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ArabicNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ArabicStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Bulgarian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_bg"</span> <span class="attr">type</span>=<span class="string">"text_bg"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_bg"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_bg.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.BulgarianStemFilterFactory"</span>/&gt;</span>      </span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Catalan --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ca"</span> <span class="attr">type</span>=<span class="string">"text_ca"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ca"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- removes l', etc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ElisionFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">articles</span>=<span class="string">"lang/contractions_ca.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ca.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Catalan"</span>/&gt;</span>      </span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- CJK bigram (see text_ja for a Japanese configuration using morphological analysis) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_cjk"</span> <span class="attr">type</span>=<span class="string">"text_cjk"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_cjk"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- normalize width before bigram, as e.g. half-width dakuten combine  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKWidthFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- for any non-CJK --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKBigramFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Czech --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_cz"</span> <span class="attr">type</span>=<span class="string">"text_cz"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_cz"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_cz.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CzechStemFilterFactory"</span>/&gt;</span>      </span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Danish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_da"</span> <span class="attr">type</span>=<span class="string">"text_da"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_da"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_da.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Danish"</span>/&gt;</span>      </span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- German --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_de"</span> <span class="attr">type</span>=<span class="string">"text_de"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_de"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_de.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.GermanNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.GermanLightStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.GermanMinimalStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- more aggressive: &lt;filter class="solr.SnowballPorterFilterFactory" language="German2"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Greek --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_el"</span> <span class="attr">type</span>=<span class="string">"text_el"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_el"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- greek specific lowercase for sigma --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.GreekLowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"false"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_el.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.GreekStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Spanish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_es"</span> <span class="attr">type</span>=<span class="string">"text_es"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_es"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_es.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SpanishLightStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- more aggressive: &lt;filter class="solr.SnowballPorterFilterFactory" language="Spanish"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Basque --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_eu"</span> <span class="attr">type</span>=<span class="string">"text_eu"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_eu"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_eu.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Basque"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Persian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_fa"</span> <span class="attr">type</span>=<span class="string">"text_fa"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_fa"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- for ZWNJ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charFilter</span> <span class="attr">class</span>=<span class="string">"solr.PersianCharFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ArabicNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PersianNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_fa.txt"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Finnish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_fi"</span> <span class="attr">type</span>=<span class="string">"text_fi"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_fi"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_fi.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Finnish"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.FinnishLightStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- French --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_fr"</span> <span class="attr">type</span>=<span class="string">"text_fr"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_fr"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- removes l', etc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ElisionFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">articles</span>=<span class="string">"lang/contractions_fr.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_fr.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.FrenchLightStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.FrenchMinimalStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- more aggressive: &lt;filter class="solr.SnowballPorterFilterFactory" language="French"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Irish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ga"</span> <span class="attr">type</span>=<span class="string">"text_ga"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ga"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- removes d', etc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ElisionFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">articles</span>=<span class="string">"lang/contractions_ga.txt"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- removes n-, etc. position increments is intentionally false! --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/hyphenations_ga.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.IrishLowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ga.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Irish"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Galician --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_gl"</span> <span class="attr">type</span>=<span class="string">"text_gl"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_gl"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_gl.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.GalicianStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.GalicianMinimalStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Hindi --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_hi"</span> <span class="attr">type</span>=<span class="string">"text_hi"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_hi"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- normalizes unicode representation --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.IndicNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- normalizes variation in spelling --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.HindiNormalizationFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_hi.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.HindiStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Hungarian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_hu"</span> <span class="attr">type</span>=<span class="string">"text_hu"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_hu"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_hu.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Hungarian"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.HungarianLightStemFilterFactory"/&gt; --&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Armenian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_hy"</span> <span class="attr">type</span>=<span class="string">"text_hy"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_hy"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_hy.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Armenian"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Indonesian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_id"</span> <span class="attr">type</span>=<span class="string">"text_id"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_id"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_id.txt"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- for a less aggressive approach (only inflectional suffixes), set stemDerivational to false --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.IndonesianStemFilterFactory"</span> <span class="attr">stemDerivational</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Italian --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_it"</span> <span class="attr">type</span>=<span class="string">"text_it"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_it"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- removes l', etc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ElisionFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">articles</span>=<span class="string">"lang/contractions_it.txt"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_it.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ItalianLightStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- more aggressive: &lt;filter class="solr.SnowballPorterFilterFactory" language="Italian"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Japanese using morphological analysis (see text_cjk for a configuration using bigramming)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">         <span class="doctag">NOTE:</span> If you want to optimize search for precision, use default operator AND in your request</span></span><br><span class="line"><span class="comment">         handler config (q.op) Use OR if you would like to optimize for recall (default).</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ja"</span> <span class="attr">type</span>=<span class="string">"text_ja"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ja"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> <span class="attr">autoGeneratePhraseQueries</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Kuromoji Japanese morphological analyzer/tokenizer (JapaneseTokenizer)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           Kuromoji has a search mode (default) that does segmentation useful for search.  A heuristic</span></span><br><span class="line"><span class="comment">           is used to segment compounds into its parts and the compound itself is kept as synonym.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           Valid values for attribute mode are:</span></span><br><span class="line"><span class="comment">              normal: regular segmentation</span></span><br><span class="line"><span class="comment">              search: segmentation useful for search with synonyms compounds (default)</span></span><br><span class="line"><span class="comment">            extended: same as search mode, but unigrams unknown words (experimental)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           For some applications it might be good to use search mode for indexing and normal mode for</span></span><br><span class="line"><span class="comment">           queries to reduce recall and prevent parts of compounds from being matched and highlighted.</span></span><br><span class="line"><span class="comment">           Use &lt;analyzer type="index"&gt; and &lt;analyzer type="query"&gt; for this and mode normal in query.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           Kuromoji also has a convenient user dictionary feature that allows overriding the statistical</span></span><br><span class="line"><span class="comment">           model with your own entries for segmentation, part-of-speech tags and readings without a need</span></span><br><span class="line"><span class="comment">           to specify weights.  Notice that user dictionaries have not been subject to extensive testing.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           User dictionary attributes are:</span></span><br><span class="line"><span class="comment">                     userDictionary: user dictionary filename</span></span><br><span class="line"><span class="comment">             userDictionaryEncoding: user dictionary encoding (default is UTF-8)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           See lang/userdict_ja.txt for a sample user dictionary file.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">           Punctuation characters are discarded by default.  Use discardPunctuation="false" to keep them.</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.JapaneseTokenizerFactory"</span> <span class="attr">mode</span>=<span class="string">"search"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;tokenizer class="solr.JapaneseTokenizerFactory" mode="search" userDictionary="lang/userdict_ja.txt"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Reduces inflected verbs and adjectives to their base/dictionary forms (辞書形) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.JapaneseBaseFormFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Removes tokens with certain part-of-speech tags --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.JapanesePartOfSpeechStopFilterFactory"</span> <span class="attr">tags</span>=<span class="string">"lang/stoptags_ja.txt"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Normalizes full-width romaji to half-width and half-width kana to full-width (Unicode NFKC subset) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKWidthFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Removes common tokens typically not useful for search, but have a negative effect on ranking --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ja.txt"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Normalizes common katakana spelling variations by removing any last long sound character (U+30FC) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.JapaneseKatakanaStemFilterFactory"</span> <span class="attr">minimumLength</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Lower-cases romaji characters --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Latvian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_lv"</span> <span class="attr">type</span>=<span class="string">"text_lv"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_lv"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_lv.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LatvianStemFilterFactory"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Dutch --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_nl"</span> <span class="attr">type</span>=<span class="string">"text_nl"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_nl"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_nl.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StemmerOverrideFilterFactory"</span> <span class="attr">dictionary</span>=<span class="string">"lang/stemdict_nl.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Dutch"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Norwegian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_no"</span> <span class="attr">type</span>=<span class="string">"text_no"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_no"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_no.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Norwegian"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.NorwegianLightStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- singular/plural: &lt;filter class="solr.NorwegianMinimalStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Portuguese --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_pt"</span> <span class="attr">type</span>=<span class="string">"text_pt"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_pt"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_pt.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.PortugueseLightStemFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.PortugueseMinimalStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- more aggressive: &lt;filter class="solr.SnowballPorterFilterFactory" language="Portuguese"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- most aggressive: &lt;filter class="solr.PortugueseStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Romanian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ro"</span> <span class="attr">type</span>=<span class="string">"text_ro"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ro"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ro.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Romanian"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Russian --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_ru"</span> <span class="attr">type</span>=<span class="string">"text_ru"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ru"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_ru.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Russian"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.RussianLightStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Swedish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_sv"</span> <span class="attr">type</span>=<span class="string">"text_sv"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_sv"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_sv.txt"</span> <span class="attr">format</span>=<span class="string">"snowball"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Swedish"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- less aggressive: &lt;filter class="solr.SwedishLightStemFilterFactory"/&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Thai --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_th"</span> <span class="attr">type</span>=<span class="string">"text_th"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_th"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.ThaiTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_th.txt"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Turkish --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_txt_tr"</span> <span class="attr">type</span>=<span class="string">"text_tr"</span>  <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_tr"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.TurkishLowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"false"</span> <span class="attr">words</span>=<span class="string">"lang/stopwords_tr.txt"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SnowballPorterFilterFactory"</span> <span class="attr">language</span>=<span class="string">"Turkish"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Similarity is the scoring routine for each document vs. a query.</span></span><br><span class="line"><span class="comment">       A custom Similarity or SimilarityFactory may be specified here, but</span></span><br><span class="line"><span class="comment">       the default is fine for most applications. </span></span><br><span class="line"><span class="comment">       For more info: http://lucene.apache.org/solr/guide/other-schema-elements.html#OtherSchemaElements-Similarity</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     &lt;similarity class="com.example.solr.CustomSimilarityFactory"&gt;</span></span><br><span class="line"><span class="comment">       &lt;str name="paramkey"&gt;param value&lt;/str&gt;</span></span><br><span class="line"><span class="comment">     &lt;/similarity&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-重启-Solr"><a class="header-anchor" href="#步骤-5-重启-Solr">¶</a>步骤 5 : 重启 Solr</h4>
<p>使用如下命令重启</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd D:\software\solr-<span class="number">7.2</span><span class="number">.1</span>\bin</span><br><span class="line">d:</span><br><span class="line">solr.cmd stop -all</span><br><span class="line">solr.cmd start</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7343.png" alt></p>
<h4 id="步骤-6-重新测试分词"><a class="header-anchor" href="#步骤-6-重新测试分词">¶</a>步骤 6 : 重新测试分词</h4>
<p>如图所示，使用中文分词后，就可以看到分词的效果了。<br>
<strong>注：</strong> FieldType 记得选[增加新的字段类型] 中的 text_ik</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7344.png" alt></p>
<h3 id="4、设置字段"><a class="header-anchor" href="#4、设置字段">¶</a>4、设置字段</h3>
<h4 id="步骤-1-字段概念"><a class="header-anchor" href="#步骤-1-字段概念">¶</a>步骤 1 : 字段概念</h4>
<p>[创建Core] 中的Core就相当于表，那么接下来就要为这个表设置字段，用于存放数据</p>
<h4 id="步骤-2-创建name字段"><a class="header-anchor" href="#步骤-2-创建name字段">¶</a>步骤 2 : 创建name字段</h4>
<p>左边选中 how2java -&gt; Schema -&gt; Add Field 输入name: <strong>name</strong>， field type: <strong>text_ik</strong>, 这里一定要使用[中文分词] 中新创建的 text_ik类型，否则后续查询中文会失败。<br>
然后点击 Add Field按钮进行添加</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7347.png" alt></p>
<h4 id="步骤-3-创建其他字段"><a class="header-anchor" href="#步骤-3-创建其他字段">¶</a>步骤 3 : 创建其他字段</h4>
<p>按照[创建name字段] 的方式，继续创建如下字段：<br>
category text_ik,<br>
price pfloat,<br>
place text_ik,<br>
code text_ik<br>
<strong>注：</strong> price的类型是<strong>pfloat</strong></p>
<h4 id="步骤-4-关于id字段"><a class="header-anchor" href="#步骤-4-关于id字段">¶</a>步骤 4 : 关于id字段</h4>
<p>id字段是默认就有的，无需自己创建</p>
<h4 id="步骤-5-查看创建的字段"><a class="header-anchor" href="#步骤-5-查看创建的字段">¶</a>步骤 5 : 查看创建的字段</h4>
<p>创建好之后，可以看到如图所示的这些字段名。<br>
为什么要有这些字段名呢？因为后续要加入索引的产品对象，就是这些字段名了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7349.png" alt></p>
<h3 id="5、使用-SOLRJ-向-SOLR-增加14万条索引记录"><a class="header-anchor" href="#5、使用-SOLRJ-向-SOLR-增加14万条索引记录">¶</a>5、使用 SOLRJ 向 SOLR 增加14万条索引记录</h3>
<h4 id="步骤-1-如何创建索引"><a class="header-anchor" href="#步骤-1-如何创建索引">¶</a>步骤 1 : 如何创建索引</h4>
<p>solr 提供了一种方式向其中增加索引的界面，但是呢。。。不太方便，也和实际工作环境不相符合。<br>
实际工作环境一般都是从数据库里读取数据，然后加入到索引的。很少会通过界面添加索引，因为这样维护更新删除也不方便，尤其是数据量比较大的时候。<br>
那么本教材就会讲解，如何通过程序把数据加入到Solr 索引里。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7351.png" alt></p>
<h4 id="步骤-2-SolrJ"><a class="header-anchor" href="#步骤-2-SolrJ">¶</a>步骤 2 : SolrJ</h4>
<p>Solr 支持通过各种各样的语言（如php,javascript, c#, ）把数据加入到索引里，因为本教程主要是基于Java的，所以会使用一个第三方工具SolrJ，使用 Java 语言来把数据加入到索引里。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7352.png" alt></p>
<h4 id="步骤-3-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v3">¶</a>步骤 3 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右上角的solr4j.rar, 然后运行里面的 TestSolr4j， 一共导入14万条数据，时间比较长，请耐心等待。<br>
完成之后，打开</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8983/solr/#/how2java</span></span><br></pre></td></tr></table></figure>
<p>左边点击 Query -&gt; 点击 Execute Query 查询之后，可以看到右侧显示查询结果，总数是 <strong>147939</strong> 条</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7354.png" alt></p>
<h4 id="步骤-4-模仿和排错-v3"><a class="header-anchor" href="#步骤-4-模仿和排错-v3">¶</a>步骤 4 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-5-14万条数据"><a class="header-anchor" href="#步骤-5-14万条数据">¶</a>步骤 5 : 14万条数据</h4>
<p>为了模仿真实环境，花了很多精力，四处搜刮来了14万条天猫的产品数据，接下来我们就会把这14万条记录加入到 Solr,然后观察搜索效果。<br>
这14万条记录放在右上角 140k_products.rar，其解析办法在后续会讲解</p>
<h4 id="步骤-6-关于数据库"><a class="header-anchor" href="#步骤-6-关于数据库">¶</a>步骤 6 : 关于数据库</h4>
<p>本来应该先把这14万条记录保存进数据库，然后再从数据库中取出来的，不过考虑到不是每个同学都有JDBC基础，以及放进数据库的繁琐，和14万条数据从数据库里读取出来的时间消耗，就改成直接从文件里读取出来，然后转换为泛型是Product的集合的形式，相当于从数据库里读取出来了，不过会快很多。</p>
<h4 id="步骤-7-140k-products-txt"><a class="header-anchor" href="#步骤-7-140k-products-txt">¶</a>步骤 7 : 140k_products.txt</h4>
<p>首先下载 140k_products.rar,并解压为140k_products.txt， 然后放在项目目录下。 这个文件里一共有14万条产品记录。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7359.png" alt></p>
<h4 id="步骤-8-Product-java"><a class="header-anchor" href="#步骤-8-Product-java">¶</a>步骤 8 : Product.java</h4>
<p>准备实体类来存放产品信息<br>
<strong>注：</strong> 每个字段上都有@Field 注解，用来告诉Solr 这些和 how2java core里的字段对应</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.Field;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    String category;</span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    String place;</span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    String code;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(String category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPlace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> place;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlace</span><span class="params">(String place)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.place = place;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", category="</span> + category + <span class="string">", price="</span> + price + <span class="string">", place="</span></span><br><span class="line">                + place + <span class="string">", code="</span> + code + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-ProductUtil"><a class="header-anchor" href="#步骤-9-ProductUtil">¶</a>步骤 9 : ProductUtil</h4>
<p>工具类，把 [140k_products.txt] 文本文件，转换为泛型是Product的集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.AWTException;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line">     </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductUtil</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, AWTException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;Product&gt; products = file2list(fileName);</span><br><span class="line">         </span><br><span class="line">        System.out.println(products.size());</span><br><span class="line">             </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Product&gt; <span class="title">file2list</span><span class="params">(String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        List&lt;String&gt; lines = FileUtils.readLines(f,<span class="string">"UTF-8"</span>);</span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">            Product p = line2product(line);</span><br><span class="line">            products.add(p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Product <span class="title">line2product</span><span class="params">(String line)</span> </span>&#123;</span><br><span class="line">        Product p = <span class="keyword">new</span> Product();</span><br><span class="line">        String[] fields = line.split(<span class="string">","</span>);</span><br><span class="line">        p.setId(Integer.parseInt(fields[<span class="number">0</span>]));</span><br><span class="line">        p.setName(fields[<span class="number">1</span>]);</span><br><span class="line">        p.setCategory(fields[<span class="number">2</span>]);</span><br><span class="line">        p.setPrice(Float.parseFloat(fields[<span class="number">3</span>]));</span><br><span class="line">        p.setPlace(fields[<span class="number">4</span>]);</span><br><span class="line">        p.setCode(fields[<span class="number">5</span>]);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-10-SolrUtil"><a class="header-anchor" href="#步骤-10-SolrUtil">¶</a>步骤 10 : SolrUtil</h4>
<p>工具类，用来把产品集合批量增加到Solr. 这里就用到了SolrJ第三方包里的api了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.DocumentObjectBinder;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SolrClient client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        url = <span class="string">"http://localhost:8983/solr/how2java"</span>;</span><br><span class="line">        client = <span class="keyword">new</span> HttpSolrClient.Builder(url).build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">batchSaveOrUpdate</span><span class="params">(List&lt;T&gt; entities)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">        <span class="keyword">int</span> total = entities.size();</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (T t : entities) &#123;</span><br><span class="line">            SolrInputDocument doc = binder.toSolrInputDocument(t);</span><br><span class="line">            client.add(doc);</span><br><span class="line">            System.out.printf(<span class="string">"添加数据到索引中，总共要添加 %d 条记录，当前添加第%d条 %n"</span>,total,++count);</span><br><span class="line">        &#125;</span><br><span class="line">        client.commit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-11-TestSolr4j"><a class="header-anchor" href="#步骤-11-TestSolr4j">¶</a>步骤 11 : TestSolr4j</h4>
<p>得到14万个产品对象，然后通过[SolrUtil] 工具类提交到Solr 服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSolr4j</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(<span class="string">"140k_products.txt"</span>);</span><br><span class="line">        SolrUtil.batchSaveOrUpdate(products);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-12-验证提交效果"><a class="header-anchor" href="#步骤-12-验证提交效果">¶</a>步骤 12 : 验证提交效果</h4>
<p>打开</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8983/solr/#/how2java</span></span><br></pre></td></tr></table></figure>
<p>左边点击 Query -&gt; 点击 Execute Query 查询之后，可以看到右侧显示查询结果，总数是 <strong>147939</strong> 条</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7362.png" alt></p>
<h3 id="6、SOLRJ-分页查询"><a class="header-anchor" href="#6、SOLRJ-分页查询">¶</a>6、SOLRJ 分页查询</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v3">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行TestSolr4j，可以看到如图所示的查询了10条出来的效果</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7363.png" alt></p>
<h4 id="步骤-2-模仿和排错-v3"><a class="header-anchor" href="#步骤-2-模仿和排错-v3">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-SolrUtil"><a class="header-anchor" href="#步骤-3-SolrUtil">¶</a>步骤 3 : SolrUtil</h4>
<p>SolrUtil 增加分页查询的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> QueryResponse <span class="title">query</span><span class="params">(String keywords,<span class="keyword">int</span> startOfPage, <span class="keyword">int</span> numberOfPage)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">     SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">     query.setStart(startOfPage);</span><br><span class="line">     query.setRows(numberOfPage);</span><br><span class="line">     </span><br><span class="line">     query.setQuery(keywords);</span><br><span class="line">     QueryResponse rsp = client.query(query);</span><br><span class="line">     <span class="keyword">return</span> rsp;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.DocumentObjectBinder;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.util.NamedList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SolrClient client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        url = <span class="string">"http://localhost:8983/solr/how2java"</span>;</span><br><span class="line">        client = <span class="keyword">new</span> HttpSolrClient.Builder(url).build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">batchSaveOrUpdate</span><span class="params">(List&lt;T&gt; entities)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">        <span class="keyword">int</span> total = entities.size();</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (T t : entities) &#123;</span><br><span class="line">            SolrInputDocument doc = binder.toSolrInputDocument(t);</span><br><span class="line">            client.add(doc);</span><br><span class="line">            System.out.printf(<span class="string">"添加数据到索引中，总共要添加 %d 条记录，当前添加第%d条 %n"</span>,total,++count);</span><br><span class="line">        &#125;</span><br><span class="line">        client.commit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> QueryResponse <span class="title">query</span><span class="params">(String keywords,<span class="keyword">int</span> startOfPage, <span class="keyword">int</span> numberOfPage)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">        query.setStart(startOfPage);</span><br><span class="line">        query.setRows(numberOfPage);</span><br><span class="line">         </span><br><span class="line">        query.setQuery(keywords);</span><br><span class="line">        QueryResponse rsp = client.query(query);</span><br><span class="line">        <span class="keyword">return</span> rsp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-TestSolr4j"><a class="header-anchor" href="#步骤-4-TestSolr4j">¶</a>步骤 4 : TestSolr4j</h4>
<p>拿到分页查询的结果，遍历出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSolr4j</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//查询</span></span><br><span class="line">        QueryResponse queryResponse = SolrUtil.query(<span class="string">"name:手机"</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">        SolrDocumentList documents= queryResponse.getResults();</span><br><span class="line">        System.out.println(<span class="string">"累计找到的条数："</span>+documents.getNumFound());</span><br><span class="line">        <span class="keyword">if</span>(!documents.isEmpty())&#123;</span><br><span class="line">             </span><br><span class="line">            Collection&lt;String&gt; fieldNames = documents.get(<span class="number">0</span>).getFieldNames();</span><br><span class="line">            <span class="keyword">for</span> (String fieldName : fieldNames) &#123;</span><br><span class="line">                System.out.print(fieldName+<span class="string">"\t"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (SolrDocument solrDocument : documents) &#123;</span><br><span class="line">             </span><br><span class="line">            Collection&lt;String&gt; fieldNames= solrDocument.getFieldNames();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">for</span> (String fieldName : fieldNames) &#123;</span><br><span class="line">                System.out.print(solrDocument.get(fieldName)+<span class="string">"\t"</span>);</span><br><span class="line">                 </span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println();</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7、SOLRJ-高亮显示"><a class="header-anchor" href="#7、SOLRJ-高亮显示">¶</a>7、SOLRJ 高亮显示</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v4">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行TestSolr4j 看到如图所示的效果，<strong>手机</strong> 这个关键字被高亮出来了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7367.png" alt></p>
<h4 id="步骤-2-模仿和排错-v4"><a class="header-anchor" href="#步骤-2-模仿和排错-v4">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-SolrUtil-v2"><a class="header-anchor" href="#步骤-3-SolrUtil-v2">¶</a>步骤 3 : SolrUtil</h4>
<p>增加queryHighlight 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">queryHighlight</span><span class="params">(String keywords)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">    SolrQuery q = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">    <span class="comment">//开始页数</span></span><br><span class="line">    q.setStart(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//每页显示条数</span></span><br><span class="line">    q.setRows(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 设置查询关键字</span></span><br><span class="line">    q.setQuery(keywords); </span><br><span class="line">    <span class="comment">// 开启高亮</span></span><br><span class="line">    q.setHighlight(<span class="keyword">true</span>); </span><br><span class="line">    <span class="comment">// 高亮字段</span></span><br><span class="line">    q.addHighlightField(<span class="string">"name"</span>); </span><br><span class="line">    <span class="comment">// 高亮单词的前缀</span></span><br><span class="line">    q.setHighlightSimplePre(<span class="string">"&lt;span style='color:red'&gt;"</span>); </span><br><span class="line">    <span class="comment">// 高亮单词的后缀</span></span><br><span class="line">    q.setHighlightSimplePost(<span class="string">"&lt;/span&gt;"</span>); </span><br><span class="line">    <span class="comment">//摘要最长100个字符</span></span><br><span class="line">    q.setHighlightFragsize(<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    QueryResponse query = client.query(q);</span><br><span class="line">    <span class="comment">//获取高亮字段name相应结果</span></span><br><span class="line">    NamedList&lt;Object&gt; response = query.getResponse();</span><br><span class="line">    NamedList&lt;?&gt; highlighting = (NamedList&lt;?&gt;) response.get(<span class="string">"highlighting"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; highlighting.size(); i++) &#123;</span><br><span class="line">        System.out.println(highlighting.getName(i) + <span class="string">"："</span> + highlighting.getVal(i));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取查询结果</span></span><br><span class="line">    SolrDocumentList results = query.getResults();</span><br><span class="line">    <span class="keyword">for</span> (SolrDocument result : results) &#123;</span><br><span class="line">        System.out.println(result.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.DocumentObjectBinder;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.util.NamedList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SolrClient client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        url = <span class="string">"http://localhost:8983/solr/how2java"</span>;</span><br><span class="line">        client = <span class="keyword">new</span> HttpSolrClient.Builder(url).build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">queryHighlight</span><span class="params">(String keywords)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrQuery q = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">        <span class="comment">//开始页数</span></span><br><span class="line">        q.setStart(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//每页显示条数</span></span><br><span class="line">        q.setRows(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 设置查询关键字</span></span><br><span class="line">        q.setQuery(keywords);</span><br><span class="line">        <span class="comment">// 开启高亮</span></span><br><span class="line">        q.setHighlight(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 高亮字段</span></span><br><span class="line">        q.addHighlightField(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// 高亮单词的前缀</span></span><br><span class="line">        q.setHighlightSimplePre(<span class="string">"&lt;span style='color:red'&gt;"</span>);</span><br><span class="line">        <span class="comment">// 高亮单词的后缀</span></span><br><span class="line">        q.setHighlightSimplePost(<span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        <span class="comment">//摘要最长100个字符</span></span><br><span class="line">        q.setHighlightFragsize(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//查询</span></span><br><span class="line">        QueryResponse query = client.query(q);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取高亮字段name相应结果</span></span><br><span class="line">        NamedList&lt;Object&gt; response = query.getResponse();</span><br><span class="line">        NamedList&lt;?&gt; highlighting = (NamedList&lt;?&gt;) response.get(<span class="string">"highlighting"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; highlighting.size(); i++) &#123;</span><br><span class="line">            System.out.println(highlighting.getName(i) + <span class="string">"："</span> + highlighting.getVal(i));</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//获取查询结果</span></span><br><span class="line">        SolrDocumentList results = query.getResults();</span><br><span class="line">        <span class="keyword">for</span> (SolrDocument result : results) &#123;</span><br><span class="line">            System.out.println(result.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">batchSaveOrUpdate</span><span class="params">(List&lt;T&gt; entities)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">        <span class="keyword">int</span> total = entities.size();</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (T t : entities) &#123;</span><br><span class="line">            SolrInputDocument doc = binder.toSolrInputDocument(t);</span><br><span class="line">            client.add(doc);</span><br><span class="line">            System.out.printf(<span class="string">"添加数据到索引中，总共要添加 %d 条记录，当前添加第%d条 %n"</span>,total,++count);</span><br><span class="line">        &#125;</span><br><span class="line">        client.commit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> QueryResponse <span class="title">query</span><span class="params">(String keywords,<span class="keyword">int</span> startOfPage, <span class="keyword">int</span> numberOfPage)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">        query.setStart(startOfPage);</span><br><span class="line">        query.setRows(numberOfPage);</span><br><span class="line">         </span><br><span class="line">        query.setQuery(keywords);</span><br><span class="line">        QueryResponse rsp = client.query(query);</span><br><span class="line">        <span class="keyword">return</span> rsp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-TestSolr4j-v2"><a class="header-anchor" href="#步骤-4-TestSolr4j-v2">¶</a>步骤 4 : TestSolr4j</h4>
<p>调用queryHighlight 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSolr4j</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//高亮查询查询</span></span><br><span class="line">        SolrUtil.queryHighlight(<span class="string">"name:手机"</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、SOLRJ-更新和删除索引"><a class="header-anchor" href="#8、SOLRJ-更新和删除索引">¶</a>8、SOLRJ 更新和删除索引</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v5"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v5">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行TestSolr4j就可以看到在 修改之前使用关键字 鞭 能查询到一条结果，修改之后，查询的结果改变了。 删除之后，查询不到结果了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7371.png" alt></p>
<h4 id="步骤-2-模仿和排错-v5"><a class="header-anchor" href="#步骤-2-模仿和排错-v5">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-SolrUtil-v3"><a class="header-anchor" href="#步骤-3-SolrUtil-v3">¶</a>步骤 3 : SolrUtil</h4>
<p>SolrUtil提供一个对象的增加或者更新(都是同一个方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdate</span><span class="params">(T entity)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">    DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">    SolrInputDocument doc = binder.toSolrInputDocument(entity);</span><br><span class="line">    client.add(doc);</span><br><span class="line">    client.commit();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据id删除这个索引</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">deleteById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.deleteById(id);</span><br><span class="line">        client.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.DocumentObjectBinder;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.util.NamedList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SolrClient client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        url = <span class="string">"http://localhost:8983/solr/how2java"</span>;</span><br><span class="line">        client = <span class="keyword">new</span> HttpSolrClient.Builder(url).build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">queryHighlight</span><span class="params">(String keywords)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrQuery q = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">        <span class="comment">//开始页数</span></span><br><span class="line">        q.setStart(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//每页显示条数</span></span><br><span class="line">        q.setRows(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 设置查询关键字</span></span><br><span class="line">        q.setQuery(keywords);</span><br><span class="line">        <span class="comment">// 开启高亮</span></span><br><span class="line">        q.setHighlight(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 高亮字段</span></span><br><span class="line">        q.addHighlightField(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// 高亮单词的前缀</span></span><br><span class="line">        q.setHighlightSimplePre(<span class="string">"&lt;span style='color:red'&gt;"</span>);</span><br><span class="line">        <span class="comment">// 高亮单词的后缀</span></span><br><span class="line">        q.setHighlightSimplePost(<span class="string">"&lt;/span&gt;"</span>);</span><br><span class="line">        <span class="comment">//摘要最长100个字符</span></span><br><span class="line">        q.setHighlightFragsize(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//查询</span></span><br><span class="line">        QueryResponse query = client.query(q);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取高亮字段name相应结果</span></span><br><span class="line">        NamedList&lt;Object&gt; response = query.getResponse();</span><br><span class="line">        NamedList&lt;?&gt; highlighting = (NamedList&lt;?&gt;) response.get(<span class="string">"highlighting"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; highlighting.size(); i++) &#123;</span><br><span class="line">            System.out.println(highlighting.getName(i) + <span class="string">"："</span> + highlighting.getVal(i));</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//获取查询结果</span></span><br><span class="line">        SolrDocumentList results = query.getResults();</span><br><span class="line">        <span class="keyword">for</span> (SolrDocument result : results) &#123;</span><br><span class="line">            System.out.println(result.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">batchSaveOrUpdate</span><span class="params">(List&lt;T&gt; entities)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">        <span class="keyword">int</span> total = entities.size();</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (T t : entities) &#123;</span><br><span class="line">            SolrInputDocument doc = binder.toSolrInputDocument(t);</span><br><span class="line">            client.add(doc);</span><br><span class="line">            System.out.printf(<span class="string">"添加数据到索引中，总共要添加 %d 条记录，当前添加第%d条 %n"</span>,total,++count);</span><br><span class="line">        &#125;</span><br><span class="line">        client.commit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> QueryResponse <span class="title">query</span><span class="params">(String keywords,<span class="keyword">int</span> startOfPage, <span class="keyword">int</span> numberOfPage)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">        query.setStart(startOfPage);</span><br><span class="line">        query.setRows(numberOfPage);</span><br><span class="line">         </span><br><span class="line">        query.setQuery(keywords);</span><br><span class="line">        QueryResponse rsp = client.query(query);</span><br><span class="line">        <span class="keyword">return</span> rsp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdate</span><span class="params">(T entity)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        DocumentObjectBinder binder = <span class="keyword">new</span> DocumentObjectBinder();</span><br><span class="line">        SolrInputDocument doc = binder.toSolrInputDocument(entity);</span><br><span class="line">        client.add(doc);</span><br><span class="line">        client.commit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">deleteById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.deleteById(id);</span><br><span class="line">            client.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-TestSolr4j-v3"><a class="header-anchor" href="#步骤-4-TestSolr4j-v3">¶</a>步骤 4 : TestSolr4j</h4>
<p>修改之前查询一次<br>
修改之后查询一次<br>
删除之后查询一次<br>
观察修改和删除的效果</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7374.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSolr4j</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        String keyword = <span class="string">"name:鞭"</span>;</span><br><span class="line">        System.out.println(<span class="string">"修改之前"</span>);</span><br><span class="line">        query(keyword);</span><br><span class="line">         </span><br><span class="line">        Product p = <span class="keyword">new</span> Product();</span><br><span class="line">        p.setId(<span class="number">51173</span>);</span><br><span class="line">        p.setName(<span class="string">"修改后的神鞭"</span>);</span><br><span class="line">        SolrUtil.saveOrUpdate(p);</span><br><span class="line">        System.out.println(<span class="string">"修改之后"</span>);</span><br><span class="line">        query(keyword);</span><br><span class="line">         </span><br><span class="line">        SolrUtil.deleteById(<span class="string">"51173"</span>);</span><br><span class="line">        System.out.println(<span class="string">"删除之后"</span>);</span><br><span class="line">        query(keyword);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(String keyword)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        QueryResponse queryResponse = SolrUtil.query(keyword,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">        SolrDocumentList documents= queryResponse.getResults();</span><br><span class="line">        System.out.println(<span class="string">"累计找到的条数："</span>+documents.getNumFound());</span><br><span class="line">        <span class="keyword">if</span>(!documents.isEmpty())&#123;</span><br><span class="line">              </span><br><span class="line">            Collection&lt;String&gt; fieldNames = documents.get(<span class="number">0</span>).getFieldNames();</span><br><span class="line">            <span class="keyword">for</span> (String fieldName : fieldNames) &#123;</span><br><span class="line">                System.out.print(fieldName+<span class="string">"\t"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">for</span> (SolrDocument solrDocument : documents) &#123;</span><br><span class="line">              </span><br><span class="line">            Collection&lt;String&gt; fieldNames= solrDocument.getFieldNames();</span><br><span class="line">              </span><br><span class="line">            <span class="keyword">for</span> (String fieldName : fieldNames) &#123;</span><br><span class="line">                System.out.print(solrDocument.get(fieldName)+<span class="string">"\t"</span>);</span><br><span class="line">                  </span><br><span class="line">            &#125; </span><br><span class="line">            System.out.println();</span><br><span class="line">              </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9、进一步学习"><a class="header-anchor" href="#9、进一步学习">¶</a>9、进一步学习</h3>
<p>以上就是 Solr 的入门级用法，更进一步的学习，请进入 Solr 官网学习：</p>
<p><a href="https://lucene.apache.org/solr/" target="_blank" rel="noopener">https://lucene.apache.org/solr/</a></p>
<h2 id="3、ELASTICSEARCH"><a class="header-anchor" href="#3、ELASTICSEARCH">¶</a>3、ELASTICSEARCH</h2>
<h3 id="1、启动服务器-v2"><a class="header-anchor" href="#1、启动服务器-v2">¶</a>1、启动服务器</h3>
<h4 id="步骤-1-什么是-ElasticSearch"><a class="header-anchor" href="#步骤-1-什么是-ElasticSearch">¶</a>步骤 1 : 什么是 ElasticSearch</h4>
<p>和 [Solr]一样的， ElasticSearch 也是基于 Lucene进行了封装，提供了更为便利的访问和调用</p>
<h4 id="步骤-2-关于JDK版本"><a class="header-anchor" href="#步骤-2-关于JDK版本">¶</a>步骤 2 : 关于JDK版本</h4>
<p>至少使用JDK8版本，请下载JDK8或者更高版本： [下载以及配置JDK环境]</p>
<h4 id="步骤-3-下载"><a class="header-anchor" href="#步骤-3-下载">¶</a>步骤 3 : 下载</h4>
<p>教程使用的ElasticSerach是截至目前 (2018-3-14) 最新的版本6.2。 点击右上角下载 elasticsearch-6.2.2.rar，并解压。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7383.png" alt></p>
<h4 id="步骤-4-运行"><a class="header-anchor" href="#步骤-4-运行">¶</a>步骤 4 : 运行</h4>
<p>假设上一步解压到</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\elasticsearch-<span class="number">6.2</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<p>这个位置，那么运行就是点击：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\elasticsearch-<span class="number">6.2</span><span class="number">.2</span>\bin\elasticsearch.bat</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7384.png" alt></p>
<h4 id="步骤-5-验证启动成功"><a class="header-anchor" href="#步骤-5-验证启动成功">¶</a>步骤 5 : 验证启动成功</h4>
<p>输入地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:9200/</span></span><br></pre></td></tr></table></figure>
<p>返回如图所示的json代码，就表示启动成功了。<br>
里面给出了服务器的基本信息，如版本号是6.2.2, 底层用的lucene版本号是7.2.1 等等<br>
<strong>注：</strong> 不同浏览器对于json代码的默认渲染方式是不一样的，截图看到的是火狐的渲染方式，其他浏览器可能是下载一个文件，里面呢内容是这些，不过都表示启动成功了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7385.png" alt></p>
<h3 id="2、工具-KIBANA"><a class="header-anchor" href="#2、工具-KIBANA">¶</a>2、工具-KIBANA</h3>
<h4 id="步骤-1-Kibana-是什么"><a class="header-anchor" href="#步骤-1-Kibana-是什么">¶</a>步骤 1 : Kibana 是什么</h4>
<p>Kibana 是在ElasticSearch 有了相当多的数据之后，进行分析这些数据用的工具。 但是现在还么有数据呀，为什么就要介绍这个工具呢？ 因为Kibana 里面有一个叫做 Dev Tools的，可以很方便地以<strong>Restful</strong> 风格向 ElasticSearch 服务器提交请求，接下来的部分学习，都会使用Kibana 里的这个Dev Tools 来讲解，简单又方便</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7375.png" alt></p>
<h4 id="步骤-2-下载并启动"><a class="header-anchor" href="#步骤-2-下载并启动">¶</a>步骤 2 : 下载并启动</h4>
<p>下载右上角的rar，并解压。 假设下载路径在：C:\Users\X7TI<br>
运行启动中的 kibana.bat</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\kibana-<span class="number">6.2</span><span class="number">.2</span>-windows-x86_64\bin\kibana.bat</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-验证启动"><a class="header-anchor" href="#步骤-3-验证启动">¶</a>步骤 3 : 验证启动</h4>
<p>打开</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>就能打开当前的开发工具 Dev Tools 界面</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7387.png" alt></p>
<h4 id="步骤-4-运行测试"><a class="header-anchor" href="#步骤-4-运行测试">¶</a>步骤 4 : 运行测试</h4>
<p>在控制台里输入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/health?v</span><br></pre></td></tr></table></figure>
<p>然后点击绿色箭头进行运行，就可以看到右侧出现查询结果<br>
GET /_cat/health?v 这个命令用来查看服务器状态（健康度），green 表示一切OK</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7388.png" alt></p>
<h3 id="3、KIBANA-索引管理"><a class="header-anchor" href="#3、KIBANA-索引管理">¶</a>3、KIBANA-索引管理</h3>
<h4 id="步骤-1-索引概念"><a class="header-anchor" href="#步骤-1-索引概念">¶</a>步骤 1 : 索引概念</h4>
<p>索引相当于就是一个数据库服务器上的某个数据库，所以索引也可以看成是Elastic Search里的某个数据库</p>
<h4 id="步骤-2-Restful-风格"><a class="header-anchor" href="#步骤-2-Restful-风格">¶</a>步骤 2 : Restful 风格</h4>
<p>接下来就要进行管理索引的工作了，管理无非就是增删改查，即 CRUD。<br>
在使用Restful风格之前，进行所以管理需要这样的访问地址： add,delete,update,get 等不同的访问地址来表示不同的业务请求。<br>
但是使用Restful 风格，就通过提交不同的method 来表示 CRUD：<br>
<strong>PUT</strong> 表示增加<br>
<strong>GET</strong> 表示获取<br>
<strong>DELETE</strong> 表示删除<br>
<strong>POST</strong>表示更新<br>
<strong>注：</strong> Method 是http请求里的一个属性，常用的属性值是post和get。 更多关于http协议请查看[http协议教程]</p>
<h4 id="步骤-3-增加索引"><a class="header-anchor" href="#步骤-3-增加索引">¶</a>步骤 3 : 增加索引</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost:5601/app/kibana#/dev_tools/console?_g=()</span></span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /how2java?pretty</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"shards_acknowledged"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"index"</span>: <span class="string">"how2java"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表示创建成功了，索引名称是how2java<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7391.png" alt></p>
<h4 id="步骤-4-查询"><a class="header-anchor" href="#步骤-4-查询">¶</a>步骤 4 : 查询</h4>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v</span><br></pre></td></tr></table></figure>
<p>可以观察到新建立的索引</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7392.png" alt></p>
<h4 id="步骤-5-删除"><a class="header-anchor" href="#步骤-5-删除">¶</a>步骤 5 : 删除</h4>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /how2java?pretty</span><br></pre></td></tr></table></figure>
<p>再运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v</span><br></pre></td></tr></table></figure>
<p>可以观察到索引how2java被删除了，右侧一个索引也看不到了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7393.png" alt></p>
<h3 id="4、中文分词器"><a class="header-anchor" href="#4、中文分词器">¶</a>4、中文分词器</h3>
<h4 id="步骤-1-分词器概念-v2"><a class="header-anchor" href="#步骤-1-分词器概念-v2">¶</a>步骤 1 : 分词器概念</h4>
<p>分词器指的是搜索引擎如何使用关键字进行匹配，如 入门 中的关键字：护眼带光源。 如果使用like,那么%护眼带光源%，匹配出来的结果就是要么全匹配，要不都不匹配。<br>
而使用分词器，就会把这个关键字分为 护眼，带，光源 3个关键字，这样就可以找到不同相关程度的结果了。</p>
<h4 id="步骤-2-安装中文分词器"><a class="header-anchor" href="#步骤-2-安装中文分词器">¶</a>步骤 2 : 安装中文分词器</h4>
<p>ElasticSearch 默认是没有中文分词器的，需要额外安装。<br>
下载右上角的elasticsearch-analysis-ik-6.2.2.zip，然后复制到 ElasticSearch 解压目录下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\elasticsearch-<span class="number">6.2</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<p>接着运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\elasticsearch-<span class="number">6.2</span><span class="number">.2</span>\bin\elasticsearch-plugin install file:\\\\C:\Users\X7TI\Downloads\elasticsearch-<span class="number">6.2</span><span class="number">.2</span>\elasticsearch-analysis-ik-<span class="number">6.2</span><span class="number">.2</span>.zip</span><br></pre></td></tr></table></figure>
<p>这样就如图所示安装成功了<br>
<strong>注：</strong> 为什么不安装github.com上的?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch-plugin install https:<span class="comment">//github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.2/elasticsearch-analysis-ik-6.2.2.zip</span></span><br></pre></td></tr></table></figure>
<p>因为github 有时候连不上呀，这他娘的不靠谱啊~ 所以才下载到本地确保安装成功呀~<br>
<strong>注：</strong> elasticsearch-analysis-ik-6.2.2.zip 所存放的路径不要有空格，比如放在 program files 这样的路径下就不行了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7395.png" alt></p>
<h4 id="步骤-3-重启-ElasticSearch"><a class="header-anchor" href="#步骤-3-重启-ElasticSearch">¶</a>步骤 3 : 重启 ElasticSearch</h4>
<p>安装插件后要重启，否则无法生效。<br>
重启很简单。。。就是右上角X掉，然后重新运行elasticsearch.bat</p>
<h4 id="步骤-4-测试中文分词效果"><a class="header-anchor" href="#步骤-4-测试中文分词效果">¶</a>步骤 4 : 测试中文分词效果</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"analyzer"</span>:<span class="string">"ik_max_word"</span>,</span><br><span class="line">  <span class="string">"text"</span>:<span class="string">"护眼带光源"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回如图所示的分词效果<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7396.png" alt></p>
<h3 id="5、KIBANA-文档管理"><a class="header-anchor" href="#5、KIBANA-文档管理">¶</a>5、KIBANA-文档管理</h3>
<h4 id="步骤-1-增加文档"><a class="header-anchor" href="#步骤-1-增加文档">¶</a>步骤 1 : 增加文档</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /how2java/product/<span class="number">1</span>?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"蜡烛"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回如图所示增加成功的响应<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]<br>
<strong>注：</strong> 其中的<strong>product</strong>在elastic search里是type的概念，相当于数据库里的<strong>表</strong>，这里就相当于向 product 表里插入了一条数据</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7398.png" alt></p>
<h4 id="步骤-2-获取文档"><a class="header-anchor" href="#步骤-2-获取文档">¶</a>步骤 2 : 获取文档</h4>
<p>输入请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/product/<span class="number">1</span>?pretty</span><br></pre></td></tr></table></figure>
<p>获取相应：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span>: <span class="string">"how2java"</span>,</span><br><span class="line">  <span class="string">"_type"</span>: <span class="string">"product"</span>,</span><br><span class="line">  <span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"_version"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"found"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"_source"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"蜡烛"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>_index 表示哪个索引<br>
_type 表示哪个表<br>
_id 主键<br>
_version 版本<br>
found 数据存在<br>
_source: 数据内容</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7402.png" alt></p>
<h4 id="步骤-3-修改文档1"><a class="header-anchor" href="#步骤-3-修改文档1">¶</a>步骤 3 : 修改文档1</h4>
<p>修改两种方式，第一种还是用PUT，PUT本来用来做增加的，但是当输入的id已经存在的时候，就自动变成修改功能了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /how2java/product/<span class="number">1</span>?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"红色蜡烛"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看看，此时如图所示，已经变成红色蜡烛了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/product/<span class="number">1</span>?pretty</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7399.png" alt></p>
<h4 id="步骤-4-修改文档2"><a class="header-anchor" href="#步骤-4-修改文档2">¶</a>步骤 4 : 修改文档2</h4>
<p>修改两种方式，第二种使用 POST，这才是正规的修改，其实和[修改文档1] 效果一样的，爱用哪种用哪种</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /how2java/product/<span class="number">1</span>/_update?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"doc"</span>: &#123; <span class="string">"name"</span>: <span class="string">"蓝色蜡烛"</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/product/<span class="number">1</span>?pretty</span><br></pre></td></tr></table></figure>
<p>留意其中的版本已经是3了，第一次创建的时候是1，第一次修改是2，现在修改是3</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7400.png" alt></p>
<h4 id="步骤-5-删除文档"><a class="header-anchor" href="#步骤-5-删除文档">¶</a>步骤 5 : 删除文档</h4>
<p>执行删除：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /how2java/product/<span class="number">1</span>?pretty</span><br></pre></td></tr></table></figure>
<p>查看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/product/<span class="number">1</span>?pretty</span><br></pre></td></tr></table></figure>
<p>查询结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span>: <span class="string">"how2java"</span>,</span><br><span class="line">  <span class="string">"_type"</span>: <span class="string">"product"</span>,</span><br><span class="line">  <span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"found"</span>: <span class="keyword">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>found:false 就表示没有找到啦</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7401.png" alt></p>
<h3 id="6、KIBANA-批量导入"><a class="header-anchor" href="#6、KIBANA-批量导入">¶</a>6、KIBANA-批量导入</h3>
<h4 id="步骤-1-批量导入两条数据"><a class="header-anchor" href="#步骤-1-批量导入两条数据">¶</a>步骤 1 : 批量导入两条数据</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;<span class="string">"_index"</span>:<span class="string">"how2java"</span>,<span class="string">"_type"</span>:<span class="string">"product"</span>,<span class="string">"_id"</span>:<span class="number">10001</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">"code"</span>:<span class="string">"540785126782"</span>,<span class="string">"price"</span>:<span class="number">398</span>,<span class="string">"name"</span>:<span class="string">"房屋卫士自流平美缝剂瓷砖地砖专用双组份真瓷胶防水填缝剂镏金色"</span>,<span class="string">"place"</span>:<span class="string">"上海"</span>,<span class="string">"category"</span>:<span class="string">"品质建材"</span>&#125;</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;<span class="string">"_index"</span>:<span class="string">"how2java"</span>,<span class="string">"_type"</span>:<span class="string">"product"</span>,<span class="string">"_id"</span>:<span class="number">10002</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">"code"</span>:<span class="string">"24727352473"</span>,<span class="string">"price"</span>:<span class="number">21.799999237060547</span>,<span class="string">"name"</span>:<span class="string">"艾瑞泽手工大号小号调温热熔胶枪玻璃胶枪硅胶条热溶胶棒20W-100W"</span>,<span class="string">"place"</span>:<span class="string">"山东青岛"</span>,<span class="string">"category"</span>:<span class="string">"品质建材"</span>&#125;</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;<span class="string">"_index"</span>:<span class="string">"how2java"</span>,<span class="string">"_type"</span>:<span class="string">"product"</span>,<span class="string">"_id"</span>:<span class="number">10003</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回如图所示增加成功的响应<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]<br>
<strong>注：</strong> 其中的<strong>product</strong>在elastic search里是type的概念，相当于数据库里的<strong>表</strong>，这里就相当于向 product 表里插入了一条数据</p>
<h4 id="步骤-2-验证插入的数据"><a class="header-anchor" href="#步骤-2-验证插入的数据">¶</a><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7403.png" alt>步骤 2 : 验证插入的数据</h4>
<p>使用命令查询how2java 索引里所有的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123; <span class="string">"match_all"</span>: &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如图所示，可以看到刚刚批量插入的两条数据<br>
**注：**这里临时使用一下查询功能，后续会有更多关于查询功能的讲解:[Kibana-查询操作]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7405.png" alt></p>
<h4 id="步骤-3-局限性"><a class="header-anchor" href="#步骤-3-局限性">¶</a>步骤 3 : 局限性</h4>
<p>使用这种方式能够插入的上限较小，在前面的Lucene和Solr教程里，都有14万条数据要插入，用这种方式就差不进去了。<br>
那么就会使用接下来的 通过 curl.exe 来插入: [curl-批量导入]</p>
<h3 id="7、CURL-批量导入"><a class="header-anchor" href="#7、CURL-批量导入">¶</a>7、CURL-批量导入</h3>
<h4 id="步骤-1-curl-exe"><a class="header-anchor" href="#步骤-1-curl-exe">¶</a>步骤 1 : curl.exe</h4>
<p>curl是一个工具，可以模拟浏览器向服务器提交数据，在右上角有下载</p>
<h4 id="步骤-2-14万条数据"><a class="header-anchor" href="#步骤-2-14万条数据">¶</a>步骤 2 : 14万条数据</h4>
<p>接下来要批量导入14万条数据到 elastic search里，右上角有一个products.json.rar，下载后解压。<br>
然后把 [curl.exe] 和 解压出来的 products.json 放在<strong>同一个目录下</strong>，一定是要同一个目录下哦，不然使用后面的命令行就不能成功。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7407.png" alt></p>
<h4 id="步骤-3-执行导入"><a class="header-anchor" href="#步骤-3-执行导入">¶</a>步骤 3 : 执行导入</h4>
<p>确认curl.exe和products.json 在同一个目录后，假设他们所在目录是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\X7TI\Downloads\curl</span><br></pre></td></tr></table></figure>
<p>在cmd中，运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Users\X7TI\Downloads\curl</span><br><span class="line">curl -H <span class="string">"Content-Type: application/json"</span> -XPOST <span class="string">"localhost:9200/how2java/product/_bulk?refresh"</span> --data-binary <span class="string">"@products.json"</span></span><br></pre></td></tr></table></figure>
<p>数量较大，运行比较花时间，请耐心等待</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7409.png" alt></p>
<h4 id="步骤-4-导入结束截屏"><a class="header-anchor" href="#步骤-4-导入结束截屏">¶</a>步骤 4 : 导入结束截屏</h4>
<p>导入结束之后，就会看到如图所示的结果，控制台会把14万条记录都打印出来，所以看不完整，但是这表示导入成功了</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7410.png" alt></p>
<h4 id="步骤-5-验证导入效果"><a class="header-anchor" href="#步骤-5-验证导入效果">¶</a>步骤 5 : 验证导入效果</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123; <span class="string">"match_all"</span>: &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回如图所示显示一共有147939条数据，这就表示都导入成功了。<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]<br>
<strong>注：</strong> 这里临时使用一下查询功能，后续会有更多关于查询功能的讲解:[Kibana-查询操作]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7408.png" alt></p>
<h3 id="8、KIBANA-查询操作-包括倒排序-条件查询-分页查询"><a class="header-anchor" href="#8、KIBANA-查询操作-包括倒排序-条件查询-分页查询">¶</a>8、KIBANA-查询操作 包括倒排序 条件查询 分页查询</h3>
<h4 id="步骤-1-准备数据"><a class="header-anchor" href="#步骤-1-准备数据">¶</a>步骤 1 : 准备数据</h4>
<p>请先按照[curl-批量导入]的做法，把14万条数据插入</p>
<h4 id="步骤-2-查询所有"><a class="header-anchor" href="#步骤-2-查询所有">¶</a>步骤 2 : 查询所有</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"query"</span>: &#123; <span class="string">"match_all"</span>: &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回如图所示显示一共有147939条数据.<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]<br>
<strong>注：</strong> 默认查询显示10条数据，欲查询更多数据请参考后面的 [分页查询]</p>
<h4 id="步骤-3-id-倒排序"><a class="header-anchor" href="#步骤-3-id-倒排序">¶</a>步骤 3 : id 倒排序</h4>
<p>输入命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123; <span class="string">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">  <span class="string">"sort"</span>: [</span><br><span class="line">    &#123; <span class="string">"_id"</span>: <span class="string">"desc"</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如图所示，按照_id 倒排序</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7412.png" alt></p>
<h4 id="步骤-4-只返回部分字段"><a class="header-anchor" href="#步骤-4-只返回部分字段">¶</a>步骤 4 : 只返回部分字段</h4>
<p>使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;how2java&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;,&quot;price&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如图所示，只返回name和price字段<br>
<strong>注：</strong> 上面name和price之间的逗号是中文的，请修改为英文的逗号</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7413.png" alt></p>
<h4 id="步骤-5-条件查询"><a class="header-anchor" href="#步骤-5-条件查询">¶</a>步骤 5 : 条件查询</h4>
<p>输入命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123; <span class="string">"match"</span>: &#123; <span class="string">"name"</span>: <span class="string">"时尚连衣裙"</span> &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如图所示根据条件查询</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7414.png" alt></p>
<h4 id="步骤-6-分页查询"><a class="header-anchor" href="#步骤-6-分页查询">¶</a>步骤 6 : 分页查询</h4>
<p>分页查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123; <span class="string">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">  <span class="string">"from"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"size"</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">"sort"</span>: &#123; <span class="string">"_id"</span>: &#123; <span class="string">"order"</span>: <span class="string">"desc"</span> &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7415.png" alt></p>
<h4 id="9、KIBANA-聚合操作"><a class="header-anchor" href="#9、KIBANA-聚合操作">¶</a>9、KIBANA-聚合操作</h4>
<h4 id="步骤-1-统计数据"><a class="header-anchor" href="#步骤-1-统计数据">¶</a>步骤 1 : 统计数据</h4>
<p>在 kibana 控制台中输入如下命令：<br>
打开 kibana控制台：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span><br></pre></td></tr></table></figure>
<p>运行如下命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /how2java/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"size"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"aggs"</span>: &#123;</span><br><span class="line">    <span class="string">"group_by_place"</span>: &#123;</span><br><span class="line">      <span class="string">"terms"</span>: &#123;</span><br><span class="line">        <span class="string">"field"</span>: <span class="string">"place.keyword"</span>,</span><br><span class="line">        <span class="string">"size"</span>: <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相当于sql语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),place from product group by place limit 0,3</span><br></pre></td></tr></table></figure>
<p>返回如图所示显示统计了3条数据。<br>
<strong>注：</strong> 要运行kibana控制台，需要先安装kibana: [下载kibana并启动]<br>
<strong>注：</strong> 第一个size:0表示 不用显示每条数据，第二个size:3表示分组数据显示3条。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7417.png" alt></p>
<h3 id="9、JAVAAPI"><a class="header-anchor" href="#9、JAVAAPI">¶</a>9、JAVAAPI</h3>
<h4 id="步骤-1-Java-API"><a class="header-anchor" href="#步骤-1-Java-API">¶</a>步骤 1 : Java API</h4>
<p>以上内容都是使用kibana 这个工具实现的。 可是实际开发中，肯定会通过编程语言来实现，那么接下来的教程就会讲解如何通过 Java api实现对Elastic Search的管理</p>
<h3 id="10、JAVAAPI-索引管理"><a class="header-anchor" href="#10、JAVAAPI-索引管理">¶</a>10、JAVAAPI-索引管理</h3>
<h4 id="步骤-1-版本"><a class="header-anchor" href="#步骤-1-版本">¶</a>步骤 1 : 版本</h4>
<p>不同版本的java api和 elasticsearch之间存在兼容风险，当前教程使用的 java api用于链接 [Elastic Search 6.2]，请确保版本一致，否则会出现无法预计的错误</p>
<h4 id="步骤-2-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-2-先运行，看到效果，再学习-v2">¶</a>步骤 2 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestElasticSearch4J<br>
可以观察到如图所示的索引创建，删除和检查索引是否存在</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7423.png" alt></p>
<h4 id="步骤-3-模仿和排错-v2"><a class="header-anchor" href="#步骤-3-模仿和排错-v2">¶</a>步骤 3 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-4-TestElasticSearch4J"><a class="header-anchor" href="#步骤-4-TestElasticSearch4J">¶</a>步骤 4 : TestElasticSearch4J</h4>
<p>代码很简单，无非就是获取连接，然后调用对应的API进行 增加和删除。<br>
需要指出来的是，通过 RestHighLevelClient 查看索引是否存在在当前 java api版本(6.2) 里是不提供了，使用的是通过捕捉异常来判断是否存在。<br>
jar 包什么的在右上角的可运行项目里已经包含了，不再赘述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.ElasticsearchStatusException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.open.OpenIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestElasticSearch4J</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">            RestClient.builder(</span><br><span class="line">                    <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9200</span>, <span class="string">"http"</span>)</span><br><span class="line">            ));</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String indexName = <span class="string">"how2java"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(!checkExistIndex(indexName))&#123;</span><br><span class="line">            createIndex(indexName);        </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(checkExistIndex(indexName))&#123;</span><br><span class="line">            deleteIndex(indexName);</span><br><span class="line">        &#125;</span><br><span class="line">        checkExistIndex(indexName);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkExistIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result =<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            OpenIndexRequest openIndexRequest = <span class="keyword">new</span> OpenIndexRequest(indexName);</span><br><span class="line">            client.indices().open(openIndexRequest).isAcknowledged();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ElasticsearchStatusException ex) &#123;</span><br><span class="line">            String m = <span class="string">"Elasticsearch exception [type=index_not_found_exception, reason=no such index]"</span>;</span><br><span class="line">            <span class="keyword">if</span> (m.equals(ex.getMessage())) &#123;</span><br><span class="line">                result = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result)</span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 是存在的"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 不存在"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(indexName);</span><br><span class="line">        client.indices().delete(request);</span><br><span class="line">        System.out.println(<span class="string">"删除了索引："</span>+indexName);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(indexName);</span><br><span class="line">        client.indices().create(request);</span><br><span class="line">        System.out.println(<span class="string">"创建了索引："</span>+indexName);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11、JAVAAPI-文档管理"><a class="header-anchor" href="#11、JAVAAPI-文档管理">¶</a>11、JAVAAPI-文档管理</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v6"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v6">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行TestElasticSearch4J, 可以观察到如图所示的文档 CRUD一套</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7426.png" alt></p>
<h4 id="步骤-2-模仿和排错-v6"><a class="header-anchor" href="#步骤-2-模仿和排错-v6">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-Product-java"><a class="header-anchor" href="#步骤-3-Product-java">¶</a>步骤 3 : Product.java</h4>
<p>准备 Product.java 用于存放数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-TestElasticSearch4J-v2"><a class="header-anchor" href="#步骤-4-TestElasticSearch4J-v2">¶</a>步骤 4 : TestElasticSearch4J</h4>
<p>TestElasticSearch4J 提供了 Document的 CRUD一套，逻辑很清晰，请看注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.ElasticsearchStatusException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.open.OpenIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestElasticSearch4J</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">            RestClient.builder(</span><br><span class="line">                    <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9200</span>, <span class="string">"http"</span>)</span><br><span class="line">            ));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String indexName = <span class="string">"how2java"</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//确保索引存在</span></span><br><span class="line">        <span class="keyword">if</span>(!checkExistIndex(indexName))&#123;</span><br><span class="line">            createIndex(indexName);        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//准备数据</span></span><br><span class="line">        Product product = <span class="keyword">new</span> Product();</span><br><span class="line">        product.setId(<span class="number">1</span>);</span><br><span class="line">        product.setName(<span class="string">"product 1"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//增加文档</span></span><br><span class="line">        addDocument(product);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//获取文档</span></span><br><span class="line">        getDocument(<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//修改数据</span></span><br><span class="line">        product.setName(<span class="string">"product 2"</span>);</span><br><span class="line">        <span class="comment">//修改文档</span></span><br><span class="line">        updateDocument(product);</span><br><span class="line">        <span class="comment">//获取文档</span></span><br><span class="line">        getDocument(<span class="number">1</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//删除文档</span></span><br><span class="line">        deleteDocument(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//获取文档</span></span><br><span class="line">        getDocument(<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">        client.close();</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteRequest  deleteRequest = <span class="keyword">new</span> DeleteRequest (indexName,<span class="string">"product"</span>, String.valueOf(id));</span><br><span class="line">        client.delete(deleteRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经从ElasticSearch服务器上删除id="</span>+id+<span class="string">"的文档"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     </span><br><span class="line">        UpdateRequest  updateRequest = <span class="keyword">new</span> UpdateRequest (indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .doc(<span class="string">"name"</span>,product.getName());</span><br><span class="line">                 </span><br><span class="line">        client.update(updateRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经在ElasticSearch服务器修改产品为："</span>+product);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        GetRequest request = <span class="keyword">new</span> GetRequest(</span><br><span class="line">                indexName,</span><br><span class="line">                <span class="string">"product"</span>, </span><br><span class="line">                String.valueOf(id));</span><br><span class="line">         </span><br><span class="line">        GetResponse response = client.get(request);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(!response.isExists())&#123;</span><br><span class="line">            System.out.println(<span class="string">"检查到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            String source = response.getSourceAsString();</span><br><span class="line">            System.out.print(<span class="string">"获取到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档内容是："</span>);</span><br><span class="line"> </span><br><span class="line">            System.out.println(source);</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">"name"</span>, product.getName());</span><br><span class="line">        IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .source(jsonMap);</span><br><span class="line">        client.index(indexRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经向ElasticSearch服务器增加产品："</span>+product);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkExistIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result =<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            OpenIndexRequest openIndexRequest = <span class="keyword">new</span> OpenIndexRequest(indexName);</span><br><span class="line">            client.indices().open(openIndexRequest).isAcknowledged();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ElasticsearchStatusException ex) &#123;</span><br><span class="line">            String m = <span class="string">"Elasticsearch exception [type=index_not_found_exception, reason=no such index]"</span>;</span><br><span class="line">            <span class="keyword">if</span> (m.equals(ex.getMessage())) &#123;</span><br><span class="line">                result = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result)</span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 是存在的"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 不存在"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(indexName);</span><br><span class="line">        client.indices().delete(request);</span><br><span class="line">        System.out.println(<span class="string">"删除了索引："</span>+indexName);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(indexName);</span><br><span class="line">        client.indices().create(request);</span><br><span class="line">        System.out.println(<span class="string">"创建了索引："</span>+indexName);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12、JAVAAPI-批量操作"><a class="header-anchor" href="#12、JAVAAPI-批量操作">¶</a>12、JAVAAPI-批量操作</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v7"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v7">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestElasticSearch4J, 然后通过[Kibana-查询操作] 看到到如图所示，总共有147939条数据被批量增加到了服务器</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7430.png" alt></p>
<h4 id="步骤-2-模仿和排错-v7"><a class="header-anchor" href="#步骤-2-模仿和排错-v7">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-14万条数据"><a class="header-anchor" href="#步骤-3-14万条数据">¶</a>步骤 3 : 14万条数据</h4>
<p>所以为了模仿真实环境，花了很多精力，四处搜刮来了14万条天猫的产品数据，接下来我们就会把这14万条记录批量增加到 Elastic Search,然后观察搜索效果。<br>
这14万条记录放在右上角 140k_products.rar，其解析办法在后续会讲解。<br>
下载解压之后放在项目目录下。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7432.png" alt></p>
<h4 id="步骤-4-关于数据库"><a class="header-anchor" href="#步骤-4-关于数据库">¶</a>步骤 4 : 关于数据库</h4>
<p>本来应该先把这14万条记录保存进数据库，然后再从数据库中取出来的，不过考虑到不是每个同学都有JDBC基础，以及放进数据库的繁琐，和14万条数据从数据库里读取出来的时间消耗，就改成直接从文件里读取出来，然后转换为泛型是Product的集合的形式，相当于从数据库里读取出来了，不过会快很多。</p>
<h4 id="步骤-5-Product-java"><a class="header-anchor" href="#步骤-5-Product-java">¶</a>步骤 5 : Product.java</h4>
<p>修改Product.java，使得其有更多的字段。 除此之外，还增加了一个toMap()方法，使得其返回为一个Map对象，方便后续的批量增加。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    String category;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    String place;</span><br><span class="line"> </span><br><span class="line">    String code;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(String category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPlace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> place;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlace</span><span class="params">(String place)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.place = place;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", category="</span> + category + <span class="string">", price="</span> + price + <span class="string">", place="</span></span><br><span class="line">                + place + <span class="string">", code="</span> + code + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">toMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"name"</span>, name);</span><br><span class="line">        map.put(<span class="string">"category"</span>, category);</span><br><span class="line">        map.put(<span class="string">"code"</span>, code);</span><br><span class="line">        map.put(<span class="string">"place"</span>, place);</span><br><span class="line">        map.put(<span class="string">"price"</span>, price);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-ProductUtil"><a class="header-anchor" href="#步骤-6-ProductUtil">¶</a>步骤 6 : ProductUtil</h4>
<p>准备工具类，把文本文件 140k_products.txt，转换为泛型是Product的集合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.AWTException;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line">     </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductUtil</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, AWTException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String fileName = <span class="string">"140k_products.txt"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;Product&gt; products = file2list(fileName);</span><br><span class="line">         </span><br><span class="line">        System.out.println(products.size());</span><br><span class="line">             </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Product&gt; <span class="title">file2list</span><span class="params">(String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File f = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        List&lt;String&gt; lines = FileUtils.readLines(f,<span class="string">"UTF-8"</span>);</span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">            Product p = line2product(line);</span><br><span class="line">            products.add(p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Product <span class="title">line2product</span><span class="params">(String line)</span> </span>&#123;</span><br><span class="line">        Product p = <span class="keyword">new</span> Product();</span><br><span class="line">        String[] fields = line.split(<span class="string">","</span>);</span><br><span class="line">        p.setId(Integer.parseInt(fields[<span class="number">0</span>]));</span><br><span class="line">        p.setName(fields[<span class="number">1</span>]);</span><br><span class="line">        p.setCategory(fields[<span class="number">2</span>]);</span><br><span class="line">        p.setPrice(Float.parseFloat(fields[<span class="number">3</span>]));</span><br><span class="line">        p.setPlace(fields[<span class="number">4</span>]);</span><br><span class="line">        p.setCode(fields[<span class="number">5</span>]);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-TestElasticSearch4J"><a class="header-anchor" href="#步骤-7-TestElasticSearch4J">¶</a>步骤 7 : TestElasticSearch4J</h4>
<p>通过[ProductUtil] 获取到14万条记录的List集合，然后把这个集合通过 BulkRequest 批量地提交到Elastic Search服务器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.ElasticsearchStatusException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.open.OpenIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestElasticSearch4J</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">            RestClient.builder(</span><br><span class="line">                    <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9200</span>, <span class="string">"http"</span>)</span><br><span class="line">            ));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String indexName = <span class="string">"how2java"</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//确保索引存在</span></span><br><span class="line">        <span class="keyword">if</span>(!checkExistIndex(indexName))&#123;</span><br><span class="line">            createIndex(indexName);        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//14万准备数据</span></span><br><span class="line">         </span><br><span class="line">        List&lt;Product&gt; products = ProductUtil.file2list(<span class="string">"140k_products.txt"</span>);</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"准备数据，总计"</span>+products.size()+<span class="string">"条"</span>);</span><br><span class="line">         </span><br><span class="line">        batchInsert(products);</span><br><span class="line">         </span><br><span class="line">        client.close();</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;Product&gt; products)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        BulkRequest request = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            Map&lt;String,Object&gt; m  = product.toMap();</span><br><span class="line">            IndexRequest indexRequest= <span class="keyword">new</span> IndexRequest(indexName, <span class="string">"product"</span>, String.valueOf(product.getId())).source(m);</span><br><span class="line">            request.add(indexRequest);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        client.bulk(request);</span><br><span class="line">        System.out.println(<span class="string">"批量插入完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteRequest  deleteRequest = <span class="keyword">new</span> DeleteRequest (indexName,<span class="string">"product"</span>, String.valueOf(id));</span><br><span class="line">        client.delete(deleteRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经从ElasticSearch服务器上删除id="</span>+id+<span class="string">"的文档"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     </span><br><span class="line">        UpdateRequest  updateRequest = <span class="keyword">new</span> UpdateRequest (indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .doc(<span class="string">"name"</span>,product.getName());</span><br><span class="line">                 </span><br><span class="line">        client.update(updateRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经在ElasticSearch服务器修改产品为："</span>+product);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        GetRequest request = <span class="keyword">new</span> GetRequest(</span><br><span class="line">                indexName,</span><br><span class="line">                <span class="string">"product"</span>, </span><br><span class="line">                String.valueOf(id));</span><br><span class="line">         </span><br><span class="line">        GetResponse response = client.get(request);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(!response.isExists())&#123;</span><br><span class="line">            System.out.println(<span class="string">"检查到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            String source = response.getSourceAsString();</span><br><span class="line">            System.out.print(<span class="string">"获取到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档内容是："</span>);</span><br><span class="line"> </span><br><span class="line">            System.out.println(source);</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">"name"</span>, product.getName());</span><br><span class="line">        IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .source(jsonMap);</span><br><span class="line">        client.index(indexRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经向ElasticSearch服务器增加产品："</span>+product);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkExistIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result =<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            OpenIndexRequest openIndexRequest = <span class="keyword">new</span> OpenIndexRequest(indexName);</span><br><span class="line">            client.indices().open(openIndexRequest).isAcknowledged();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ElasticsearchStatusException ex) &#123;</span><br><span class="line">            String m = <span class="string">"Elasticsearch exception [type=index_not_found_exception, reason=no such index]"</span>;</span><br><span class="line">            <span class="keyword">if</span> (m.equals(ex.getMessage())) &#123;</span><br><span class="line">                result = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result)</span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 是存在的"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 不存在"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(indexName);</span><br><span class="line">        client.indices().delete(request);</span><br><span class="line">        System.out.println(<span class="string">"删除了索引："</span>+indexName);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(indexName);</span><br><span class="line">        client.indices().create(request);</span><br><span class="line">        System.out.println(<span class="string">"创建了索引："</span>+indexName);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13、JAVAAPI-查询操作"><a class="header-anchor" href="#13、JAVAAPI-查询操作">¶</a>13、JAVAAPI-查询操作</h3>
<h4 id="步骤-1-数据"><a class="header-anchor" href="#步骤-1-数据">¶</a>步骤 1 : 数据</h4>
<p>当前查询建立在 [JavaAPI-批量操作] 之后得到的数据的基础之上</p>
<h4 id="步骤-2-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-2-先运行，看到效果，再学习-v3">¶</a>步骤 2 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestElasticSearch4J 看到如图所示的效果</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7437.png" alt></p>
<h4 id="步骤-3-模仿和排错-v3"><a class="header-anchor" href="#步骤-3-模仿和排错-v3">¶</a>步骤 3 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-4-TestElasticSearch4J-v3"><a class="header-anchor" href="#步骤-4-TestElasticSearch4J-v3">¶</a>步骤 4 : TestElasticSearch4J</h4>
<p>根据关键字进行分页查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.ElasticsearchStatusException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.open.OpenIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.Fuzziness;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.MatchQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.ScoreSortBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestElasticSearch4J</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">            RestClient.builder(</span><br><span class="line">                    <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9200</span>, <span class="string">"http"</span>)</span><br><span class="line">            ));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String indexName = <span class="string">"how2java"</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         </span><br><span class="line">        String keyword = <span class="string">"时尚连衣裙"</span>;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">         </span><br><span class="line">        SearchHits hits = search(keyword, start, count);</span><br><span class="line">         </span><br><span class="line">        SearchHit[] searchHits = hits.getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : searchHits) &#123;</span><br><span class="line"> </span><br><span class="line">            System.out.println(hit.getSourceAsString());</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        client.close();</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SearchHits <span class="title">search</span><span class="params">(String keyword, <span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(indexName);</span><br><span class="line">         </span><br><span class="line">        SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        <span class="comment">//关键字匹配</span></span><br><span class="line">        MatchQueryBuilder matchQueryBuilder = <span class="keyword">new</span> MatchQueryBuilder(<span class="string">"name"</span>,keyword );</span><br><span class="line">        <span class="comment">//模糊匹配</span></span><br><span class="line">        matchQueryBuilder.fuzziness(Fuzziness.AUTO);</span><br><span class="line">        sourceBuilder.query(matchQueryBuilder);</span><br><span class="line">        <span class="comment">//第几页</span></span><br><span class="line">        sourceBuilder.from(start);</span><br><span class="line">        <span class="comment">//第几条</span></span><br><span class="line">        sourceBuilder.size(count);</span><br><span class="line"> </span><br><span class="line">        searchRequest.source(sourceBuilder);</span><br><span class="line">        <span class="comment">//匹配度从高到低</span></span><br><span class="line">        sourceBuilder.sort(<span class="keyword">new</span> ScoreSortBuilder().order(SortOrder.DESC));</span><br><span class="line">         </span><br><span class="line">        SearchResponse searchResponse = client.search(searchRequest);</span><br><span class="line">         </span><br><span class="line">        SearchHits hits = searchResponse.getHits();</span><br><span class="line">        <span class="keyword">return</span> hits;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;Product&gt; products)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        BulkRequest request = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            Map&lt;String,Object&gt; m  = product.toMap();</span><br><span class="line">            IndexRequest indexRequest= <span class="keyword">new</span> IndexRequest(indexName, <span class="string">"product"</span>, String.valueOf(product.getId())).source(m);</span><br><span class="line">            request.add(indexRequest);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        client.bulk(request);</span><br><span class="line">        System.out.println(<span class="string">"批量插入完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteRequest  deleteRequest = <span class="keyword">new</span> DeleteRequest (indexName,<span class="string">"product"</span>, String.valueOf(id));</span><br><span class="line">        client.delete(deleteRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经从ElasticSearch服务器上删除id="</span>+id+<span class="string">"的文档"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     </span><br><span class="line">        UpdateRequest  updateRequest = <span class="keyword">new</span> UpdateRequest (indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .doc(<span class="string">"name"</span>,product.getName());</span><br><span class="line">                 </span><br><span class="line">        client.update(updateRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经在ElasticSearch服务器修改产品为："</span>+product);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getDocument</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        GetRequest request = <span class="keyword">new</span> GetRequest(</span><br><span class="line">                indexName,</span><br><span class="line">                <span class="string">"product"</span>, </span><br><span class="line">                String.valueOf(id));</span><br><span class="line">         </span><br><span class="line">        GetResponse response = client.get(request);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(!response.isExists())&#123;</span><br><span class="line">            System.out.println(<span class="string">"检查到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            String source = response.getSourceAsString();</span><br><span class="line">            System.out.print(<span class="string">"获取到服务器上 "</span>+<span class="string">"id="</span>+id+ <span class="string">"的文档内容是："</span>);</span><br><span class="line"> </span><br><span class="line">            System.out.println(source);</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addDocument</span><span class="params">(Product product)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">"name"</span>, product.getName());</span><br><span class="line">        IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(indexName, <span class="string">"product"</span>, String.valueOf(product.getId()))</span><br><span class="line">                .source(jsonMap);</span><br><span class="line">        client.index(indexRequest);</span><br><span class="line">        System.out.println(<span class="string">"已经向ElasticSearch服务器增加产品："</span>+product);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkExistIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result =<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            OpenIndexRequest openIndexRequest = <span class="keyword">new</span> OpenIndexRequest(indexName);</span><br><span class="line">            client.indices().open(openIndexRequest).isAcknowledged();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ElasticsearchStatusException ex) &#123;</span><br><span class="line">            String m = <span class="string">"Elasticsearch exception [type=index_not_found_exception, reason=no such index]"</span>;</span><br><span class="line">            <span class="keyword">if</span> (m.equals(ex.getMessage())) &#123;</span><br><span class="line">                result = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result)</span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 是存在的"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"索引:"</span> +indexName + <span class="string">" 不存在"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(indexName);</span><br><span class="line">        client.indices().delete(request);</span><br><span class="line">        System.out.println(<span class="string">"删除了索引："</span>+indexName);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">(String indexName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(indexName);</span><br><span class="line">        client.indices().create(request);</span><br><span class="line">        System.out.println(<span class="string">"创建了索引："</span>+indexName);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14、SPRINGBOOT-1-5-9-整合-ELASTICSEARCH-2-4-2-做-增删改查-CRUD以及分页"><a class="header-anchor" href="#14、SPRINGBOOT-1-5-9-整合-ELASTICSEARCH-2-4-2-做-增删改查-CRUD以及分页">¶</a>14、SPRINGBOOT 1.5.9 整合 ELASTICSEARCH 2.4.2 做 增删改查 CRUD以及分页</h3>
<h4 id="步骤-1-版本问题"><a class="header-anchor" href="#步骤-1-版本问题">¶</a>步骤 1 : 版本问题</h4>
<p>springboot 有一个 spring data 组件，可以用来连接各种数据源。 用来连接 elasticsearch 的是 spring-data-elasticsearch。<br>
但是呢。。。 截止现在（2018-9-17）,spring-data-elasticsearch 更新比较慢，其最高版本无法支持教程里的 elasticsearch的6.x 版本。<br>
为了支持 6.x 版本，需要用要用奇怪的 transportclient 来连接， 这就不是 spring-data 系列里的内容了。<br>
考虑到将来，spring data 总会支持最新版本的 elasticsearch的，所以我们还是使用 spring-data 来进行链接。 只是，elasticsearch 的版本，我们换成了 2.4.2, kibana 版本，也换成了能够连接 elasticsearch 2.4.2 的 4.6.3 版本。<br>
这两个新的版本，都在右上角提供了下载。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8072.png" alt></p>
<h4 id="步骤-2-启动-elasticsearch-2-4-2"><a class="header-anchor" href="#步骤-2-启动-elasticsearch-2-4-2">¶</a>步骤 2 : 启动 elasticsearch 2.4.2</h4>
<p>首先关闭本系列教材可能启动的 elasticsearch 6.2.2。<br>
然后下载并解压右上角的 elasticsearch 2.4.2，运行其中的 elasticsearch.bat<br>
启动后，可以看到左上角的版本号。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8073.png" alt></p>
<h4 id="步骤-3-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v4">¶</a>步骤 3 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
首先确保 [启动 elasticsearch 2.4.2] 这个步骤要做了，不然跑不起来。<br>
然后运行 Application.java 启动项目<br>
接着访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/listCategory</span></span><br></pre></td></tr></table></figure>
<p>CRUD和分页效果都有。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8074.png" alt></p>
<h4 id="步骤-4-模仿和排错-v4"><a class="header-anchor" href="#步骤-4-模仿和排错-v4">¶</a>步骤 4 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-5-创建-springboot-项目"><a class="header-anchor" href="#步骤-5-创建-springboot-项目">¶</a>步骤 5 : 创建 springboot 项目</h4>
<p>创建方式在 springboot 模块里， eclipse 和 idea 都有：<br>
[eclipse 方式创建 springboot 项目 ]<br>
[idea 方式创建 springboot 项目]</p>
<h4 id="步骤-6-pom-xml"><a class="header-anchor" href="#步骤-6-pom-xml">¶</a>步骤 6 : pom.xml</h4>
<p>各种jar包，主要是 spring-boot-starter-data-elastisearch 这个 jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.how2java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- servlet依赖. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tomcat的支持.--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> <span class="comment">&lt;!-- 这个需要为 true 热部署才有效 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">&lt;!-- mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- jpa--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--         &lt;dependency&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--             &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--             &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--         &lt;/dependency&gt;         --&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>       </span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-Application-java"><a class="header-anchor" href="#步骤-7-Application-java">¶</a>步骤 7 : Application.java</h4>
<p>启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.springboot;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-Category"><a class="header-anchor" href="#步骤-8-Category">¶</a>步骤 8 : Category</h4>
<p>Category 实体类，其中的 @Document就表明了要连接到 ElasticSearch 的哪个索引和哪个 type 上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">"how2java"</span>,type = <span class="string">"category"</span>)</span><br></pre></td></tr></table></figure>
<p>索引相当于就是数据库，type 相当于就是表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.springboot.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Document;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">"how2java"</span>,type = <span class="string">"category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-CategoryDAO"><a class="header-anchor" href="#步骤-9-CategoryDAO">¶</a>步骤 9 : CategoryDAO</h4>
<p>继承了，就什么东西都有了~</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.springboot.dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.springboot.pojo.Category;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryDAO</span> <span class="keyword">extends</span> <span class="title">ElasticsearchRepository</span>&lt;<span class="title">Category</span>,<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-10-控制类"><a class="header-anchor" href="#步骤-10-控制类">¶</a>步骤 10 : 控制类</h4>
<p>控制类提供 CRUD 一套</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.springboot.web;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.functionscore.FunctionScoreQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.functionscore.ScoreFunctionBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.PageRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Sort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.query.SearchQuery;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;</span><br><span class="line"><span class="keyword">import</span> com.how2java.springboot.pojo.Category;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> CategoryDAO categoryDAO;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//每页数量</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/listCategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">listCategory</span><span class="params">(Model m,@RequestParam(value = <span class="string">"start"</span>, defaultValue = <span class="string">"0"</span>)</span> <span class="keyword">int</span> start,@<span class="title">RequestParam</span><span class="params">(value = <span class="string">"size"</span>, defaultValue = <span class="string">"5"</span>)</span> <span class="keyword">int</span> size)</span>&#123;</span><br><span class="line">        String query = <span class="string">"商品"</span>; <span class="comment">//查询条件，但是并未使用，放在这里，为的是将来使用，方便参考，知道如何用</span></span><br><span class="line">        SearchQuery searchQuery=getEntitySearchQuery(start,size,query);</span><br><span class="line">        Page&lt;Category&gt; page = categoryDAO.search(searchQuery);</span><br><span class="line">        m.addAttribute(<span class="string">"page"</span>, page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> SearchQuery <span class="title">getEntitySearchQuery</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> size, String searchContent)</span> </span>&#123;</span><br><span class="line">        FunctionScoreQueryBuilder functionScoreQueryBuilder = QueryBuilders.functionScoreQuery()</span><br><span class="line">                .add(QueryBuilders.matchAllQuery(), <span class="comment">//查询所有</span></span><br><span class="line">                        ScoreFunctionBuilders.weightFactorFunction(<span class="number">100</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">//                查询条件，但是并未使用，放在这里，为的是将来使用，方便参考，知道如何用</span></span><br><span class="line"><span class="comment">//                .add(QueryBuilders.matchPhraseQuery("name", searchContent),</span></span><br><span class="line"><span class="comment">//                      ScoreFunctionBuilders.weightFactorFunction(100))</span></span><br><span class="line">                <span class="comment">//设置权重分 求和模式</span></span><br><span class="line">                .scoreMode(<span class="string">"sum"</span>)</span><br><span class="line">                <span class="comment">//设置权重分最低分</span></span><br><span class="line">                .setMinScore(<span class="number">10</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 设置分页</span></span><br><span class="line">        Sort sort  = <span class="keyword">new</span> Sort(Sort.Direction.DESC,<span class="string">"id"</span>);</span><br><span class="line">        Pageable pageable = <span class="keyword">new</span> PageRequest(start, size,sort);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NativeSearchQueryBuilder()</span><br><span class="line">                .withPageable(pageable)</span><br><span class="line">                .withQuery(functionScoreQueryBuilder).build();</span><br><span class="line">    &#125;   </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/addCategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = currentTime();</span><br><span class="line">        c.setId(id);</span><br><span class="line">        categoryDAO.save(c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">currentTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"MMddHHmmss"</span>);</span><br><span class="line">        String time= sdf.format(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(time);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/deleteCategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        categoryDAO.delete(c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/updateCategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        categoryDAO.save(c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/editCategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ediitCategory</span><span class="params">(<span class="keyword">int</span> id,Model m)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Category c= categoryDAO.findOne(id);</span><br><span class="line">        m.addAttribute(<span class="string">"c"</span>, c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-11-listCategory-jsp"><a class="header-anchor" href="#步骤-11-listCategory-jsp">¶</a>步骤 11 : listCategory.jsp</h4>
<p>listCategory.jsp 文件，记得放在如图所示的位置。没有的目录，自己创建就好了。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8082.png" alt="8082"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">   </span><br><span class="line">&lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div style=<span class="string">"width:500px;margin:20px auto;text-align: center"</span>&gt;</span><br><span class="line">    &lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;编辑&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;page.content&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="editCategory?id=$&#123;c.id&#125;"&gt;编辑&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="deleteCategory?id=$&#123;c.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">                &lt;a href="?start=0"&gt;[首  页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;page.number-1&#125;"&gt;[上一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;page.number+1&#125;"&gt;[下一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;page.totalPages-1&#125;"&gt;[末  页]&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;form action=<span class="string">"addCategory"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    name: &lt;input name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">    &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-12-editCategory-jsp"><a class="header-anchor" href="#步骤-12-editCategory-jsp">¶</a>步骤 12 : editCategory.jsp</h4>
<p>editCategory.jsp 做编辑工作</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line"> pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div style=<span class="string">"margin:0px auto; width:500px"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;form action=<span class="string">"updateCategory"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line"> </span><br><span class="line">name: &lt;input name=<span class="string">"name"</span> value=<span class="string">"$&#123;c.name&#125;"</span>&gt; &lt;br&gt;</span><br><span class="line"> </span><br><span class="line">&lt;input name=<span class="string">"id"</span> type=<span class="string">"hidden"</span> value=<span class="string">"$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">&lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-13-application-properties"><a class="header-anchor" href="#步骤-13-application-properties">¶</a>步骤 13 : application.properties</h4>
<p>配置 jsp 作为视图<br>
配置spring端口 为8080<br>
配置 elastic链接地址为 127.0.0.1:9300</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8084.png" alt></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span></span><br><span class="line"><span class="meta">spring.mvc.view.suffix</span>=<span class="string">.jsp</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="meta">spring.data.elasticsearch.cluster-nodes</span> = <span class="string">127.0.0.1:9300</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-14-启动并测试"><a class="header-anchor" href="#步骤-14-启动并测试">¶</a>步骤 14 : 启动并测试</h4>
<p>运行 Application.java 启动项目<br>
接着访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/listCategory</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8085.png" alt></p>
<h4 id="步骤-15-kibana"><a class="header-anchor" href="#步骤-15-kibana">¶</a>步骤 15 : kibana</h4>
<p>下面用 kibana 来查看数据。 和前面的 kibana 版本不同，要连接本教材的 elasticsearch 2.4.2 版本，需要用到右上角提供的 kibana 4.6.3 版本。</p>
<p><strong>注：</strong> 如果启动了前面提供的 kibana 6.2.2 ，请记得关闭。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8086.png" alt></p>
<h4 id="步骤-16-启动-kibana-并访问"><a class="header-anchor" href="#步骤-16-启动-kibana-并访问">¶</a>步骤 16 : 启动 kibana 并访问</h4>
<p>启动之后，如图所示，是看不到版本信息的。。<br>
然后访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:5601</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8087.png" alt></p>
<h4 id="步骤-17-选择索引"><a class="header-anchor" href="#步骤-17-选择索引">¶</a>步骤 17 : 选择索引</h4>
<p>刚开始是没有选定索引的，所以要自己指定索引。</p>
<ol>
<li>把默认勾选的 Index contians time-based evens 去掉</li>
<li>输入 how2java</li>
<li>点击 Create 按钮</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8088.png" alt></p>
<h4 id="步骤-18-查看数据"><a class="header-anchor" href="#步骤-18-查看数据">¶</a>步骤 18 : 查看数据</h4>
<p>然后点击上面的Discover，就可以看到左边是当前的索引 :how2java. 右边就是数据了。。。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/8089.png" alt></p>
<h3 id="15、ELASTICSEARCH-进一步学习"><a class="header-anchor" href="#15、ELASTICSEARCH-进一步学习">¶</a>15、ELASTICSEARCH - 进一步学习</h3>
<p>以上就是Elasticsearch 的常用做法，更多的内容请访问 Elasticsearch 官方学习文档：<br>
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a><br>
Java API<br>
<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/java-api.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/java-api.html</a></p>
<h2 id="4、集群"><a class="header-anchor" href="#4、集群">¶</a>4、集群</h2>
<h3 id="1、关于集群"><a class="header-anchor" href="#1、关于集群">¶</a>1、关于集群</h3>
<p>以上的Solr 和 ElasticSearch 的教程都是单点的操作，同时他们又都是支持集群的。 相关集群教程还在准备中，敬请期待</p>
<h1 id="十二、Shiro"><a class="header-anchor" href="#十二、Shiro">¶</a>十二、Shiro</h1>
<h2 id="1、教程安排"><a class="header-anchor" href="#1、教程安排">¶</a>1、教程安排</h2>
<h3 id="步骤-1-教程安排"><a class="header-anchor" href="#步骤-1-教程安排">¶</a>步骤 1 : 教程安排</h3>
<p>Shiro 是当下常见的安全框架，主要用于用户验证和授权操作。<br>
Shiro 有相当的复杂性，为了使得学习更加平滑，本系列教程按照如下节奏系统地，循序渐进地，难度平滑提高地展开</p>
<ol>
<li>
<p>先来个最简单的，两下就跑起来的基于ini配置文件的<br>
[shiro 入门]</p>
</li>
<li>
<p>基于ini和工作环境不匹配，所以还是要搞到数据库里<br>
[shiro jdbc方式使用数据库]</p>
</li>
<li>
<p>搞到数据库里，那么就存在密码问题了<br>
[shiro 如何进行加密]</p>
</li>
<li>
<p>shiro的独立程序的做法就是上面3种，而现在应用都是基于web的，所以要来个基于web的做法，用的是Servlet<br>
[在web中使用shiro]</p>
</li>
<li>
<p>可是现在开发web用的又都是ssm一套，所以把上面的改造成ssm的<br>
[ssm 中整合 shiro ]</p>
</li>
<li>
<p>上面的做法是基于注解的，虽然能用，但是修改后要重启才生效，不灵活。 而实际工作大都是基于url灵活配置的，所以要做成基于url配置的。 可是做成url配置的前提是要用户，角色，权限，以及彼此之间的多对多关系能够设置和管理。因为权限一套维护工作本身就相当复杂了， 所以本知识点先不讲如何url配置，而是把权限一套维护工作做了，为了下一个知识点做铺垫， 这样学习起来更平滑一些。<br>
[使用ssm 维护 shiro 一套权限维护]</p>
</li>
<li>
<p>接着再是基于url 配置权限的教程，基于上面一个知识点，这里做起来的改动就没有那么大了，更加容易掌握。<br>
[基于url配置权限]</p>
</li>
<li>
<p>上面3种做法都是基于ssm的， 眼下springboot也很流行，本知识点就把ssm的做法改造成了springboot的做法了。<br>
[springboot 整合 shiro]</p>
</li>
</ol>
<h2 id="2、教程入门"><a class="header-anchor" href="#2、教程入门">¶</a>2、教程入门</h2>
<h3 id="步骤-1-Shiro-概念"><a class="header-anchor" href="#步骤-1-Shiro-概念">¶</a>步骤 1 : Shiro 概念</h3>
<p>在使用Shiro 之前，大家做登录，权限什么的都是<strong>五花八门</strong>，各种<strong>花里胡哨</strong>的代码，不同系统的做法很有可能千差万别。<br>
但是使用 Shiro 这个安全框架之后，大家做权限的方式都<strong>一致化</strong>了，这样的好处就是你的代码我看起来容易，我的代码你也好理解。<br>
Shiro 也比较成熟，基本上能满足大部分的权限需要。</p>
<h3 id="步骤-2-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-2-先运行，看到效果，再学习-v4">¶</a>步骤 2 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestShiro，可以观察到如图所示的效果<br>
某个用户是否登陆成功<br>
某个用户是否拥有某个角色<br>
某个用户是否拥有某种权限</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7531.png" alt></p>
<h3 id="步骤-3-模仿和排错-v4"><a class="header-anchor" href="#步骤-3-模仿和排错-v4">¶</a>步骤 3 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-4-shiro-ini"><a class="header-anchor" href="#步骤-4-shiro-ini">¶</a>步骤 4 : shiro.ini</h3>
<p>在src目录下新建 shiro.ini<br>
这里面定义了和安全相关的数据： 用户，角色和权限<br>
注释很详细了，挨个看就能理解了</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义用户</span></span><br><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="comment">#用户名 zhang3  密码是 12345， 角色是 admin</span></span><br><span class="line"><span class="attr">zhang3</span> = <span class="number">12345</span>, admin</span><br><span class="line"><span class="comment">#用户名 li4  密码是 abcde， 角色是 产品经理</span></span><br><span class="line"><span class="attr">li4</span> = abcde,productManager</span><br><span class="line"><span class="comment">#定义角色</span></span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="comment">#管理员什么都能做</span></span><br><span class="line"><span class="attr">admin</span> = *</span><br><span class="line"><span class="comment">#产品经理只能做产品管理</span></span><br><span class="line"><span class="attr">productManager</span> = addProduct,deleteProduct,editProduct,updateProduct,listProduct</span><br><span class="line"><span class="comment">#订单经理只能做订单管理</span></span><br><span class="line"><span class="attr">orderManager</span> = addOrder,deleteOrder,editOrder,updateOrder,listOrder</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-User"><a class="header-anchor" href="#步骤-5-User">¶</a>步骤 5 : User</h3>
<p>准备用户类，用于存放账号密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-TestShiro"><a class="header-anchor" href="#步骤-6-TestShiro">¶</a>步骤 6 : TestShiro</h3>
<p>准备3个用户，前两个能在 [shiro.ini] 中找到，第3个不存在<br>
然后测试登录<br>
接着测试是否包含角色<br>
最后测试是否拥有权限</p>
<p>**注：**Subject 在 Shiro 这个安全框架下， Subject 就是当前用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.Factory;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestShiro</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//用户们</span></span><br><span class="line">        User zhang3 = <span class="keyword">new</span> User();</span><br><span class="line">        zhang3.setName(<span class="string">"zhang3"</span>);</span><br><span class="line">        zhang3.setPassword(<span class="string">"12345"</span>);</span><br><span class="line"> </span><br><span class="line">        User li4 = <span class="keyword">new</span> User();</span><br><span class="line">        li4.setName(<span class="string">"li4"</span>);</span><br><span class="line">        li4.setPassword(<span class="string">"abcde"</span>);</span><br><span class="line">         </span><br><span class="line">        User wang5 = <span class="keyword">new</span> User();</span><br><span class="line">        wang5.setName(<span class="string">"wang5"</span>);</span><br><span class="line">        wang5.setPassword(<span class="string">"wrongpassword"</span>);</span><br><span class="line"> </span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">        users.add(zhang3);</span><br><span class="line">        users.add(li4);</span><br><span class="line">        users.add(wang5);      </span><br><span class="line">        <span class="comment">//角色们</span></span><br><span class="line">        String roleAdmin = <span class="string">"admin"</span>;</span><br><span class="line">        String roleProductManager =<span class="string">"productManager"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;String&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        roles.add(roleAdmin);</span><br><span class="line">        roles.add(roleProductManager);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//权限们</span></span><br><span class="line">        String permitAddProduct = <span class="string">"addProduct"</span>;</span><br><span class="line">        String permitAddOrder = <span class="string">"addOrder"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;String&gt; permits = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        permits.add(permitAddProduct);</span><br><span class="line">        permits.add(permitAddOrder);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//登陆每个用户</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span>(login(user))</span><br><span class="line">                System.out.printf(<span class="string">"%s \t成功登陆，用的密码是 %s\t %n"</span>,user.getName(),user.getPassword());</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                System.out.printf(<span class="string">"%s \t成功失败，用的密码是 %s\t %n"</span>,user.getName(),user.getPassword());</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"-------how2j 分割线------"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//判断能够登录的用户是否拥有某个角色</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String role : roles) &#123;</span><br><span class="line">                <span class="keyword">if</span>(login(user)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(hasRole(user, role))</span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 拥有角色: %s\t%n"</span>,user.getName(),role);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 不拥有角色: %s\t%n"</span>,user.getName(),role);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"-------how2j 分割线------"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//判断能够登录的用户，是否拥有某种权限</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String permit : permits) &#123;</span><br><span class="line">                <span class="keyword">if</span>(login(user)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(isPermitted(user, permit))</span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 拥有权限: %s\t%n"</span>,user.getName(),permit);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 不拥有权限: %s\t%n"</span>,user.getName(),permit);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasRole</span><span class="params">(User user, String role)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.hasRole(role);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPermitted</span><span class="params">(User user, String permit)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.isPermitted(permit);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Subject <span class="title">getSubject</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//加载配置文件，并获取工厂</span></span><br><span class="line">        Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br><span class="line">        <span class="comment">//获取安全管理者实例</span></span><br><span class="line">        SecurityManager sm = factory.getInstance();</span><br><span class="line">        <span class="comment">//将安全管理者放入全局对象</span></span><br><span class="line">        SecurityUtils.setSecurityManager(sm);</span><br><span class="line">        <span class="comment">//全局对象通过安全管理者生成Subject对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        Subject subject= getSubject(user);</span><br><span class="line">        <span class="comment">//如果已经登录过了，退出</span></span><br><span class="line">        <span class="keyword">if</span>(subject.isAuthenticated())</span><br><span class="line">            subject.logout();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//封装用户的数据</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(user.getName(), user.getPassword());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将用户的数据token 最终传递到Realm中进行对比</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">            <span class="comment">//验证错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;              </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> subject.isAuthenticated();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-数据库"><a class="header-anchor" href="#步骤-7-数据库">¶</a>步骤 7 : 数据库</h3>
<p>在本教材里，账号密码，角色信息都是放在配置文件里的，真实工作的时候，肯定都是放在数据库里的。<br>
所以接下来就会讲解如何配合数据库工作</p>
<h2 id="3、结合数据库进行验证和授权"><a class="header-anchor" href="#3、结合数据库进行验证和授权">¶</a>3、结合数据库进行验证和授权</h2>
<h3 id="步骤-1-数据库支持"><a class="header-anchor" href="#步骤-1-数据库支持">¶</a>步骤 1 : 数据库支持</h3>
<p>在[ Shiro 入门] 中使用ini 配置文件进行了相关权限数据的配置。 但是实际工作中，我们都会把权限相关的内容放在数据库里。 所以本知识点讲解如何放在数据库里来撸。</p>
<h3 id="步骤-2-RBAC-概念"><a class="header-anchor" href="#步骤-2-RBAC-概念">¶</a>步骤 2 : RBAC 概念</h3>
<p>RBAC 是当下权限系统的设计基础，同时有两种解释：<br>
一： Role-Based Access Control，基于角色的访问控制<br>
即，你要能够删除产品，那么当前用户就必须拥有<strong>产品经理</strong>这个角色<br>
二：Resource-Based Access Control，基于资源的访问控制<br>
即，你要能够删除产品，那么当前用户就必须拥有<strong>删除产品</strong>这样的权限</p>
<h3 id="步骤-3-表结构"><a class="header-anchor" href="#步骤-3-表结构">¶</a>步骤 3 : 表结构</h3>
<p>基于 [RBAC 概念]， 就会存在3 张基础表： 用户，角色，权限， 以及 2 张中间表来建立 用户与角色的多对多关系，角色与权限的多对多关系。 用户与权限之间也是多对多关系，但是是通过 角色间接建立的。</p>
<p>这里给出了表结构，导入数据库即可。</p>
<p><strong>注：</strong> 补充多对多概念： 用户和角色是多对多，即表示：<br>
一个用户可以有多种角色，一个角色也可以赋予多个用户。<br>
一个角色可以包含多种权限，一种权限也可以赋予多个角色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS shiro;</span><br><span class="line">CREATE DATABASE shiro DEFAULT CHARACTER SET utf8;</span><br><span class="line">USE shiro;</span><br><span class="line"> </span><br><span class="line">drop table if exists user;</span><br><span class="line">drop table if exists role;</span><br><span class="line">drop table if exists permission;</span><br><span class="line">drop table if exists user_role;</span><br><span class="line">drop table if exists role_permission;</span><br><span class="line"> </span><br><span class="line">create table user (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  password varchar(100),</span><br><span class="line">  constraint pk_users primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">create table role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  constraint pk_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">create table permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  constraint pk_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">create table user_role (</span><br><span class="line">  uid bigint,</span><br><span class="line">  rid bigint,</span><br><span class="line">  constraint pk_users_roles primary key(uid, rid)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">create table role_permission (</span><br><span class="line">  rid bigint,</span><br><span class="line">  pid bigint,</span><br><span class="line">  constraint pk_roles_permissions primary key(rid, pid)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-表数据"><a class="header-anchor" href="#步骤-4-表数据">¶</a>步骤 4 : 表数据</h3>
<p>这里基于[ Shiro入门中的shiro.ini 文件]，插入一样的用户，角色和权限数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &#96;permission&#96; VALUES (1,&#39;addProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (2,&#39;deleteProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (3,&#39;editProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (4,&#39;updateProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (5,&#39;listProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (6,&#39;addOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (7,&#39;deleteOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (8,&#39;editOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (9,&#39;updateOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (10,&#39;listOrder&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (1,&#39;admin&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (2,&#39;productManager&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (3,&#39;orderManager&#39;);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,10);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (1,&#39;zhang3&#39;,&#39;12345&#39;);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (2,&#39;li4&#39;,&#39;abcde&#39;);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (1,1);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (2,2);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-5-先运行，看到效果，再学习">¶</a>步骤 5 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestShiro，可以看到如图所示，其效果和 [Shiro 入门]中的效果一模一样，而这样的效果，是基于数据库来做的</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7549.png" alt></p>
<h3 id="步骤-6-模仿和排错"><a class="header-anchor" href="#步骤-6-模仿和排错">¶</a>步骤 6 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-7-User"><a class="header-anchor" href="#步骤-7-User">¶</a>步骤 7 : User</h3>
<p>在原来的基础上增加了一个id字段。 其实。。。本知识点也没有用到这个id,只是和数据库关联了嘛，数据库里有，还是加上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-DAO"><a class="header-anchor" href="#步骤-8-DAO">¶</a>步骤 8 : DAO</h3>
<p>这个DAO提供了和权限相关查询。 但是，并没有提供权限数据本身的维护。 比如没有做用户的增删改，角色和权限表也没有。 因为那些在提供了 [表数据] 的基础上，就不是必须的了。<br>
为了专注于 Shiro 和 DAO 的结合，只提供必要的数据库操作支持。</p>
<ol>
<li>getPassword 方法：<br>
根据用户名查询密码，这样既能判断用户是否存在，也能判断密码是否正确</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select password from user where name = ?"</span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>listRoles 方法：<br>
根据用户名查询此用户有哪些角色，这是3张表的关联</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select r.name from user u "</span></span><br><span class="line">		+ <span class="string">"left join user_role ur on u.id = ur.uid "</span></span><br><span class="line">		+ <span class="string">"left join Role r on r.id = ur.rid "</span></span><br><span class="line">		+ <span class="string">"where u.name = ?"</span>;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>listPermissions 方法：<br>
根据用户名查询此用户有哪些权限，这是5张表的关联</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String sql = </span><br><span class="line">	<span class="string">"select p.name from user u "</span>+</span><br><span class="line">	<span class="string">"left join user_role ru on u.id = ru.uid "</span>+</span><br><span class="line">	<span class="string">"left join role r on r.id = ru.rid "</span>+</span><br><span class="line">	<span class="string">"left join role_permission rp on r.id = rp.rid "</span>+</span><br><span class="line">	<span class="string">"left join permission p on p.id = rp.pid "</span>+</span><br><span class="line">	<span class="string">"where u.name =?"</span>;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>主方法测试<br>
运行之后，看到如图所示 zhang3，li4　拥有的角色和权限和　 [Shiro入门中的shiro.ini 文件]　中的数据是一致的</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7545.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAO</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/shiro?characterEncoding=UTF-8"</span>, <span class="string">"root"</span>,</span><br><span class="line">                <span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select password from user where name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">                <span class="keyword">return</span> rs.getString(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"> </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoles</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql = <span class="string">"select r.name from user u "</span></span><br><span class="line">                + <span class="string">"left join user_role ur on u.id = ur.uid "</span></span><br><span class="line">                + <span class="string">"left join Role r on r.id = ur.rid "</span></span><br><span class="line">                + <span class="string">"where u.name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                roles.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql =</span><br><span class="line">        <span class="string">"select p.name from user u "</span>+</span><br><span class="line">        <span class="string">"left join user_role ru on u.id = ru.uid "</span>+</span><br><span class="line">        <span class="string">"left join role r on r.id = ru.rid "</span>+</span><br><span class="line">        <span class="string">"left join role_permission rp on r.id = rp.rid "</span>+</span><br><span class="line">        <span class="string">"left join permission p on p.id = rp.pid "</span>+</span><br><span class="line">        <span class="string">"where u.name =?"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                permissions.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> permissions;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listRoles(<span class="string">"zhang3"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listRoles(<span class="string">"li4"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listPermissions(<span class="string">"zhang3"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listPermissions(<span class="string">"li4"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-Realm-概念"><a class="header-anchor" href="#步骤-9-Realm-概念">¶</a>步骤 9 : Realm 概念</h3>
<p>在 Shiro 中存在 Realm 这么个概念， Realm 这个单词翻译为 域，其实是非常难以理解的。<br>
域 是什么鬼？和权限有什么毛关系？ 这个单词Shiro的作者用的非常不好，让人很难理解。<br>
那么 Realm 在 Shiro里到底扮演什么角色呢？<br>
当应用程序向 Shiro 提供了 账号和密码之后， Shiro 就会问 Realm 这个账号密码是否对， 如果对的话，其所对应的用户拥有哪些角色，哪些权限。<br>
所以Realm 是什么？ 其实就是个中介。 Realm 得到了 Shiro 给的用户和密码后，有可能去找 ini 文件，就像[Shiro 入门中的 shiro.ini]，也可以去找数据库，就如同本知识点中的 [DAO] 查询信息。</p>
<p>Realm 就是干这个用的，它才是真正进行用户认证和授权的关键地方。</p>
<h3 id="步骤-10-DatabaseRealm"><a class="header-anchor" href="#步骤-10-DatabaseRealm">¶</a>步骤 10 : DatabaseRealm</h3>
<p>DatabaseRealm 就是用来通过数据库 验证用户，和相关授权的类。<br>
两个方法分别做验证和授权：<br>
doGetAuthenticationInfo(), doGetAuthorizationInfo()<br>
细节在代码里都有详细注释，请仔细阅读。</p>
<p><strong>注：</strong> DatabaseRealm 这个类，用户提供，但是不由用户自己调用，而是由 Shiro 去调用。 就像Servlet的doPost方法，是被Tomcat调用一样。<br>
那么 Shiro 怎么找到这个 Realm 呢？ 那么就需要下一步，[修改 shiro.ini]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过DAO获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> DAO().listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> DAO().listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过DAO获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        String password= <span class="keyword">new</span> String( t.getPassword());</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">        String passwordInDB = <span class="keyword">new</span> DAO().getPassword(userName);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//如果为空就是账号不存在，如果不相同就是密码错误，但是都抛出AuthenticationException，而不是抛出具体错误原因，免得给破解者提供帮助信息</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==passwordInDB || !passwordInDB.equals(password))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,password,getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-修改-shiro-ini"><a class="header-anchor" href="#步骤-11-修改-shiro-ini">¶</a>步骤 11 : 修改 shiro.ini</h3>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">databaseRealm</span>=com.how2java.DatabaseRealm</span><br><span class="line"><span class="attr">securityManager.realms</span>=<span class="variable">$databaseRealm</span></span><br></pre></td></tr></table></figure>
<p>前面准备了[DatabaseRealm]，那么在配置文件里，就指定当前的realm 是 他。 默认情况下是找 IniRealm。<br>
shiro.ini 中原本的数据信息，都删除掉了</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">databaseRealm</span>=com.how2java.DatabaseRealm</span><br><span class="line"><span class="attr">securityManager.realms</span>=<span class="variable">$databaseRealm</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-TestRealm"><a class="header-anchor" href="#步骤-12-TestRealm">¶</a>步骤 12 : TestRealm</h3>
<p>TestRealm 没任何变化，运行效果和基于 ini的效果一模一样。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7551.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.Factory;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestShiro</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//用户们</span></span><br><span class="line">        User zhang3 = <span class="keyword">new</span> User();</span><br><span class="line">        zhang3.setName(<span class="string">"zhang3"</span>);</span><br><span class="line">        zhang3.setPassword(<span class="string">"12345"</span>);</span><br><span class="line"> </span><br><span class="line">        User li4 = <span class="keyword">new</span> User();</span><br><span class="line">        li4.setName(<span class="string">"li4"</span>);</span><br><span class="line">        li4.setPassword(<span class="string">"abcde"</span>);</span><br><span class="line">         </span><br><span class="line">        User wang5 = <span class="keyword">new</span> User();</span><br><span class="line">        wang5.setName(<span class="string">"wang5"</span>);</span><br><span class="line">        wang5.setPassword(<span class="string">"wrongpassword"</span>);</span><br><span class="line"> </span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">        users.add(zhang3);</span><br><span class="line">        users.add(li4);</span><br><span class="line">        users.add(wang5);      </span><br><span class="line">        <span class="comment">//角色们</span></span><br><span class="line">        String roleAdmin = <span class="string">"admin"</span>;</span><br><span class="line">        String roleProductManager =<span class="string">"productManager"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;String&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        roles.add(roleAdmin);</span><br><span class="line">        roles.add(roleProductManager);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//权限们</span></span><br><span class="line">        String permitAddProduct = <span class="string">"addProduct"</span>;</span><br><span class="line">        String permitAddOrder = <span class="string">"addOrder"</span>;</span><br><span class="line">         </span><br><span class="line">        List&lt;String&gt; permits = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        permits.add(permitAddProduct);</span><br><span class="line">        permits.add(permitAddOrder);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//登陆每个用户</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span>(login(user))</span><br><span class="line">                System.out.printf(<span class="string">"%s \t成功登陆，用的密码是 %s\t %n"</span>,user.getName(),user.getPassword());</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                System.out.printf(<span class="string">"%s \t成功失败，用的密码是 %s\t %n"</span>,user.getName(),user.getPassword());</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"-------how2j 分割线------"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//判断能够登录的用户是否拥有某个角色</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String role : roles) &#123;</span><br><span class="line">                <span class="keyword">if</span>(login(user)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(hasRole(user, role))</span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 拥有角色: %s\t%n"</span>,user.getName(),role);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 不拥有角色: %s\t%n"</span>,user.getName(),role);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"-------how2j 分割线------"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//判断能够登录的用户，是否拥有某种权限</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String permit : permits) &#123;</span><br><span class="line">                <span class="keyword">if</span>(login(user)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(isPermitted(user, permit))</span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 拥有权限: %s\t%n"</span>,user.getName(),permit);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        System.out.printf(<span class="string">"%s\t 不拥有权限: %s\t%n"</span>,user.getName(),permit);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasRole</span><span class="params">(User user, String role)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.hasRole(role);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPermitted</span><span class="params">(User user, String permit)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.isPermitted(permit);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Subject <span class="title">getSubject</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//加载配置文件，并获取工厂</span></span><br><span class="line">        Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br><span class="line">        <span class="comment">//获取安全管理者实例</span></span><br><span class="line">        SecurityManager sm = factory.getInstance();</span><br><span class="line">        <span class="comment">//将安全管理者放入全局对象</span></span><br><span class="line">        SecurityUtils.setSecurityManager(sm);</span><br><span class="line">        <span class="comment">//全局对象通过安全管理者生成Subject对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        Subject subject= getSubject(user);</span><br><span class="line">        <span class="comment">//如果已经登录过了，退出</span></span><br><span class="line">        <span class="keyword">if</span>(subject.isAuthenticated())</span><br><span class="line">            subject.logout();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//封装用户的数据</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(user.getName(), user.getPassword());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将用户的数据token 最终传递到Realm中进行对比</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">            <span class="comment">//验证错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;              </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> subject.isAuthenticated();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-关于JdbcRealm"><a class="header-anchor" href="#步骤-13-关于JdbcRealm">¶</a>步骤 13 : 关于JdbcRealm</h3>
<p>Shiro 提供了一个 JdbcRealm，它会默认去寻找 users, roles, permissions 三张表做类似于 [DAO] 中的查询。<br>
但是本例没有使用它，因为实际工作通常都会有更复杂的权限需要，以上3张表不够用。 JdbcRealm 又封装得太严实了，连它执行了 SQL 语句这件事，我都是很久才明白过来，这样不利于初学者消化， 最后 使用 DAO 更符合开发者的习惯，也觉得一切都在自己掌握中，用起来心里更踏实一些。</p>
<h2 id="4、如何加密处理"><a class="header-anchor" href="#4、如何加密处理">¶</a>4、如何加密处理</h2>
<h3 id="步骤-1-md5-加密"><a class="header-anchor" href="#步骤-1-md5-加密">¶</a>步骤 1 : md5 加密</h3>
<p>在前面的例子里，用户密码是明文的，这样是有巨大风险的，一旦泄露，就不好了。<br>
所以，通常都会采用非对称加密，什么是非对称呢？就是不可逆的，而 md5 就是这样一个算法.<br>
如代码所示 123 用 md5 加密后，得到字符串： <strong>202CB962AC59075B964B07152D234B70</strong><br>
这个字符串，却无法通过计算，反过来得到源密码是 123.<br>
这个加密后的字符串就存在数据库里了，下次用户再登陆，输入密码 123， 同样用md5 加密后，再和这个字符串一比较，就知道密码是否正确了。<br>
如此这样，既能保证用户密码校验的功能，又能保证不暴露密码。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7553.png" alt></p>
<h3 id="步骤-2-盐"><a class="header-anchor" href="#步骤-2-盐">¶</a>步骤 2 : 盐</h3>
<p>上面讲了md5加密，但是md5加密又有一些缺陷:</p>
<ol>
<li>
<p>如果我的密码是 123,你的也是 123, 那么md5的值是一样的，那么通过比较加密后的字符串，我就可以反推过来，原来你的密码也是123.</p>
</li>
<li>
<p>与上述相同，虽然 md5 不可逆，但是我可以穷举法呀，我把特别常用的100万或者更多个密码的 md5 值记录下来，比如12345的，abcde的。 相当一部分人用的密码也是这些，那么只要到数据库里一找，也很快就可以知道原密码是多少了。这样看上去也就<strong>破解</strong>了，至少一部分没有想象中那么安全吧。<br>
为了解决这个问题，引入了盐的概念。 盐是什么意思呢？ 比如炒菜，直接使用md5，就是对食材（源密码）进行炒菜，因为食材是一样的，所以炒出来的味道都一样，可是如果加了不同分量的盐，那么即便食材一样，炒出来的味道也就不一样了。</p>
</li>
</ol>
<p>所以，虽然每次 123 md5 之后都是202CB962AC59075B964B07152D234B70，但是 我加上盐，即 123+随机数，那么md5值不就不一样了吗？ 这个随机数，就是盐，而这个随机数也会在数据库里保存下来，每个不同的用户，随机数也是不一样的。<br>
再就是加密次数，加密一次是202CB962AC59075B964B07152D234B70，我可以加密两次呀，就是另一个数了。 而黑客即便是拿到了加密后的密码，如果不知道到底加密了多少次，也是很难办的。</p>
<p>在代码里就演示了，如何用Shiro自带的工具类，做生成盐，两次md5的做法，如图所示得到一串机密都很高的密文。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7554.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.SecureRandomNumberGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEncryption</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String password = <span class="string">"123"</span>;</span><br><span class="line">        String salt = <span class="keyword">new</span> SecureRandomNumberGenerator().nextBytes().toString();</span><br><span class="line">        <span class="keyword">int</span> times = <span class="number">2</span>;</span><br><span class="line">        String algorithmName = <span class="string">"md5"</span>;</span><br><span class="line">         </span><br><span class="line">        String encodedPassword = <span class="keyword">new</span> SimpleHash(algorithmName,password,salt,times).toString();</span><br><span class="line">         </span><br><span class="line">        System.out.printf(<span class="string">"原始密码是 %s , 盐是： %s, 运算次数是： %d, 运算出来的密文是：%s "</span>,password,salt,times,encodedPassword);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-数据库调整"><a class="header-anchor" href="#步骤-3-数据库调整">¶</a>步骤 3 : 数据库调整</h3>
<p>有了以上基础，那么就可以开始在原来的教程里加入对加密的支持了。 在开始之前，要修改一下user表，加上盐 字段: salt。<br>
因盐是随机数，得保留下来，如果不知道盐巴是多少，我们也就没法判断密码是否正确了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table user add (salt varchar(100) )</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-4-先运行，看到效果，再学习">¶</a>步骤 4 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
运行 TestShiro 进行账号密码验证测试。 注意，测试之前要先释放注释，以执行一次注册用户行为，如果不注册，后面肯定是不能验证通过的，因为数据库里没有嘛。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DAO().createUser(<span class="string">"tom"</span>, <span class="string">"123"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7561.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">//这里要释放注释，先注册一个用户</span></span><br><span class="line"><span class="comment">//      new DAO().createUser("tom", "123");</span></span><br><span class="line">         </span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"tom"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"123"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(login(user))</span><br><span class="line">            System.out.println(<span class="string">"登录成功"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"登录失败"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-模仿和排错"><a class="header-anchor" href="#步骤-5-模仿和排错">¶</a>步骤 5 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-6-DAO"><a class="header-anchor" href="#步骤-6-DAO">¶</a>步骤 6 : DAO</h3>
<p>增加两个方法 createUser，getUser<br>
createUser 用于注册，并且在注册的时候，将用户提交的密码加密<br>
getUser 用于取出用户信息，其中不仅仅包括加密后的密码，还包括盐</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.SecureRandomNumberGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAO</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/shiro?characterEncoding=UTF-8"</span>, <span class="string">"root"</span>,</span><br><span class="line">                <span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createUser</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        String sql = <span class="string">"insert into user values(null,?,?,?)"</span>;</span><br><span class="line">         </span><br><span class="line">        String salt = <span class="keyword">new</span> SecureRandomNumberGenerator().nextBytes().toString(); <span class="comment">//盐量随机</span></span><br><span class="line">        String encodedPassword= <span class="keyword">new</span> SimpleHash(<span class="string">"md5"</span>,password,salt,<span class="number">2</span>).toString();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, name);</span><br><span class="line">            ps.setString(<span class="number">2</span>, encodedPassword);</span><br><span class="line">            ps.setString(<span class="number">3</span>, salt);</span><br><span class="line">            ps.execute();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"> </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;       </span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select password from user where name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">                <span class="keyword">return</span> rs.getString(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"> </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        String sql = <span class="string">"select * from user where name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                user = <span class="keyword">new</span> User();</span><br><span class="line">                user.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">                user.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">                user.setPassword(rs.getString(<span class="string">"password"</span>));</span><br><span class="line">                user.setSalt(rs.getString(<span class="string">"salt"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoles</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql = <span class="string">"select r.name from user u "</span></span><br><span class="line">                + <span class="string">"left join user_role ur on u.id = ur.uid "</span></span><br><span class="line">                + <span class="string">"left join Role r on r.id = ur.rid "</span></span><br><span class="line">                + <span class="string">"where u.name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                roles.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql =</span><br><span class="line">            <span class="string">"select p.name from user u "</span>+</span><br><span class="line">            <span class="string">"left join user_role ru on u.id = ru.uid "</span>+</span><br><span class="line">            <span class="string">"left join role r on r.id = ru.rid "</span>+</span><br><span class="line">            <span class="string">"left join role_permission rp on r.id = rp.rid "</span>+</span><br><span class="line">            <span class="string">"left join permission p on p.id = rp.pid "</span>+</span><br><span class="line">            <span class="string">"where u.name =?"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                permissions.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> permissions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-DatabaseRealm"><a class="header-anchor" href="#步骤-7-DatabaseRealm">¶</a>步骤 7 : DatabaseRealm</h3>
<p>修改 DatabaseRealm，把用户通过 UsernamePasswordToken 传进来的密码，以及数据库里取出来的 salt 进行加密，加密之后再与数据库里的密文进行比较，判断用户是否能够通过验证。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过DAO获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> DAO().listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> DAO().listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过DAO获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        String password =<span class="keyword">new</span> String(t.getPassword());</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">         </span><br><span class="line">        User user = <span class="keyword">new</span> DAO().getUser(userName);</span><br><span class="line">        String passwordInDB = user.getPassword();</span><br><span class="line">        String salt = user.getSalt();</span><br><span class="line">        String passwordEncoded = <span class="keyword">new</span> SimpleHash(<span class="string">"md5"</span>,password,salt,<span class="number">2</span>).toString();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user || !passwordEncoded.equals(passwordInDB))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,password,getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-TestShiro"><a class="header-anchor" href="#步骤-8-TestShiro">¶</a>步骤 8 : TestShiro</h3>
<p>进行账号密码验证测试。 注意，测试之前要先释放注释，以执行一次注册用户行为，如果不注册，后面肯定是不能验证通过的，因为数据库里没有嘛。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DAO().createUser(<span class="string">"tom"</span>, <span class="string">"123"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7560.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.Factory;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestShiro</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里要释放注释，先注册一个用户</span></span><br><span class="line"><span class="comment">//      new DAO().createUser("tom", "123");</span></span><br><span class="line">         </span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"tom"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"123"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(login(user))</span><br><span class="line">            System.out.println(<span class="string">"登录成功"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"登录失败"</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasRole</span><span class="params">(User user, String role)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.hasRole(role);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPermitted</span><span class="params">(User user, String permit)</span> </span>&#123;</span><br><span class="line">        Subject subject = getSubject(user);</span><br><span class="line">        <span class="keyword">return</span> subject.isPermitted(permit);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Subject <span class="title">getSubject</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//加载配置文件，并获取工厂</span></span><br><span class="line">        Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br><span class="line">        <span class="comment">//获取安全管理者实例</span></span><br><span class="line">        SecurityManager sm = factory.getInstance();</span><br><span class="line">        <span class="comment">//将安全管理者放入全局对象</span></span><br><span class="line">        SecurityUtils.setSecurityManager(sm);</span><br><span class="line">        <span class="comment">//全局对象通过安全管理者生成Subject对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        Subject subject= getSubject(user);</span><br><span class="line">        <span class="comment">//如果已经登录过了，退出</span></span><br><span class="line">        <span class="keyword">if</span>(subject.isAuthenticated())</span><br><span class="line">            subject.logout();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//封装用户的数据</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(user.getName(), user.getPassword());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将用户的数据token 最终传递到Realm中进行对比</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">            <span class="comment">//验证错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;              </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> subject.isAuthenticated();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-表中数据"><a class="header-anchor" href="#步骤-9-表中数据">¶</a>步骤 9 : 表中数据</h3>
<p>观察表中的数据，可以发现新增加的用户 他的盐值是 KjJR57qg08XWwcqBLHzOgQ==， 而加密后的密文是 dba57276a413ac826bf473e08eb1c650。</p>
<p>你们运行的效果，和我肯定是不一样的，因为盐值是随机数，我们的盐是不一样的。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7563.png" alt></p>
<h3 id="步骤-10-另一个做法的DatabaseRealm"><a class="header-anchor" href="#步骤-10-另一个做法的DatabaseRealm">¶</a>步骤 10 : 另一个做法的DatabaseRealm</h3>
<p>[DatabaseRealm] 中的做法是自己计算加密后的秘文，再自己比较。 另一个做法是使用Shiro提供的 HashedCredentialsMatcher 帮我们做。<br>
在创建 SimpleAuthenticationInfo 的时候，把数据库中取出来的密文以及盐作为参数传递进去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,passwordInDB,ByteSource.Util.bytes(salt),getName());</span><br></pre></td></tr></table></figure>
<p>对比 [DatabaseRealm] 中的做法，传递的是加密之前的密码，也没有传盐</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,password,getName());</span><br></pre></td></tr></table></figure>
<p>这是第一步，下一步就是 修改 [shiro.ini]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过DAO获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> DAO().listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> DAO().listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过DAO获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getCredentialsMatcher());</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">         </span><br><span class="line">        User user = <span class="keyword">new</span> DAO().getUser(userName);</span><br><span class="line">        String passwordInDB = user.getPassword();</span><br><span class="line">        String salt = user.getSalt();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        <span class="comment">//盐也放进去</span></span><br><span class="line">        <span class="comment">//这样通过shiro.ini里配置的 HashedCredentialsMatcher 进行自动校验</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,passwordInDB,ByteSource.Util.bytes(salt),getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-shiro-ini"><a class="header-anchor" href="#步骤-11-shiro-ini">¶</a>步骤 11 : shiro.ini</h3>
<p>[另一个做法的DatabaseRealm] 中只是提供了密文和盐，那么具体算法怎么指定呢？ 那么就<br>
修改shiro.ini：<br>
为DatabaseRealm 指定credentialsMatcher，其中就指定了算法是 md5, 次数为2， storedCredentialsHexEncoded 这个表示计算之后以密文为16进制。</p>
<p>这样Shiro就拿着在subject.login() 时传入的UsernamePasswordToken 中的源密码， 数据库里的密文和盐巴，以及配置文件里指定的算法参数，自己去进行相关匹配了。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">credentialsMatcher</span>=org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><br><span class="line"><span class="attr">credentialsMatcher.hashAlgorithmName</span>=md5</span><br><span class="line"><span class="attr">credentialsMatcher.hashIterations</span>=<span class="number">2</span></span><br><span class="line"><span class="attr">credentialsMatcher.storedCredentialsHexEncoded</span>=<span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">databaseRealm</span>=com.how2java.DatabaseRealm</span><br><span class="line"><span class="attr">databaseRealm.credentialsMatcher</span>=<span class="variable">$credentialsMatcher</span></span><br><span class="line"><span class="attr">securityManager.realms</span>=<span class="variable">$databaseRealm</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-TestShiro"><a class="header-anchor" href="#步骤-12-TestShiro">¶</a>步骤 12 : TestShiro</h3>
<p>TestShiro 没有任何变化，一样运行，效果也是一样的<br>
运行 TestShiro 进行账号密码验证测试。 注意，测试之前要先释放注释，以执行一次注册用户行为，如果不注册，后面肯定是不能验证通过的，因为数据库里没有嘛。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DAO().createUser(<span class="string">"tom"</span>, <span class="string">"123"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7564.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">//这里要释放注释，先注册一个用户</span></span><br><span class="line"><span class="comment">//      new DAO().createUser("tom", "123");</span></span><br><span class="line">          </span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"tom"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"123"</span>);</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span>(login(user))</span><br><span class="line">            System.out.println(<span class="string">"登录成功"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"登录失败"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="5、SHIRO-如何集成到WEB中"><a class="header-anchor" href="#5、SHIRO-如何集成到WEB中">¶</a>5、SHIRO 如何集成到WEB中</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v8"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v8">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
本项目是用的 Eclipse 动态Web项目风格，如果用的是 IDEA ，那么请参考 [如何 idea 导入 web 动态项目]<br>
本项目建立在 [数据库支持] 的基础之上，所以假设已经在数据库中创建了相关表结构以及表中的数据了<br>
运行测试效果期望如下：</p>
<ol>
<li>
<p>如图所示，下面3个链接都要求登陆，未登陆点击会提示错误信息</p>
</li>
<li>
<p>zhang3 登录之后，因为有对应的角色和权限，所以可以访问后两个超链</p>
</li>
<li>
<p>li4 登录后，因为没有对应的角色和权限，所以访问后两个超链，会提示错误信息</p>
</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7566.png" alt></p>
<h3 id="步骤-2-模仿和排错-v8"><a class="header-anchor" href="#步骤-2-模仿和排错-v8">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-新建Web动态项目"><a class="header-anchor" href="#步骤-3-新建Web动态项目">¶</a>步骤 3 : 新建Web动态项目</h3>
<p>新建Web动态项目 shiro</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7569.png" alt></p>
<h3 id="步骤-4-jar包"><a class="header-anchor" href="#步骤-4-jar包">¶</a>步骤 4 : jar包</h3>
<p>右上角的lib.rar里，有本项目需要的jar包，都复制到 WebContent/WEB-INF/lib 下面去</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7570.png" alt></p>
<h3 id="步骤-5-web-xml"><a class="header-anchor" href="#步骤-5-web-xml">¶</a>步骤 5 : web.xml</h3>
<p>修改web.xml，在里面加了个过滤器。 这个过滤器的作用，简单的说，就是 [Shiro 入门里的TestShiro] 这部分的工作，悄悄的干了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//加载配置文件，并获取工厂</span><br><span class="line">Factory<span class="tag">&lt;<span class="name">SecurityManager</span>&gt;</span> factory = new IniSecurityManagerFactory("classpath:shiro.ini");</span><br><span class="line">//获取安全管理者实例</span><br><span class="line">SecurityManager sm = factory.getInstance();</span><br><span class="line">//将安全管理者放入全局对象</span><br><span class="line">SecurityUtils.setSecurityManager(sm);</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.apache.shiro.web.env.EnvironmentLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>shiroEnvironmentClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>org.apache.shiro.web.env.IniWebEnvironment<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span><span class="comment">&lt;!-- 默认先从/WEB-INF/shiro.ini，如果没有找classpath:shiro.ini --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>shiroConfigLocations<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:shiro.ini<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.shiro.web.servlet.ShiroFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-User-DAO-DatabaseRealm"><a class="header-anchor" href="#步骤-6-User-DAO-DatabaseRealm">¶</a>步骤 6 : User DAO DatabaseRealm</h3>
<p>这3个类是在前面的[数据库支持] 知识点就讲解过的，不再赘述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAO</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/shiro?characterEncoding=UTF-8"</span>, <span class="string">"root"</span>,</span><br><span class="line">                <span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select password from user where name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next())</span><br><span class="line">                <span class="keyword">return</span> rs.getString(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"> </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoles</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql = <span class="string">"select r.name from user u "</span></span><br><span class="line">                + <span class="string">"left join user_role ur on u.id = ur.uid "</span></span><br><span class="line">                + <span class="string">"left join Role r on r.id = ur.rid "</span></span><br><span class="line">                + <span class="string">"where u.name = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                roles.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        String sql =</span><br><span class="line">            <span class="string">"select p.name from user u "</span>+</span><br><span class="line">            <span class="string">"left join user_role ru on u.id = ru.uid "</span>+</span><br><span class="line">            <span class="string">"left join role r on r.id = ru.rid "</span>+</span><br><span class="line">            <span class="string">"left join role_permission rp on r.id = rp.rid "</span>+</span><br><span class="line">            <span class="string">"left join permission p on p.id = rp.pid "</span>+</span><br><span class="line">            <span class="string">"where u.name =?"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">             </span><br><span class="line">            ps.setString(<span class="number">1</span>, userName);</span><br><span class="line">             </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                permissions.add(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> permissions;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listRoles(<span class="string">"zhang3"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listRoles(<span class="string">"li4"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listPermissions(<span class="string">"zhang3"</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> DAO().listPermissions(<span class="string">"li4"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过DAO获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = <span class="keyword">new</span> DAO().listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> DAO().listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过DAO获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        String password= <span class="keyword">new</span> String( t.getPassword());</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">        String passwordInDB = <span class="keyword">new</span> DAO().getPassword(userName);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//如果为空就是账号不存在，如果不相同就是密码错误，但是都抛出AuthenticationException，而不是抛出具体错误原因，免得给破解者提供帮助信息</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==passwordInDB || !passwordInDB.equals(password))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,password,getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-LoginServlet"><a class="header-anchor" href="#步骤-7-LoginServlet">¶</a>步骤 7 : LoginServlet</h3>
<p>LoginServlet 映射路径/login的访问。<br>
获取账号和密码，然后组成UsernamePasswordToken 对象，扔给Shiro进行判断。 如果判断不报错，即表示成功，客户端跳转到根目录，否则返回login.jsp，并带上错误信息<br>
登录成功后还会把subject放在shiro的session对象里，shiro的这个session和httpsession是串通好了的，所以在这里放了，它会自动放在httpsession里，它们之间是同步的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.session.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"loginServlet"</span>, urlPatterns = <span class="string">"/login"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> ServletException, IOException </span>&#123; </span><br><span class="line">        String name = req.getParameter(<span class="string">"name"</span>); </span><br><span class="line">        String password = req.getParameter(<span class="string">"password"</span>); </span><br><span class="line">        Subject subject = SecurityUtils.getSubject(); </span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(name, password); </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            subject.login(token);</span><br><span class="line">            Session session=subject.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">"subject"</span>, subject);</span><br><span class="line">             </span><br><span class="line">            resp.sendRedirect(<span class="string">""</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123; </span><br><span class="line">            req.setAttribute(<span class="string">"error"</span>, <span class="string">"验证失败"</span>); </span><br><span class="line">            req.getRequestDispatcher(<span class="string">"login.jsp"</span>).forward(req, resp);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-shiro-ini"><a class="header-anchor" href="#步骤-8-shiro-ini">¶</a>步骤 8 : shiro.ini</h3>
<p>[main]</p>
<ol>
<li>指定了用数据库进行验证和授权判断</li>
<li>指定了未登录，无角色，无权限分别跳转到哪个页面去</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当访问需要验证的页面，但是又没有验证的情况下，跳转到login.jsp</span></span><br><span class="line"><span class="attr">authc.loginUrl</span>=/login.jsp</span><br><span class="line"><span class="comment">#当访问需要角色的页面，但是又不拥有这个角色的情况下，跳转到noroles.jsp</span></span><br><span class="line"><span class="attr">roles.unauthorizedUrl</span>=/noRoles.jsp</span><br><span class="line"><span class="comment">#当访问需要权限的页面，但是又不拥有这个权限的情况下，跳转到noperms.jsp</span></span><br><span class="line"><span class="attr">perms.unauthorizedUrl</span>=/noPerms.jsp</span><br></pre></td></tr></table></figure>
<p>[users]<br>
用户，角色和权限都放在数据库里了，所以这里是空的<br>
[urls]</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#doLogout地址就会进行退出行为</span></span><br><span class="line">/doLogout=logout</span><br><span class="line"><span class="comment">#login.jsp,noroles.jsp,noperms.jsp 可以匿名访问</span></span><br><span class="line">/login.jsp=anon</span><br><span class="line">/noroles.jsp=anon</span><br><span class="line">/noperms.jsp=anon</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询所有产品,需要登录后才可以查看</span></span><br><span class="line">/listProduct.jsp=authc  </span><br><span class="line"><span class="comment">#删除商品不仅需要登录，而且要拥有 productManager 权限才可以操作</span></span><br><span class="line">/deleteProduct.jsp=authc,roles[productManager]  </span><br><span class="line"><span class="comment">#删除订单，不仅需要登录，而且要拥有 deleteOrder 权限才可以操作</span></span><br><span class="line">/deleteOrder.jsp=authc,perms["deleteOrder"]</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span> </span><br><span class="line"><span class="comment">#使用数据库进行验证和授权</span></span><br><span class="line"><span class="attr">databaseRealm</span>=com.how2java.DatabaseRealm</span><br><span class="line"><span class="attr">securityManager.realms</span>=<span class="variable">$databaseRealm</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#当访问需要验证的页面，但是又没有验证的情况下，跳转到login.jsp</span></span><br><span class="line"><span class="attr">authc.loginUrl</span>=/login.jsp</span><br><span class="line"><span class="comment">#当访问需要角色的页面，但是又不拥有这个角色的情况下，跳转到noroles.jsp</span></span><br><span class="line"><span class="attr">roles.unauthorizedUrl</span>=/noRoles.jsp</span><br><span class="line"><span class="comment">#当访问需要权限的页面，但是又不拥有这个权限的情况下，跳转到noperms.jsp</span></span><br><span class="line"><span class="attr">perms.unauthorizedUrl</span>=/noPerms.jsp</span><br><span class="line"> </span><br><span class="line"><span class="comment">#users，roles和perms都通过前面知识点的数据库配置了</span></span><br><span class="line"><span class="section">[users]</span> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#urls用来指定哪些资源需要什么对应的授权才能使用</span></span><br><span class="line"><span class="section">[urls]</span> </span><br><span class="line"><span class="comment">#doLogout地址就会进行退出行为</span></span><br><span class="line">/doLogout=logout</span><br><span class="line"><span class="comment">#login.jsp,noroles.jsp,noperms.jsp 可以匿名访问</span></span><br><span class="line">/login.jsp=anon</span><br><span class="line">/noroles.jsp=anon</span><br><span class="line">/noperms.jsp=anon</span><br><span class="line"> </span><br><span class="line"><span class="comment">#查询所有产品,需要登录后才可以查看</span></span><br><span class="line">/listProduct.jsp=authc </span><br><span class="line"><span class="comment">#删除商品不仅需要登录，而且要拥有 productManager 权限才可以操作</span></span><br><span class="line">/deleteProduct.jsp=authc,roles[productManager] </span><br><span class="line"><span class="comment">#删除订单，不仅需要登录，而且要拥有 deleteOrder 权限才可以操作</span></span><br><span class="line">/deleteOrder.jsp=authc,perms["deleteOrder"]</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-style-css"><a class="header-anchor" href="#步骤-9-style-css">¶</a>步骤 9 : style.css</h3>
<p>新建个样式文件，后面的 jsp 会用得着<br>
本文件位于： WebContent/static/css/style.css 下</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7575.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">span.desc&#123;</span><br><span class="line">    margin-left:<span class="number">20</span>px;</span><br><span class="line">    color:gray;</span><br><span class="line">&#125;</span><br><span class="line">div.workingroom&#123;</span><br><span class="line">    margin:<span class="number">200</span>px auto;</span><br><span class="line">    width:<span class="number">400</span>px;</span><br><span class="line">&#125;</span><br><span class="line">div.workingroom a&#123;</span><br><span class="line">    display:inline-block;</span><br><span class="line">    margin-top:<span class="number">20</span>px;</span><br><span class="line">&#125;</span><br><span class="line">div.loginDiv&#123;</span><br><span class="line">    text-align: left;</span><br><span class="line">&#125;</span><br><span class="line">div.errorInfo&#123;</span><br><span class="line">    color:red;</span><br><span class="line">    font-size:<span class="number">0.65</span>em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-index-jsp"><a class="header-anchor" href="#步骤-10-index-jsp">¶</a>步骤 10 : index.jsp</h3>
<ol>
<li>
<p>通过 ${subject.principal} 来判断用户是否登录，如果登录过了就显示退出，如果未登录就显示登录按钮</p>
</li>
<li>
<p>提供3个超链，分别要 登录后才可以查看，有角色才能看，有权限才能看，便于进行测试<br>
<strong>注：</strong> subject 是在 [LoginServlet]里放进session的</p>
</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7576.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginDiv"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;a href="login.jsp"&gt;登录&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;span class="desc"&gt;你好，$&#123;subject.principal&#125;，&lt;/span&gt;</span><br><span class="line">        &lt;a href="doLogout"&gt;退出&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;a href="listProduct.jsp"&gt;查看产品&lt;/a&gt;&lt;span class="desc"&gt;(登录后才可以查看) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteProduct.jsp"&gt;删除产品&lt;/a&gt;&lt;span  class="desc"&gt;(要有产品管理员角色, zhang3没有，li4 有) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteOrder.jsp"&gt;删除订单&lt;/a&gt;&lt;span class="desc"&gt;(要有删除订单权限, zhang3有，li4没有) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-login-jsp"><a class="header-anchor" href="#步骤-11-login-jsp">¶</a>步骤 11 : login.jsp</h3>
<p>登陆页面，如果有错误返回会显示错误. 账号密码也写在下面，方便输入</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7579.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div class="errorInfo"&gt;$&#123;error&#125;&lt;/div&gt;</span><br><span class="line">    &lt;form action=<span class="string">"login"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        账号： &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">        密码： &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt; &lt;br&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span class="desc"&gt;账号:zhang3 密码:12345 角色:admin&lt;/span&gt;&lt;br&gt;</span><br><span class="line">        &lt;span class="desc"&gt;账号:li4 密码:abcde 角色:productManager&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-listProduct-jsp"><a class="header-anchor" href="#步骤-12-listProduct-jsp">¶</a>步骤 12 : listProduct.jsp</h3>
<p>根据 [shiro.ini] 里的配置信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/listProduct.jsp=authc</span><br></pre></td></tr></table></figure>
<p>这个页面要在登录之后才能访问</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    listProduct.jsp ，能进来，就表示已经登录成功了</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-deleteOrder-jsp"><a class="header-anchor" href="#步骤-13-deleteOrder-jsp">¶</a>步骤 13 : deleteOrder.jsp</h3>
<p>根据 [shiro.ini] 里的配置信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/deleteProduct.jsp=authc,roles[admin]</span><br></pre></td></tr></table></figure>
<p>这个页面要在登录之后，并且有角色的前提下才能访问</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteOrder.jsp ，能进来，就表示有deleteOrder权限</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-deleteProduct-jsp"><a class="header-anchor" href="#步骤-14-deleteProduct-jsp">¶</a>步骤 14 : deleteProduct.jsp</h3>
<p>根据 [shiro.ini] 里的配置信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/deleteOrder.jsp=authc,perms["deleteOrder"]</span><br></pre></td></tr></table></figure>
<p>这个页面要在登录之后，并且有权限的前提下才能访问</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteProduct.jsp，能进来&lt;br&gt;就表示拥有 productManager 角色</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-noRoles-jsp"><a class="header-anchor" href="#步骤-15-noRoles-jsp">¶</a>步骤 15 : noRoles.jsp</h3>
<p>根据 [shiro.ini] 里的配置信息：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">roles.unauthorizedUrl</span>=/noRoles.jsp</span><br></pre></td></tr></table></figure>
<p>当没有角色的时候，就会跳转到这里来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    角色不匹配</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-noPerms-jsp"><a class="header-anchor" href="#步骤-16-noPerms-jsp">¶</a>步骤 16 : noPerms.jsp</h3>
<p>根据 [shiro.ini] 里的配置信息：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">perms.unauthorizedUrl</span>=/noPerms.jsp</span><br></pre></td></tr></table></figure>
<p>当没有权限的时候，就会跳转到这里来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    权限不足</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-重启tomcat-访问测试"><a class="header-anchor" href="#步骤-17-重启tomcat-访问测试">¶</a>步骤 17 : 重启tomcat 访问测试</h3>
<p>重启tomcat 访问测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/shiro/</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7577.png" alt></p>
<h2 id="6、如何在SSM中整合SHIRO"><a class="header-anchor" href="#6、如何在SSM中整合SHIRO">¶</a>6、如何在SSM中整合SHIRO</h2>
<h3 id="步骤-1-基于-SSM-的-SHIRO-项目"><a class="header-anchor" href="#步骤-1-基于-SSM-的-SHIRO-项目">¶</a>步骤 1 : 基于 SSM 的 SHIRO 项目</h3>
<p>前面的知识点学习了 [Web 支持(Servlet)]，也学习了[数据库支持]，接下来，在前面的基础之上，把项目改造成为SSM风格。<br>
如果没有SSM基础，请先学习SSM相关教程：[SSM 入门]，否则一下接触太多的新知识，如下内容是不可能看得懂的。<br>
SSM简单的说，就是springmvc负责web部分，mybatis负责数据库部分。<br>
所以基于 ssm 的 shiro 项目，就是 Servlet部分，修改为了SpringMVC，数据库部分，修改为了Mybatis，然后把shiro集成进去，用这样一个思路来把本项目实现。</p>
<h3 id="步骤-2-表结构和表数据"><a class="header-anchor" href="#步骤-2-表结构和表数据">¶</a>步骤 2 : 表结构和表数据</h3>
<p>本项目要跑起来，必须依赖 [数据库支持] 教程中的 [表结构] 和 [表数据]，所以尽量先学习前面的教程。</p>
<h3 id="步骤-3-先运行，看到效果，再学习-v5"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v5">¶</a>步骤 3 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
启动之后，运行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/index</span></span><br></pre></td></tr></table></figure>
<p>可以看到 [Web 支持(Servlet)] 里一样的效果</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7586.png" alt></p>
<h3 id="步骤-4-模仿和排错-v5"><a class="header-anchor" href="#步骤-4-模仿和排错-v5">¶</a>步骤 4 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-5-一步一步实现"><a class="header-anchor" href="#步骤-5-一步一步实现">¶</a>步骤 5 : 一步一步实现</h3>
<p>ssm 本身就有一定的复杂性，涉及的内容很多，所以一定要先[先运行，看到效果，再学习]，不然自己一不留神做错了，都不知道哪里错了，回头还怪项目本身有问题。</p>
<h3 id="步骤-6-创建-web-动态项目"><a class="header-anchor" href="#步骤-6-创建-web-动态项目">¶</a>步骤 6 : 创建 web 动态项目</h3>
<p>创建 web 动态项目，位于 e:\project\shiro 这个位置</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7589.png" alt></p>
<h3 id="步骤-7-jar-包"><a class="header-anchor" href="#步骤-7-jar-包">¶</a>步骤 7 : jar 包</h3>
<p>jar 包放在右上角的lib.rar里，解压后复制到 <strong>WebContent/WEB-INF/lib</strong> 下</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7590.png" alt></p>
<h3 id="步骤-8-web-xml"><a class="header-anchor" href="#步骤-8-web-xml">¶</a>步骤 8 : web.xml</h3>
<p>web.xml做了如下几件事情</p>
<ol>
<li>指定spring的配置文件有两个</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">applicationContext.xml： 用于链接数据库的</span><br><span class="line">applicationContext-shiro.xml： 用于配置shiro的</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>指定springmvc的配置文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">springMVC.xml</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用shiro过滤器</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- spring的配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">            classpath:applicationContext.xml,</span><br><span class="line">            classpath:applicationContext-shiro.xml</span><br><span class="line">        <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- spring mvc核心：分发servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring mvc的配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Shiro配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-applicationContext-xml"><a class="header-anchor" href="#步骤-9-applicationContext-xml">¶</a>步骤 9 : applicationContext.xml</h3>
<ol>
<li>配置数据库的相关信息</li>
<li>扫描mybatis的mapper什么的，虽然目前还没有提供mapper类</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">   <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.how2java.service"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/shiro?characterEncoding=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">     </span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSession"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.how2java.pojo"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:com/how2java/mapper/*.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.how2java.mapper"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-applicationContext-shiro-xml"><a class="header-anchor" href="#步骤-10-applicationContext-shiro-xml">¶</a>步骤 10 : applicationContext-shiro.xml</h3>
<p>提供shiro的相关配置，简单的说，就是把shiro.ini里的内容搬到这个xml文件里面来了，只是写法不同</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-4.0.xsd http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-4.0.xsd http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/util/spring-util.xsd"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 配置shiro的过滤器工厂类，id- shiroFilter要和我们在web.xml中配置的过滤器一致 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 调用我们配置的权限管理器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置我们的登录请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果您请求的资源不再您的权限范围，则跳转到/403请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/unauthorized"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 退出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">util:map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"logout"</span> <span class="attr">value-ref</span>=<span class="string">"logoutFilter"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 权限配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- anon表示此地址不需要任何权限即可访问 --&gt;</span></span><br><span class="line">                /login=anon</span><br><span class="line">                /index=anon</span><br><span class="line">                /static/**=anon</span><br><span class="line">                /doLogout=logout</span><br><span class="line">                <span class="comment">&lt;!--所有的请求(除去配置的静态资源请求或请求地址为anon的请求)都要通过登录验证,如果未登录则跳到/login --&gt;</span></span><br><span class="line">                /** = authc</span><br><span class="line">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 退出过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logoutFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.filter.authc.LogoutFilter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"redirectUrl"</span> <span class="attr">value</span>=<span class="string">"/index"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 会话ID生成器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdGenerator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话Cookie模板 关闭浏览器立即失效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.servlet.SimpleCookie"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"sid"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"httpOnly"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxAge"</span> <span class="attr">value</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话DAO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionDAO"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdGenerator"</span> <span class="attr">ref</span>=<span class="string">"sessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话验证调度器，每30分钟执行一次验证 ，设定会话超时及保存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interval"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionManager"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.session.mgt.DefaultWebSessionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全局会话超时时间（单位毫秒），默认30分钟 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"globalSessionTimeout"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deleteInvalidSessions"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationSchedulerEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span> <span class="attr">ref</span>=<span class="string">"sessionValidationScheduler"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionDAO"</span> <span class="attr">ref</span>=<span class="string">"sessionDAO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookieEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">ref</span>=<span class="string">"sessionIdCookie"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 安全管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"databaseRealm"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 相当于调用SecurityUtils.setSecurityManager(securityManager) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staticMethod"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"org.apache.shiro.SecurityUtils.setSecurityManager"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arguments"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"databaseRealm"</span> <span class="attr">class</span>=<span class="string">"com.how2java.realm.DatabaseRealm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 保证实现了Shiro内部lifecycle函数的bean执行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-springMVC-xml"><a class="header-anchor" href="#步骤-11-springMVC-xml">¶</a>步骤 11 : springMVC.xml</h3>
<ol>
<li>springmvc的基本配置</li>
<li>增加了对shiro的支持<br>
这样可以在控制器Controller上，使用像@RequireRole 这样的注解，来表示某个方法必须有相关的角色才能访问</li>
<li>指定了异常处理类DefaultExceptionHandler，这样当访问没有权限的资源的时候，就会跳到统一的页面去显示错误信息</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.how2java.controller"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewClass"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--启用shiro注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">depends-on</span>=<span class="string">"lifecycleBeanPostProcessor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyTargetClass"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 控制器异常处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exceptionHandlerExceptionResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.how2java.exception.DefaultExceptionHandler"</span>/&gt;</span>   </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-log4j-properties"><a class="header-anchor" href="#步骤-12-log4j-properties">¶</a>步骤 12 : log4j.properties</h3>
<p>日志配置文件，主要用于显示数据库的SQL语句</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">ERROR, stdout</span></span><br><span class="line"><span class="comment"># MyBatis logging configuration...</span></span><br><span class="line"><span class="meta">log4j.logger.com.how2java</span>=<span class="string">TRACE</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-PageController"><a class="header-anchor" href="#步骤-13-PageController">¶</a>步骤 13 : PageController</h3>
<p>因为使用 ssm，所以jsp通常都会放在WEB-INF/jsp 下面，而这个位置是无法通过浏览器直接访问的，所以就会专门做这么一个类，便于访问这些jsp。<br>
比如要访问WEB-INF/jsp/index.jsp文件，那么就通过/index 这个路径来访问。<br>
这个类还有两点需要注意：</p>
<ol>
<li>/login 只支持get方式。 post方式是后续用来进行登录行为的，这里的get方式仅仅用于显示登录页面</li>
<li>权限注解：<br>
通过注解： @RequiresRoles(“admin”) 指明了 访问 deleteProduct 需要角色&quot;admin&quot;<br>
通过注解：@RequiresPermissions(“deleteOrder”) 指明了 访问 deleteOrder 需要权限&quot;deleteOrder&quot;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.annotation.RequiresPermissions;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.annotation.RequiresRoles;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//专门用于显示页面的控制器</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageController</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequiresPermissions</span>(<span class="string">"deleteOrder"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"deleteOrder"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequiresRoles</span>(<span class="string">"admin"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteProduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteProduct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"deleteProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"listProduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">listProduct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/login"</span>,method=RequestMethod.GET) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"unauthorized"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">noPerms</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"unauthorized"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-index-jsp"><a class="header-anchor" href="#步骤-14-index-jsp">¶</a>步骤 14 : index.jsp</h3>
<p>index页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginDiv"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;a href="login"&gt;登录&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;span class="desc"&gt;你好，$&#123;subject.principal&#125;，&lt;/span&gt;</span><br><span class="line">        &lt;a href="doLogout"&gt;退出&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;a href="listProduct"&gt;查看产品&lt;/a&gt;&lt;span class="desc"&gt;(登录后才可以查看) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteProduct"&gt;删除产品&lt;/a&gt;&lt;span  class="desc"&gt;(要有产品管理员角色, zhang3没有，li4 有) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteOrder"&gt;删除订单&lt;/a&gt;&lt;span class="desc"&gt;(要有删除订单权限, zhang3有，li4没有) &lt;/span&gt;&lt;br&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-listProduct-jsp"><a class="header-anchor" href="#步骤-15-listProduct-jsp">¶</a>步骤 15 : listProduct.jsp</h3>
<p>需要登录才能访问的页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    listProduct.jsp ，能进来，就表示已经登录成功了</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-deleteProduct-jsp"><a class="header-anchor" href="#步骤-16-deleteProduct-jsp">¶</a>步骤 16 : deleteProduct.jsp</h3>
<p>需要角色才能访问的页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteProduct.jsp，能进来&lt;br&gt;就表示拥有 productManager 角色</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-deleteOrder-jsp"><a class="header-anchor" href="#步骤-17-deleteOrder-jsp">¶</a>步骤 17 : deleteOrder.jsp</h3>
<p>需要权限deleteOrder 才能访问的页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteOrder.jsp ，能进来，就表示有deleteOrder权限</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-18-login-jsp"><a class="header-anchor" href="#步骤-18-login-jsp">¶</a>步骤 18 : login.jsp</h3>
<p>登陆页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div class="errorInfo"&gt;$&#123;error&#125;&lt;/div&gt;</span><br><span class="line">    &lt;form action=<span class="string">"login"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        账号： &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">        密码： &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt; &lt;br&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span class="desc"&gt;账号:zhang3 密码:12345 角色:admin&lt;/span&gt;&lt;br&gt;</span><br><span class="line">        &lt;span class="desc"&gt;账号:li4 密码:abcde 角色:productManager&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-19-unauthorized-jsp"><a class="header-anchor" href="#步骤-19-unauthorized-jsp">¶</a>步骤 19 : unauthorized.jsp</h3>
<p>没有角色，没有权限都会跳转到这个页面来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    权限不足,具体原因：$&#123;ex.message&#125;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-20-style-css"><a class="header-anchor" href="#步骤-20-style-css">¶</a>步骤 20 : style.css</h3>
<p>样式文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-class">.desc</span>&#123;</span><br><span class="line">    <span class="attribute">margin-left</span>:<span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">color</span>:gray;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">200px</span> auto;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>:inline-block;</span><br><span class="line">    <span class="attribute">margin-top</span>:<span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.loginDiv</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.errorInfo</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:red;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">0.65em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-21-User-一套"><a class="header-anchor" href="#步骤-21-User-一套">¶</a>步骤 21 : User 一套</h3>
<p>一套是指实体类，Mapper,xml文件， Service接口，Service实现类<br>
需要说明的是UserMapper是得到一个User对象，但是在UserService里又返回的是这个对象的password属性，这样做是为了和前面教程里<a href="https://how2j.cn/k/shiro/shiro-database/1721.html#step7545" target="_blank" rel="noopener">DAO</a> 里的做法保持一直</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.mapper;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.how2java.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByName"</span>  <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">            select * from user where name = #&#123;0&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span>  <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> UserMapper userMapper;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        User u  = userMapper.getByName(name);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> u.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-22-Role-一套"><a class="header-anchor" href="#步骤-22-Role-一套">¶</a>步骤 22 : Role 一套</h3>
<p>Role 一套，与[User 一套]类似的，RoleMapper返回的是Role的集合，而RoleService里返回的就是String 的集合了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Role [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.mapper;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">listRolesByUserName</span><span class="params">(String userName)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.how2java.mapper.RoleMapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listRolesByUserName"</span>  <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"Role"</span>&gt;</span></span><br><span class="line">            select r.id, r.name from user u</span><br><span class="line">                left join user_role ur</span><br><span class="line">                    on u.id = ur.uid</span><br><span class="line">                left join Role r</span><br><span class="line">                    on r.id = ur.rid</span><br><span class="line">            where u.name = #&#123;0&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoles</span><span class="params">(String userName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.RoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleServiceImpl</span>  <span class="keyword">implements</span> <span class="title">RoleService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> RoleMapper roleMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoles</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleMapper.listRolesByUserName(userName);</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role: roles) &#123;</span><br><span class="line">            result.add(role.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-23-Permission-一套"><a class="header-anchor" href="#步骤-23-Permission-一套">¶</a>步骤 23 : Permission 一套</h3>
<p>Permission 一套，与[User 一套]类似的，PermissionMapper返回的是 Permission 的集合，而 PermissionService 里返回的就是String 的集合了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Permission</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Permission [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.mapper;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">listPermissionsByUserName</span><span class="params">(String userName)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.how2java.mapper.PermissionMapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listPermissionsByUserName"</span>  <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"Permission"</span>&gt;</span></span><br><span class="line">            select p.id, p.name from user u</span><br><span class="line">                left join user_role ru</span><br><span class="line">                    on u.id = ru.uid left</span><br><span class="line">                join role r</span><br><span class="line">                    on r.id = ru.rid</span><br><span class="line">                left join role_permission rp</span><br><span class="line">                    on r.id = rp.rid</span><br><span class="line">                left join permission p</span><br><span class="line">                    on p.id = rp.pid</span><br><span class="line">            where u.name =#&#123;0&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.PermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionServiceImpl</span>  <span class="keyword">implements</span> <span class="title">PermissionService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> PermissionMapper permissionMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        List&lt;Permission&gt; permissions = permissionMapper.listPermissionsByUserName(userName);</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Permission permission: permissions) &#123;</span><br><span class="line">            result.add(permission.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-24-LoginController"><a class="header-anchor" href="#步骤-24-LoginController">¶</a>步骤 24 : LoginController</h3>
<p>进行登录的控制器，和 [LoginServlet] 一样，获取账号密码进行验证，如果成功了就客户端跳转到index,否则就返回login.jsp页面。<br>
需要注意的是，这里用的是 post 方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/login"</span>,method=RequestMethod.POST)</span><br></pre></td></tr></table></figure>
<p>区别于PageController里用 get 方式的 login</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.session.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/login"</span>,method=RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(Model model,String name, String password)</span> </span>&#123;</span><br><span class="line">        Subject subject = SecurityUtils.getSubject(); </span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(name, password); </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            subject.login(token);</span><br><span class="line">            Session session=subject.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">"subject"</span>, subject);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:index"</span>;</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123; </span><br><span class="line">            model.addAttribute(<span class="string">"error"</span>, <span class="string">"验证失败"</span>); </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-25-DatabaseRealm"><a class="header-anchor" href="#步骤-25-DatabaseRealm">¶</a>步骤 25 : DatabaseRealm</h3>
<p>这里才是真正做登录验证和授权的地方<br>
做法和 [数据库支持] 教程中的[DatabaseRealm] 做法一模一样，区别只是在于把DAO 换成了 Service<br>
而这个 DatabaseRealm 的使用，是声明在 [applicationContext-shiro.xml] 中的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"databaseRealm"</span> <span class="attr">class</span>=<span class="string">"com.how2java.realm.DatabaseRealm"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"databaseRealm"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.realm;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionService permissionService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过service获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = permissionService.listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = roleService.listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过service获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        String password= <span class="keyword">new</span> String( t.getPassword());</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">        String passwordInDB = userService.getPassword(userName);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//如果为空就是账号不存在，如果不相同就是密码错误，但是都抛出AuthenticationException，而不是抛出具体错误原因，免得给破解者提供帮助信息</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==passwordInDB || !passwordInDB.equals(password))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,password,getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-26-DefaultExceptionHandler"><a class="header-anchor" href="#步骤-26-DefaultExceptionHandler">¶</a>步骤 26 : DefaultExceptionHandler</h3>
<p>最后是异常处理，当发生UnauthorizedException 异常的时候，就表示访问了无授权的资源，那么就会跳转到unauthorized.jsp，而在unauthorized.jsp 中就会把错误信息通过变量 ex 取出来。</p>
<p>DefaultExceptionHandler 的使用，是声明在 [springMVC.xml] 的最后几行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exceptionHandlerExceptionResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.how2java.exception.DefaultExceptionHandler"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.exception;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.UnauthorizedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.NativeWebRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(&#123;UnauthorizedException<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseStatus</span>(<span class="title">HttpStatus</span>.<span class="title">UNAUTHORIZED</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">processUnauthenticatedException</span>(<span class="title">NativeWebRequest</span> <span class="title">request</span>, <span class="title">UnauthorizedException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"ex"</span>, e);</span><br><span class="line">        mv.setViewName(<span class="string">"unauthorized"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-27-缺陷"><a class="header-anchor" href="#步骤-27-缺陷">¶</a>步骤 27 : 缺陷</h3>
<p>这种方式直观，哪里需要权限，哪里写注解@RequirePermission就行。 但是，真正项目开发的时候，这种方式就很有局限性了，当权限配置关系发生变化，每次都要修改代码，编译打包重启系统，这肯定是不能够被接受的。<br>
所以，最好的方式，还是通过动态配置，给不同的用户配置不同的角色，权限，修改之后立马生效这种方式。 为了实现这个效果，就需要基于URL配置权限的方式来做了。那么就在下面的教程中展开了。</p>
<h2 id="7、基于SHIRO-，使用SSM框架-进行用户，角色，权限维护和管理一套"><a class="header-anchor" href="#7、基于SHIRO-，使用SSM框架-进行用户，角色，权限维护和管理一套">¶</a>7、基于SHIRO ，使用SSM框架 进行用户，角色，权限维护和管理一套</h2>
<h3 id="步骤-1-权限维护一套"><a class="header-anchor" href="#步骤-1-权限维护一套">¶</a>步骤 1 : 权限维护一套</h3>
<p>上一个知识点[ssm]，哪里需要权限，哪里写注解@RequirePermission就行。 但是，真正项目开发的时候，这种方式就很有局限性了，当权限配置关系发生变化，每次都要修改代码，编译打包重启系统，这肯定是不能够被接受的。<br>
所以，最好的方式，还是通过动态配置，哪个给不同的用户配置不同的角色，权限，修改之后立马生效这种方式。 为了实现这个效果，就需要基于URL配置的方式来做了。</p>
<p>接下来要做基于URL配置权限的讲解。 但是基于URL配置权限需要自己能够进行权限信息的灵活配置，那么就需要对权限信息一套进行维护。<br>
而权限一套本身的维护，就已经有相当的复杂性了。 <strong>为了学习更加平滑</strong>，本知识仅仅对权限一套信息的维护，进行开发，以此为后续的基于URL配置权限做准备。</p>
<h3 id="步骤-2-表结构调整"><a class="header-anchor" href="#步骤-2-表结构调整">¶</a>步骤 2 : 表结构调整</h3>
<p>对表结构有所调整，主要是增加了一些字段。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS shiro;</span><br><span class="line">CREATE DATABASE shiro DEFAULT CHARACTER SET utf8;</span><br><span class="line">USE shiro;</span><br><span class="line">   </span><br><span class="line">drop table if exists user;</span><br><span class="line">drop table if exists role;</span><br><span class="line">drop table if exists permission;</span><br><span class="line">drop table if exists user_role;</span><br><span class="line">drop table if exists role_permission;</span><br><span class="line">   </span><br><span class="line">create table user (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  password varchar(100),</span><br><span class="line">  salt varchar(100),</span><br><span class="line">  constraint pk_users primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">   </span><br><span class="line">create table role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  constraint pk_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">   </span><br><span class="line">create table permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  url varchar(100), </span><br><span class="line">  constraint pk_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">   </span><br><span class="line">create table user_role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  uid bigint,</span><br><span class="line">  rid bigint,</span><br><span class="line">  constraint pk_users_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">   </span><br><span class="line">create table role_permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  rid bigint,</span><br><span class="line">  pid bigint,</span><br><span class="line">  constraint pk_roles_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-新的表数据"><a class="header-anchor" href="#步骤-3-新的表数据">¶</a>步骤 3 : 新的表数据</h3>
<p>增加基本数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &#96;permission&#96; VALUES (1,&#39;addProduct&#39;,&#39;增加产品&#39;,&#39;&#x2F;addProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (2,&#39;deleteProduct&#39;,&#39;删除产品&#39;,&#39;&#x2F;deleteProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (3,&#39;editeProduct&#39;,&#39;编辑产品&#39;,&#39;&#x2F;editeProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (4,&#39;updateProduct&#39;,&#39;修改产品&#39;,&#39;&#x2F;updateProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (5,&#39;listProduct&#39;,&#39;查看产品&#39;,&#39;&#x2F;listProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (6,&#39;addOrder&#39;,&#39;增加订单&#39;,&#39;&#x2F;addOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (7,&#39;deleteOrder&#39;,&#39;删除订单&#39;,&#39;&#x2F;deleteOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (8,&#39;editeOrder&#39;,&#39;编辑订单&#39;,&#39;&#x2F;editeOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (9,&#39;updateOrder&#39;,&#39;修改订单&#39;,&#39;&#x2F;updateOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (10,&#39;listOrder&#39;,&#39;查看订单&#39;,&#39;&#x2F;listOrder&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (1,&#39;admin&#39;,&#39;超级管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (2,&#39;productManager&#39;,&#39;产品管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (3,&#39;orderManager&#39;,&#39;订单管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,1,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,1,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,1,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (4,1,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (5,1,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (6,1,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (7,1,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (8,1,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (9,1,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (10,1,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (11,2,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (12,2,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (13,2,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (14,2,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (15,2,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (50,3,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (51,3,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (52,3,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (53,3,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (54,3,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (55,3,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (56,5,11);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (1,&#39;zhang3&#39;,&#39;a7d59dfc5332749cb801f86a24f5f590&#39;,&#39;e5ykFiNwShfCXvBRPr3wXg&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (2,&#39;li4&#39;,&#39;43e28304197b9216e45ab1ce8dac831b&#39;,&#39;jPz19y7arvYIGhuUjsb6sQ&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (43,2,2);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (45,1,1);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-4-先运行，看到效果，再学习-v2">¶</a>步骤 4 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-5-模仿和排错-v2"><a class="header-anchor" href="#步骤-5-模仿和排错-v2">¶</a>步骤 5 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-6-用户管理效果"><a class="header-anchor" href="#步骤-6-用户管理效果">¶</a>步骤 6 : 用户管理效果</h3>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listUser</span></span><br></pre></td></tr></table></figure>
<p>两张截图放在一起，上面是查询和增加，下面是修改和配置角色关系。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7616.png" alt></p>
<h3 id="步骤-7-角色管理效果"><a class="header-anchor" href="#步骤-7-角色管理效果">¶</a>步骤 7 : 角色管理效果</h3>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listRole</span></span><br></pre></td></tr></table></figure>
<p>两张截图放在一起，上面是查询和增加，下面是修改和配置权限关系。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7617.png" alt></p>
<h3 id="步骤-8-权限管理效果"><a class="header-anchor" href="#步骤-8-权限管理效果">¶</a>步骤 8 : 权限管理效果</h3>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listPermission</span></span><br></pre></td></tr></table></figure>
<p>两张截图放在一起，上面是查询和增加，下面是修改和配置权限关系。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7618.png" alt></p>
<h3 id="步骤-9-基于前面的知识点"><a class="header-anchor" href="#步骤-9-基于前面的知识点">¶</a>步骤 9 : 基于前面的知识点</h3>
<p>本项目是基于上一个知识点[ssm] 进行扩展，所以下面就列出改动了的地方，不再从每一文件创建说起。</p>
<h3 id="步骤-10-jar"><a class="header-anchor" href="#步骤-10-jar">¶</a>步骤 10 : jar</h3>
<p>增加了一些jar,主要用于对 Mybatis 逆向工程的支持<br>
参考：逆向工程教程：[逆向工程]<br>
右上角的lib.rar，解压后复制粘贴到 WebContent/WEB-INF/lib 下</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7620.png" alt></p>
<h3 id="步骤-11-OverIsMergeablePlugin"><a class="header-anchor" href="#步骤-11-OverIsMergeablePlugin">¶</a>步骤 11 : OverIsMergeablePlugin</h3>
<p>MybatisGenerator插件是Mybatis官方提供的，这个插件存在一个固有的Bug，即当第一次生成了Mapper.xml之后，再次运行会导致Mapper.xml生成重复内容，而影响正常的运行。<br>
为了解决这个问题，需要自己写一个小插件类OverIsMergeablePlugin。 它为什么起作用说起来比较复杂，不在这里展开了，反正。。。我也是复制粘贴来的~<br>
至于怎么使用，将在下一个步骤 [generatorConfig.xml] 讲解，这里先准备这个类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.util;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.GeneratedXmlFile;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.IntrospectedTable;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.PluginAdapter;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OverIsMergeablePlugin</span> <span class="keyword">extends</span> <span class="title">PluginAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validate</span><span class="params">(List&lt;String&gt; warnings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sqlMapGenerated</span><span class="params">(GeneratedXmlFile sqlMap, IntrospectedTable introspectedTable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field field = sqlMap.getClass().getDeclaredField(<span class="string">"isMergeable"</span>);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            field.setBoolean(sqlMap, <span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-generatorConfig-xml"><a class="header-anchor" href="#步骤-12-generatorConfig-xml">¶</a>步骤 12 : generatorConfig.xml</h3>
<p>这个配置文件就是用于指定要逆向工程哪些表的</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7622.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"DB2Tables"</span>    <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--避免生成重复代码的插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">"com.how2java.util.OverIsMergeablePlugin"</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!--是否在代码中显示注释--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!--数据库链接地址账号密码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span> <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost/shiro"</span> <span class="attr">userId</span>=<span class="string">"root"</span> <span class="attr">password</span>=<span class="string">"admin"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--不知道做什么用的。。。反正贴上来了~--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--生成pojo类存放位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.how2java.pojo"</span> <span class="attr">targetProject</span>=<span class="string">"src"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--生成xml映射文件存放位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.how2java.mapper"</span> <span class="attr">targetProject</span>=<span class="string">"src"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--生成mapper类存放位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span> <span class="attr">targetPackage</span>=<span class="string">"com.how2java.mapper"</span> <span class="attr">targetProject</span>=<span class="string">"src"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!--生成对应表及类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"user"</span> <span class="attr">domainObjectName</span>=<span class="string">"User"</span> <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span> <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"true"</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"my.isgen.usekeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"role"</span> <span class="attr">domainObjectName</span>=<span class="string">"Role"</span> <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span> <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"true"</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"my.isgen.usekeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"permission"</span> <span class="attr">domainObjectName</span>=<span class="string">"Permission"</span> <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span> <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"true"</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"my.isgen.usekeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"user_role"</span> <span class="attr">domainObjectName</span>=<span class="string">"UserRole"</span> <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span> <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"true"</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"my.isgen.usekeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"role_permission"</span> <span class="attr">domainObjectName</span>=<span class="string">"RolePermission"</span> <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span> <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"true"</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"my.isgen.usekeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-MybatisGenerator"><a class="header-anchor" href="#步骤-13-MybatisGenerator">¶</a>步骤 13 : MybatisGenerator</h3>
<p>运行 MybatisGenerator 以获取自动生成 [Pojo、Example 和 Mapper]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.util;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisGenerator</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String today = <span class="string">"2018-5-16"</span>;</span><br><span class="line">  </span><br><span class="line">        SimpleDateFormat sdf =<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">        Date now =sdf.parse(today);</span><br><span class="line">        Date d = <span class="keyword">new</span> Date();</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span>(d.getTime()&gt;now.getTime()+<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>)&#123;</span><br><span class="line">            System.err.println(<span class="string">"——————未成成功运行——————"</span>);</span><br><span class="line">            System.err.println(<span class="string">"——————未成成功运行——————"</span>);</span><br><span class="line">            System.err.println(<span class="string">"本程序具有破坏作用，应该只运行一次，如果必须要再运行，需要修改today变量为今天，如:"</span> + sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">false</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">        InputStream is= MybatisGenerator.class.getClassLoader().getResource("generatorConfig.xml").openStream();</span><br><span class="line">        ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">        Configuration config = cp.parseConfiguration(is);</span><br><span class="line">        is.close();</span><br><span class="line">        DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">        MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">        myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">"生成代码成功，只能执行一次，以后执行会覆盖掉mapper,pojo,xml 等文件上做的修改"</span>);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-Pojo-Example-Mapper"><a class="header-anchor" href="#步骤-14-Pojo-Example-Mapper">¶</a>步骤 14 : Pojo,Example,Mapper</h3>
<p>如果是IDEA，那么生成后就会自动观察到这些文件的存在，如果是Eclipse需要刷新一下项目，才能看到如图所示pojo Mapper和xml都生成好了。</p>
<p>为什么要这么做？ Mybatis 本质上就是自己写 sql 语句的一个帮助工具。 但是自己写 sql 太他妈繁琐了。。。 还是用逆向工程好，什么sql 都准备好了，能够支撑完成90% 的业务功能。 所以能偷懒就偷懒吧~</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7624.png" alt></p>
<h3 id="步骤-15-Service层"><a class="header-anchor" href="#步骤-15-Service层">¶</a>步骤 15 : Service层</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoleNames</span><span class="params">(String userName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">listRoles</span><span class="params">(String userName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">listRoles</span><span class="params">(User user)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Role role)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Role role)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Permission permission)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Permission <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Permission permission)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">(Role role)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRoleService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(User user, <span class="keyword">long</span>[] roleIds)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByUser</span><span class="params">(<span class="keyword">long</span> userId)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByRole</span><span class="params">(<span class="keyword">long</span> roleId)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RolePermissionService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPermissions</span><span class="params">(Role role, <span class="keyword">long</span>[] permissionIds)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByRole</span><span class="params">(<span class="keyword">long</span> roleId)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByPermission</span><span class="params">(<span class="keyword">long</span> permissionId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-Service实现层"><a class="header-anchor" href="#步骤-16-Service实现层">¶</a>步骤 16 : Service实现层</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.UserExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserRoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span>  <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Autowired</span> UserRoleService userRoleService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        User user = getByName(name);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        UserExample example = <span class="keyword">new</span> UserExample();</span><br><span class="line">        example.createCriteria().andNameEqualTo(name);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">if</span>(users.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> users.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(User u)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        userMapper.deleteByPrimaryKey(id);</span><br><span class="line">        userRoleService.deleteByUser(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User u)</span> </span>&#123;</span><br><span class="line">        userMapper.updateByPrimaryKeySelective(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UserExample example =<span class="keyword">new</span> UserExample();</span><br><span class="line">        example.setOrderByClause(<span class="string">"id desc"</span>);</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectByExample(example);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.RoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.UserRoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RoleExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.UserRole;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.UserRoleExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleServiceImpl</span>  <span class="keyword">implements</span> <span class="title">RoleService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> RoleMapper roleMapper;</span><br><span class="line">    <span class="meta">@Autowired</span> UserRoleMapper userRoleMapper;</span><br><span class="line">    <span class="meta">@Autowired</span> UserService userService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listRoleNames</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        List&lt;Role&gt; roles = listRoles(userName);</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            result.add(role.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">listRoles</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        User user = userService.getByName(userName);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user)</span><br><span class="line">            <span class="keyword">return</span> roles;</span><br><span class="line">         </span><br><span class="line">        roles = listRoles(user);</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Role u)</span> </span>&#123;</span><br><span class="line">        roleMapper.insert(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        roleMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Role u)</span> </span>&#123;</span><br><span class="line">        roleMapper.updateByPrimaryKeySelective(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RoleExample example =<span class="keyword">new</span> RoleExample();</span><br><span class="line">        example.setOrderByClause(<span class="string">"id desc"</span>);</span><br><span class="line">        <span class="keyword">return</span> roleMapper.selectByExample(example);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">listRoles</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        UserRoleExample example = <span class="keyword">new</span> UserRoleExample();</span><br><span class="line">         </span><br><span class="line">        example.createCriteria().andUidEqualTo(user.getId());</span><br><span class="line">        List&lt;UserRole&gt; userRoles= userRoleMapper.selectByExample(example);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (UserRole userRole : userRoles) &#123;</span><br><span class="line">            Role role=roleMapper.selectByPrimaryKey(userRole.getRid());</span><br><span class="line">            roles.add(role);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.PermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.RolePermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.PermissionExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermissionExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionServiceImpl</span>  <span class="keyword">implements</span> <span class="title">PermissionService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> PermissionMapper permissionMapper;</span><br><span class="line">    <span class="meta">@Autowired</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span> RoleService roleService;</span><br><span class="line">    <span class="meta">@Autowired</span> RolePermissionMapper rolePermissionMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        List&lt;Role&gt; roles = roleService.listRoles(userName);</span><br><span class="line">         </span><br><span class="line">        List&lt;RolePermission&gt; rolePermissions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            RolePermissionExample example = <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">            example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">            List&lt;RolePermission&gt; rps= rolePermissionMapper.selectByExample(example);</span><br><span class="line">            rolePermissions.addAll(rps);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rolePermissions) &#123;</span><br><span class="line">            Permission p = permissionMapper.selectByPrimaryKey(rolePermission.getPid());</span><br><span class="line">            result.add(p.getName());</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Permission u)</span> </span>&#123;</span><br><span class="line">        permissionMapper.insert(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        permissionMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Permission u)</span> </span>&#123;</span><br><span class="line">        permissionMapper.updateByPrimaryKeySelective(u);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Permission <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> permissionMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        PermissionExample example =<span class="keyword">new</span> PermissionExample();</span><br><span class="line">        example.setOrderByClause(<span class="string">"id desc"</span>);</span><br><span class="line">        <span class="keyword">return</span> permissionMapper.selectByExample(example);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line">        List&lt;Permission&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        RolePermissionExample example = <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">        example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">        List&lt;RolePermission&gt; rps = rolePermissionMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rps) &#123;</span><br><span class="line">            result.add(permissionMapper.selectByPrimaryKey(rolePermission.getPid()));</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.UserRoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.UserRole;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.UserRoleExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserRoleService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRoleServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserRoleService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> UserRoleMapper userRoleMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(User user, <span class="keyword">long</span>[] roleIds)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//删除当前用户所有的角色</span></span><br><span class="line">        UserRoleExample example= <span class="keyword">new</span> UserRoleExample();</span><br><span class="line">        example.createCriteria().andUidEqualTo(user.getId());</span><br><span class="line">        List&lt;UserRole&gt; urs= userRoleMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (UserRole userRole : urs)</span><br><span class="line">            userRoleMapper.deleteByPrimaryKey(userRole.getId());</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//设置新的角色关系</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=roleIds)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">long</span> rid : roleIds) &#123;</span><br><span class="line">                UserRole userRole = <span class="keyword">new</span> UserRole();</span><br><span class="line">                userRole.setRid(rid);</span><br><span class="line">                userRole.setUid(user.getId());</span><br><span class="line">                userRoleMapper.insert(userRole);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByUser</span><span class="params">(<span class="keyword">long</span> userId)</span> </span>&#123;</span><br><span class="line">        UserRoleExample example= <span class="keyword">new</span> UserRoleExample();</span><br><span class="line">        example.createCriteria().andUidEqualTo(userId);</span><br><span class="line">        List&lt;UserRole&gt; urs= userRoleMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (UserRole userRole : urs) &#123;</span><br><span class="line">            userRoleMapper.deleteByPrimaryKey(userRole.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByRole</span><span class="params">(<span class="keyword">long</span> roleId)</span> </span>&#123;</span><br><span class="line">        UserRoleExample example= <span class="keyword">new</span> UserRoleExample();</span><br><span class="line">        example.createCriteria().andRidEqualTo(roleId);</span><br><span class="line">        List&lt;UserRole&gt; urs= userRoleMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (UserRole userRole : urs) &#123;</span><br><span class="line">            userRoleMapper.deleteByPrimaryKey(userRole.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.RolePermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermissionExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RolePermissionService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RolePermissionServiceImpl</span> <span class="keyword">implements</span> <span class="title">RolePermissionService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> RolePermissionMapper rolePermissionMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPermissions</span><span class="params">(Role role, <span class="keyword">long</span>[] permissionIds)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//删除当前角色所有的权限</span></span><br><span class="line">        RolePermissionExample example= <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">        example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">        List&lt;RolePermission&gt; rps= rolePermissionMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rps)</span><br><span class="line">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//设置新的权限关系</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=permissionIds)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">long</span> pid : permissionIds) &#123;</span><br><span class="line">                RolePermission rolePermission = <span class="keyword">new</span> RolePermission();</span><br><span class="line">                rolePermission.setPid(pid);</span><br><span class="line">                rolePermission.setRid(role.getId());</span><br><span class="line">                rolePermissionMapper.insert(rolePermission);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByRole</span><span class="params">(<span class="keyword">long</span> roleId)</span> </span>&#123;</span><br><span class="line">        RolePermissionExample example= <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">        example.createCriteria().andRidEqualTo(roleId);</span><br><span class="line">        List&lt;RolePermission&gt; rps= rolePermissionMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rps)</span><br><span class="line">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByPermission</span><span class="params">(<span class="keyword">long</span> permissionId)</span> </span>&#123;</span><br><span class="line">        RolePermissionExample example= <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">        example.createCriteria().andPidEqualTo(permissionId);</span><br><span class="line">        List&lt;RolePermission&gt; rps= rolePermissionMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rps)</span><br><span class="line">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-Controller-层"><a class="header-anchor" href="#步骤-17-Controller-层">¶</a>步骤 17 : Controller 层</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.SecureRandomNumberGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserRoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> UserRoleService userRoleService;</span><br><span class="line">    <span class="meta">@Autowired</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span> RoleService roleService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"listUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; us= userService.list();</span><br><span class="line">        model.addAttribute(<span class="string">"us"</span>, us);</span><br><span class="line">        Map&lt;User,List&lt;Role&gt;&gt; user_roles = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (User user : us) &#123;</span><br><span class="line">            List&lt;Role&gt; roles=roleService.listRoles(user);</span><br><span class="line">            user_roles.put(user, roles);</span><br><span class="line">        &#125;</span><br><span class="line">        model.addAttribute(<span class="string">"user_roles"</span>, user_roles);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"editUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        List&lt;Role&gt; rs = roleService.list();</span><br><span class="line">        model.addAttribute(<span class="string">"rs"</span>, rs);      </span><br><span class="line">        User user =userService.get(id);</span><br><span class="line">        model.addAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">         </span><br><span class="line">        List&lt;Role&gt; roles =roleService.listRoles(user);</span><br><span class="line">        model.addAttribute(<span class="string">"currentRoles"</span>, roles);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        userService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"updateUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(User user,<span class="keyword">long</span>[] roleIds)</span></span>&#123;</span><br><span class="line">        userRoleService.setRoles(user,roleIds);</span><br><span class="line">         </span><br><span class="line">        String password=user.getPassword();</span><br><span class="line">        <span class="comment">//如果在修改的时候没有设置密码，就表示不改动密码</span></span><br><span class="line">        <span class="keyword">if</span>(user.getPassword().length()!=<span class="number">0</span>) &#123;</span><br><span class="line">            String salt = <span class="keyword">new</span> SecureRandomNumberGenerator().nextBytes().toString();</span><br><span class="line">            <span class="keyword">int</span> times = <span class="number">2</span>;</span><br><span class="line">            String algorithmName = <span class="string">"md5"</span>;</span><br><span class="line">            String encodedPassword = <span class="keyword">new</span> SimpleHash(algorithmName,password,salt,times).toString();</span><br><span class="line">            user.setSalt(salt);</span><br><span class="line">            user.setPassword(encodedPassword);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            user.setPassword(<span class="keyword">null</span>);</span><br><span class="line">         </span><br><span class="line">        userService.update(user);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listUser"</span>;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"addUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(Model model,String name, String password)</span></span>&#123;</span><br><span class="line">         </span><br><span class="line">        String salt = <span class="keyword">new</span> SecureRandomNumberGenerator().nextBytes().toString();</span><br><span class="line">        <span class="keyword">int</span> times = <span class="number">2</span>;</span><br><span class="line">        String algorithmName = <span class="string">"md5"</span>;</span><br><span class="line">          </span><br><span class="line">        String encodedPassword = <span class="keyword">new</span> SimpleHash(algorithmName,password,salt,times).toString();</span><br><span class="line">         </span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        u.setName(name);</span><br><span class="line">        u.setPassword(encodedPassword);</span><br><span class="line">        u.setSalt(salt);</span><br><span class="line">        userService.add(u);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RolePermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> RoleService roleService;</span><br><span class="line">    <span class="meta">@Autowired</span> RolePermissionService rolePermissionService;</span><br><span class="line">    <span class="meta">@Autowired</span> PermissionService permissionService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"listRole"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        List&lt;Role&gt; rs= roleService.list();</span><br><span class="line">        model.addAttribute(<span class="string">"rs"</span>, rs);</span><br><span class="line">         </span><br><span class="line">        Map&lt;Role,List&lt;Permission&gt;&gt; role_permissions = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Role role : rs) &#123;</span><br><span class="line">            List&lt;Permission&gt; ps = permissionService.list(role);</span><br><span class="line">            role_permissions.put(role, ps);</span><br><span class="line">        &#125;</span><br><span class="line">        model.addAttribute(<span class="string">"role_permissions"</span>, role_permissions);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listRole"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"editRole"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        Role role =roleService.get(id);</span><br><span class="line">        model.addAttribute(<span class="string">"role"</span>, role);</span><br><span class="line">         </span><br><span class="line">        List&lt;Permission&gt; ps = permissionService.list();</span><br><span class="line">        model.addAttribute(<span class="string">"ps"</span>, ps);</span><br><span class="line"> </span><br><span class="line">        List&lt;Permission&gt; currentPermissions = permissionService.list(role);</span><br><span class="line">        model.addAttribute(<span class="string">"currentPermissions"</span>, currentPermissions);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editRole"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"updateRole"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(Role role,<span class="keyword">long</span>[] permissionIds)</span></span>&#123;</span><br><span class="line">        rolePermissionService.setPermissions(role, permissionIds);</span><br><span class="line">        roleService.update(role);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listRole"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"addRole"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model,Role role)</span></span>&#123;</span><br><span class="line">        System.out.println(role.getName());</span><br><span class="line">        System.out.println(role.getDesc_());</span><br><span class="line">        roleService.add(role);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listRole"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteRole"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        roleService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listRole"</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> PermissionService permissionService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"listPermission"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        List&lt;Permission&gt; ps= permissionService.list();</span><br><span class="line">        model.addAttribute(<span class="string">"ps"</span>, ps);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listPermission"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"editPermission"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        Permission permission =permissionService.get(id);</span><br><span class="line">        model.addAttribute(<span class="string">"permission"</span>, permission);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editPermission"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"updatePermission"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(Permission permission)</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">        permissionService.update(permission);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listPermission"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"addPermission"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model,Permission permission)</span></span>&#123;</span><br><span class="line">        System.out.println(permission.getName());</span><br><span class="line">        System.out.println(permission.getDesc_());</span><br><span class="line">        permissionService.add(permission);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listPermission"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deletePermission"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(Model model,<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">        permissionService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:listPermission"</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-18-menu-jsp"><a class="header-anchor" href="#步骤-18-menu-jsp">¶</a>步骤 18 : menu.jsp</h3>
<p>因为下面的[View层] 步骤中的jsp要用到这个文件，所以先准备它<br>
在jsp目录下新增一个 include目录，然后新建menu.jsp文件</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7633.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"menu"</span>&gt;</span><br><span class="line">        &lt;a href="listUser"&gt;用户管理&lt;/a&gt;</span><br><span class="line">        &lt;a href="listRole"&gt;角色管理&lt;/a&gt;</span><br><span class="line">        &lt;a href="listPermission"&gt;权限管理&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-19-View层"><a class="header-anchor" href="#步骤-19-View层">¶</a>步骤 19 : View层</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;用户名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;用户密码&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;加密盐&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;角色&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;编辑&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;us&#125;"</span> <span class="keyword">var</span>=<span class="string">"u"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;u.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;u.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;fn:substring(u.password, 0, 5)&#125;...&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;fn:substring(u.salt, 0, 5)&#125;...&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                     &lt;c:forEach items=<span class="string">"$&#123;user_roles[u]&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">                        $&#123;r.name&#125; &lt;br&gt;</span><br><span class="line">                     &lt;/c:forEach&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="editUser?id=$&#123;u.id&#125;"&gt;编辑&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="deleteUser?id=$&#123;u.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"addUser"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            用户名: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">            密码: &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"增加"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"updateUser"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            用户名: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"$&#123;user.name&#125;"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            密码: &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span> value=<span class="string">""</span> placeholder=<span class="string">"留空就表示不修改密码"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            配置角色:&lt;br&gt;</span><br><span class="line">            &lt;div style=<span class="string">"text-align:left;width:300px;margin:0px auto;padding-left:50px"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;rs&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">                    &lt;c:set <span class="keyword">var</span>=<span class="string">"hasRole"</span> value=<span class="string">"false"</span> /&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">"$&#123;currentRoles&#125;"</span> <span class="keyword">var</span>=<span class="string">"currentRole"</span>&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;r.id==currentRole.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;c:set <span class="keyword">var</span>=<span class="string">"hasRole"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"checkbox"</span>  $&#123;hasRole?<span class="string">"checked='checked'"</span>:<span class="string">""</span> &#125; name=<span class="string">"roleIds"</span> value=<span class="string">"$&#123;r.id&#125;"</span>&gt; $&#123;r.name&#125;&lt;br&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"id"</span> value=<span class="string">"$&#123;user.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"修改"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;角色名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;角色描述&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;权限&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;编辑&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;rs&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;r.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;r.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;r.desc_&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                     &lt;c:forEach items=<span class="string">"$&#123;role_permissions[r]&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">                        $&#123;p.name&#125; &lt;br&gt;</span><br><span class="line">                     &lt;/c:forEach&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;td&gt;&lt;a href="editRole?id=$&#123;r.id&#125;"&gt;编辑&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="deleteRole?id=$&#123;r.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"addRole"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            角色名称: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">            角色描述: &lt;input type=<span class="string">"text"</span> name=<span class="string">"desc_"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"增加"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"updateRole"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            角色名: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"$&#123;role.name&#125;"</span>&gt; &lt;br&gt;</span><br><span class="line">            角色描述: &lt;input type=<span class="string">"text"</span> name=<span class="string">"desc_"</span> value=<span class="string">"$&#123;role.desc_&#125;"</span> &gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            配置权限:&lt;br&gt;</span><br><span class="line">            &lt;div style=<span class="string">"text-align:left;width:300px;margin:0px auto;padding-left:50px"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;ps&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">                    &lt;c:set <span class="keyword">var</span>=<span class="string">"hasPermission"</span> value=<span class="string">"false"</span> /&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">"$&#123;currentPermissions&#125;"</span> <span class="keyword">var</span>=<span class="string">"currentPermission"</span>&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;p.id==currentPermission.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;c:set <span class="keyword">var</span>=<span class="string">"hasPermission"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"checkbox"</span>  $&#123;hasPermission?<span class="string">"checked='checked'"</span>:<span class="string">""</span> &#125; name=<span class="string">"permissionIds"</span> value=<span class="string">"$&#123;p.id&#125;"</span>&gt; $&#123;p.name&#125;&lt;br&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/div&gt;           </span><br><span class="line">             </span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"id"</span> value=<span class="string">"$&#123;role.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"修改"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;权限名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;权限描述&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;权限对应的路径&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;编辑&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;ps&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;p.desc_&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;p.url&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="editPermission?id=$&#123;p.id&#125;"&gt;编辑&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="deletePermission?id=$&#123;p.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"addPermission"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            权限名称: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">            权限描述: &lt;input type=<span class="string">"text"</span> name=<span class="string">"desc_"</span>&gt; &lt;br&gt;</span><br><span class="line">            权限对应的url: &lt;input type=<span class="string">"text"</span> name=<span class="string">"url"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"增加"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"../static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"include/menu.jsp"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"addOrEdit"</span> &gt;</span><br><span class="line">        &lt;form action=<span class="string">"updatePermission"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            权限名称: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"$&#123;permission.name&#125;"</span>&gt; &lt;br&gt;</span><br><span class="line">            权限描述: &lt;input type=<span class="string">"text"</span> name=<span class="string">"desc_"</span> value=<span class="string">"$&#123;permission.desc_&#125;"</span>&gt; &lt;br&gt;</span><br><span class="line">            权限对应的url: &lt;input type=<span class="string">"text"</span> name=<span class="string">"url"</span>  value=<span class="string">"$&#123;permission.url&#125;"</span>&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"id"</span> value=<span class="string">"$&#123;permission.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"修改"</span>&gt;</span><br><span class="line">        &lt;/form&gt;  </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-20-style-css-v2"><a class="header-anchor" href="#步骤-20-style-css-v2">¶</a>步骤 20 : style.css</h3>
<p>样式做了些调整</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-class">.desc</span>&#123;</span><br><span class="line">    <span class="attribute">margin-left</span>:<span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">color</span>:gray;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">200px</span> auto;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line"><span class="comment">/*  display:inline-block; */</span></span><br><span class="line"><span class="comment">/*  margin-top:20px; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.loginDiv</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.errorInfo</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:red;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">0.65em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">td</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">table</span>&#123;</span><br><span class="line">    <span class="attribute">border-collapse</span>:collapse;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">td</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">div</span><span class="selector-class">.menu</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:absolute;</span><br><span class="line">    <span class="attribute">left</span>:-<span class="number">160px</span>;</span><br><span class="line">    <span class="attribute">top</span>:-<span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">div</span><span class="selector-class">.menu</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">    <span class="attribute">margin-top</span>:<span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.workingroom</span> <span class="selector-tag">div</span><span class="selector-class">.addOrEdit</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>:center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-21-web-xml"><a class="header-anchor" href="#步骤-21-web-xml">¶</a>步骤 21 : web.xml</h3>
<p>增加了中文过滤器，上一个知识点居然没这个。。。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 中文过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">    <span class="comment">&lt;!-- spring的配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">            classpath:applicationContext.xml,</span><br><span class="line">            classpath:applicationContext-shiro.xml</span><br><span class="line">        <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- spring mvc核心：分发servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring mvc的配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- Shiro配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-22-DatabaseRealm"><a class="header-anchor" href="#步骤-22-DatabaseRealm">¶</a>步骤 22 : DatabaseRealm</h3>
<ol>
<li>
<p>roleService.listRoles 改成了 roleService.listRoleNames</p>
</li>
<li>
<p>因为现在有了增加用户功能（相当于注册），那么此时数据库里的密码也是加密状态的了。 那么校验工作，也使用 [shiro 教程里另一个做法的DatabaseRealm] 的方式来进行密码校验，而不是上个知识点 [ssm] 中的那样用明文校验了。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.realm;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.codec.CodecException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.UnknownAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionService permissionService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//能进入到这里，表示账号已经通过验证了</span></span><br><span class="line">        String userName =(String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//通过service获取角色和权限</span></span><br><span class="line">        Set&lt;String&gt; permissions = permissionService.listPermissions(userName);</span><br><span class="line">        Set&lt;String&gt; roles = roleService.listRoleNames(userName);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//授权对象</span></span><br><span class="line">        SimpleAuthorizationInfo s = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//把通过service获取到的角色和权限放进去</span></span><br><span class="line">        s.setStringPermissions(permissions);</span><br><span class="line">        s.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取账号密码</span></span><br><span class="line">        UsernamePasswordToken t = (UsernamePasswordToken) token;</span><br><span class="line">        String userName= token.getPrincipal().toString();</span><br><span class="line">        <span class="comment">//获取数据库中的密码</span></span><br><span class="line">        User user =userService.getByName(userName);</span><br><span class="line">        String passwordInDB = user.getPassword();</span><br><span class="line">        String salt = user.getSalt();</span><br><span class="line">        <span class="comment">//认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm</span></span><br><span class="line">        <span class="comment">//盐也放进去</span></span><br><span class="line">        <span class="comment">//这样通过applicationContext-shiro.xml里配置的 HashedCredentialsMatcher 进行自动校验</span></span><br><span class="line">        SimpleAuthenticationInfo a = <span class="keyword">new</span> SimpleAuthenticationInfo(userName,passwordInDB,ByteSource.Util.bytes(salt),getName());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-23-applicationContext-shiro-xml"><a class="header-anchor" href="#步骤-23-applicationContext-shiro-xml">¶</a>步骤 23 : applicationContext-shiro.xml</h3>
<p>配合上个步骤[DatabaseRealm],做了 [shiro加密教程中的shiro.ini] 中做的事情<br>
设置密码匹配器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 密码匹配器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.authc.credential.HashedCredentialsMatcher"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashAlgorithmName"</span> <span class="attr">value</span>=<span class="string">"md5"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashIterations"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"storedCredentialsHexEncoded"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>让DatabaseRealm使用这个密码匹配器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"databaseRealm"</span> <span class="attr">class</span>=<span class="string">"com.how2java.realm.DatabaseRealm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">ref</span>=<span class="string">"credentialsMatcher"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只对业务功能进行权限管理，权限配置本身不需要没有做权限要求，这样做是为了不让初学者又要做业务的权限管理，又要做权限配置本身的权限管理，这样太过混乱</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/config/**=anon</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-4.0.xsd http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-4.0.xsd http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/util/spring-util.xsd"</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- 配置shiro的过滤器工厂类，id- shiroFilter要和我们在web.xml中配置的过滤器一致 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 调用我们配置的权限管理器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置我们的登录请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果您请求的资源不再您的权限范围，则跳转到/403请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/unauthorized"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 退出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">util:map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"logout"</span> <span class="attr">value-ref</span>=<span class="string">"logoutFilter"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 权限配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- anon表示此地址不需要任何权限即可访问 --&gt;</span></span><br><span class="line">                /login=anon</span><br><span class="line">                /index=anon</span><br><span class="line">                /static/**=anon</span><br><span class="line">                <span class="comment">&lt;!-- 只对业务功能进行权限管理，权限配置本身不需要没有做权限要求，这样做是为了不让初学者混淆 --&gt;</span></span><br><span class="line">                /config/**=anon</span><br><span class="line">                /doLogout=logout</span><br><span class="line">                <span class="comment">&lt;!--所有的请求(除去配置的静态资源请求或请求地址为anon的请求)都要通过登录验证,如果未登录则跳到/login --&gt;</span></span><br><span class="line">                /** = authc</span><br><span class="line">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 退出过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logoutFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.filter.authc.LogoutFilter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"redirectUrl"</span> <span class="attr">value</span>=<span class="string">"/index"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 会话ID生成器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdGenerator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话Cookie模板 关闭浏览器立即失效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.servlet.SimpleCookie"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"sid"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"httpOnly"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxAge"</span> <span class="attr">value</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话DAO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionDAO"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdGenerator"</span> <span class="attr">ref</span>=<span class="string">"sessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话验证调度器，每30分钟执行一次验证 ，设定会话超时及保存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interval"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionManager"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.session.mgt.DefaultWebSessionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全局会话超时时间（单位毫秒），默认30分钟 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"globalSessionTimeout"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deleteInvalidSessions"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationSchedulerEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span> <span class="attr">ref</span>=<span class="string">"sessionValidationScheduler"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionDAO"</span> <span class="attr">ref</span>=<span class="string">"sessionDAO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookieEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">ref</span>=<span class="string">"sessionIdCookie"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 安全管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"databaseRealm"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 相当于调用SecurityUtils.setSecurityManager(securityManager) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staticMethod"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"org.apache.shiro.SecurityUtils.setSecurityManager"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arguments"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 密码匹配器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.authc.credential.HashedCredentialsMatcher"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashAlgorithmName"</span> <span class="attr">value</span>=<span class="string">"md5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashIterations"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"storedCredentialsHexEncoded"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"databaseRealm"</span> <span class="attr">class</span>=<span class="string">"com.how2java.realm.DatabaseRealm"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">ref</span>=<span class="string">"credentialsMatcher"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- 保证实现了Shiro内部lifecycle函数的bean执行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-24-重启tomcat-访问测试"><a class="header-anchor" href="#步骤-24-重启tomcat-访问测试">¶</a>步骤 24 : 重启tomcat 访问测试</h3>
<p>重启Tomcat ，然后访问如下地址进行测试：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listUser</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-25-原业务功能"><a class="header-anchor" href="#步骤-25-原业务功能">¶</a>步骤 25 : 原业务功能</h3>
<p>原业务功能还是访问如下地址进行访问：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/index</span></span><br></pre></td></tr></table></figure>
<p>不过此时的权限还是通过注解@@RequiresPermissions 实现，而非动态url. 在下面知识点就会讲解动态url了</p>
<h2 id="8、SHIRO-基于-URL-配置动态权限"><a class="header-anchor" href="#8、SHIRO-基于-URL-配置动态权限">¶</a>8、SHIRO 基于 URL 配置动态权限</h2>
<h3 id="步骤-1-基于URL配置权限"><a class="header-anchor" href="#步骤-1-基于URL配置权限">¶</a>步骤 1 : 基于URL配置权限</h3>
<p>在本知识点就做到，如何通过URL配置来灵活设置权限，而不是非要在Controller里通过注解来做了</p>
<h3 id="步骤-2-表中数据"><a class="header-anchor" href="#步骤-2-表中数据">¶</a>步骤 2 : 表中数据</h3>
<p>在学习上个知识点[权限维护一套] 的过程中，同学们多半会自己修改表中数据，为了能够重现本知识点所演示的效果，请把下面数据再次导入到数据库中，否则因为数据不一致，演示的效果就会有出入，影响学习</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS shiro;</span><br><span class="line">CREATE DATABASE shiro DEFAULT CHARACTER SET utf8;</span><br><span class="line">USE shiro;</span><br><span class="line">    </span><br><span class="line">drop table if exists user;</span><br><span class="line">drop table if exists role;</span><br><span class="line">drop table if exists permission;</span><br><span class="line">drop table if exists user_role;</span><br><span class="line">drop table if exists role_permission;</span><br><span class="line">    </span><br><span class="line">create table user (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  password varchar(100),</span><br><span class="line">  salt varchar(100),</span><br><span class="line">  constraint pk_users primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  constraint pk_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  url varchar(100),</span><br><span class="line">  constraint pk_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table user_role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  uid bigint,</span><br><span class="line">  rid bigint,</span><br><span class="line">  constraint pk_users_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table role_permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  rid bigint,</span><br><span class="line">  pid bigint,</span><br><span class="line">  constraint pk_roles_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (1,&#39;addProduct&#39;,&#39;增加产品&#39;,&#39;&#x2F;addProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (2,&#39;deleteProduct&#39;,&#39;删除产品&#39;,&#39;&#x2F;deleteProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (3,&#39;editeProduct&#39;,&#39;编辑产品&#39;,&#39;&#x2F;editeProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (4,&#39;updateProduct&#39;,&#39;修改产品&#39;,&#39;&#x2F;updateProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (5,&#39;listProduct&#39;,&#39;查看产品&#39;,&#39;&#x2F;listProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (6,&#39;addOrder&#39;,&#39;增加订单&#39;,&#39;&#x2F;addOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (7,&#39;deleteOrder&#39;,&#39;删除订单&#39;,&#39;&#x2F;deleteOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (8,&#39;editeOrder&#39;,&#39;编辑订单&#39;,&#39;&#x2F;editeOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (9,&#39;updateOrder&#39;,&#39;修改订单&#39;,&#39;&#x2F;updateOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (10,&#39;listOrder&#39;,&#39;查看订单&#39;,&#39;&#x2F;listOrder&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (1,&#39;admin&#39;,&#39;超级管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (2,&#39;productManager&#39;,&#39;产品管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (3,&#39;orderManager&#39;,&#39;订单管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,1,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,1,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,1,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (4,1,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (5,1,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (6,1,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (7,1,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (8,1,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (9,1,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (10,1,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (11,2,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (12,2,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (13,2,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (14,2,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (15,2,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (50,3,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (51,3,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (52,3,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (53,3,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (54,3,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (55,3,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (56,5,11);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (1,&#39;zhang3&#39;,&#39;a7d59dfc5332749cb801f86a24f5f590&#39;,&#39;e5ykFiNwShfCXvBRPr3wXg&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (2,&#39;li4&#39;,&#39;43e28304197b9216e45ab1ce8dac831b&#39;,&#39;jPz19y7arvYIGhuUjsb6sQ&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (43,2,2);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (45,1,1);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-先运行，看到效果，再学习-v6"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v6">¶</a>步骤 3 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
通过如下地址登录：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/login</span></span><br></pre></td></tr></table></figure>
<p>登录之后，可以看到如图所示：<br>
zhang3因为是超级管理员admin, 有所有的权限，所以都能访问<br>
li4 因为是productManager，所以可以访问前两个产品相关权限的，但是不能访问第三个订单相关权限的地址<br>
而以上的做法，都<strong>不是通过固定写在方法上的注解实现</strong>的，而是通过权限灵活配置实现的</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7640.png" alt></p>
<h3 id="步骤-4-模仿和排错-v6"><a class="header-anchor" href="#步骤-4-模仿和排错-v6">¶</a>步骤 4 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-5-基于前面的知识点进行"><a class="header-anchor" href="#步骤-5-基于前面的知识点进行">¶</a>步骤 5 : 基于前面的知识点进行</h3>
<p>本知识点基于 [权限维护一套] 扩展出来，接下来讲解做了哪些工作达到这样的效果</p>
<h3 id="步骤-6-PageController-java"><a class="header-anchor" href="#步骤-6-PageController-java">¶</a>步骤 6 : PageController.java</h3>
<p>首先是PageController.java 里原本通过注解方式的@RequiresPermissions和@RequiresRoles 注释掉了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//专门用于显示页面的控制器</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageController</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"><span class="comment">//  @RequiresPermissions("deleteOrder")</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"deleteOrder"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//  @RequiresRoles("productManager")</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"deleteProduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteProduct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"deleteProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"listProduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">listProduct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/login"</span>,method=RequestMethod.GET) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"unauthorized"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">noPerms</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"unauthorized"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-PermissionService-java"><a class="header-anchor" href="#步骤-7-PermissionService-java">¶</a>步骤 7 : PermissionService.java</h3>
<p>增加了两个方法 needInterceptor，listPermissionURLs</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Permission permission)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Permission <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Permission permission)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">(Role role)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">needInterceptor</span><span class="params">(String requestURI)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissionURLs</span><span class="params">(String userName)</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-PermissionServiceImpl-java"><a class="header-anchor" href="#步骤-8-PermissionServiceImpl-java">¶</a>步骤 8 : PermissionServiceImpl.java</h3>
<p>为两个方法 needInterceptor，listPermissionURLs 增加了实现<br>
needInterceptor 表示是否要进行拦截，判断依据是如果访问的某个url,在权限系统里存在，就要进行拦截。 如果不存在，就放行了。<br>
这一种策略，也可以切换成另一个，即，访问的地址如果不存在于权限系统中，就提示没有拦截。 这两种做法没有对错之分，取决于业务上希望如何制定权限策略。</p>
<p>listPermissionURLs(User user) 用来获取某个用户所拥有的权限地址集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.PermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.mapper.RolePermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.PermissionExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermission;</span><br><span class="line"><span class="keyword">import</span> com.how2java.pojo.RolePermissionExample;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionServiceImpl</span> <span class="keyword">implements</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PermissionMapper permissionMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RoleService roleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RolePermissionMapper rolePermissionMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissions</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        List&lt;Role&gt; roles = roleService.listRoles(userName);</span><br><span class="line"> </span><br><span class="line">        List&lt;RolePermission&gt; rolePermissions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            RolePermissionExample example = <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">            example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">            List&lt;RolePermission&gt; rps = rolePermissionMapper.selectByExample(example);</span><br><span class="line">            rolePermissions.addAll(rps);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rolePermissions) &#123;</span><br><span class="line">            Permission p = permissionMapper.selectByPrimaryKey(rolePermission.getPid());</span><br><span class="line">            result.add(p.getName());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Permission u)</span> </span>&#123;</span><br><span class="line">        permissionMapper.insert(u);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        permissionMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Permission u)</span> </span>&#123;</span><br><span class="line">        permissionMapper.updateByPrimaryKeySelective(u);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Permission <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> permissionMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PermissionExample example = <span class="keyword">new</span> PermissionExample();</span><br><span class="line">        example.setOrderByClause(<span class="string">"id desc"</span>);</span><br><span class="line">        <span class="keyword">return</span> permissionMapper.selectByExample(example);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">list</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line">        List&lt;Permission&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        RolePermissionExample example = <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">        example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">        List&lt;RolePermission&gt; rps = rolePermissionMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rps) &#123;</span><br><span class="line">            result.add(permissionMapper.selectByPrimaryKey(rolePermission.getPid()));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">needInterceptor</span><span class="params">(String requestURI)</span> </span>&#123;</span><br><span class="line">        List&lt;Permission&gt; ps = list();</span><br><span class="line">        <span class="keyword">for</span> (Permission p : ps) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.getUrl().equals(requestURI))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">listPermissionURLs</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        List&lt;Role&gt; roles = roleService.listRoles(userName);</span><br><span class="line"> </span><br><span class="line">        List&lt;RolePermission&gt; rolePermissions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            RolePermissionExample example = <span class="keyword">new</span> RolePermissionExample();</span><br><span class="line">            example.createCriteria().andRidEqualTo(role.getId());</span><br><span class="line">            List&lt;RolePermission&gt; rps = rolePermissionMapper.selectByExample(example);</span><br><span class="line">            rolePermissions.addAll(rps);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (RolePermission rolePermission : rolePermissions) &#123;</span><br><span class="line">            Permission p = permissionMapper.selectByPrimaryKey(rolePermission.getPid());</span><br><span class="line">            result.add(p.getUrl());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-URLPathMatchingFilter-java"><a class="header-anchor" href="#步骤-9-URLPathMatchingFilter-java">¶</a>步骤 9 : URLPathMatchingFilter.java</h3>
<p>PathMatchingFilter 是shiro 内置过滤器 PathMatchingFilter 继承了这个它。<br>
基本思路如下：</p>
<ol>
<li>如果没登录就跳转到登录</li>
<li>如果当前访问路径没有在权限系统里维护，则允许访问</li>
<li>当前用户所拥有的权限如果不包含当前的访问地址，则跳转到/unauthorized，否则就允许访问</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.UnauthorizedException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.PathMatchingFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.util.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLPathMatchingFilter</span> <span class="keyword">extends</span> <span class="title">PathMatchingFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PermissionService permissionService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onPreHandle</span><span class="params">(ServletRequest request, ServletResponse response, Object mappedValue)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String requestURI = getPathWithinApplication(request);</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"requestURI:"</span> + requestURI);</span><br><span class="line"> </span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        <span class="comment">// 如果没有登录，就跳转到登录页面</span></span><br><span class="line">        <span class="keyword">if</span> (!subject.isAuthenticated()) &#123;</span><br><span class="line">            WebUtils.issueRedirect(request, response, <span class="string">"/login"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 看看这个路径权限里有没有维护，如果没有维护，一律放行(也可以改为一律不放行)</span></span><br><span class="line">        <span class="keyword">boolean</span> needInterceptor = permissionService.needInterceptor(requestURI);</span><br><span class="line">        <span class="keyword">if</span> (!needInterceptor) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> hasPermission = <span class="keyword">false</span>;</span><br><span class="line">            String userName = subject.getPrincipal().toString();</span><br><span class="line">            Set&lt;String&gt; permissionUrls = permissionService.listPermissionURLs(userName);</span><br><span class="line">            <span class="keyword">for</span> (String url : permissionUrls) &#123;</span><br><span class="line">                <span class="comment">// 这就表示当前用户有这个权限</span></span><br><span class="line">                <span class="keyword">if</span> (url.equals(requestURI)) &#123;</span><br><span class="line">                    hasPermission = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (hasPermission)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                UnauthorizedException ex = <span class="keyword">new</span> UnauthorizedException(<span class="string">"当前用户没有访问路径 "</span> + requestURI + <span class="string">" 的权限"</span>);</span><br><span class="line"> </span><br><span class="line">                subject.getSession().setAttribute(<span class="string">"ex"</span>, ex);</span><br><span class="line"> </span><br><span class="line">                WebUtils.issueRedirect(request, response, <span class="string">"/unauthorized"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-applicationContext-shiro-xml-v2"><a class="header-anchor" href="#步骤-10-applicationContext-shiro-xml-v2">¶</a>步骤 10 : applicationContext-shiro.xml</h3>
<p>首先声明URLPathMatchingFilter 过滤器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"urlPathMatchingFilter"</span> <span class="attr">class</span>=<span class="string">"com.how2java.filter.URLPathMatchingFilter"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在shiro中使用这个过滤器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"url"</span> <span class="attr">value-ref</span>=<span class="string">"urlPathMatchingFilter"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>过滤规则是所有访问</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/** = url</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-4.0.xsd http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-4.0.xsd http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/util/spring-util.xsd"</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- url过滤器 --&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"urlPathMatchingFilter"</span> <span class="attr">class</span>=<span class="string">"com.how2java.filter.URLPathMatchingFilter"</span>/&gt;</span></span><br><span class="line">          </span><br><span class="line">    <span class="comment">&lt;!-- 配置shiro的过滤器工厂类，id- shiroFilter要和我们在web.xml中配置的过滤器一致 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 调用我们配置的权限管理器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置我们的登录请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果您请求的资源不再您的权限范围，则跳转到/403请求地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/unauthorized"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 退出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">util:map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"logout"</span> <span class="attr">value-ref</span>=<span class="string">"logoutFilter"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"url"</span> <span class="attr">value-ref</span>=<span class="string">"urlPathMatchingFilter"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 权限配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- anon表示此地址不需要任何权限即可访问 --&gt;</span></span><br><span class="line">                /login=anon</span><br><span class="line">                /index=anon</span><br><span class="line">                /static/**=anon</span><br><span class="line">                <span class="comment">&lt;!-- 只对业务功能进行权限管理，权限配置本身不需要没有做权限要求，这样做是为了不让初学者混淆 --&gt;</span></span><br><span class="line">                /config/**=anon</span><br><span class="line">                /doLogout=logout</span><br><span class="line">                <span class="comment">&lt;!--所有的请求(除去配置的静态资源请求或请求地址为anon的请求)都要通过过滤器url --&gt;</span></span><br><span class="line">                /** = url</span><br><span class="line">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 退出过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logoutFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.filter.authc.LogoutFilter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"redirectUrl"</span> <span class="attr">value</span>=<span class="string">"/index"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 会话ID生成器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdGenerator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话Cookie模板 关闭浏览器立即失效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.servlet.SimpleCookie"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"sid"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"httpOnly"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxAge"</span> <span class="attr">value</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话DAO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionDAO"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdGenerator"</span> <span class="attr">ref</span>=<span class="string">"sessionIdGenerator"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话验证调度器，每30分钟执行一次验证 ，设定会话超时及保存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interval"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 会话管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionManager"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.session.mgt.DefaultWebSessionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全局会话超时时间（单位毫秒），默认30分钟 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"globalSessionTimeout"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deleteInvalidSessions"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationSchedulerEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionValidationScheduler"</span> <span class="attr">ref</span>=<span class="string">"sessionValidationScheduler"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionDAO"</span> <span class="attr">ref</span>=<span class="string">"sessionDAO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookieEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionIdCookie"</span> <span class="attr">ref</span>=<span class="string">"sessionIdCookie"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 安全管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"databaseRealm"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionManager"</span> <span class="attr">ref</span>=<span class="string">"sessionManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 相当于调用SecurityUtils.setSecurityManager(securityManager) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staticMethod"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"org.apache.shiro.SecurityUtils.setSecurityManager"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arguments"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 密码匹配器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.authc.credential.HashedCredentialsMatcher"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashAlgorithmName"</span> <span class="attr">value</span>=<span class="string">"md5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashIterations"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"storedCredentialsHexEncoded"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"databaseRealm"</span> <span class="attr">class</span>=<span class="string">"com.how2java.realm.DatabaseRealm"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">ref</span>=<span class="string">"credentialsMatcher"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- 保证实现了Shiro内部lifecycle函数的bean执行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-jsp-们"><a class="header-anchor" href="#步骤-11-jsp-们">¶</a>步骤 11 : jsp 们</h3>
<p>显示用的jsp做了些文字上的改动</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginDiv"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;a href="login"&gt;登录&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty subject.principal&#125;"</span>&gt;</span><br><span class="line">        &lt;span class="desc"&gt;你好，$&#123;subject.principal&#125;，&lt;/span&gt;</span><br><span class="line">        &lt;a href="doLogout"&gt;退出&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;a href="listProduct"&gt;查看产品&lt;/a&gt;&lt;span class="desc"&gt;(要有查看产品权限, zhang3有，li4 有)&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteProduct"&gt;删除产品&lt;/a&gt;&lt;span  class="desc"&gt;(要有删除产品权限, zhang3有，li4 有)&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href="deleteOrder"&gt;删除订单&lt;/a&gt;&lt;span class="desc"&gt;(要有删除订单权限, zhang3有，li4没有)&lt;/span&gt;&lt;br&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteOrder.jsp，能进来&lt;br&gt;就表示拥有 deleteOrder 权限</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    deleteProduct.jsp，能进来&lt;br&gt;就表示拥有 deleteProduct 权限</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"static/css/style.css"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingroom"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    listProduct.jsp，能进来&lt;br&gt;就表示拥有 listProduct 权限</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-重启Tomcat测试"><a class="header-anchor" href="#步骤-12-重启Tomcat测试">¶</a>步骤 12 : 重启Tomcat测试</h3>
<p>重启Tomcat测试，业务测试地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/index</span></span><br></pre></td></tr></table></figure>
<p>权限配置测试地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listUser</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-关于角色"><a class="header-anchor" href="#步骤-13-关于角色">¶</a>步骤 13 : 关于角色</h3>
<p>在本知识点中，权限通过url进行灵活配置了。 但是角色还没有和url对应起来。 为什么不把角色也对应起来呢？<br>
从代码开发的角度讲是可以做的，无非就是在 role表上增加一个url 字段。 但是从权限管理本身的角度看，当一个url 既对应权限表的数据，又对应角色表的数据，反而容易产生混淆。<br>
反倒是现在这种，url地址，仅仅和权限表关联起来，在逻辑上明晰简单，也更容易维护。 所以就放弃了角色表也进行url维护的做法了。</p>
<h2 id="9、在-SPRINGBOOT-中整合-SHIRO"><a class="header-anchor" href="#9、在-SPRINGBOOT-中整合-SHIRO">¶</a>9、在 SPRINGBOOT 中整合 SHIRO</h2>
<h3 id="步骤-1-springboot-概念"><a class="header-anchor" href="#步骤-1-springboot-概念">¶</a>步骤 1 : springboot 概念</h3>
<p>springboot 作为一个框架集成，把ssm的配置都简化了。<br>
如果没有springboot基础，请事先学习 [springboot 入门]</p>
<h3 id="步骤-2-数据"><a class="header-anchor" href="#步骤-2-数据">¶</a>步骤 2 : 数据</h3>
<p>通过前面的学习，数据估计又被修改了，执行下面这部分sql语句，还原数据，以便观察演示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS shiro;</span><br><span class="line">CREATE DATABASE shiro DEFAULT CHARACTER SET utf8;</span><br><span class="line">USE shiro;</span><br><span class="line">    </span><br><span class="line">drop table if exists user;</span><br><span class="line">drop table if exists role;</span><br><span class="line">drop table if exists permission;</span><br><span class="line">drop table if exists user_role;</span><br><span class="line">drop table if exists role_permission;</span><br><span class="line">    </span><br><span class="line">create table user (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  password varchar(100),</span><br><span class="line">  salt varchar(100),</span><br><span class="line">  constraint pk_users primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  constraint pk_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  name varchar(100),</span><br><span class="line">  desc_ varchar(100),</span><br><span class="line">  url varchar(100),</span><br><span class="line">  constraint pk_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table user_role (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  uid bigint,</span><br><span class="line">  rid bigint,</span><br><span class="line">  constraint pk_users_roles primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line">    </span><br><span class="line">create table role_permission (</span><br><span class="line">  id bigint auto_increment,</span><br><span class="line">  rid bigint,</span><br><span class="line">  pid bigint,</span><br><span class="line">  constraint pk_roles_permissions primary key(id)</span><br><span class="line">) charset&#x3D;utf8 ENGINE&#x3D;InnoDB;</span><br><span class="line"> </span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (1,&#39;addProduct&#39;,&#39;增加产品&#39;,&#39;&#x2F;addProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (2,&#39;deleteProduct&#39;,&#39;删除产品&#39;,&#39;&#x2F;deleteProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (3,&#39;editeProduct&#39;,&#39;编辑产品&#39;,&#39;&#x2F;editeProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (4,&#39;updateProduct&#39;,&#39;修改产品&#39;,&#39;&#x2F;updateProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (5,&#39;listProduct&#39;,&#39;查看产品&#39;,&#39;&#x2F;listProduct&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (6,&#39;addOrder&#39;,&#39;增加订单&#39;,&#39;&#x2F;addOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (7,&#39;deleteOrder&#39;,&#39;删除订单&#39;,&#39;&#x2F;deleteOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (8,&#39;editeOrder&#39;,&#39;编辑订单&#39;,&#39;&#x2F;editeOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (9,&#39;updateOrder&#39;,&#39;修改订单&#39;,&#39;&#x2F;updateOrder&#39;);</span><br><span class="line">INSERT INTO &#96;permission&#96; VALUES (10,&#39;listOrder&#39;,&#39;查看订单&#39;,&#39;&#x2F;listOrder&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (1,&#39;admin&#39;,&#39;超级管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (2,&#39;productManager&#39;,&#39;产品管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role&#96; VALUES (3,&#39;orderManager&#39;,&#39;订单管理员&#39;);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (1,1,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (2,1,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (3,1,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (4,1,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (5,1,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (6,1,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (7,1,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (8,1,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (9,1,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (10,1,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (11,2,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (12,2,2);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (13,2,3);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (14,2,4);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (15,2,5);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (50,3,10);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (51,3,9);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (52,3,8);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (53,3,7);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (54,3,6);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (55,3,1);</span><br><span class="line">INSERT INTO &#96;role_permission&#96; VALUES (56,5,11);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (1,&#39;zhang3&#39;,&#39;a7d59dfc5332749cb801f86a24f5f590&#39;,&#39;e5ykFiNwShfCXvBRPr3wXg&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user&#96; VALUES (2,&#39;li4&#39;,&#39;43e28304197b9216e45ab1ce8dac831b&#39;,&#39;jPz19y7arvYIGhuUjsb6sQ&#x3D;&#x3D;&#39;);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (43,2,2);</span><br><span class="line">INSERT INTO &#96;user_role&#96; VALUES (45,1,1);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-先运行，看到效果，再学习-v7"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习-v7">¶</a>步骤 3 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
启动Application类，然后访问业务地址进行测试：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/index</span></span><br></pre></td></tr></table></figure>
<p>权限配置地址,进行权限设置：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listUser</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-模仿和排错-v7"><a class="header-anchor" href="#步骤-4-模仿和排错-v7">¶</a>步骤 4 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-5-运用前面的文件"><a class="header-anchor" href="#步骤-5-运用前面的文件">¶</a>步骤 5 : 运用前面的文件</h3>
<p>springboot，说到底，也就是配置方式变化了，该要的类，都要有，该要的jsp，也都要有。 所以本知识点会运用[基于URL配置权限] 中的源代码进行改进，一些要调整的地方会重点说一说</p>
<h3 id="步骤-6-创建项目"><a class="header-anchor" href="#步骤-6-创建项目">¶</a>步骤 6 : 创建项目</h3>
<p>首先新建个 maven 项目<br>
菜单 -&gt; File -&gt; New -&gt; Other -&gt; Maven -&gt; Maven -&gt; Maven Project -&gt; New Maven Project<br>
勾上这个 Create a simple project (skip archetype selection), 看吧，Springboot就是个简单的maven 项目</p>
<p><strong>注：</strong> 这里用的是eclipse的，idea的做法请看[ springboot-idea入门]</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7663.png" alt></p>
<h3 id="步骤-7-输入项目参数"><a class="header-anchor" href="#步骤-7-输入项目参数">¶</a>步骤 7 : 输入项目参数</h3>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7672.png" alt></p>
<h3 id="步骤-8-pom-xml"><a class="header-anchor" href="#步骤-8-pom-xml">¶</a>步骤 8 : pom.xml</h3>
<p>修改pom.xml， 修改之后，记得刷新一下maven. 刷新办法： 项目右键-&gt;Maven-&gt;Update Project。<br>
这个pom.xml里就提供了本项目需要的各种jar包</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7664.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.how2java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>shiro<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>shiro<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- servlet依赖. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tomcat的支持.--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> <span class="comment">&lt;!-- 这个需要为 true 热部署才有效 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">&lt;!-- mybatis 逆向工程 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">&lt;!-- shiro --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                 </span><br><span class="line">        <span class="comment">&lt;!-- shiro-web --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-application-properties"><a class="header-anchor" href="#步骤-9-application-properties">¶</a>步骤 9 : application.properties</h3>
<p>在resources目录下新建文件application.properties<br>
这里就提供了数据库链接参数， jsp重定位位置， mybatis配置以及项目访问的时候需要加上一个/shiro, 这样才和前面的教程保持一致。</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7665.png" alt></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span></span><br><span class="line"><span class="meta">spring.mvc.view.suffix</span>=<span class="string">.jsp</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/shiro?characterEncoding=UTF-8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:com/how2java/mapper/*.xml</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span>=<span class="string">com.how2java.pojo</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">server.context-path</span>=<span class="string">/shiro</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-Application-java"><a class="header-anchor" href="#步骤-10-Application-java">¶</a>步骤 10 : Application.java</h3>
<p>这个是启动类。 需要注意几点：</p>
<ol>
<li>
<p>包一定要放在com.how2java 下，因为其他包，比如mapper,service什么的都是基于这个包名，SpringBoot会根据这个启动类所处与的包名去搜索其他类。 如果放其他包名下面，会折腾死个人的。</p>
</li>
<li>
<p>还要通过这种方式指定mapper的位置，不然就找不到。 妈蛋~ 虽然[application.properties] 里指定了扫描mapper的位置，但是他是不听啊~ 这个也折腾了我很久~</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.how2java.mapper"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.how2java.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-src-下的-java-文件们"><a class="header-anchor" href="#步骤-11-src-下的-java-文件们">¶</a>步骤 11 : src 下的 java 文件们</h3>
<p>然后就是上一个知识点[基于URL配置权限] 下载的项目里的src下的源代码。 仅仅是java源代码， 什么.xml, .properties等文件就不要了。<br>
下载后，解压，然后把里面的src下的java源代码都复制过来。<br>
复制过来后，记得刷新一下项目才看得到。<br>
这些文件用用途在前面的知识点已经讲过了，这里就不再赘述，否则本页起码要有40个步骤，太过眼花缭乱。<br>
所以，没有学习前面知识点的同学，还是回过头去学习一边，里面每个类的讲解也更加清晰详细</p>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7667.png" alt></p>
<h3 id="步骤-12-jsp们"><a class="header-anchor" href="#步骤-12-jsp们">¶</a>步骤 12 : jsp们</h3>
<p>然后就是jsp也复制过来。需要注意几点</p>
<ol>
<li>WEB-INF目录要自己建</li>
<li>web.xml 文件不用复制</li>
<li>lib 目录不用复制</li>
<li>static 目录要复制过来</li>
</ol>
<p><img src="/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/7668.png" alt></p>
<h3 id="步骤-13-ShiroConfiguration"><a class="header-anchor" href="#步骤-13-ShiroConfiguration">¶</a>步骤 13 : ShiroConfiguration</h3>
<p>接着就是Shiro配置了。<br>
按照Springboot的尿性，配置文件不要了， 用类来做。。。其实不是一样的么，还没有配置文件可读性强呢。。。<br>
哎，咱们也这样做吧，以后看别人的springboot项目看得懂。<br>
ShiroConfiguration 这个类就是shiro配置类，类名怎么命名都可以，就是要用@Configuration 注解表示它是一个配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LifecycleBeanPostProcessor <span class="title">getLifecycleBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LifecycleBeanPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种写法就和 [applicationContext-shiro.xml] 中的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>是同一个作用，只要用@Bean 注解了，就表示是被spring管理起来的对象了。</p>
<p>这个类里面就声明了SecurityManager,DatabaseRealm, HashedCredentialsMatcher，ShiroFilterFactoryBean 等等东西，只是写法变化了，其实和配置文件里是一样的。<br>
需要注意一点，URLPathMatchingFilter 并没有用@Bean管理起来。 原因是Shiro的bug, 这个也是过滤器，ShiroFilterFactoryBean 也是过滤器，当他们都出现的时候，默认的什么anno,authc,logout过滤器就失效了。所以不能把他声明为@Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> URLPathMatchingFilter <span class="title">getURLPathMatchingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> URLPathMatchingFilter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.shiro;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.LifecycleBeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.filter.URLPathMatchingFilter;</span><br><span class="line"><span class="keyword">import</span> com.how2java.realm.DatabaseRealm;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LifecycleBeanPostProcessor <span class="title">getLifecycleBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LifecycleBeanPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ShiroFilterFactoryBean 处理拦截资源文件问题。</span></span><br><span class="line"><span class="comment">     * 注意：单独一个ShiroFilterFactoryBean配置是或报错的，因为在</span></span><br><span class="line"><span class="comment">     * 初始化ShiroFilterFactoryBean的时候需要注入：SecurityManager</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     Filter Chain定义说明</span></span><br><span class="line"><span class="comment">     1、一个URL可以配置多个Filter，使用逗号分隔</span></span><br><span class="line"><span class="comment">     2、当设置多个过滤器时，全部验证通过，才视为通过</span></span><br><span class="line"><span class="comment">     3、部分过滤器可指定参数，如perms，roles</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shirFilter</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ShiroConfiguration.shirFilter()"</span>);</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean  = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 必须设置 SecurityManager</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">// 如果不设置默认会自动寻找Web工程根目录下的"/login.jsp"页面</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">"/login"</span>);</span><br><span class="line">        <span class="comment">// 登录成功后要跳转的链接</span></span><br><span class="line">        shiroFilterFactoryBean.setSuccessUrl(<span class="string">"/index"</span>);</span><br><span class="line">        <span class="comment">//未授权界面;</span></span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">"/unauthorized"</span>);</span><br><span class="line">        <span class="comment">//拦截器.</span></span><br><span class="line">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class="keyword">new</span> LinkedHashMap&lt;String,String&gt;();</span><br><span class="line">        <span class="comment">//自定义拦截器</span></span><br><span class="line">        Map&lt;String, Filter&gt; customisedFilter = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        customisedFilter.put(<span class="string">"url"</span>, getURLPathMatchingFilter());</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//配置映射关系</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/login"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/index"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/static/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/config/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/doLogout"</span>, <span class="string">"logout"</span>);;</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/**"</span>, <span class="string">"url"</span>);</span><br><span class="line">        shiroFilterFactoryBean.setFilters(customisedFilter);</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> URLPathMatchingFilter <span class="title">getURLPathMatchingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> URLPathMatchingFilter();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityManager <span class="title">securityManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager =  <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">//设置realm.</span></span><br><span class="line">        securityManager.setRealm(getDatabaseRealm());</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DatabaseRealm <span class="title">getDatabaseRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DatabaseRealm myShiroRealm = <span class="keyword">new</span> DatabaseRealm();</span><br><span class="line">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class="line">        <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 凭证匹配器</span></span><br><span class="line"><span class="comment">     * （由于我们的密码校验交给Shiro的SimpleAuthenticationInfo进行处理了</span></span><br><span class="line"><span class="comment">     *  所以我们需要修改下doGetAuthenticationInfo中的代码;</span></span><br><span class="line"><span class="comment">     * ）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line"> </span><br><span class="line">        hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">"md5"</span>);<span class="comment">//散列算法:这里使用MD5算法;</span></span><br><span class="line">        hashedCredentialsMatcher.setHashIterations(<span class="number">2</span>);<span class="comment">//散列的次数，比如散列两次，相当于 md5(md5(""));</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> hashedCredentialsMatcher;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  开启shiro aop注解支持.</span></span><br><span class="line"><span class="comment">     *  使用代理方式;所以需要开启代码支持;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> securityManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-SpringContextUtils-java"><a class="header-anchor" href="#步骤-14-SpringContextUtils-java">¶</a>步骤 14 : SpringContextUtils.java</h3>
<p>继续上面的知识点，因为URLPathMatchingFilter 没有被声明为@Bean, 那么换句话说 URLPathMatchingFilter 就没有被Spring管理起来，那么也就无法在里面注入 PermissionService类了。<br>
但是在业务上URLPathMatchingFilter 里面又必须使用PermissionService类，怎么办呢? 就借助SpringContextUtils 这个工具类，来获取PermissionService的实例。<br>
这里提供工具类，下个步骤讲解如何使用这个工具类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.util;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringContextUtils</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext context; </span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext context)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123; </span><br><span class="line">        SpringContextUtils.context = context; </span><br><span class="line">    &#125; </span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getContext</span><span class="params">()</span></span>&#123; </span><br><span class="line">        <span class="keyword">return</span> context; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-URLPathMatchingFilter-java"><a class="header-anchor" href="#步骤-15-URLPathMatchingFilter-java">¶</a>步骤 15 : URLPathMatchingFilter.java</h3>
<p>因为前面两个步骤的原因，既不能把 URLPathMatchingFilter.java 作为@Bean管理起来，又需要在里面使用 PermissionService，所以就用上一步的工具类 [SpringContextUtils.java]，通过如下方式获取 PermissionService了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permissionService = SpringContextUtils.getContext().getBean(PermissionService<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.UnauthorizedException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.PathMatchingFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.util.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.service.impl.PermissionServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.util.SpringContextUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLPathMatchingFilter</span> <span class="keyword">extends</span> <span class="title">PathMatchingFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PermissionService permissionService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onPreHandle</span><span class="params">(ServletRequest request, ServletResponse response, Object mappedValue)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==permissionService)</span><br><span class="line">            permissionService = SpringContextUtils.getContext().getBean(PermissionService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">         </span><br><span class="line">        String requestURI = getPathWithinApplication(request);</span><br><span class="line">        System.out.println(<span class="string">"requestURI:"</span> + requestURI);</span><br><span class="line"> </span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        <span class="comment">// 如果没有登录，就跳转到登录页面</span></span><br><span class="line">        <span class="keyword">if</span> (!subject.isAuthenticated()) &#123;</span><br><span class="line">            WebUtils.issueRedirect(request, response, <span class="string">"/login"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 看看这个路径权限里有没有维护，如果没有维护，一律放行(也可以改为一律不放行)</span></span><br><span class="line">        System.out.println(<span class="string">"permissionService:"</span>+permissionService);</span><br><span class="line">        <span class="keyword">boolean</span> needInterceptor = permissionService.needInterceptor(requestURI);</span><br><span class="line">        <span class="keyword">if</span> (!needInterceptor) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> hasPermission = <span class="keyword">false</span>;</span><br><span class="line">            String userName = subject.getPrincipal().toString();</span><br><span class="line">            Set&lt;String&gt; permissionUrls = permissionService.listPermissionURLs(userName);</span><br><span class="line">            <span class="keyword">for</span> (String url : permissionUrls) &#123;</span><br><span class="line">                <span class="comment">// 这就表示当前用户有这个权限</span></span><br><span class="line">                <span class="keyword">if</span> (url.equals(requestURI)) &#123;</span><br><span class="line">                    hasPermission = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (hasPermission)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                UnauthorizedException ex = <span class="keyword">new</span> UnauthorizedException(<span class="string">"当前用户没有访问路径 "</span> + requestURI + <span class="string">" 的权限"</span>);</span><br><span class="line"> </span><br><span class="line">                subject.getSession().setAttribute(<span class="string">"ex"</span>, ex);</span><br><span class="line"> </span><br><span class="line">                WebUtils.issueRedirect(request, response, <span class="string">"/unauthorized"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-重启后测试"><a class="header-anchor" href="#步骤-16-重启后测试">¶</a>步骤 16 : 重启后测试</h3>
<p>重新启动Application类，然后访问业务地址进行测试：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/index</span></span><br></pre></td></tr></table></figure>
<p>权限配置地址,进行权限设置：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/shiro/config/listUser</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    <div>
     
         <div>
 
  <div style="text-align:center;color:#bfbfbf;font-size:16px;">
   <span>-------- 本文结束 </span>
   <i class="fa fa-paw"></i>
   <span> 感谢阅读 --------</span>
  </div>
 
</div>
     
    </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="潇 卟 甸 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="潇 卟 甸 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <!-- JS库 clipboard 拷贝内容到粘贴板-->
<script src="https://cdn.bootcss.com/clipboard.js/2.0.1/clipboard.min.js"></script>

<!-- JS库 sweetalert 显示提示信息-->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<ul class="post-copyright">
<!-- 本文标题 -->
<li>
  <strong>本文标题： </strong>
  工具和中间件【HOW2J】
</li>

<!-- 本文作者 -->
<li class="post-copyright-author">
  <strong>本文作者： </strong>
  
</li>

<!-- 创建时间 -->
<li>
  <strong>创建时间： </strong>
  2020年09月22日 - 17时09分
</li>

<!-- 修改时间 -->
<li>
  <strong>修改时间： </strong>
  2021年04月19日 - 12时04分
</li>

<!-- 引用链接 -->
<li class="post-copyright-link">
  <strong>本文链接：</strong>
  <a href="http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/" title="工具和中间件【HOW2J】"
    >http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/</a
  >
  <span class="copy-path" title="点击复制引用链接"
    ><i
      style="cursor: pointer"
      class="fa fa-clipboard"
      data-clipboard-text="['s Blog | 工具和中间件【HOW2J】](http://yoursite.com/2020/09/22/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6%E3%80%90HOW2J%E3%80%91/)"
      aria-label="复制成功"
    ></i
  ></span>
</li>

<!-- 版权声明 -->
<li class="post-copyright-license">
  <strong
    >版权声明：
  </strong>
  本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
</li>
</ul>

<script>
var clipboard = new ClipboardJS(".fa-clipboard");
clipboard.on("success", function(target) {
  var message = document.createElement("div");
  message.innerHTML =
    '<i class="fa fa-check-circle message-icon"></i><span class="message-content">' +
    target.trigger.getAttribute("aria-label") +
    "</span>";
  swal({
    content: message,
    className: "copy-success-message",
    timer: 1000,
    button: false
  });
});
</script>
      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 编程</a>
          
            <a href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag"><i class="fa fa-tag"></i> 源代码</a>
          
            <a href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag"><i class="fa fa-tag"></i> Java实践</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/09/08/Java%E6%A1%86%E6%9E%B6%E3%80%90HOW2J%E3%80%91/" rel="next" title="Java框架【HOW2J】">
                <i class="fa fa-chevron-left"></i> Java框架【HOW2J】
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/03/10/Java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%EF%BC%88%E5%8D%B7%E4%BA%8C%EF%BC%89/" rel="prev" title="Java核心技术（卷二）">
                Java核心技术（卷二） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <a href="/">
              <img class="site-author-image" itemprop="image"
                src="/uploads/picture.jpg"
                alt="潇 卟 甸" />
              </a>
            
              <p class="site-author-name" itemprop="name">潇 卟 甸</p>
              <p class="site-description motion-element" itemprop="description">总结自己一些知识，一些事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

			
				<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
				<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
				<div class="widget-wrap">
					<div id="myCanvasContainer" class="widget tagcloud">
						<canvas width="250" height="250" id="resCanvas" style="width=100%">
							<ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">48</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag">Java实践</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/b%E7%AB%99%E8%A7%86%E9%A2%91/" rel="tag">b站视频</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E7%BA%A7/" rel="tag">中级</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85/" rel="tag">喜马拉雅</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E8%AF%AD/" rel="tag">日语</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag">源代码</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">电子书</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a><span class="tag-list-count">62</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BE%8E%E5%8C%96/" rel="tag">美化</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD/" rel="tag">英语</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" rel="tag">计算机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E6%8E%A8%E8%8D%90/" rel="tag">读书推荐</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E9%98%B6/" rel="tag">进阶</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">3</span></li></ul>
						</canvas>
					</div>
				</div>
			

          </nav>

          

          
		  
		  <!-- 添加近期文章 -->
			
				<div class="links-of-blogroll motion-element links-of-blogroll-block">
				<div class="links-of-blogroll-title">
				<!-- modify icon to fire by szw -->
				<i class="fa fa-history fa-" aria-hidden="true"></i>
				近期文章
				</div>
				<ul class="links-of-blogroll-list">
				
				
					<li>
					<a href="/2021/08/10/%E5%B0%9A%E7%A1%85%E8%B0%B7-%E7%AC%AC3%E5%AD%A3%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%90Java%E5%AD%A6%E7%A7%91%E3%80%91/" title="尚硅谷-第3季面试题【Java学科】" target="_blank">尚硅谷-第3季面试题【Java学科】</a>
					</li>
				
					<li>
					<a href="/2021/08/05/%E5%B0%9A%E7%A1%85%E8%B0%B7-%E7%AC%AC2%E5%AD%A3%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%90Java%E5%AD%A6%E7%A7%91%E3%80%91/" title="尚硅谷-第2季面试题【Java学科】" target="_blank">尚硅谷-第2季面试题【Java学科】</a>
					</li>
				
					<li>
					<a href="/2021/08/04/%E5%B0%9A%E7%A1%85%E8%B0%B7-%E7%AC%AC1%E5%AD%A3%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%90Java%E5%AD%A6%E7%A7%91%E3%80%91/" title="尚硅谷-第1季面试题【Java学科】" target="_blank">尚硅谷-第1季面试题【Java学科】</a>
					</li>
				
					<li>
					<a href="/2021/07/28/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/" title="尚硅谷-SpringCloud教程" target="_blank">尚硅谷-SpringCloud教程</a>
					</li>
				
					<li>
					<a href="/2021/07/26/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringBoot2%E6%95%99%E7%A8%8B/" title="尚硅谷-SpringBoot2教程" target="_blank">尚硅谷-SpringBoot2教程</a>
					</li>
				
				</ul>
			</div>
			

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sushan102.top/posts/1410804403/" title="博客搭建" target="_blank">博客搭建</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://how2j.cn?p=154642" title="HOW2J" target="_blank">HOW2J</a>
                  </li>
                
              </ul>
            </div>
          
		  
		  
			
		  
		  <div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>


        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、Maven"><span class="nav-text">一、Maven</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、什么是MAVEN"><span class="nav-text">1、什么是MAVEN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-什么是Maven"><span class="nav-text">步骤 1 : 什么是Maven</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-Maven-主要用处一：相同的项目结构"><span class="nav-text">步骤 2 : Maven 主要用处一：相同的项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-Maven-主要用处二：统一维护jar包"><span class="nav-text">步骤 3 : Maven 主要用处二：统一维护jar包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、下载与配置MAVEN"><span class="nav-text">2、下载与配置MAVEN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-下载"><span class="nav-text">步骤 1 : 下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-配置环境变量"><span class="nav-text">步骤 2 : 配置环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-检验版本"><span class="nav-text">步骤 3 : 检验版本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、仓库概念，下载与配置"><span class="nav-text">3、仓库概念，下载与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-仓库概念"><span class="nav-text">步骤 1 : 仓库概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-仓库默认位置"><span class="nav-text">步骤 2 : 仓库默认位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-默认下载路径"><span class="nav-text">步骤 3 : 默认下载路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-使用阿里云下载路径"><span class="nav-text">步骤 4 : 使用阿里云下载路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-修改仓库位置"><span class="nav-text">步骤 5 : 修改仓库位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-使用现成的仓库"><span class="nav-text">步骤 6 : 使用现成的仓库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、通过命令行创建MAVEN风格的JAVA项目"><span class="nav-text">4、通过命令行创建MAVEN风格的JAVA项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-关于Maven风格的Java项目"><span class="nav-text">步骤 1 : 关于Maven风格的Java项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-切换到项目目录"><span class="nav-text">步骤 2 : 切换到项目目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-创建maven项目"><span class="nav-text">步骤 3 : 创建maven项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-项目结构"><span class="nav-text">步骤 4 : 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-运行package命令"><span class="nav-text">步骤 5 : 运行package命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-执行Jar"><span class="nav-text">步骤 6 : 执行Jar</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、ECLIPSE中的MAVEN设置"><span class="nav-text">5、ECLIPSE中的MAVEN设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-集成MAVEN"><span class="nav-text">步骤 1 : 集成MAVEN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-设置MAVEN路径"><span class="nav-text">步骤 2 : 设置MAVEN路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-设置仓库路径"><span class="nav-text">步骤 3 : 设置仓库路径</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、ECLIPSE下创建MAVEN风格的JAVA项目"><span class="nav-text">6、ECLIPSE下创建MAVEN风格的JAVA项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-删除j2se目录"><span class="nav-text">步骤 1 : 删除j2se目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-新建Maven-项目"><span class="nav-text">步骤 2 : 新建Maven 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-这个界面点下一步"><span class="nav-text">步骤 3 : 这个界面点下一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-这个界面使用默认的选项，点下一步"><span class="nav-text">步骤 4 : 这个界面使用默认的选项，点下一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-这一步填写如图所示的信息"><span class="nav-text">步骤 5 : 这一步填写如图所示的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-运行App"><span class="nav-text">步骤 6 : 运行App</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、如何添加第三方JAR包"><span class="nav-text">7、如何添加第三方JAR包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-Maven项目用到第三方jar"><span class="nav-text">步骤 1 : Maven项目用到第三方jar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-修改App"><span class="nav-text">步骤 2 : 修改App</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-给maven项目添加jar"><span class="nav-text">步骤 3 : 给maven项目添加jar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-保存再执行"><span class="nav-text">步骤 4 : 保存再执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-重建本地仓库"><span class="nav-text">步骤 5 : 重建本地仓库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、用命令行创建MAVEN风格的JAVA-WEB项目"><span class="nav-text">8、用命令行创建MAVEN风格的JAVA WEB项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-关于Maven风格的Web项目"><span class="nav-text">步骤 1 : 关于Maven风格的Web项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-创建命令"><span class="nav-text">步骤 2 : 创建命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-目录结构"><span class="nav-text">步骤 3 : 目录结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、在ECLIPSE中创建MAVEN风格的JAVA-WEB项目"><span class="nav-text">9、在ECLIPSE中创建MAVEN风格的JAVA WEB项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-删除j2ee目录"><span class="nav-text">步骤 1 : 删除j2ee目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-新建Maven-项目-v2"><span class="nav-text">步骤 2 : 新建Maven 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-这个界面点下一步-v2"><span class="nav-text">步骤 3 : 这个界面点下一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-这个界面使用webapp，点下一步"><span class="nav-text">步骤 4 : 这个界面使用webapp，点下一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-这一步填写如图所示的信息-v2"><span class="nav-text">步骤 5 : 这一步填写如图所示的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-此时得到的maven-web-项目的问题"><span class="nav-text">步骤 6 : 此时得到的maven web 项目的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-创建java-源代码目录"><span class="nav-text">步骤 7 : 创建java 源代码目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-java源文件目录创建好了"><span class="nav-text">步骤 8 : java源文件目录创建好了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-通过pom-xml添加servlet-jar包"><span class="nav-text">步骤 9 : 通过pom.xml添加servlet jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-添加好之后，index-jsp也不报错了"><span class="nav-text">步骤 10 : 添加好之后，index.jsp也不报错了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-通过eclipse内置tomcat启动"><span class="nav-text">步骤 11 : 通过eclipse内置tomcat启动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、使用ECLIPSE创建一个MAVEN风格的SSM项目"><span class="nav-text">10、使用ECLIPSE创建一个MAVEN风格的SSM项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-基于前面的知识点"><span class="nav-text">步骤 1 : 基于前面的知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-创建maven-web项目"><span class="nav-text">步骤 2 : 创建maven web项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-设置项目目录"><span class="nav-text">步骤 3 : 设置项目目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-选择Archetype"><span class="nav-text">步骤 4 : 选择Archetype</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-设置GroupId和Artifact-Id"><span class="nav-text">步骤 5 : 设置GroupId和Artifact Id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-项目截图"><span class="nav-text">步骤 6 : 项目截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-创建java-源代码目录-v2"><span class="nav-text">步骤 7 : 创建java 源代码目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-java源文件目录创建好了-v2"><span class="nav-text">步骤 8 : java源文件目录创建好了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-pom-xml"><span class="nav-text">步骤 9 : pom.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-接着复制项目文件"><span class="nav-text">步骤 10 : 接着复制项目文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-web-xml"><span class="nav-text">步骤 11 : web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-jsp-目录"><span class="nav-text">步骤 12 : jsp 目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-配置文件"><span class="nav-text">步骤 13 : 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-java源代码"><span class="nav-text">步骤 14 : java源代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-关于Category-xml"><span class="nav-text">步骤 15 : 关于Category.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-启动Tomcat"><span class="nav-text">步骤 16 : 启动Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-访问测试地址"><span class="nav-text">步骤 17 : 访问测试地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-18-可运行项目"><span class="nav-text">步骤 18 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、使用ECLIPSE导入一个MAVEN风格的SSM项目"><span class="nav-text">11、使用ECLIPSE导入一个MAVEN风格的SSM项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-介绍"><span class="nav-text">步骤 1 : 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-下载右上角的可运行项目"><span class="nav-text">步骤 2 : 下载右上角的可运行项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-导入项目"><span class="nav-text">步骤 3 : 导入项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-启动Tomcat"><span class="nav-text">步骤 4 : 启动Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-测试"><span class="nav-text">步骤 5 : 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、INTELLIJ-IDEA"><span class="nav-text">12、INTELLIJ IDEA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-Intellij-IDEA"><span class="nav-text">步骤 1 : Intellij IDEA</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、ECLIPSE-中创建父子-聚合项目"><span class="nav-text">13、ECLIPSE 中创建父子-聚合项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-父子-聚合项目"><span class="nav-text">步骤 1 : 父子-聚合项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-创建父项目"><span class="nav-text">步骤 2 : 创建父项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-选择简单项目"><span class="nav-text">步骤 3 : 选择简单项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-输入参数"><span class="nav-text">步骤 4 : 输入参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-parentMavenProject-的-pom-xml"><span class="nav-text">步骤 5 : parentMavenProject 的 pom.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-update-maven"><span class="nav-text">步骤 6 : update maven</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-创建子项目"><span class="nav-text">步骤 7 : 创建子项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-简单项目"><span class="nav-text">步骤 8 : 简单项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-项目参数"><span class="nav-text">步骤 9 : 项目参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-TestHutool"><span class="nav-text">步骤 10 : TestHutool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-子项目的pom-xml"><span class="nav-text">步骤 11 : 子项目的pom.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-父项目的pom-xml"><span class="nav-text">步骤 12 : 父项目的pom.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-目录结构"><span class="nav-text">步骤 13 : 目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-可运行项目"><span class="nav-text">步骤 14 : 可运行项目</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、调试"><span class="nav-text">二、调试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、如何在ECLIPSE中调试JAVA程序"><span class="nav-text">1、如何在ECLIPSE中调试JAVA程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-准备一段Java代码"><span class="nav-text">步骤 1 : 准备一段Java代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-设置断点"><span class="nav-text">步骤 2 : 设置断点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-点击调试按钮"><span class="nav-text">步骤 3 : 点击调试按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-确认切换到调试Perspective"><span class="nav-text">步骤 4 : 确认切换到调试Perspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-切换回开发Java代码的Perspective"><span class="nav-text">步骤 5 : 切换回开发Java代码的Perspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-调试Perspective"><span class="nav-text">步骤 6 : 调试Perspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-单步运行"><span class="nav-text">步骤 7 : 单步运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-观察右上角-Variables的变化"><span class="nav-text">步骤 8 : 观察右上角 Variables的变化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-退出"><span class="nav-text">步骤 9 : 退出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、如何在ECLIPSE中调试JAVA-WEB程序"><span class="nav-text">2、如何在ECLIPSE中调试JAVA WEB程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-动态Web项目"><span class="nav-text">步骤 1 : 动态Web项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-下载j2ee项目"><span class="nav-text">步骤 2 : 下载j2ee项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-设置断点"><span class="nav-text">步骤 3 : 设置断点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-点击调试按钮"><span class="nav-text">步骤 4 : 点击调试按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-确认切换到调试Perspective"><span class="nav-text">步骤 5 : 确认切换到调试Perspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-调试Perspective-v2"><span class="nav-text">步骤 6 : 调试Perspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-单步运行-v2"><span class="nav-text">步骤 7 : 单步运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-退出"><span class="nav-text">步骤 8 : 退出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、多控制台显示"><span class="nav-text">3、多控制台显示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-单控制台"><span class="nav-text">步骤 1 : 单控制台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-多控制台需求"><span class="nav-text">步骤 2 : 多控制台需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-启动多个控制台"><span class="nav-text">步骤 3 : 启动多个控制台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-拖动新的控制台"><span class="nav-text">步骤 4 : 拖动新的控制台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-不同控制台显示不同进程"><span class="nav-text">步骤 5 : 不同控制台显示不同进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-注意"><span class="nav-text">步骤 6 : 注意</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、REDIS"><span class="nav-text">五、REDIS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、下载安装"><span class="nav-text">1、下载安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-关于JDK版本"><span class="nav-text">步骤 1 : 关于JDK版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-什么是Redis"><span class="nav-text">步骤 2 : 什么是Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-Redis官网"><span class="nav-text">步骤 3 : Redis官网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-下载并解压"><span class="nav-text">步骤 4 : 下载并解压</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、运行"><span class="nav-text">2、运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-运行位置"><span class="nav-text">步骤 1 : 运行位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-启动服务端"><span class="nav-text">步骤 2 : 启动服务端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-启动客户端"><span class="nav-text">步骤 3 : 启动客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-简单运用"><span class="nav-text">步骤 4 : 简单运用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、常见命令"><span class="nav-text">3、常见命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-5种数据类型"><span class="nav-text">步骤 1 : 5种数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-String-字符串"><span class="nav-text">步骤 2 : String 字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-List-列表"><span class="nav-text">步骤 3 : List 列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Hash-字典，哈希表"><span class="nav-text">步骤 4 : Hash 字典，哈希表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-Set-集合"><span class="nav-text">步骤 5 : Set 集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-Sorted-Set-有序集合"><span class="nav-text">步骤 6 : Sorted Set 有序集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-官方命令手册"><span class="nav-text">步骤 7 : 官方命令手册</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、JEDIS-教程"><span class="nav-text">4、JEDIS 教程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-什么是Jedis"><span class="nav-text">步骤 1 : 什么是Jedis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-jar包"><span class="nav-text">步骤 2 : jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-TestJedis"><span class="nav-text">步骤 3 : TestJedis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-TestRedisManyCommands"><span class="nav-text">步骤 4 : TestRedisManyCommands</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、SPRING-DATA-REDIS-使用例子"><span class="nav-text">5、SPRING DATA REDIS 使用例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-Spring-对-Redis的支持"><span class="nav-text">步骤 1 : Spring 对 Redis的支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-先运行，看到效果，再学习"><span class="nav-text">步骤 2 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-模仿和排错"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-redis-properties"><span class="nav-text">步骤 4 : redis.properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-applicationContext-xml"><span class="nav-text">步骤 5 : applicationContext.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-RedisUtil"><span class="nav-text">步骤 6 : RedisUtil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-TestRedis"><span class="nav-text">步骤 7 : TestRedis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、CLIENT"><span class="nav-text">6、CLIENT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-RedisClient"><span class="nav-text">步骤 1 : RedisClient</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-下载运行"><span class="nav-text">步骤 2 : 下载运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-登陆"><span class="nav-text">步骤 3 : 登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-选择数据库"><span class="nav-text">步骤 4 : 选择数据库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六、Nginx"><span class="nav-text">六、Nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、入门"><span class="nav-text">1、入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-下载并解压"><span class="nav-text">步骤 1 : 下载并解压</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-启动方式-直接双击"><span class="nav-text">步骤 2 : 启动方式-直接双击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-启动方式-命令行"><span class="nav-text">步骤 3 : 启动方式-命令行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-端口被占用"><span class="nav-text">步骤 4 : 端口被占用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-端口号修改"><span class="nav-text">步骤 5 : 端口号修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-nginx-conf配置文件"><span class="nav-text">步骤 6 : nginx.conf配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、为NGINX准备的多个TOMCAT"><span class="nav-text">2、为NGINX准备的多个TOMCAT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-为什么要提供多个Tomcat"><span class="nav-text">步骤 1 : 为什么要提供多个Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-以8111为例，下载解压运行"><span class="nav-text">步骤 2 : 以8111为例，下载解压运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-访问地址"><span class="nav-text">步骤 3 : 访问地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-精心设计。。。"><span class="nav-text">步骤 4 : 精心设计。。。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-动静分离"><span class="nav-text">步骤 5 : 动静分离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-负载均衡"><span class="nav-text">步骤 6 : 负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-登陆之后放session"><span class="nav-text">步骤 7 : 登陆之后放session</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、反向代理TOMCAT"><span class="nav-text">3、反向代理TOMCAT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-反向代理概念"><span class="nav-text">步骤 1 : 反向代理概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-启动tomcat"><span class="nav-text">步骤 2 : 启动tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-修改nginx-conf"><span class="nav-text">步骤 3 : 修改nginx.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-重启nginx并访问"><span class="nav-text">步骤 4 : 重启nginx并访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-意义何在"><span class="nav-text">步骤 5 : 意义何在</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、和TOMCAT进行动静分离整合"><span class="nav-text">4、和TOMCAT进行动静分离整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-动静分离概念"><span class="nav-text">步骤 1 : 动静分离概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-修改nginx-conf"><span class="nav-text">步骤 2 : 修改nginx.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-观察效果"><span class="nav-text">步骤 3 : 观察效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-观察tomcat输入日志"><span class="nav-text">步骤 4 : 观察tomcat输入日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、和TOMCAT进行负载均衡ZHENG’HE"><span class="nav-text">5、和TOMCAT进行负载均衡ZHENG’HE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-负载均衡的概念"><span class="nav-text">步骤 1 : 负载均衡的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-启动两个Tomcat"><span class="nav-text">步骤 2 : 启动两个Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-修改nginx-conf-v2"><span class="nav-text">步骤 3 : 修改nginx.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-重启nginx并访问-v2"><span class="nav-text">步骤 4 : 重启nginx并访问</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、借助JEDIS-对TOMCAT做SESSION共享"><span class="nav-text">6、借助JEDIS 对TOMCAT做SESSION共享</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-负载均衡-session问题"><span class="nav-text">步骤 1 : 负载均衡 session问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-解决办法一-ip-hash"><span class="nav-text">步骤 2 : 解决办法一: ip_hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-解决办法二：-redis-tomcat-sessoin-manager"><span class="nav-text">步骤 3 : 解决办法二： redis+tomcat-sessoin-manager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-接下来进行具体操作"><span class="nav-text">步骤 4 : 接下来进行具体操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-启动redis"><span class="nav-text">步骤 5 : 启动redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-jar包"><span class="nav-text">步骤 6 : jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-修改context-xml"><span class="nav-text">步骤 7 : 修改context.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-重启tomcat"><span class="nav-text">步骤 8 : 重启tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-测试访问tomcat8111"><span class="nav-text">步骤 9 : 测试访问tomcat8111</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-测试访问tomcat8222"><span class="nav-text">步骤 10 : 测试访问tomcat8222</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-下载已经配置好了的tomcat"><span class="nav-text">步骤 11 : 下载已经配置好了的tomcat</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十、搜索引擎技术"><span class="nav-text">十、搜索引擎技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、lucene"><span class="nav-text">1、lucene</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、入门-v2"><span class="nav-text">1、入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-关于JDK版本-v2"><span class="nav-text">步骤 1 : 关于JDK版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-Lucene-概念"><span class="nav-text">步骤 2 : Lucene 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-模仿和排错"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-Lucene-版本"><span class="nav-text">步骤 5 : Lucene 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-jar-包"><span class="nav-text">步骤 6 : jar 包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-TestLucene-java"><span class="nav-text">步骤 7 : TestLucene.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-分词器"><span class="nav-text">步骤 8 : 分词器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-创建索引"><span class="nav-text">步骤 9 : 创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-创建查询器"><span class="nav-text">步骤 10 : 创建查询器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-11-执行搜索"><span class="nav-text">步骤 11 : 执行搜索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-12-显示查询结果"><span class="nav-text">步骤 12 : 显示查询结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-13-运行结果"><span class="nav-text">步骤 13 : 运行结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-14-和-like-的区别"><span class="nav-text">步骤 14 : 和 like 的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-15-思路图"><span class="nav-text">步骤 15 : 思路图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、LUCENE7可以用的中文分词器-IKANALYZER6-5-0-JAR"><span class="nav-text">2、LUCENE7可以用的中文分词器 IKANALYZER6.5.0.JAR</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-分词器概念"><span class="nav-text">步骤 1 : 分词器概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-IKAnalyzer6-5-0-jar"><span class="nav-text">步骤 2 : IKAnalyzer6.5.0.jar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-代码演示-TestAnalyzer"><span class="nav-text">步骤 3 : 代码演示 TestAnalyzer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、高亮显示"><span class="nav-text">3、高亮显示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-TestLucene"><span class="nav-text">步骤 3 : TestLucene</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-运行结果"><span class="nav-text">步骤 4 : 运行结果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、向LUCENE中导入14万条产品数据"><span class="nav-text">4、向LUCENE中导入14万条产品数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-14万条数据"><span class="nav-text">步骤 1 : 14万条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-关于数据库"><span class="nav-text">步骤 2 : 关于数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-模仿和排错-v2"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-140k-products-txt"><span class="nav-text">步骤 5 : 140k_products.txt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-Product-java"><span class="nav-text">步骤 6 : Product.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-ProductUtil-java"><span class="nav-text">步骤 7 : ProductUtil.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-TestLucene-java"><span class="nav-text">步骤 8 : TestLucene.java</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、分页查询"><span class="nav-text">5、分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v2"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-两种方式"><span class="nav-text">步骤 3 : 两种方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-第一种"><span class="nav-text">步骤 4 : 第一种</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-第二种"><span class="nav-text">步骤 5 : 第二种</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、索引删除和更新"><span class="nav-text">6、索引删除和更新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-索引删除和更新"><span class="nav-text">步骤 1 : 索引删除和更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-先说没有删除前的情形"><span class="nav-text">步骤 2 : 先说没有删除前的情形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-删除索引"><span class="nav-text">步骤 3 : 删除索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-更多删除"><span class="nav-text">步骤 4 : 更多删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-更新索引"><span class="nav-text">步骤 5 : 更新索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、LUCENE-进一步学习"><span class="nav-text">7、LUCENE - 进一步学习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、Solr"><span class="nav-text">2、Solr</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、启动服务器"><span class="nav-text">1、启动服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-关于JDK版本-v3"><span class="nav-text">步骤 1 : 关于JDK版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-什么是-Solr"><span class="nav-text">步骤 2 : 什么是 Solr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-下载-Solr"><span class="nav-text">步骤 3 : 下载 Solr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-启动服务器"><span class="nav-text">步骤 4 : 启动服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-访问服务器"><span class="nav-text">步骤 5 : 访问服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-继续"><span class="nav-text">步骤 6 : 继续</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、创建CORE"><span class="nav-text">2、创建CORE</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-Core-概念"><span class="nav-text">步骤 1 : Core 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-不要通过图形界面创建Core"><span class="nav-text">步骤 2 : 不要通过图形界面创建Core</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-命令行方式创建Core"><span class="nav-text">步骤 3 : 命令行方式创建Core</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-删除-new-core"><span class="nav-text">步骤 4 : 删除 new_core</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、SOLR7-2-可以用的中文分词器-IKANALYZER6-5-0-JAR"><span class="nav-text">3、SOLR7.2 可以用的中文分词器 IKANALYZER6.5.0.JAR</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-没有中文分词"><span class="nav-text">步骤 1 : 没有中文分词</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-配置中文分词"><span class="nav-text">步骤 2 : 配置中文分词</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-下载-IKAnalyzer6-5-0-jar"><span class="nav-text">步骤 3 : 下载 IKAnalyzer6.5.0.jar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-增加新的字段类型"><span class="nav-text">步骤 4 : 增加新的字段类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-重启-Solr"><span class="nav-text">步骤 5 : 重启 Solr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-重新测试分词"><span class="nav-text">步骤 6 : 重新测试分词</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、设置字段"><span class="nav-text">4、设置字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-字段概念"><span class="nav-text">步骤 1 : 字段概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-创建name字段"><span class="nav-text">步骤 2 : 创建name字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-创建其他字段"><span class="nav-text">步骤 3 : 创建其他字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-关于id字段"><span class="nav-text">步骤 4 : 关于id字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-查看创建的字段"><span class="nav-text">步骤 5 : 查看创建的字段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、使用-SOLRJ-向-SOLR-增加14万条索引记录"><span class="nav-text">5、使用 SOLRJ 向 SOLR 增加14万条索引记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-如何创建索引"><span class="nav-text">步骤 1 : 如何创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-SolrJ"><span class="nav-text">步骤 2 : SolrJ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v3"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-模仿和排错-v3"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-14万条数据"><span class="nav-text">步骤 5 : 14万条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-关于数据库"><span class="nav-text">步骤 6 : 关于数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-140k-products-txt"><span class="nav-text">步骤 7 : 140k_products.txt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-Product-java"><span class="nav-text">步骤 8 : Product.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-ProductUtil"><span class="nav-text">步骤 9 : ProductUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-SolrUtil"><span class="nav-text">步骤 10 : SolrUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-11-TestSolr4j"><span class="nav-text">步骤 11 : TestSolr4j</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-12-验证提交效果"><span class="nav-text">步骤 12 : 验证提交效果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、SOLRJ-分页查询"><span class="nav-text">6、SOLRJ 分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v3"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v3"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-SolrUtil"><span class="nav-text">步骤 3 : SolrUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestSolr4j"><span class="nav-text">步骤 4 : TestSolr4j</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、SOLRJ-高亮显示"><span class="nav-text">7、SOLRJ 高亮显示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v4"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v4"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-SolrUtil-v2"><span class="nav-text">步骤 3 : SolrUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestSolr4j-v2"><span class="nav-text">步骤 4 : TestSolr4j</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、SOLRJ-更新和删除索引"><span class="nav-text">8、SOLRJ 更新和删除索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v5"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v5"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-SolrUtil-v3"><span class="nav-text">步骤 3 : SolrUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestSolr4j-v3"><span class="nav-text">步骤 4 : TestSolr4j</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9、进一步学习"><span class="nav-text">9、进一步学习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、ELASTICSEARCH"><span class="nav-text">3、ELASTICSEARCH</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、启动服务器-v2"><span class="nav-text">1、启动服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-什么是-ElasticSearch"><span class="nav-text">步骤 1 : 什么是 ElasticSearch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-关于JDK版本"><span class="nav-text">步骤 2 : 关于JDK版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-下载"><span class="nav-text">步骤 3 : 下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-运行"><span class="nav-text">步骤 4 : 运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-验证启动成功"><span class="nav-text">步骤 5 : 验证启动成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、工具-KIBANA"><span class="nav-text">2、工具-KIBANA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-Kibana-是什么"><span class="nav-text">步骤 1 : Kibana 是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-下载并启动"><span class="nav-text">步骤 2 : 下载并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-验证启动"><span class="nav-text">步骤 3 : 验证启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-运行测试"><span class="nav-text">步骤 4 : 运行测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、KIBANA-索引管理"><span class="nav-text">3、KIBANA-索引管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-索引概念"><span class="nav-text">步骤 1 : 索引概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-Restful-风格"><span class="nav-text">步骤 2 : Restful 风格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-增加索引"><span class="nav-text">步骤 3 : 增加索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-查询"><span class="nav-text">步骤 4 : 查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-删除"><span class="nav-text">步骤 5 : 删除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、中文分词器"><span class="nav-text">4、中文分词器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-分词器概念-v2"><span class="nav-text">步骤 1 : 分词器概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-安装中文分词器"><span class="nav-text">步骤 2 : 安装中文分词器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-重启-ElasticSearch"><span class="nav-text">步骤 3 : 重启 ElasticSearch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-测试中文分词效果"><span class="nav-text">步骤 4 : 测试中文分词效果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、KIBANA-文档管理"><span class="nav-text">5、KIBANA-文档管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-增加文档"><span class="nav-text">步骤 1 : 增加文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-获取文档"><span class="nav-text">步骤 2 : 获取文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-修改文档1"><span class="nav-text">步骤 3 : 修改文档1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-修改文档2"><span class="nav-text">步骤 4 : 修改文档2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-删除文档"><span class="nav-text">步骤 5 : 删除文档</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、KIBANA-批量导入"><span class="nav-text">6、KIBANA-批量导入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-批量导入两条数据"><span class="nav-text">步骤 1 : 批量导入两条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-验证插入的数据"><span class="nav-text">步骤 2 : 验证插入的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-局限性"><span class="nav-text">步骤 3 : 局限性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、CURL-批量导入"><span class="nav-text">7、CURL-批量导入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-curl-exe"><span class="nav-text">步骤 1 : curl.exe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-14万条数据"><span class="nav-text">步骤 2 : 14万条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-执行导入"><span class="nav-text">步骤 3 : 执行导入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-导入结束截屏"><span class="nav-text">步骤 4 : 导入结束截屏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-验证导入效果"><span class="nav-text">步骤 5 : 验证导入效果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、KIBANA-查询操作-包括倒排序-条件查询-分页查询"><span class="nav-text">8、KIBANA-查询操作 包括倒排序 条件查询 分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-准备数据"><span class="nav-text">步骤 1 : 准备数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-查询所有"><span class="nav-text">步骤 2 : 查询所有</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-id-倒排序"><span class="nav-text">步骤 3 : id 倒排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-只返回部分字段"><span class="nav-text">步骤 4 : 只返回部分字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-条件查询"><span class="nav-text">步骤 5 : 条件查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-分页查询"><span class="nav-text">步骤 6 : 分页查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9、KIBANA-聚合操作"><span class="nav-text">9、KIBANA-聚合操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-统计数据"><span class="nav-text">步骤 1 : 统计数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9、JAVAAPI"><span class="nav-text">9、JAVAAPI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-Java-API"><span class="nav-text">步骤 1 : Java API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10、JAVAAPI-索引管理"><span class="nav-text">10、JAVAAPI-索引管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-版本"><span class="nav-text">步骤 1 : 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 2 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-模仿和排错-v2"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestElasticSearch4J"><span class="nav-text">步骤 4 : TestElasticSearch4J</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11、JAVAAPI-文档管理"><span class="nav-text">11、JAVAAPI-文档管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v6"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v6"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-Product-java"><span class="nav-text">步骤 3 : Product.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestElasticSearch4J-v2"><span class="nav-text">步骤 4 : TestElasticSearch4J</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12、JAVAAPI-批量操作"><span class="nav-text">12、JAVAAPI-批量操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v7"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v7"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-14万条数据"><span class="nav-text">步骤 3 : 14万条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-关于数据库"><span class="nav-text">步骤 4 : 关于数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-Product-java"><span class="nav-text">步骤 5 : Product.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-ProductUtil"><span class="nav-text">步骤 6 : ProductUtil</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-TestElasticSearch4J"><span class="nav-text">步骤 7 : TestElasticSearch4J</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13、JAVAAPI-查询操作"><span class="nav-text">13、JAVAAPI-查询操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-数据"><span class="nav-text">步骤 1 : 数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-先运行，看到效果，再学习-v3"><span class="nav-text">步骤 2 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-模仿和排错-v3"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-TestElasticSearch4J-v3"><span class="nav-text">步骤 4 : TestElasticSearch4J</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14、SPRINGBOOT-1-5-9-整合-ELASTICSEARCH-2-4-2-做-增删改查-CRUD以及分页"><span class="nav-text">14、SPRINGBOOT 1.5.9 整合 ELASTICSEARCH 2.4.2 做 增删改查 CRUD以及分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-版本问题"><span class="nav-text">步骤 1 : 版本问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-启动-elasticsearch-2-4-2"><span class="nav-text">步骤 2 : 启动 elasticsearch 2.4.2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v4"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-模仿和排错-v4"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-创建-springboot-项目"><span class="nav-text">步骤 5 : 创建 springboot 项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-pom-xml"><span class="nav-text">步骤 6 : pom.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-Application-java"><span class="nav-text">步骤 7 : Application.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-Category"><span class="nav-text">步骤 8 : Category</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-CategoryDAO"><span class="nav-text">步骤 9 : CategoryDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-控制类"><span class="nav-text">步骤 10 : 控制类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-11-listCategory-jsp"><span class="nav-text">步骤 11 : listCategory.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-12-editCategory-jsp"><span class="nav-text">步骤 12 : editCategory.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-13-application-properties"><span class="nav-text">步骤 13 : application.properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-14-启动并测试"><span class="nav-text">步骤 14 : 启动并测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-15-kibana"><span class="nav-text">步骤 15 : kibana</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-16-启动-kibana-并访问"><span class="nav-text">步骤 16 : 启动 kibana 并访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-17-选择索引"><span class="nav-text">步骤 17 : 选择索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-18-查看数据"><span class="nav-text">步骤 18 : 查看数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15、ELASTICSEARCH-进一步学习"><span class="nav-text">15、ELASTICSEARCH - 进一步学习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、集群"><span class="nav-text">4、集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、关于集群"><span class="nav-text">1、关于集群</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十二、Shiro"><span class="nav-text">十二、Shiro</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、教程安排"><span class="nav-text">1、教程安排</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-教程安排"><span class="nav-text">步骤 1 : 教程安排</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、教程入门"><span class="nav-text">2、教程入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-Shiro-概念"><span class="nav-text">步骤 1 : Shiro 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-先运行，看到效果，再学习-v4"><span class="nav-text">步骤 2 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-模仿和排错-v4"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-shiro-ini"><span class="nav-text">步骤 4 : shiro.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-User"><span class="nav-text">步骤 5 : User</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-TestShiro"><span class="nav-text">步骤 6 : TestShiro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-数据库"><span class="nav-text">步骤 7 : 数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、结合数据库进行验证和授权"><span class="nav-text">3、结合数据库进行验证和授权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-数据库支持"><span class="nav-text">步骤 1 : 数据库支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-RBAC-概念"><span class="nav-text">步骤 2 : RBAC 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-表结构"><span class="nav-text">步骤 3 : 表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-表数据"><span class="nav-text">步骤 4 : 表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-先运行，看到效果，再学习"><span class="nav-text">步骤 5 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-模仿和排错"><span class="nav-text">步骤 6 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-User"><span class="nav-text">步骤 7 : User</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-DAO"><span class="nav-text">步骤 8 : DAO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-Realm-概念"><span class="nav-text">步骤 9 : Realm 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-DatabaseRealm"><span class="nav-text">步骤 10 : DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-修改-shiro-ini"><span class="nav-text">步骤 11 : 修改 shiro.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-TestRealm"><span class="nav-text">步骤 12 : TestRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-关于JdbcRealm"><span class="nav-text">步骤 13 : 关于JdbcRealm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、如何加密处理"><span class="nav-text">4、如何加密处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-md5-加密"><span class="nav-text">步骤 1 : md5 加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-盐"><span class="nav-text">步骤 2 : 盐</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-数据库调整"><span class="nav-text">步骤 3 : 数据库调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-先运行，看到效果，再学习"><span class="nav-text">步骤 4 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-模仿和排错"><span class="nav-text">步骤 5 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-DAO"><span class="nav-text">步骤 6 : DAO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-DatabaseRealm"><span class="nav-text">步骤 7 : DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-TestShiro"><span class="nav-text">步骤 8 : TestShiro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-表中数据"><span class="nav-text">步骤 9 : 表中数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-另一个做法的DatabaseRealm"><span class="nav-text">步骤 10 : 另一个做法的DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-shiro-ini"><span class="nav-text">步骤 11 : shiro.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-TestShiro"><span class="nav-text">步骤 12 : TestShiro</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、SHIRO-如何集成到WEB中"><span class="nav-text">5、SHIRO 如何集成到WEB中</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v8"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v8"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-新建Web动态项目"><span class="nav-text">步骤 3 : 新建Web动态项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-jar包"><span class="nav-text">步骤 4 : jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-web-xml"><span class="nav-text">步骤 5 : web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-User-DAO-DatabaseRealm"><span class="nav-text">步骤 6 : User DAO DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-LoginServlet"><span class="nav-text">步骤 7 : LoginServlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-shiro-ini"><span class="nav-text">步骤 8 : shiro.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-style-css"><span class="nav-text">步骤 9 : style.css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-index-jsp"><span class="nav-text">步骤 10 : index.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-login-jsp"><span class="nav-text">步骤 11 : login.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-listProduct-jsp"><span class="nav-text">步骤 12 : listProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-deleteOrder-jsp"><span class="nav-text">步骤 13 : deleteOrder.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-deleteProduct-jsp"><span class="nav-text">步骤 14 : deleteProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-noRoles-jsp"><span class="nav-text">步骤 15 : noRoles.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-noPerms-jsp"><span class="nav-text">步骤 16 : noPerms.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-重启tomcat-访问测试"><span class="nav-text">步骤 17 : 重启tomcat 访问测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、如何在SSM中整合SHIRO"><span class="nav-text">6、如何在SSM中整合SHIRO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-基于-SSM-的-SHIRO-项目"><span class="nav-text">步骤 1 : 基于 SSM 的 SHIRO 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-表结构和表数据"><span class="nav-text">步骤 2 : 表结构和表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v5"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-模仿和排错-v5"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-一步一步实现"><span class="nav-text">步骤 5 : 一步一步实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-创建-web-动态项目"><span class="nav-text">步骤 6 : 创建 web 动态项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-jar-包"><span class="nav-text">步骤 7 : jar 包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-web-xml"><span class="nav-text">步骤 8 : web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-applicationContext-xml"><span class="nav-text">步骤 9 : applicationContext.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-applicationContext-shiro-xml"><span class="nav-text">步骤 10 : applicationContext-shiro.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-springMVC-xml"><span class="nav-text">步骤 11 : springMVC.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-log4j-properties"><span class="nav-text">步骤 12 : log4j.properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-PageController"><span class="nav-text">步骤 13 : PageController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-index-jsp"><span class="nav-text">步骤 14 : index.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-listProduct-jsp"><span class="nav-text">步骤 15 : listProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-deleteProduct-jsp"><span class="nav-text">步骤 16 : deleteProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-deleteOrder-jsp"><span class="nav-text">步骤 17 : deleteOrder.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-18-login-jsp"><span class="nav-text">步骤 18 : login.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-19-unauthorized-jsp"><span class="nav-text">步骤 19 : unauthorized.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-20-style-css"><span class="nav-text">步骤 20 : style.css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-21-User-一套"><span class="nav-text">步骤 21 : User 一套</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-22-Role-一套"><span class="nav-text">步骤 22 : Role 一套</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-23-Permission-一套"><span class="nav-text">步骤 23 : Permission 一套</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-24-LoginController"><span class="nav-text">步骤 24 : LoginController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-25-DatabaseRealm"><span class="nav-text">步骤 25 : DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-26-DefaultExceptionHandler"><span class="nav-text">步骤 26 : DefaultExceptionHandler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-27-缺陷"><span class="nav-text">步骤 27 : 缺陷</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、基于SHIRO-，使用SSM框架-进行用户，角色，权限维护和管理一套"><span class="nav-text">7、基于SHIRO ，使用SSM框架 进行用户，角色，权限维护和管理一套</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-权限维护一套"><span class="nav-text">步骤 1 : 权限维护一套</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-表结构调整"><span class="nav-text">步骤 2 : 表结构调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-新的表数据"><span class="nav-text">步骤 3 : 新的表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 4 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-模仿和排错-v2"><span class="nav-text">步骤 5 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-用户管理效果"><span class="nav-text">步骤 6 : 用户管理效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-角色管理效果"><span class="nav-text">步骤 7 : 角色管理效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-权限管理效果"><span class="nav-text">步骤 8 : 权限管理效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-基于前面的知识点"><span class="nav-text">步骤 9 : 基于前面的知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-jar"><span class="nav-text">步骤 10 : jar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-OverIsMergeablePlugin"><span class="nav-text">步骤 11 : OverIsMergeablePlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-generatorConfig-xml"><span class="nav-text">步骤 12 : generatorConfig.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-MybatisGenerator"><span class="nav-text">步骤 13 : MybatisGenerator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-Pojo-Example-Mapper"><span class="nav-text">步骤 14 : Pojo,Example,Mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-Service层"><span class="nav-text">步骤 15 : Service层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-Service实现层"><span class="nav-text">步骤 16 : Service实现层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-Controller-层"><span class="nav-text">步骤 17 : Controller 层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-18-menu-jsp"><span class="nav-text">步骤 18 : menu.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-19-View层"><span class="nav-text">步骤 19 : View层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-20-style-css-v2"><span class="nav-text">步骤 20 : style.css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-21-web-xml"><span class="nav-text">步骤 21 : web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-22-DatabaseRealm"><span class="nav-text">步骤 22 : DatabaseRealm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-23-applicationContext-shiro-xml"><span class="nav-text">步骤 23 : applicationContext-shiro.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-24-重启tomcat-访问测试"><span class="nav-text">步骤 24 : 重启tomcat 访问测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-25-原业务功能"><span class="nav-text">步骤 25 : 原业务功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、SHIRO-基于-URL-配置动态权限"><span class="nav-text">8、SHIRO 基于 URL 配置动态权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-基于URL配置权限"><span class="nav-text">步骤 1 : 基于URL配置权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-表中数据"><span class="nav-text">步骤 2 : 表中数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v6"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-模仿和排错-v6"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-基于前面的知识点进行"><span class="nav-text">步骤 5 : 基于前面的知识点进行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-PageController-java"><span class="nav-text">步骤 6 : PageController.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-PermissionService-java"><span class="nav-text">步骤 7 : PermissionService.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-PermissionServiceImpl-java"><span class="nav-text">步骤 8 : PermissionServiceImpl.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-URLPathMatchingFilter-java"><span class="nav-text">步骤 9 : URLPathMatchingFilter.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-applicationContext-shiro-xml-v2"><span class="nav-text">步骤 10 : applicationContext-shiro.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-jsp-们"><span class="nav-text">步骤 11 : jsp 们</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-重启Tomcat测试"><span class="nav-text">步骤 12 : 重启Tomcat测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-关于角色"><span class="nav-text">步骤 13 : 关于角色</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、在-SPRINGBOOT-中整合-SHIRO"><span class="nav-text">9、在 SPRINGBOOT 中整合 SHIRO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-springboot-概念"><span class="nav-text">步骤 1 : springboot 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-数据"><span class="nav-text">步骤 2 : 数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习-v7"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-模仿和排错-v7"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-运用前面的文件"><span class="nav-text">步骤 5 : 运用前面的文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-创建项目"><span class="nav-text">步骤 6 : 创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-输入项目参数"><span class="nav-text">步骤 7 : 输入项目参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-pom-xml"><span class="nav-text">步骤 8 : pom.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-application-properties"><span class="nav-text">步骤 9 : application.properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-Application-java"><span class="nav-text">步骤 10 : Application.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-src-下的-java-文件们"><span class="nav-text">步骤 11 : src 下的 java 文件们</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-jsp们"><span class="nav-text">步骤 12 : jsp们</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-ShiroConfiguration"><span class="nav-text">步骤 13 : ShiroConfiguration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-SpringContextUtils-java"><span class="nav-text">步骤 14 : SpringContextUtils.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-URLPathMatchingFilter-java"><span class="nav-text">步骤 15 : URLPathMatchingFilter.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-重启后测试"><span class="nav-text">步骤 16 : 重启后测试</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script
  async
  src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"
></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潇 卟 甸</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
     我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
  

  
    <span class="site-pv">
     历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz',
        appKey: 'NMGzUaGqmpzSiSItkHBQGUaA',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz", "NMGzUaGqmpzSiSItkHBQGUaA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  


  

 <script src="/js/src/activate-power-mode.js"></script>
 <script>
   POWERMODE.colorful = true;
   POWERMODE.shake = false;
   document.body.addEventListener('input', POWERMODE);
 </script>




<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20200610,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span style="color:#1890ff">$&</span>');
    div.innerHTML = `我已在此等候你 ${ages}`;
  }
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>




<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>


  
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
<!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
