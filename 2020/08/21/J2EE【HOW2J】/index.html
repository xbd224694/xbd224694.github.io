<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,编程,源代码,Java实践," />










<meta name="description" content="地址：https:&#x2F;&#x2F;how2j.cn?p&#x3D;154642">
<meta property="og:type" content="article">
<meta property="og:title" content="J2EE【HOW2J】">
<meta property="og:url" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/index.html">
<meta property="og:site_name" content="伶仃浩瀚">
<meta property="og:description" content="地址：https:&#x2F;&#x2F;how2j.cn?p&#x3D;154642">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1554.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1555.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1556.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1557.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1560.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1561.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1562.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4480.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4481.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4482.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4484.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4485.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4486.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4605.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4621.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4627.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1563.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1564.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1565.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4521.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4522.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4526.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4523.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4524.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4525.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4527.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1570.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1571.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1572.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1573.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1574.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1576.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1577.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1584.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1586.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1589.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/7461.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3029.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1603.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1604.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1593.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1594.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1595.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1597.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1601.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1568.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1567.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1602.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1605.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1606.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1608.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1609.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1611.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1612.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1613.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1746.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3875.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1749.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1750.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5129.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5130.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5131.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5132.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5133.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5134.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5135.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5136.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5137.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5138.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5143.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5139.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5681.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5682.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5683.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5684.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5685.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5839.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5840.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5841.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5559.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5560.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5871.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5872.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3921.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1618.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1621.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1622.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1623.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3036.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1626.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3037.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1628.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1629.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5537.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5538.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5539.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5544.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5551.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1633.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1634.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1635.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1636.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1637.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1638.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1640.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1647.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1648.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1649.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1641.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1643.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1644.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1645.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1646.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/7019.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1650.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1655.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1657.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1659.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1662.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1660.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1661.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1663.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1664.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1666.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1668.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1669.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1675.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1672.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1673.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1674.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1676.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1678.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1685.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1689.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1695.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/2893.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1696.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1697.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1699.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1700.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1701.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1706.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1709.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1710.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1711.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1712.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3044.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1719.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1717.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1720.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1721.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1722.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1726.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1794.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1798.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1801.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1805.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1809.png">
<meta property="og:image" content="http://yoursite.com/2020/08/Blog-Hexo/source/_posts/J2EE%E3%80%90HOW2J%E3%80%91/1813.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1756.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1751.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1762.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1763.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1767.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1769.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3061.png">
<meta property="og:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1771.png">
<meta property="og:image" content="http://yoursite.com/2020/08/Blog-Hexo/source/_posts/J2EE%E3%80%90HOW2J%E3%80%91/1786.png">
<meta property="article:published_time" content="2020-08-21T01:34:31.000Z">
<meta property="article:modified_time" content="2020-08-27T09:51:11.182Z">
<meta property="article:author" content="潇 卟 甸">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="源代码">
<meta property="article:tag" content="Java实践">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1554.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/08/21/J2EE【HOW2J】/"/>







<script>
    (function(){
        if('224694'){
            if (prompt('请输入文章密码') !== '224694'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>

  <title>J2EE【HOW2J】 | 伶仃浩瀚</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://xbd224694.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">伶仃浩瀚</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潇 卟 甸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/picture.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="伶仃浩瀚">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">J2EE【HOW2J】</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建时间" itemprop="dateCreated datePublished" datetime="2020-08-21T09:34:31+08:00">
                2020-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/How2j/" itemprop="url" rel="index">
                    <span itemprop="name">How2j</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/" class="leancloud_visitors" data-flag-title="J2EE【HOW2J】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度 </span>
               
                 <span class="leancloud-visitors-count"></span>
	 <span> ℃ </span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  53.9k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  254 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>地址：<strong><a href="https://how2j.cn/?p=154642" target="_blank" rel="noopener">https://how2j.cn?p=154642</a></strong></p>
<a id="more"></a>
<h1 id="壹、Tomcat"><a class="header-anchor" href="#壹、Tomcat">¶</a>壹、Tomcat</h1>
<p>Tomcat是常见的免费的web服务器.<br>
Tomcat 这个名字的来历，Tomcat是一种野外的猫科动物，不依赖人类，独立生活。 Tomcat的作者，取这个名字的初衷是希望，这一款服务器可以自力更生，自给自足，像Tomcat这样一种野生动物一般，不依赖其他插件，而可以独立达到提供web 服务的效果。</p>
<h2 id="一、基础"><a class="header-anchor" href="#一、基础">¶</a>一、基础</h2>
<h3 id="1、Hello-Tomcat"><a class="header-anchor" href="#1、Hello-Tomcat">¶</a>1、Hello Tomcat</h3>
<h4 id="步骤-1-不使用tomcat访问html"><a class="header-anchor" href="#步骤-1-不使用tomcat访问html">¶</a>步骤 1 : 不使用tomcat访问html</h4>
<p>不使用tomcat也可以打开html页面，但是可以在浏览器的地址里看到 <strong>file:d:/test.html</strong> 这样的格式，是通过打开本地文件的形式打开的</p>
<p>但是我们平时上网看到的html网址一般都是:<br>
<a href="http://12306.com/index.html" target="_blank" rel="noopener">http://12306.com/index.html</a> 这样的形式<br>
这是因为有web服务器的存在</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1554.png" alt></p>
<h4 id="步骤-2-使用tomcat后，访问html"><a class="header-anchor" href="#步骤-2-使用tomcat后，访问html">¶</a>步骤 2 : 使用tomcat后，访问html</h4>
<p>使用tomcat后，可以这样 <strong>127.0.0.1:8080/test.html</strong> 像访问一个网站似的，访问一个html文件了。</p>
<p>这是因为tomcat本身是一个web 服务器，test.html部署在了这个web服务器上，所以就可以这样访问了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1555.png" alt></p>
<h4 id="步骤-3-如何启动tomcat"><a class="header-anchor" href="#步骤-3-如何启动tomcat">¶</a>步骤 3 : 如何启动tomcat</h4>
<p>首先右边下载 tomcat.rar</p>
<p>解压在d:盘，随便你解压在哪里，一般解压在一个好找的地方，因为后续的学习需要频繁的启动它</p>
<p>然后运行批处理文件： <strong>D:/tomcat/bin/startup.bat</strong></p>
<p>最后如果你看到Server startup in xxx ms，就表明启动成功了。</p>
<p><strong>注</strong> Tomcat启动之后，不要关闭。。。。 关闭了就不能访问了。。。。</p>
<p>为了正常运行，请务必确认当前java环境是JDK1.8.<br>
在命令行中输入<strong>java -version</strong>进行校验<br>
参考JDK下载以及配置办法： [JDK1.8以及更高版本下载和环境变量配置]<br>
JDK9 不够稳定，特别是Tomcat7 <strong>无法在JDK9 中运行</strong>，请勿使用JDK9运行本Tomcat7，请切换至JDK8，谢谢</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1556.png" alt></p>
<h4 id="步骤-4-如何部署网页"><a class="header-anchor" href="#步骤-4-如何部署网页">¶</a>步骤 4 : 如何部署网页</h4>
<p>部署一个功能完备的web应用 有很多种方式，但是如果只是部署一个test.html，很简单</p>
<p>把test.html 复制到 D:\tomcat\webapps\ROOT 目录下</p>
<p>就可以通过 <a href="http://127.0.0.1:8080/test.html" target="_blank" rel="noopener">http://127.0.0.1:8080/test.html</a> 访问了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1557.png" alt></p>
<h4 id="步骤-5-8080是什么鬼？"><a class="header-anchor" href="#步骤-5-8080是什么鬼？">¶</a>步骤 5 : 8080是什么鬼？</h4>
<p>8080是tomcat默认使用的端口号</p>
<p>平时上网的网址，比如 <a href="http://12306.com/index.html" target="_blank" rel="noopener">http://12306.com/index.html</a> 是没有端口号的</p>
<p>如何让tomcat也做成这样呢？ 请继续下一个章节，[给tomcat改端口]</p>
<h3 id="2、改端口"><a class="header-anchor" href="#2、改端口">¶</a>2、改端口</h3>
<p>tomcat默认的端口号是8080，可以通过配置把端口号修改成80</p>
<h4 id="步骤-1-server-xml"><a class="header-anchor" href="#步骤-1-server-xml">¶</a>步骤 1 : server.xml</h4>
<p>tomcat的端口配置相关信息在 server.xml中</p>
<p>server.xml 记录了非常多的tomcat配置信息，其中就包括端口</p>
<p>用记事本打开 D:\tomcat\conf\server.xml</p>
<p>查询 ctrl+f，输入8080</p>
<p>可以找到两个8080，一个在注释中，不用理会。 另一个是</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span>             <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">redirectPort</span>=<span class="string">"8543"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这就表明使用的是8080端口，把它修改为80，保存。</p>
<p>接着，必须<strong>重启tomcat</strong></p>
<p>重启tomcat…就是先关掉(点击黑屏幕右上角的xx)，再运行startup.bat…</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1560.png" alt></p>
<h4 id="步骤-2-80端口"><a class="header-anchor" href="#步骤-2-80端口">¶</a>步骤 2 : 80端口</h4>
<p>接着就可以直接通过 <a href="http://127.0.0.1/test.html%E8%AE%BF%E9%97%AE%E7%BD%91%E9%A1%B5%E4%BA%86%E3%80%82" target="_blank" rel="noopener">http://127.0.0.1/test.html访问网页了。</a></p>
<p>80端口就是web服务默认的端口号，所以就不需要显式写这个端口号了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1561.png" alt></p>
<h4 id="步骤-3-80端口被占用"><a class="header-anchor" href="#步骤-3-80端口被占用">¶</a>步骤 3 : 80端口被占用</h4>
<p>有时候80端口被占用了，无法使用该端口。</p>
<p>解决这个问题，请查看 [端口被占用怎么办]</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1562.png" alt></p>
<h3 id="3、问题排查"><a class="header-anchor" href="#3、问题排查">¶</a>3、问题排查</h3>
<p>列罗出了Tomcat常见的问题，如不能启动，屏幕一闪而过，启动之后，访问总是出现404等等常见问题。</p>
<p>以下排查手段都是针对通过startup.bat 独立方式启动的Tomcat，集成开发环境IDE(IDEA,ECLIPSE,MYECLIPSE等) 下的Tomcat启动不在此知识点讨论范围之内。</p>
<h4 id="步骤-1-JAVA-HOME"><a class="header-anchor" href="#步骤-1-JAVA-HOME">¶</a>步骤 1 : JAVA_HOME</h4>
<p>现象：点击startup.bat之后，屏幕一闪而过<br>
检验：如图所示, 首先通过cmd命令进入控制台，然后切换到对应的目录执行startup命令，得到JRE_HOME environment … 这么个提示，就表示JAVA_HOME环境变量没有设置。<br>
分析：Tomcat本身是JAVA程序，必须要有JDK才可以执行，所以必须配置JAVA_HOME。<br>
解决：进入[配置JAVA_HOME教程]，跟着下载，配置，验证三个步骤学习如何进行JDK环境变量配置。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4480.png" alt></p>
<h4 id="步骤-2-CATALINA-HOME未设置"><a class="header-anchor" href="#步骤-2-CATALINA-HOME未设置">¶</a>步骤 2 : CATALINA_HOME未设置</h4>
<p>现象：点击startup.bat之后，屏幕一闪而过<br>
检验：如图所示, 首先通过cmd命令进入控制台，然后切换到对应的目录执行startup命令，得到CATALINA_HOME environment … 这么个提示，就表示CATALINA_HOME环境变量设置错误。<br>
分析：Tomcat执行必须依赖CATALINA_HOME或者CATALINA_BASE这两个环境变量。 如果没有在环境变量里配置过，那么会自动采用bin目录的父目录作为CATALINA_HOME和CATALINA_BASE。 如果配置了，而所配置的地方又不是正确的TOMCAT目录，那么就会出现这个错误。<br>
解决：</p>
<ol>
<li>
<p>在环境变量中删除CATALINA_HOME,CATALINA_BASE的配置，记得不仅要检查环境变量，还要检查用户变量。</p>
</li>
<li>
<p>或者把CATALINA_HOME设置为正确的TOMCAT目录。</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4481.png" alt></p>
<h4 id="步骤-3-CATALINA-HOME错误设置"><a class="header-anchor" href="#步骤-3-CATALINA-HOME错误设置">¶</a>步骤 3 : CATALINA_HOME错误设置</h4>
<p>现象：Tomcat可以成功启动，但是就是不能访问自己配置的web应用，老是提示404错误<br>
检验：如图所示, 在环境变量里，CATALINA_HOME设置在了另一个合法的tomcat目录上，所以无论运行哪个startup.bat，都会导致这个d:/tomcatxxxx目录下的程序被启动，而不是你期望的那个。<br>
分析：默认的Tomcat会优先根据环境变量中的CATALINA_HOME来定位目录，并运行。<br>
解决：</p>
<ol>
<li>
<p>在环境变量中删除CATALINA_HOME,CATALINA_BASE的配置，记得不仅要检查环境变量，还要检查用户变量。</p>
</li>
<li>
<p>或者使用本站的[纯净版 Tomcat]，已经取消了对环境变量CATALINA_HOME和CATALINA_BASE的依赖。</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4482.png" alt></p>
<h4 id="步骤-4-端口冲突"><a class="header-anchor" href="#步骤-4-端口冲突">¶</a>步骤 4 : 端口冲突</h4>
<p>现象：屏幕一闪而过，或者不会关闭，但是提示大量错误，其中会看到如图所示的Address already in use: JVM_Bind &lt;null&gt;:80，即表示端口被占用了。</p>
<p>检验：如果是这个错误，在TOMCAT目录下的logs目录里，会有一个日志文件：catalina.yyyy-mm-dd.log（当天时间），在这个日志文件里会记载一样的错误:Address already in use: JVM_Bind &lt;null&gt;:80。即表明80端口被占用了。</p>
<p>分析：端口是独占式的，一旦一个程序占用了这个端口，其他程序就不能够再去占用它了。而80端口，有可能是被已经存在的Tomcat占用了，也有可能是被其他不知名的软件占用了，比如Apache,IIS,Oracle等等。<br>
解决：请按照[Tomcat 端口被占用了怎么办？] 步骤进行操作，定位占用端口的程序，并关闭，即可。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4484.png" alt></p>
<h4 id="步骤-5-localhost-yyyy-mm-dd-log"><a class="header-anchor" href="#步骤-5-localhost-yyyy-mm-dd-log">¶</a>步骤 5 : localhost.yyyy-mm-dd.log</h4>
<p>现象：404错误<br>
检验：打开tomcat/logs目录里的localhost.yyyy-mm-dd.log文件，发现大量的报错信息。<br>
分析：当server.xml， web.xml配置错误的时候，当前web应用就会部署失败，并且会将错误信息输出到localhost.yyyy-mm-dd.log文件中。<br>
解决： 要在localhost.yyyy-mm-dd.log文件中看提示什么错误，有可能是配置的context目录不存在，有可能是多了一个&gt;符号，具体问题，具体分析了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4485.png" alt></p>
<h4 id="步骤-6-Error-FilterStart"><a class="header-anchor" href="#步骤-6-Error-FilterStart">¶</a>步骤 6 : Error FilterStart</h4>
<p>现象：404错误，明明有文件，但是就是不能访问。<br>
检验：这个严格地说，也是配置失败，但是tomcat不会大量报错，只会偷偷地来这么一句： startup failed due to previous errors。<br>
分析：过滤器启动失败就会报这个错。<br>
解决：同样的，过滤器启动失败原因也是多种多样，好在它都会把具体错误信息输出到localhost.yyyy-mm-dd.log，这样打开localhost.yyyy-mm-dd.log根据实际情况分析，就可以较快定位问题所在了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4486.png" alt></p>
<h4 id="步骤-7-JDK版本"><a class="header-anchor" href="#步骤-7-JDK版本">¶</a>步骤 7 : JDK版本</h4>
<p>现象：404错误，明明有文件，但是就是不能访问。<br>
检验：在命令行中运行java -version 检查一下当前java的版本<br>
分析：当部署的web应用中的类是由高版本JDK编译生成，而当前tomcat运行所使用的JDK又是低版本的话，就会报出如图所示的错误：UnsupportedClassVersionError，进而导致web应用启动失败。<br>
解决：请使用JDK8或者更高版本，请参考 [检测JDK版本，以及下载与配置]</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4605.png" alt></p>
<h3 id="4、-404问题排查"><a class="header-anchor" href="#4、-404问题排查">¶</a>4、 404问题排查</h3>
<h4 id="步骤-1-404问题"><a class="header-anchor" href="#步骤-1-404问题">¶</a>步骤 1 : 404问题</h4>
<p>404表示File Not Found， 文件不存在错误。<br>
通过学员反映，出现比较多的问题是页面报404错误，因此除了前面的 [Tomcat 问题排查] 之外，又专门做了这么一个404问题排查的文章，提供问题分析的思路和对策。</p>
<h4 id="步骤-2-正确的端口号"><a class="header-anchor" href="#步骤-2-正确的端口号">¶</a>步骤 2 : 正确的端口号</h4>
<p>出现404错误证明，TOMCAT是启动成功了的。 但是在一台计算机上，可以启动多个端口号不一样的TOMCAT, 所以请确保自己访问的是正确的那个端口号，别自己启动的是8080端口号的TOMCAT,但是访问的地址却用的是80端口（默认），这样肯定会出现404错误的。</p>
<h4 id="步骤-3-环境变量"><a class="header-anchor" href="#步骤-3-环境变量">¶</a>步骤 3 : 环境变量</h4>
<p>假设有两个Tomcat A和 B，自己分明运行的是B 下的startup.bat, 但是启动的却是A，为什么会这样呢？ 这就是环境变量在作祟了。<br>
在环境变量中有两个属性：分别是CATALINA_HOME和CATALNIA_BASE，如果这个值指向的是A，那么即便运行的是B下的startup.bat, 真正启动的还会是A。</p>
<p>解决办法： 删除掉这个环境变量，或者使用移除了环境变量影响的[纯净版 Tomcat]</p>
<h4 id="步骤-4-确定Web应用是否成功启动"><a class="header-anchor" href="#步骤-4-确定Web应用是否成功启动">¶</a>步骤 4 : 确定Web应用是否成功启动</h4>
<p>虽然Tomcat启动成功了，但是对应的Web应用启动失败，依然会导致404错误。<br>
怎么判断Web应用成功与失败呢？ 倘若Web引用启动失败，那么就一定会在Tomcat的logs目录下的 <strong>localhost.当前日期.log</strong> 里留下错误信息。<br>
打开这个文件，检查对应的Web应用是否启动过程中报错了。 也许是web.xml多写了一个标签结束，也许是对应的servlet类找不到。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4621.png" alt></p>
<h4 id="步骤-5-webapps下的ROOT目录"><a class="header-anchor" href="#步骤-5-webapps下的ROOT目录">¶</a>步骤 5 : webapps下的ROOT目录</h4>
<p>有的时候，在server.xml 中配置的&lt;context 是以**“/&quot;<strong>为开始路径的，与此同时，在webapps目录下还存在一个ROOT目录，这个ROOT目录其实也是告诉tomcat，以</strong>“/”** 为开始路径，那么这样就发生冲突了，Tomcat只能二选一，通常情况下都会选择ROOT目录，那么在server.xml中配置的&lt;context 就无法启动了，导致访问对应的资源提示404错误。<br>
解决办法就是删除掉ROOT目录，或者把ROOT目录重命名</p>
<h4 id="步骤-6-访问地址的时候是否加了web应用的名称"><a class="header-anchor" href="#步骤-6-访问地址的时候是否加了web应用的名称">¶</a>步骤 6 : 访问地址的时候是否加了web应用的名称</h4>
<p>这个也是常犯的错误，加入部署的时候，指定了路径，比如：<br>
&lt;Context path=&quot;/j2ee&quot; docBase=“e:\project\j2ee\web” debug=“0” reloadable=“false” /&gt;</p>
<p>那么访问的时候，要记得加上j2ee，像这样：<br>
<a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a><strong>j2ee</strong>/hello</p>
<h4 id="步骤-7-是否访问对资源了"><a class="header-anchor" href="#步骤-7-是否访问对资源了">¶</a>步骤 7 : 是否访问对资源了</h4>
<p>。。。 这种错误也常见，你写的文件是 hello.html， 但是访问的是 holle.html，自然会提示404啦</p>
<h4 id="步骤-8-不能访问WEB-INF目录下的资源"><a class="header-anchor" href="#步骤-8-不能访问WEB-INF目录下的资源">¶</a>步骤 8 : 不能访问WEB-INF目录下的资源</h4>
<p>从安全角度出发，TOMCAT不允许访问WEB-INF目录下的HTML,JSP文件。 所以如果你的资源文件放在WEB-INF下，也会提示404错误</p>
<h4 id="步骤-9-访问地址后面多加了一个斜杠"><a class="header-anchor" href="#步骤-9-访问地址后面多加了一个斜杠">¶</a>步骤 9 : 访问地址后面多加了一个斜杠</h4>
<p>访问地址后面多加了一个<strong>斜杠</strong><br>
如图，本来应该访问</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/j2ee/login.html</span></span><br></pre></td></tr></table></figure>
<p>但是却访问了地址：<br>
<a href="http://127.0.0.1:8080/j2ee/login.html/" target="_blank" rel="noopener">http://127.0.0.1:8080/j2ee/login.html/</a></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4627.png" alt></p>
<h3 id="5、端口被占用"><a class="header-anchor" href="#5、端口被占用">¶</a>5、端口被占用</h3>
<p>端口被占用就无法启动tomcat</p>
<p>所以要找到端口被占用的程序是哪一个</p>
<p>然后再关闭对应的程序即可</p>
<h4 id="步骤-1-查看80端口被哪些程序占用了"><a class="header-anchor" href="#步骤-1-查看80端口被哪些程序占用了">¶</a>步骤 1 : 查看80端口被哪些程序占用了</h4>
<p>使用命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano|findstr &quot;80&quot;</span><br></pre></td></tr></table></figure>
<p>查看 端口号包含&quot;80&quot;的占用情况</p>
<p>查询结果找到 80，8009，8005 （这三个都包含80）。</p>
<p>对应的pid(process id) 进程id 是1828</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1563.png" alt></p>
<h4 id="步骤-2-根据pid（进程id）-查询对应的应用程序"><a class="header-anchor" href="#步骤-2-根据pid（进程id）-查询对应的应用程序">¶</a>步骤 2 : 根据pid（进程id） 查询对应的应用程序</h4>
<p>使用命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist|findstr &quot;1828&quot;</span><br></pre></td></tr></table></figure>
<p>1828根据上一步找到的对应的pid</p>
<p>发现是一个java.exe程序占用了80端口</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1564.png" alt></p>
<h4 id="步骤-3-根据名称-结束该程序"><a class="header-anchor" href="#步骤-3-根据名称-结束该程序">¶</a>步骤 3 : 根据名称 结束该程序</h4>
<p>最后使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill &#x2F;f &#x2F;t &#x2F;im java.exe</span><br></pre></td></tr></table></figure>
<p>结束java.exe</p>
<p>结束成功会提示：<br>
成功： 已终止 。。。</p>
<p>或者通过pid终止：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill &#x2F;f &#x2F;pid 1828</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1565.png" alt></p>
<h3 id="6、持久化异常"><a class="header-anchor" href="#6、持久化异常">¶</a>6、持久化异常</h3>
<p>Tomcat启动的时候会报一个Exception loading sessions from persistent storage异常，但是又不影响正常的业务。</p>
<h4 id="步骤-1-启动报错"><a class="header-anchor" href="#步骤-1-启动报错">¶</a>步骤 1 : 启动报错</h4>
<p>Tomcat启动的时候会报一个<strong>Exception loading sessions from persistent storage</strong>异常</p>
<p>该问题的原因是tomcat的session持久化机制引起的，tomcat这个功能本身的用意在于重启tomcat后保存之前的session，Tomcat会把session持久化在%TOMCAT%/work/Catalina/localhost/session.ser 这个文件里。 但是因为tomcat非正常关闭，所以这个文件没有正确地结束(无EOF标记)</p>
<p><strong>解决办法治标：</strong> 只需要删除 session.ser文件即可。</p>
<p>**解决办法治本：**关闭tomcat的持久化功能，就能一劳永逸的解决这个问题。具体为修改conf下的server.xml文件。在项目的context间加入一句代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.session.PersistentManager"</span> <span class="attr">saveOnRestart</span>=<span class="string">"false"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>重启tomcat以后再也不会报这个错误了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">docBase</span>=<span class="string">"D:\\project\\j2ee\\web"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">reloadable</span>=<span class="string">"false"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.session.PersistentManager"</span> <span class="attr">saveOnRestart</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="7、纯净版-TOMCAT"><a class="header-anchor" href="#7、纯净版-TOMCAT">¶</a>7、纯净版 TOMCAT</h3>
<p>学员常常碰到启动Tomcat失败的问题，这里对Tomcat做了些调整.</p>
<ol>
<li>
<p>移除了对换变量中配置的CATALINA_HOME和CATALINE_BASE的依赖，运行startup.bat就一定是启动当前的tomcat。</p>
</li>
<li>
<p>删除了webapps里的所有文件夹，避免未删除的ROOT目录与server.xml中的context配置发生冲突可能导致的错误，详见：[webapps下的ROOT目录]</p>
</li>
</ol>
<p>右侧准备了两个一个是80端口的，一个是8080端口的，下载解压之后运行bin目录下的startup.bat即可。</p>
<h4 id="步骤-1-80端口的，纯净版tomcat"><a class="header-anchor" href="#步骤-1-80端口的，纯净版tomcat">¶</a>步骤 1 : 80端口的，纯净版tomcat</h4>
<p>下载右上角80端口的纯净版tomcat： tomcat_80.rar</p>
<h4 id="步骤-2-8080端口的，纯净版tomcat"><a class="header-anchor" href="#步骤-2-8080端口的，纯净版tomcat">¶</a>步骤 2 : 8080端口的，纯净版tomcat</h4>
<p>下载右上角8080端口的纯净版tomcat： tomcat_8080.rar</p>
<h4 id="步骤-3-注意"><a class="header-anchor" href="#步骤-3-注意">¶</a>步骤 3 : 注意</h4>
<p>以上两个版本单独运行不会有问题，但是不要在[创建]中使用。 在动态web project中应该使用 [tomcat7-8080-eclipse.rar]</p>
<h3 id="8、部署"><a class="header-anchor" href="#8、部署">¶</a>8、部署</h3>
<h4 id="步骤-1-本知识点目的"><a class="header-anchor" href="#步骤-1-本知识点目的">¶</a>步骤 1 : 本知识点目的</h4>
<p>在接下来的课程中有大量的J2EE应用，比如servlet, struts, springmvc，这些 J2EE应用都需要部署在Tomcat里才可以运行。而初学者又特别容易在这一步犯错，所以本文专门示例如何从0开始，正确地部署一个可运行的J2EE应用，包括在过程中会碰到的问题以及对应的解决办法。</p>
<h4 id="步骤-2-下载"><a class="header-anchor" href="#步骤-2-下载">¶</a>步骤 2 : 下载</h4>
<p>下载[纯净版 Tomcat]，这是我调整过之后的tomcat, 移除了对换变量中配置的CATALINA_HOME和CATALINE_BASE的依赖。</p>
<p>推荐使用8080端口那个。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4521.png" alt></p>
<h4 id="步骤-3-测试端口"><a class="header-anchor" href="#步骤-3-测试端口">¶</a>步骤 3 : 测试端口</h4>
<p>下载好之后，解压，并运行其bin目录下的startup.bat。<br>
如果启动失败，多半是8080端口被占用了(假设上一步下载的是8080端口的那个)。 那么就通过 [端口排查]手段，找到是哪个程序占用了8080，并关闭之，然后再启动。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4522.png" alt></p>
<h4 id="步骤-4-成功启动截图"><a class="header-anchor" href="#步骤-4-成功启动截图">¶</a>步骤 4 : 成功启动截图</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4526.png" alt></p>
<h4 id="步骤-5-下载一个J2EE应用"><a class="header-anchor" href="#步骤-5-下载一个J2EE应用">¶</a>步骤 5 : 下载一个J2EE应用</h4>
<p>接下来下载一个J2EE应用来进行测试，本站有很多可以运行的J2EE应用项目可供下载，尽量使用一个简单点的，不用连接数据库的来测试。<br>
如[第一个servlet]知识点右上角有一个j2ee.rar 可供下载。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4523.png" alt></p>
<h4 id="步骤-6-部署"><a class="header-anchor" href="#步骤-6-部署">¶</a>步骤 6 : 部署</h4>
<p>下载好j2ee.rar后，解压出来，假设解压到如下目录：<br>
E:\download\j2ee</p>
<p>接着用记事本把 前面下载的 tomcat8080 对应的 conf 目录下的 server.xml文件打开，复制本来被注释掉的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;Context path="/" docBase="E:\\project\\j2ee\\web" debug="0" reloadable="false" /&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>如图所示，把e:\<strong>project</strong>\j2ee\web 修改为 e:\<strong>download</strong>\j2ee\web。<br>
如果没有把握就下载右上角的server.xml,并覆盖server.xml。</p>
<p><strong>注：</strong> 文件路径是<strong>双斜杠</strong>哦，不是单斜杠</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4524.png" alt></p>
<h4 id="步骤-7-重启tomcat-并测试"><a class="header-anchor" href="#步骤-7-重启tomcat-并测试">¶</a>步骤 7 : 重启tomcat,并测试</h4>
<p>关闭tomcat, 并重新运行startup.bat。 然后输入如下网址，看到如图所示的截图，即表示部署成功了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/hello</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4525.png" alt></p>
<h1 id="贰、Servlet"><a class="header-anchor" href="#贰、Servlet">¶</a>贰、Servlet</h1>
<h2 id="一、基础-v2"><a class="header-anchor" href="#一、基础-v2">¶</a>一、基础</h2>
<h3 id="1、开发第一个SERVLET"><a class="header-anchor" href="#1、开发第一个SERVLET">¶</a>1、开发第一个SERVLET</h3>
<p>Servlet 本身不能独立运行，需要在一个web应用中运行的<br>
而一个web应用是部署在tomcat中的</p>
<p>所以开发一个servlet需要如下几个步骤<br>
创建web应用项目<br>
编写servlet代码<br>
部署到tomcat中</p>
<p>开发的IDE也有各种选择，有的使用MyEclipse，有的使用eclipse 的EE版本,有的使用IDEA开发。</p>
<p>本例使用<strong>Eclipse EE版</strong> 结合<strong>独立的 tomcat</strong>进行一次<strong>java普通项目</strong>的创建。</p>
<p>这样做的好处是，通过最原始的方式创建一个web应用，可以掌握最基本的知识。</p>
<p>以后再碰到相关问题出错的时候，更加利于解决。</p>
<p><strong>注：</strong> 动态WEB项目的风格在[如何在Eclipse中创建动态Web项目]中也有讲解</p>
<p><strong>必读：</strong> 基于Tomcat的程序要成功运行，对于配置文件的正确性有着苛刻的要求，任何一个地方出错了，都会导致运行失败。 如果你是第一次学习本教程，<strong>务必严格按照教程的指导，完全模仿操作</strong>，直到成功看到运行效果。 第一次成功之后，信心，思路都会有较好的铺垫，然后再根据自己的疑惑，在“成功”的代码上做原本想做的改动和调整，这样可以大大节约学习的时间，提高效率，<strong>切勿一来就擅自改动</strong>，给自己的学习制造障碍</p>
<h4 id="步骤-1-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>先运行，再学习</p>
<p>本知识点是一个JAVA WEB项目，需要做不少步骤，任何一步部做漏了，做错了，都有可能失败，这样会影响学习的信心，并且误以为本教程是走不通的。</p>
<p>所以先下载右上角的可运行项目:j2ee.rar，解压后部署在tomcat中，观察是否正常运行。确定可以运行，确定教程是可以跑得起来的，再学习下面的内容。</p>
<p>部署tomcat的办法请参考：[在tomcat中部署JAVA WEB应用]</p>
<p>部署成功之后，测试地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/hello</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 本教程用的是80端口</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/4527.png" alt></p>
<h4 id="步骤-2-模仿和排错"><a class="header-anchor" href="#步骤-2-模仿和排错">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-创建一个java项目j2ee"><a class="header-anchor" href="#步骤-3-创建一个java项目j2ee">¶</a>步骤 3 : 创建一个java项目j2ee</h4>
<p>File-&gt;New-&gt;Other-&gt;Java-&gt;Java Project<br>
输入名称j2ee<br>
这样就创建一个单纯的基于java的项目<br>
注意： 必须 放在 <strong>e:\project\j2ee</strong>目录下，后续配置是基于这个目录进行<br>
注意：<strong>不要使用如下方式</strong><br>
File-&gt;New-&gt;Other-Web-&gt;Dynamic Web Project<br>
这是eclipse ee创建项目的方式，它会把各种tomcat,相关配置文件的生成都自动做掉了。 而这些细节，恰恰就是你需要学习和掌握的。 所以对于初学者不建议使用这种方式。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1570.png" alt></p>
<h4 id="步骤-4-导入必须的servlet-api-jar包"><a class="header-anchor" href="#步骤-4-导入必须的servlet-api-jar包">¶</a>步骤 4 : 导入必须的servlet-api.jar包</h4>
<p>因为是开发Servlet所以需要用到 servlet-api.jar 这个包里的相关类。</p>
<p>servlet-api.jar 包位于 D:\tomcat\lib\servlet-api.jar</p>
<p>或者从本网页的右侧下载</p>
<p>导入办法:</p>
<p>右键点击项目 -&gt; properties -&gt; Java Build Path -&gt;Libraries -&gt; Add External JARs</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1571.png" alt></p>
<h4 id="步骤-5-编写HelloServlet"><a class="header-anchor" href="#步骤-5-编写HelloServlet">¶</a>步骤 5 : 编写HelloServlet</h4>
<p>创建 HelloServlet(在Eclipse中创建一个普通类的方式：菜单-&gt;File-&gt;New-&gt;Class)<br>
<strong>注意：<strong>eclipse创建的时候会自带一个</strong>包名j2ee</strong>，**不要使用这个包名，让包名置空<br>
**<br>
HelloServlet继承了 HttpServlet<br>
并且提供了一个doGet方法</p>
<p>后续测试该类的时候，会直接在浏览器输入地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.01&#x2F;hello</span><br></pre></td></tr></table></figure>
<p>在浏览器中输入地址提交数据的方式是GET ([参考GET和POST的区别])<br>
所以该Servlet需要提供一个对应的doGet方法</p>
<p>在doGet中，输出html<br>
分别是 标题元素h1 和 当前时间的字符串</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1572.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.getWriter().println(<span class="string">"&lt;h1&gt;Hello Servlet!&lt;/h1&gt;"</span>);</span><br><span class="line">            response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-配置web-xml"><a class="header-anchor" href="#步骤-6-配置web-xml">¶</a>步骤 6 : 配置web.xml</h4>
<p>首先在j2ee下创建目录web<br>
接着再创建目录web/WEB-INF<br>
然后在WEB-INF目录中创建 <strong>web.xml</strong></p>
<p>web.xml提供路径与servlet的映射关系<br>
把/hello这个路径，映射到 HelloServlet这个类上</p>
<p>&lt;servlet&gt; 标签下的 &lt;servlet-name&gt;<br>
与 &lt;servlet-mapping&gt; 标签下的 &lt;servlet-name&gt; 必须一样</p>
<p>&lt;servlet-name&gt;与&lt;servlet-class&gt;可以不一样，但是为了便于理解与维护，一般都会写的一样。 一目了然</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1573.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-指定项目输出到classes目录"><a class="header-anchor" href="#步骤-7-指定项目输出到classes目录">¶</a>步骤 7 : 指定项目输出到classes目录</h4>
<p>首先在WEB-INF下创建classes目录</p>
<p>把项目的class文件输出由原来的 j2ee/bin 设置到 j2ee/web/WEB-INF/classes下</p>
<p>步骤:<br>
项目右键-&gt;properties-&gt;Java Build Path-&gt;Source-&gt;右下角的 Brower-&gt; 指定位置是 j2ee/web/WEB-INF/classes。</p>
<p><strong>为什么要有这一步？</strong> 在ecilpse中默认输出的class是在bin目录下，但是tomcat启动之后，在默认情况下，不会去bin目录找这些class文件，而是到WEB-INF/classes这个目录下去寻找。 所以通过这一步的配置，使得eclipse的class文件输出到WEB-INF/classes目录下，那么这样就和tomcat兼容了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1574.png" alt></p>
<h4 id="步骤-8-配置tomcat的server-xml-中的-context"><a class="header-anchor" href="#步骤-8-配置tomcat的server-xml-中的-context">¶</a>步骤 8 : 配置tomcat的server.xml 中的&lt;context&gt;</h4>
<p>Tomcat 请使用 [80端口的，纯净版tomcat]</p>
<p>为了把 j2ee/web 这个目录部署到tomcat中，进行如下操作：</p>
<p>打开tomcat/conf/sever.xml</p>
<p>在 &lt;Host name=“localhost” 。。。 下面加一句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">docBase</span>=<span class="string">"e:\\project\\j2ee\\web"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">reloadable</span>=<span class="string">"false"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>path=&quot;/&quot; 就表示直接通过 <a href="http://127.0.0.1/hello" target="_blank" rel="noopener">http://127.0.0.1/hello</a> 就可以访问网页了。</p>
<p>如果设置为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/j2ee"</span> <span class="attr">docBase</span>=<span class="string">"e:\\project\\j2ee\\web"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">reloadable</span>=<span class="string">"false"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么表示需要通过 <a href="http://127.0.0.1/" target="_blank" rel="noopener">http://127.0.0.1/</a><strong>j2ee</strong>/hello才能访问呢</p>
<p>如果这一步老是失败，请直接在右侧下载修改好的server.xml</p>
<h4 id="步骤-9-删除tomcat-webapps下的ROOT目录"><a class="header-anchor" href="#步骤-9-删除tomcat-webapps下的ROOT目录">¶</a>步骤 9 : 删除tomcat webapps下的ROOT目录</h4>
<p>在上一步部署web的时候server.xml中的path 配置为 “/” 与 webapps下的ROOT目录冲突了</p>
<p>所以要<strong>删除ROOT目录</strong>，如果没有就不用删除了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1576.png" alt></p>
<h4 id="步骤-10-重启tomcat，访问http-127-0-0-1-hello"><a class="header-anchor" href="#步骤-10-重启tomcat，访问http-127-0-0-1-hello">¶</a>步骤 10 : 重启tomcat，访问http://127.0.0.1/hello</h4>
<p>关闭tomcat后，重新启动startup.bat 访问下面地址就可以看到servlet的输出</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/hello</span></span><br></pre></td></tr></table></figure>
<p>并且每一次刷新，都能看到输出新的时间</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1577.png" alt></p>
<h4 id="步骤-11-完整项目"><a class="header-anchor" href="#步骤-11-完整项目">¶</a>步骤 11 : 完整项目</h4>
<p>最后，在右侧提供本项目的完整压缩包。</p>
<p>实在搞不出来，可以先解压出来，完全照着里面的复制一遍，总归能搞得出来的</p>
<h3 id="2、获取参数"><a class="header-anchor" href="#2、获取参数">¶</a>2、获取参数</h3>
<p>本例通过登录行为，演示servlet如何获取从浏览器提交的账号密码</p>
<h4 id="步骤-1-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v2">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v2"><a class="header-anchor" href="#步骤-2-模仿和排错-v2">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-创建-login-html"><a class="header-anchor" href="#步骤-3-创建-login-html">¶</a>步骤 3 : 创建 login.html</h4>
<p>在web上右键 -&gt; New -&gt;File<br>
创建一个 login.html文件<br>
然后添加一个form元素<br>
action=“login” 标题会提交到login路径，login路径在后续步骤会映射到LoginServlet<br>
method=“post” post方式表示提交的密码信息在浏览器地址栏看不到</p>
<p>接着准备账号和密码的input元素<br>
因为要提交两个数据，在servlet端为了区分哪个是账号，哪个是密码，要给这两个input元素的name属性分别叫做name和password。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1584.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">账号: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-创建-LoginServlet"><a class="header-anchor" href="#步骤-4-创建-LoginServlet">¶</a>步骤 4 : 创建 LoginServlet</h4>
<p>创建一个LoginServlet</p>
<p>因为浏览器中的<strong>form的method是post</strong>,所以LoginServlet需要提供一个<strong>doPost</strong>方法</p>
<p>在doPost方法中，通过<strong>request.getParameter</strong> 根据name取出对应的账号和密码</p>
<p>然后用System.out.println() 打印在控制台</p>
<p><strong>注</strong> 这里是打印在控制台，并没有在网页上输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">"name:"</span> + name);</span><br><span class="line">        System.out.println(<span class="string">"password:"</span> + password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-映射LoginServlet到路径login"><a class="header-anchor" href="#步骤-5-映射LoginServlet到路径login">¶</a>步骤 5 : 映射LoginServlet到路径login</h4>
<p>在web.xml中新增映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-在页面提交数据"><a class="header-anchor" href="#步骤-6-在页面提交数据">¶</a>步骤 6 : 在页面提交数据</h4>
<p><strong>首先重启tomcat</strong><br>
然后访问页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/login.html</span><br></pre></td></tr></table></figure>
<p>输入账号密码，提交<br>
然后<strong>在tomcat的窗口</strong>，就可以看到提交的账号和密码了。</p>
<p><strong>注</strong> 不是在浏览器上看到这个提交的数据，浏览器上要看到tomcat的反馈数据，需要通过[响应]来实现。将在下一个章节讲解。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1586.png" alt></p>
<h3 id="3、返回响应"><a class="header-anchor" href="#3、返回响应">¶</a>3、返回响应</h3>
<p>根据浏览器提交的账号密码返回登录成功或者失败</p>
<p>这一步本来应该通过访问数据库来实现，这里简化一下，直接在内存中进行校验</p>
<p>如果账号是 admin,密码是123, 就返回登录成功，否则返回登录失败</p>
<h4 id="步骤-1-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v3">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v3"><a class="header-anchor" href="#步骤-2-模仿和排错-v3">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-LoginServlet"><a class="header-anchor" href="#步骤-3-LoginServlet">¶</a>步骤 3 : LoginServlet</h4>
<p>判断账号密码是否为 admin 123，如果是就打印<br>
success 否则就打印 fail</p>
<p>根据账号密码，创建对应的html字符串。</p>
<p>然后通过response.getWriter().println() 发送到浏览器。</p>
<p><strong>注:</strong> 比较的时候把常量字符串&quot;admin&quot; &quot;123&quot;放前面，因为用户可能没有输入账号密码就提交，servlet会获取到null。 这样就规避了空指针异常的问题。</p>
<p><strong>注:</strong> 这里输出的响应是success和fail，不是中文。 如果使用中文浏览器有可能看到乱码。</p>
<p>关于中文乱码问题，统一在[中文问题]章节解决，咱们一个知识点一个知识点的掌握</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">  </span><br><span class="line">        String html = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password))</span><br><span class="line">            html = <span class="string">"&lt;div style='color:green'&gt;success&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">"&lt;div style='color:red'&gt;fail&lt;/div&gt;"</span>;</span><br><span class="line">  </span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-重启tomcat，提交数据"><a class="header-anchor" href="#步骤-4-重启tomcat，提交数据">¶</a>步骤 4 : 重启tomcat，提交数据</h4>
<p>访问页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/login.html</span><br></pre></td></tr></table></figure>
<p>账号输入admin<br>
密码输入123<br>
提交可以看到success</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1589.png" alt></p>
<h3 id="4、调用流程"><a class="header-anchor" href="#4、调用流程">¶</a>4、调用流程</h3>
<p>做到目前为止，已经可以使用简单的Servlet完成一些功能了。 接下来，把Servlet的调用流程整理一遍，让大家的思路更清晰一些。</p>
<h4 id="步骤-1-流程图"><a class="header-anchor" href="#步骤-1-流程图">¶</a>步骤 1 : 流程图</h4>
<p>大体思路图就是这样，接下来对思路图里的每个环节具体讲解</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/7461.png" alt></p>
<h4 id="步骤-2-login-html"><a class="header-anchor" href="#步骤-2-login-html">¶</a>步骤 2 : login.html</h4>
<p>首先访问</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/login.html</span><br></pre></td></tr></table></figure>
<p>打开一个静态的html页面，在这个页面中可以通过form，以post的形式提交数据</p>
<h4 id="步骤-3-login路径"><a class="header-anchor" href="#步骤-3-login路径">¶</a>步骤 3 : /login路径</h4>
<p>在上一步的login.html中，用form，把账号和密码，提交到/login这个路径，并且附带method=“post”</p>
<h4 id="步骤-4-找到对应的Servlet"><a class="header-anchor" href="#步骤-4-找到对应的Servlet">¶</a>步骤 4 : 找到对应的Servlet</h4>
<p>tomcat接受到一个新的请求：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/login</span><br></pre></td></tr></table></figure>
<p>其路径是/login，接着就到[配置文件web.xml]进行匹配，发现/login，对应的Servlet类是 LoginServlet。<br>
接下来的工作，就会基于这个LoginServlet进行。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3029.png" alt></p>
<h4 id="步骤-5-实例化Servlet对象"><a class="header-anchor" href="#步骤-5-实例化Servlet对象">¶</a>步骤 5 : 实例化Servlet对象</h4>
<p>Tomcat 定位到了LoginServlet后，发现并没有LoginServlet的实例存在，于是就调用LoginServlet的public无参的构造方法LoginServlet()实例化一个LoginServlet对象以备后续使用</p>
<h4 id="步骤-6-调用doGet或者doPost"><a class="header-anchor" href="#步骤-6-调用doGet或者doPost">¶</a>步骤 6 : 调用doGet或者doPost</h4>
<p>Tomcat从上一步拿到了LoginServlet的实例之后，根据页面login.html提交信息的时候带的method=“post”，去调用对应的doPost方法。</p>
<h4 id="步骤-7-request获取参数"><a class="header-anchor" href="#步骤-7-request获取参数">¶</a>步骤 7 : request获取参数</h4>
<p>接着流程进入了doPost方法中，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个方法中，通过参数request，把页面上传递来的账号和密码信息取出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">String password = request.getParameter(<span class="string">"password"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-response设置响应"><a class="header-anchor" href="#步骤-8-response设置响应">¶</a>步骤 8 : response设置响应</h4>
<p>接着，根据账号和密码是否正确(判断是否是admin和123)， 创建不同的html字符串。</p>
<p>然后把html字符串通过如下方式，设置在了response对象上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter pw = response.getWriter();</span><br><span class="line">pw.println(html);</span><br></pre></td></tr></table></figure>
<p>到这里，Servlet的工作就做完了。</p>
<h4 id="步骤-9-tomcat把html传递给浏览器"><a class="header-anchor" href="#步骤-9-tomcat把html传递给浏览器">¶</a>步骤 9 : tomcat把html传递给浏览器</h4>
<p>在Servlet完成工作之后，tomcat拿到被Servlet修改过的response，根据这个response生成html 字符串，然后再通过[HTTP协议]，这个html字符串，回发给浏览器，浏览器再根据HTTP协议获取这个html字符串，并<strong>渲染</strong>在界面上。</p>
<p>这样在效果上，浏览器就可以看到Servlet中生成的字符串了。</p>
<p>关于HTTP协议，有专门的章节讲解 ： [HTTP协议教程]</p>
<h3 id="5、service"><a class="header-anchor" href="#5、service">¶</a>5、service()</h3>
<p>Servlet 需要提供对应的doGet() 与 doPost()方法</p>
<h4 id="步骤-1-doGet"><a class="header-anchor" href="#步骤-1-doGet">¶</a>步骤 1 : doGet()</h4>
<p>当浏览器使用get方式提交数据的时候，servlet需要提供doGet()方法</p>
<p>哪些是get方式呢？</p>
<p>form默认的提交方式<br>
如果通过一个超链访问某个地址<br>
如果在地址栏直接输入某个地址<br>
ajax指定使用get方式的时候</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-doPost"><a class="header-anchor" href="#步骤-2-doPost">¶</a>步骤 2 : doPost()</h4>
<p>当浏览器使用post方式提交数据的时候，servlet需要提供doPost()方法</p>
<p>哪些是post方式呢？<br>
在form上显示设置 method=&quot;post&quot;的时候<br>
ajax指定post方式的时候</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-service"><a class="header-anchor" href="#步骤-3-service">¶</a>步骤 3 : service()</h4>
<p>LoginServlet继承了HttpServlet,同时也继承了一个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service(HttpServletRequest , HttpServletResponse )</span><br></pre></td></tr></table></figure>
<p>实际上，在执行doGet()或者doPost()之前，都会先执行service()</p>
<p>由service()方法进行判断，到底该调用doGet()还是doPost()</p>
<p>可以发现，service(), doGet(), doPost() 三种方式的参数列表都是一样的。</p>
<p>所以，有时候也会**直接重写service()**方法，在其中提供相应的服务，就不用区分到底是get还是post了。</p>
<p>比如把前面的登录的LoginServlet，改为提供service方法，也可以达到相同的效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        String html = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password))</span><br><span class="line">            html = <span class="string">"&lt;div style='color:green'&gt;success&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">"&lt;div style='color:red'&gt;fail&lt;/div&gt;"</span>;</span><br><span class="line"> </span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、中文问题"><a class="header-anchor" href="#6、中文问题">¶</a>6、中文问题</h3>
<h4 id="示例-1-获取中文的参数"><a class="header-anchor" href="#示例-1-获取中文的参数">¶</a>示例 1 : 获取中文的参数</h4>
<p>为了成功获取中文参数，需要做如下操作</p>
<ol>
<li>login.html中加上</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这句话的目的是告诉浏览器，等下发消息给服务器的时候，使用UTF-8编码</p>
<ol start="2">
<li>
<p>login.html<br>
form的method修改为post</p>
</li>
<li>
<p>在servlet进行解码和编码</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes=  name.getBytes(<span class="string">"ISO-8859-1"</span>);</span><br><span class="line">name = <span class="keyword">new</span> String(bytes,<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>先根据ISO-8859-1解码，然后用UTF-8编码<br>
这样就可以得到正确的中文参数了</p>
<p>这样需要对每一个提交的数据都进行编码和解码处理，如果觉得麻烦，也可以使用一句话代替：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>并且把这句话放在request.getParameter()之前</p>
<p>以上是使用UTF-8的方式获取中文呢。 也可以使用GBK。把所有的UTF-8替换为GBK即可。 GB2312同理。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1603.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//login.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    账号 ： <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span> 密码: <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//LoginServlet.java</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// byte[] bytes = name.getBytes("ISO-8859-1");</span></span><br><span class="line">        <span class="comment">// name = new String(bytes, "UTF-8");</span></span><br><span class="line"> </span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"name:"</span> + name);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-2-返回中文的响应"><a class="header-anchor" href="#示例-2-返回中文的响应">¶</a>示例 2 : 返回中文的响应</h4>
<p>在Servlet中，加上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1604.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        String html = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password))</span><br><span class="line">            html = <span class="string">"&lt;div style='color:green'&gt;登录成功&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">"&lt;div style='color:red'&gt;登录失败&lt;/div&gt;"</span>;</span><br><span class="line"> </span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7、生命周期"><a class="header-anchor" href="#7、生命周期">¶</a>7、生命周期</h3>
<h4 id="步骤-1-生命周期"><a class="header-anchor" href="#步骤-1-生命周期">¶</a>步骤 1 : 生命周期</h4>
<p>一个Servlet的生命周期由 [实例化]，[初始化]，[提供服务]，[销毁]，[被回收] 几个步骤组成</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1593.png" alt></p>
<h4 id="步骤-2-实例化"><a class="header-anchor" href="#步骤-2-实例化">¶</a>步骤 2 : 实例化</h4>
<p>当用户通过浏览器输入一个路径，这个路径对应的servlet被调用的时候，该Servlet就会被实例化</p>
<p>为LoginServlet显式提供一个构造方法 LoginServlet()</p>
<p>然后通过浏览器访问，就可以观察到<br>
“LoginServlet 构造方法 被调用”</p>
<p>无论访问了多少次LoginServlet<br>
LoginServlet构造方法 <strong>只会执行一次</strong>，所以Servlet是<strong>单实例的</strong></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1594.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LoginServlet 构造方法 被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//略</span></span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-初始化"><a class="header-anchor" href="#步骤-3-初始化">¶</a>步骤 3 : 初始化</h4>
<p>LoginServlet 继承了HttpServlet，同时也继承了init(ServletConfig) 方法</p>
<p>init 方法是一个实例方法，所以会在构造方法执行后执行。</p>
<p>无论访问了多少次LoginSerlvet<br>
init初始化 <strong>只会执行一次</strong></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1595.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LoginServlet 构造方法 被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init(ServletConfig)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 略</span></span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-提供服务"><a class="header-anchor" href="#步骤-4-提供服务">¶</a>步骤 4 : 提供服务</h4>
<p>接下来就是执行service()方法，然后通过浏览器传递过来的信息进行判断，是调用doGet()还是doPost()方法</p>
<p>在service()中就会编写我们的<strong>业务代码</strong>，在本例中就是判断用户输入的账号和密码是否正确</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LoginServlet 构造方法 被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init(ServletConfig)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">  </span><br><span class="line">        String html = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password))</span><br><span class="line">            html = <span class="string">"&lt;div style='color:green'&gt;success&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">"&lt;div style='color:red'&gt;fail&lt;/div&gt;"</span>;</span><br><span class="line">  </span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-销毁"><a class="header-anchor" href="#步骤-5-销毁">¶</a>步骤 5 : 销毁</h4>
<p>接着是销毁destroy()<br>
在如下几种情况下，会调用destroy()</p>
<ol>
<li>该Servlet所在的web应用重新启动<br>
在server.xml中配置该web应用的时候用到了</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">docBase</span>=<span class="string">"e:\\project\\j2ee\\web"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">reloadable</span>=<span class="string">"false"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果把 reloadable=“<strong>false</strong>” 改为reloadable=“<strong>true</strong>” 就表示有任何类发生的更新，web应用会<strong>自动重启</strong><br>
当web应用自动重启的时候，destroy()方法就会被调用</p>
<ol start="2">
<li>关闭tomcat的时候 destroy()方法会被调用，但是这个一般都发生的很快，不易被发现。</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1597.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"destroy()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 略</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-被回收"><a class="header-anchor" href="#步骤-6-被回收">¶</a>步骤 6 : 被回收</h4>
<p>当该Servlet被销毁后，就满足垃圾回收的条件了。 当下一次垃圾回收GC来临的时候，就有可能被回收。</p>
<p>这个。。。也是不容易被观察到的现象。</p>
<h3 id="8、跳转"><a class="header-anchor" href="#8、跳转">¶</a>8、跳转</h3>
<p>页面跳转是开发一个web应用经常会发生的事情。</p>
<p>比如登录成功或是失败后，分别会跳转到不同的页面。</p>
<p>跳转的方式有两种，<strong>服务端跳转</strong>和客户端跳转</p>
<h4 id="步骤-1-首先准备两个页面-success-html-fail-html"><a class="header-anchor" href="#步骤-1-首先准备两个页面-success-html-fail-html">¶</a>步骤 1 : 首先准备两个页面 success.html fail.html</h4>
<p>首先在web目录下准备两个页面 success.html,fail.html<br>
分别用于显示登录成功 或者登录失败</p>
<p>如果登录成功了，就<strong>服务端跳转</strong>到success.html</p>
<p>如果登录失败了，就<strong>客户端跳转</strong>到fail.html</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1601.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//success.html</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"color:green"</span>&gt;</span>login success<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//fail.html</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"color:red"</span>&gt;</span>login fail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-服务端跳转"><a class="header-anchor" href="#步骤-2-服务端跳转">¶</a>步骤 2 : 服务端跳转</h4>
<p>在Servlet中进行服务端跳转的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"success.html"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>
<p>服务端跳转可以看到浏览器的地址依然是/login 路径，并不会变成success.html</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1568.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password)) &#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"success.html"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-客户端跳转"><a class="header-anchor" href="#步骤-3-客户端跳转">¶</a>步骤 3 : 客户端跳转</h4>
<p>在Servlet中进行客户端跳转的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"fail.html"</span>);</span><br></pre></td></tr></table></figure>
<p>可以观察到，浏览器地址发生了变化</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1567.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password)) &#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"success.html"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"fail.html"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-服务端跳转与客户端跳转图示"><a class="header-anchor" href="#步骤-4-服务端跳转与客户端跳转图示">¶</a>步骤 4 : 服务端跳转与客户端跳转图示</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1602.png" alt></p>
<h3 id="9、自启动"><a class="header-anchor" href="#9、自启动">¶</a>9、自启动</h3>
<p>有的时候会有这样的业务需求：<br>
tomcat一启动，就需要执行一些初始化的代码，比如校验数据库的完整性等。</p>
<p>但是Servlet的生命周期是在用户访问浏览器对应的路径开始的。如果没有用户的第一次访问，就无法执行相关代码。</p>
<p>这个时候，就需要Servlet实现<strong>自启动</strong> 即，伴随着tomcat的启动，自动启动初始化，在初始化方法init()中，就可以进行一些业务代码的工作了。</p>
<h4 id="步骤-1-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v4">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v4"><a class="header-anchor" href="#步骤-2-模仿和排错-v4">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-load-on-startup"><a class="header-anchor" href="#步骤-3-load-on-startup">¶</a>步骤 3 : load-on-startup</h4>
<p>在web.xml中，配置Hello Servlet的地方，增加一句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>取值范围是1-99</p>
<p>即表明该Servlet会随着Tomcat的启动而初始化。</p>
<p>同时，为HelloServlet提供一个init(ServletConfig) 方法，验证自启动</p>
<p>如图所示，在tomcat完全启动之前，就打印了<strong>init of HelloServlet</strong><br>
&lt;load-on-startup&gt;<strong>10</strong>&lt;/load-on-startup&gt; 中的<strong>10</strong>表示启动顺序<br>
如果有多个Servlet都配置了自动启动，数字越小，启动的优先级越高</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1605.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//web.xml</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HelloServlet</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init of Hello Servlet"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.getWriter().println(<span class="string">"&lt;h1&gt;Hello Servlet!&lt;/h1&gt;"</span>);</span><br><span class="line">            response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10、request常见用法"><a class="header-anchor" href="#10、request常见用法">¶</a>10、request常见用法</h3>
<p>request对象的类是HttpServletRequest，提供了很多有实用价值的方法</p>
<h4 id="示例-1-先运行，看到效果，再学习"><a class="header-anchor" href="#示例-1-先运行，看到效果，再学习">¶</a>示例 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="示例-2-模仿和排错"><a class="header-anchor" href="#示例-2-模仿和排错">¶</a>示例 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="示例-3-request的常见方法"><a class="header-anchor" href="#示例-3-request的常见方法">¶</a>示例 3 : request的常见方法</h4>
<p><strong>request.getRequestURL():</strong> 浏览器发出请求时的完整URL，包括协议 主机名 端口(如果有)&quot;<br>
<strong>request.getRequestURI():</strong> 浏览器发出请求的资源名部分，去掉了协议和主机名&quot;<br>
<strong>request.getQueryString():</strong> 请求行中的参数部分，只能显示以get方式发出的参数，post方式的看不到<br>
<strong>request.getRemoteAddr():</strong> 浏览器所处于的客户机的IP地址<br>
<strong>request.getRemoteHost():</strong> 浏览器所处于的客户机的主机名<br>
<strong>request.getRemotePort():</strong> 浏览器所处于的客户机使用的网络端口<br>
<strong>request.getLocalAddr():</strong> 服务器的IP地址<br>
<strong>request.getLocalName():</strong> 服务器的主机名<br>
<strong>request.getMethod():</strong> 得到客户机请求方式一般是GET或者POST</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1606.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"浏览器发出请求时的完整URL，包括协议 主机名 端口(如果有): "</span> + request.getRequestURL());</span><br><span class="line">        System.out.println(<span class="string">"浏览器发出请求的资源名部分，去掉了协议和主机名: "</span> + request.getRequestURI());</span><br><span class="line">        System.out.println(<span class="string">"请求行中的参数部分: "</span> + request.getQueryString());</span><br><span class="line">        System.out.println(<span class="string">"浏览器所处于的客户机的IP地址: "</span> + request.getRemoteAddr());</span><br><span class="line">        System.out.println(<span class="string">"浏览器所处于的客户机的主机名: "</span> + request.getRemoteHost());</span><br><span class="line">        System.out.println(<span class="string">"浏览器所处于的客户机使用的网络端口: "</span> + request.getRemotePort());</span><br><span class="line">        System.out.println(<span class="string">"服务器的IP地址: "</span> + request.getLocalAddr());</span><br><span class="line">        System.out.println(<span class="string">"服务器的主机名: "</span> + request.getLocalName());</span><br><span class="line">        System.out.println(<span class="string">"得到客户机请求方式: "</span> + request.getMethod());</span><br><span class="line"> </span><br><span class="line">        String html = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password))</span><br><span class="line">            html = <span class="string">"&lt;div style='color:green'&gt;登录成功&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">"&lt;div style='color:red'&gt;登录失败&lt;/div&gt;"</span>;</span><br><span class="line"> </span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-4-获取参数"><a class="header-anchor" href="#示例-4-获取参数">¶</a>示例 4 : 获取参数</h4>
<p><strong>request.getParameter()</strong>: 是常见的方法，用于获取单值的参数<br>
<strong>request.getParameterValues():</strong> 用于获取具有多值的参数，比如注册时候提交的 “hobits”，可以是多选的。<br>
<strong>request.getParameterMap():</strong> 用于遍历所有的参数，并返回Map类型。</p>
<p>本例准备了一个注册的例子<br>
包括一个注册页面 register.html<br>
服务端的 RegisterServlet</p>
<p>分别演示了获取单值参数，多值参数以及遍历所有的参数</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1608.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//register.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"register"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    账号 ： <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    爱好 ： LOL<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobits"</span> <span class="attr">value</span>=<span class="string">"lol"</span>&gt;</span></span><br><span class="line">        DOTA<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobits"</span> <span class="attr">value</span>=<span class="string">"dota"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RegisterServlet.java</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"获取单值参数name:"</span> + request.getParameter(<span class="string">"name"</span>));</span><br><span class="line"> </span><br><span class="line">        String[] hobits = request.getParameterValues(<span class="string">"hobits"</span>);</span><br><span class="line">        System.out.println(<span class="string">"获取具有多值的参数hobits: "</span> + Arrays.asList(hobits));</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"通过 getParameterMap 遍历所有的参数： "</span>);</span><br><span class="line">        Map&lt;String, String[]&gt; parameters = request.getParameterMap();</span><br><span class="line"> </span><br><span class="line">        Set&lt;String&gt; paramNames = parameters.keySet();</span><br><span class="line">        <span class="keyword">for</span> (String param : paramNames) &#123;</span><br><span class="line">            String[] value = parameters.get(param);</span><br><span class="line">            System.out.println(param + <span class="string">":"</span> + Arrays.asList(value));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">//web.xml</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="示例-5-获取头信息"><a class="header-anchor" href="#示例-5-获取头信息">¶</a>示例 5 : 获取头信息</h4>
<p><strong>request.getHeader()</strong> 获取浏览器传递过来的头信息。<br>
比如getHeader(“user-agent”) 可以获取浏览器的基本资料，这样就能判断是firefox、IE、chrome、或者是safari浏览器<br>
<strong>request.getHeaderNames()</strong> 获取浏览器所有的<strong>头信息名称</strong>，根据头信息名称就能遍历出所有的头信息</p>
<p>在本例，修改HelloServlet,使其获取头信息<br>
访问HelloServlet获取如下头信息:<br>
host: 主机地址<br>
user-agent: 浏览器基本资料<br>
accept: 表示浏览器接受的数据类型<br>
accept-language: 表示浏览器接受的语言<br>
accept-encoding: 表示浏览器接受的<strong>压缩方式</strong>，是压缩方式，并非编码<br>
connection: 是否保持连接<br>
cache-control: 缓存时限</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1609.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init of Hello Servlet"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">        Enumeration&lt;String&gt; headerNames= request.getHeaderNames();</span><br><span class="line">        <span class="keyword">while</span>(headerNames.hasMoreElements())&#123;</span><br><span class="line">            String header = headerNames.nextElement();</span><br><span class="line">            String value = request.getHeader(header);</span><br><span class="line">            System.out.printf(<span class="string">"%s\t%s%n"</span>,header,value);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.getWriter().println(<span class="string">"&lt;h1&gt;Hello Servlet!&lt;/h1&gt;"</span>);</span><br><span class="line">            response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-6-服务端传参"><a class="header-anchor" href="#示例-6-服务端传参">¶</a>示例 6 : 服务端传参</h4>
<p>setAttribute和getAttribute可以用来在进行服务端跳转的时候，在不同的Servlet之间进行数据共享</p>
<p>在[MVC]章节会提供更好实例帮助大家理解这两个方法的用途</p>
<h3 id="11、response-用法"><a class="header-anchor" href="#11、response-用法">¶</a>11、response 用法</h3>
<p>response是HttpServletResponse的实例，用于提供给浏览器的响应信息</p>
<h4 id="示例-1-设置响应内容"><a class="header-anchor" href="#示例-1-设置响应内容">¶</a>示例 1 : 设置响应内容</h4>
<p>通过response设置响应已经用得比较多了，在前面的Servlet学习中都是用到<br>
PrintWriter pw= <strong>response.getWriter();</strong><br>
通过response.getWriter(); 获取一个PrintWriter 对象<br>
可以使用println(),append(),write(),format()等等方法设置返回给浏览器的html内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PrintWriter pw= response.getWriter();</span><br><span class="line">            pw.println(<span class="string">"&lt;h1&gt;Hello Servlet&lt;/h1&gt;"</span>);</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-2-设置响应格式"><a class="header-anchor" href="#示例-2-设置响应格式">¶</a>示例 2 : 设置响应格式</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html"</span>);</span><br></pre></td></tr></table></figure>
<p>“text/html” 是即格式 ，在[request获取头信息] 中对应的request.getHeader(“accept”).<br>
“text/html” 是存在的，表示浏览器可以识别这种格式，如果换一个其他的格式， 比如 “text/lol” ，浏览器不能识别，那么打开此servlet就会弹出一个下载的对话框。</p>
<p>这样的手段也就常常用于实现下载功能</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1611.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PrintWriter pw = response.getWriter();</span><br><span class="line">            pw.println(<span class="string">"&lt;h1&gt;Hello Servlet&lt;/h1&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">            response.setContentType(<span class="string">"text/lol"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-3-设置响应编码"><a class="header-anchor" href="#示例-3-设置响应编码">¶</a>示例 3 : 设置响应编码</h4>
<p>设置响应编码有两种方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"><span class="number">2</span>. response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>这两种方式都需要在response.getWriter调用之前执行才能生效。</p>
<p>他们的区别在于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>不仅发送到浏览器的内容会使用UTF-8编码，而且还通知浏览器使用UTF-8编码方式进行显示。所以总能正常显示中文</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>. response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>仅仅是发送的浏览器的内容是UTF-8编码的，至于浏览器是用哪种编码方式显示不管。 所以当浏览器的显示编码方式不是UTF-8的时候，就会看到乱码，需要手动再进行一次设置。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1612.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"><span class="comment">//          response.setCharacterEncoding("UTF-8");</span></span><br><span class="line"> </span><br><span class="line">            PrintWriter pw = response.getWriter();</span><br><span class="line">            pw.println(<span class="string">"&lt;h1&gt;第一次 使用 Servlet&lt;/h1&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-4-301或者302客户端跳转"><a class="header-anchor" href="#示例-4-301或者302客户端跳转">¶</a>示例 4 : 301或者302客户端跳转</h4>
<p>客户端有两种跳转<br>
302 表示临时跳转<br>
301 表示永久性跳转</p>
<p>302就是前面在[客户端跳转]章节用到过的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"fail.html"</span>);</span><br></pre></td></tr></table></figure>
<p>301要使用另外的手段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setStatus(<span class="number">301</span>);</span><br><span class="line">response.setHeader(<span class="string">"Location"</span>, <span class="string">"fail.html"</span>);</span><br></pre></td></tr></table></figure>
<p>用户感受不出这两种跳转的区别，但是可以借助[火狐的调试工具]看到响应的头信息是:<br>
301 Moved Permanently。<br>
301和302的区别主要在搜索引擎对页面排名的时候有影响，这是属于SEO范畴的概念，在此就不展开了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1613.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password)) &#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"success.html"</span>).forward(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.setStatus(<span class="number">301</span>);</span><br><span class="line">            response.setHeader(<span class="string">"Location"</span>, <span class="string">"fail.html"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-5-设置不使用缓存"><a class="header-anchor" href="#示例-5-设置不使用缓存">¶</a>示例 5 : 设置不使用缓存</h4>
<p>使用缓存可以加快页面的加载，降低服务端的负担。但是也可能看到过时的信息，可以通过如下手段通知浏览器不要使用缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.setDateHeader(<span class="string">"Expires"</span>,<span class="number">0</span> );</span><br><span class="line">response.setHeader(<span class="string">"Cache-Control"</span>,<span class="string">"no-cache"</span>);</span><br><span class="line">response.setHeader(<span class="string">"pragma"</span>,<span class="string">"no-cache"</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.setDateHeader(<span class="string">"Expires"</span>, <span class="number">0</span>);</span><br><span class="line">            response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line">            response.setHeader(<span class="string">"pragma"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line">            response.getWriter().println(<span class="string">"&lt;h1&gt;Hello Servlet!&lt;/h1&gt;"</span>);</span><br><span class="line">            response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12、上传文件"><a class="header-anchor" href="#12、上传文件">¶</a>12、上传文件</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v5"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v5">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v5"><a class="header-anchor" href="#步骤-2-模仿和排错-v5">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-首先准备上传页面-upload-html"><a class="header-anchor" href="#步骤-3-首先准备上传页面-upload-html">¶</a>步骤 3 : 首先准备上传页面 upload.html</h4>
<p>上传页面有两点需要注意</p>
<ol>
<li>form 的<strong>method必须是post</strong>的，get不能上传文件。 还需要加上<strong>enctype=“multipart/form-data”</strong> 表示提交的数据是二进制文件</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"uploadPhoto"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>需要提供<strong>type=“file”</strong> 的字段进行上传</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"uploadPhoto"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">  英雄名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"heroName"</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  上传头像 : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"filepath"</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-接着准备-UploadPhotoServlet"><a class="header-anchor" href="#步骤-4-接着准备-UploadPhotoServlet">¶</a>步骤 4 : 接着准备 UploadPhotoServlet</h4>
<p>在UploadPhotoServlet进行上传的功能开发。</p>
<ol>
<li>
<p>需要用到两个第三方的jar包，<strong>commons-io-1.4.jar</strong>和<strong>commons-fileupload-1.2.2.jar</strong>。 在右侧下载，并放在WEB-INF/lib下</p>
</li>
<li>
<p>前部分代码是固定写法，用来做一些准备工作。 直到遍历出Item,一个Item就是对应一个浏览器提交的数据，通过item.getInputStream可以打开浏览器上传的文件的输入流。</p>
</li>
<li>
<p>客户提交的文件名有可能是一样的，所以在服务端保存文件的时候，不能使用客户提交的文件名。这里使用的是一种粗糙的解决文件名重复的办法，即使用时间戳。</p>
</li>
<li>
<p>读取输入流中的数据，保存在服务端的目录下 e:/project/j2ee/web/uploaded，这个目录是通过getRealPath获取到的。 如果项目部署在其他地方，那么会自动做相应的变化。<br>
<strong>注：</strong> 为什么要放这里？ 因为后续网页上显示的时候是通过http://127.0.0.1/uploaded/xxx.jpg 路径来获取图片。</p>
</li>
<li>
<p>根据临时生成的文件名，创建一个html img元素，然后通过response返回浏览器</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1746.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadPhotoServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String filename = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">            ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">            <span class="comment">// 设置上传文件的大小限制为1M</span></span><br><span class="line">            factory.setSizeThreshold(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">             </span><br><span class="line">            List items = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                items = upload.parseRequest(request);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">  </span><br><span class="line">            Iterator iter = items.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                FileItem item = (FileItem) iter.next();</span><br><span class="line">                <span class="keyword">if</span> (!item.isFormField()) &#123;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 根据时间戳创建头像文件</span></span><br><span class="line">                    filename = System.currentTimeMillis() + <span class="string">".jpg"</span>;</span><br><span class="line">                     </span><br><span class="line">                    <span class="comment">//通过getRealPath获取上传文件夹，如果项目在e:/project/j2ee/web,那么就会自动获取到 e:/project/j2ee/web/uploaded</span></span><br><span class="line">                    String photoFolder =request.getServletContext().getRealPath(<span class="string">"uploaded"</span>);</span><br><span class="line">                     </span><br><span class="line">                    File f = <span class="keyword">new</span> File(photoFolder, filename);</span><br><span class="line">                    f.getParentFile().mkdirs();</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 通过item.getInputStream()获取浏览器上传的文件的输入流</span></span><br><span class="line">                    InputStream is = item.getInputStream();</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 复制文件</span></span><br><span class="line">                    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(f);</span><br><span class="line">                    <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">                    <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span> (-<span class="number">1</span> != (length = is.read(b))) &#123;</span><br><span class="line">                        fos.write(b, <span class="number">0</span>, length);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fos.close();</span><br><span class="line">  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(item.getFieldName());</span><br><span class="line">                    String value = item.getString();</span><br><span class="line">                    value = <span class="keyword">new</span> String(value.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">                    System.out.println(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            String html = <span class="string">"&lt;img width='200' height='150' src='uploaded/%s' /&gt;"</span>;</span><br><span class="line">            response.setContentType(<span class="string">"text/html"</span>);</span><br><span class="line">            PrintWriter pw= response.getWriter();</span><br><span class="line">             </span><br><span class="line">            pw.format(html, filename);</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-配置web-xml"><a class="header-anchor" href="#步骤-5-配置web-xml">¶</a>步骤 5 : 配置web.xml</h4>
<p>配置UploadPhotoServlet</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadPhotoServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>UploadPhotoServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadPhotoServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/uploadPhoto<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-复制jar包"><a class="header-anchor" href="#步骤-6-复制jar包">¶</a>步骤 6 : 复制jar包</h4>
<p><strong>再强调一遍</strong>：把右侧的两个jar包commons-io-1.4.jar，commons-fileupload-1.2.2.jar 复制到WEB-INF/lib 目录下</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3875.png" alt></p>
<h4 id="步骤-7-在项目中导入jar包"><a class="header-anchor" href="#步骤-7-在项目中导入jar包">¶</a>步骤 7 : 在项目中导入jar包</h4>
<p>把jar包导入到项目中，导包办法：右键 project-&gt;properties-&gt;java build path-&gt;libaries-&gt;add external jars</p>
<h4 id="步骤-8-上传测试"><a class="header-anchor" href="#步骤-8-上传测试">¶</a>步骤 8 : 上传测试</h4>
<p>重启tomcat, 打开页面进行上传</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/upload.html</span><br></pre></td></tr></table></figure>
<p>选中某个图片点击上传，就可以看到上传的图片了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1749.png" alt></p>
<h4 id="步骤-9-如何处理其他非File字段"><a class="header-anchor" href="#步骤-9-如何处理其他非File字段">¶</a>步骤 9 : 如何处理其他非File字段</h4>
<p>因为浏览器指定了以二进制的形式提交数据，那么就不能通过常规的手段获取非File字段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getParameter(<span class="string">"heroName"</span>)</span><br></pre></td></tr></table></figure>
<p>在遍历Item时(Item即对应浏览器提交的字段)，可以通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item.isFormField</span><br></pre></td></tr></table></figure>
<p>来判断是否是常规字段还是提交的文件。 当item.isFormField返回true的时候，就表示是常规字段。</p>
<p>然后通过item.getFieldName()和item.getString()就知道分别是哪个字段，以及字段的值了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1750.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadPhotoServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String filename = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">            ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">            <span class="comment">// 设置上传文件的大小限制为1M</span></span><br><span class="line">            factory.setSizeThreshold(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">             </span><br><span class="line">            List items = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                items = upload.parseRequest(request);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">  </span><br><span class="line">            Iterator iter = items.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                FileItem item = (FileItem) iter.next();</span><br><span class="line">                <span class="keyword">if</span> (!item.isFormField()) &#123;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 根据时间戳创建头像文件</span></span><br><span class="line">                    filename = System.currentTimeMillis() + <span class="string">".jpg"</span>;</span><br><span class="line">                    String photoFolder = <span class="string">"e:\\project\\j2ee\\web\\uploaded"</span>;</span><br><span class="line">                    File f = <span class="keyword">new</span> File(photoFolder, filename);</span><br><span class="line">                    f.getParentFile().mkdirs();</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 通过item.getInputStream()获取浏览器上传的文件的输入流</span></span><br><span class="line">                    InputStream is = item.getInputStream();</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">// 复制文件</span></span><br><span class="line">                    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(f);</span><br><span class="line">                    <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">                    <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span> (-<span class="number">1</span> != (length = is.read(b))) &#123;</span><br><span class="line">                        fos.write(b, <span class="number">0</span>, length);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fos.close();</span><br><span class="line">  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(item.getFieldName());</span><br><span class="line">                    String value = item.getString();</span><br><span class="line">                    value = <span class="keyword">new</span> String(value.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">                    System.out.println(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            String html = <span class="string">"&lt;img width='200' height='150' src='uploaded/%s' /&gt;"</span>;</span><br><span class="line">            PrintWriter pw= response.getWriter();</span><br><span class="line">            pw.format(html, filename);</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、动态Web项目"><a class="header-anchor" href="#二、动态Web项目">¶</a>二、动态Web项目</h2>
<h3 id="1、创建"><a class="header-anchor" href="#1、创建">¶</a>1、创建</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v6"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v6">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目 j2ee.rar，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v6"><a class="header-anchor" href="#步骤-2-模仿和排错-v6">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-说明"><a class="header-anchor" href="#步骤-3-说明">¶</a>步骤 3 : 说明</h4>
<p>本知识点采用动态Web项目-Dynamic Web Project的方式把 [Java project+独立Tomcat的Hello Servlet] 重新做一遍。</p>
<h4 id="步骤-4-新建Dynamic-Web-Project"><a class="header-anchor" href="#步骤-4-新建Dynamic-Web-Project">¶</a>步骤 4 : 新建Dynamic Web Project</h4>
<p>新建Dynamic Web Project<br>
File-&gt;New-&gt;Other-&gt;Web-&gt;Dynamic Web Project</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5129.png" alt></p>
<h4 id="步骤-5-Servlet类"><a class="header-anchor" href="#步骤-5-Servlet类">¶</a>步骤 5 : Servlet类</h4>
<p>创建 HelloServlet<br>
**注意：**eclipse创建的时候会自带一个包名j2ee，不要使用这个包名，让包名置空</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5130.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.getWriter().println(<span class="string">"&lt;h1&gt;Hello Servlet!&lt;/h1&gt;"</span>);</span><br><span class="line">            response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-解决HttpServlet找不到问题"><a class="header-anchor" href="#步骤-6-解决HttpServlet找不到问题">¶</a>步骤 6 : 解决HttpServlet找不到问题</h4>
<p>默认的Dynamic Web Project并不会导入servlet-api.jar，所以Servlet会出现编译错误。<br>
在右上角下载servlet-api.jar,并复制到e:/project/j2ee/WebContent/WEB-INF/lib 目录下</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5131.png" alt></p>
<h4 id="步骤-7-刷新项目"><a class="header-anchor" href="#步骤-7-刷新项目">¶</a>步骤 7 : 刷新项目</h4>
<p>复制好之后，右键点击项目，刷新即可。 这个动作，会导致当前项目的build path-&gt;Libraries里的 Web App Libraries 自动加上这个servlet-api.jar包，这样HelloServlet就编译通过了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5132.png" alt></p>
<h4 id="步骤-8-web-xml"><a class="header-anchor" href="#步骤-8-web-xml">¶</a>步骤 8 : web.xml</h4>
<p>在WEB-INF目录中创建 web.xml</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5133.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-通过Eclipse启动Tomcat-Run-On-Server"><a class="header-anchor" href="#步骤-9-通过Eclipse启动Tomcat-Run-On-Server">¶</a>步骤 9 : 通过Eclipse启动Tomcat-Run On Server</h4>
<p>接下来就是在eclipse中配置Tomcat并启动，这个需要好几个步骤完成。<br>
首先右键项目 -&gt; Run As -&gt; Run on Server</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5134.png" alt></p>
<h4 id="步骤-10-通过Eclipse启动Tomcat-服务器选择Tomcat-v7-0-Server"><a class="header-anchor" href="#步骤-10-通过Eclipse启动Tomcat-服务器选择Tomcat-v7-0-Server">¶</a>步骤 10 : 通过Eclipse启动Tomcat-服务器选择Tomcat v7.0 Server</h4>
<p>这里选中Tomcat v7.0 Server, 如果你使用的是更高版本的eclipse,这里还可以看到Tomcat v9.0 Server.<br>
本知识点使用Tomcat 为例进行讲解，其他版本的Tomcat使用类似的操作。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5135.png" alt></p>
<h4 id="步骤-11-通过Eclipse启动Tomcat-指定Tomcat服务器地址"><a class="header-anchor" href="#步骤-11-通过Eclipse启动Tomcat-指定Tomcat服务器地址">¶</a>步骤 11 : 通过Eclipse启动Tomcat-指定Tomcat服务器地址</h4>
<p>然后指定Tomcat目录所在位置，这里使用的位置是：<br>
<strong>D:\tomcat7-8080-eclipse</strong>，这个位置的Tomcat 在右上角可以下载。<br>
表示版本是7的tomcat,端口号是8080.</p>
<p><strong>注意：</strong> 右上角的tomcat7-8080-eclipse.rar是可以确保能够在eclipse中配置的，有时候tomcat被人为自定义修改之后，就不再能够在Eclipse中使用，请使用右上角确保可以运行的tomcat7，绕开不必要的麻烦。</p>
<p><strong>注意：</strong> 不要使用[纯净版 Tomcat]，因为我对其进行了修改，有可能会导致在eclipse中启动失败。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5136.png" alt></p>
<h4 id="步骤-12-通过Eclipse启动Tomcat-部署"><a class="header-anchor" href="#步骤-12-通过Eclipse启动Tomcat-部署">¶</a>步骤 12 : 通过Eclipse启动Tomcat-部署</h4>
<p>然后就是下一步，把当前项目作为 “j2ee” 部署在tomcat中。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5137.png" alt></p>
<h4 id="步骤-13-测试"><a class="header-anchor" href="#步骤-13-测试">¶</a>步骤 13 : 测试</h4>
<p>部署成功之后，访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/j2ee/hello</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，因为在上一步部署的时候，使用的是<strong>j2ee</strong>这个配置，所以这里访问的时候有路径名称<strong>j2ee</strong>,与 [前面的独立Tomcat部署方式]不一样，那个没有j2ee这个路径</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/hello</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5138.png" alt></p>
<h4 id="步骤-14-关闭Eclipse中的Tomcat"><a class="header-anchor" href="#步骤-14-关闭Eclipse中的Tomcat">¶</a>步骤 14 : 关闭Eclipse中的Tomcat</h4>
<p>以Eclipse的方式启动Tomcat,其实就是一个普通的Java 进程，只需要在Console 面板关闭即可</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5143.png" alt></p>
<h4 id="步骤-15-Eclipse中启动Tomcat问题-端口"><a class="header-anchor" href="#步骤-15-Eclipse中启动Tomcat问题-端口">¶</a>步骤 15 : Eclipse中启动Tomcat问题-端口</h4>
<p>启动的时候，如果出现这个错误窗口，就表示端口8080和8089被占用了。 请使用端口排查教程找出端口被哪个程序占用了：<br>
[端口被占用]</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5139.png" alt></p>
<h4 id="步骤-16-需要注意的几点"><a class="header-anchor" href="#步骤-16-需要注意的几点">¶</a>步骤 16 : 需要注意的几点</h4>
<ol>
<li>
<p>类文件会被输出到build里，而不是WEB-INF/classes目录下</p>
</li>
<li>
<p>当有类或者配置文件变化时，会自动重启，无需手动重启Tomcat. 但是不稳定，当很许多类改动，新加了jar包，新增加了配置文件等等，都有可能导致自动重启失效，所以最好还是手动重启，确保重启成功。</p>
</li>
<li>
<p>WebContent会被整个复制到 <strong>E:\project.metadata.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\j2ee</strong> 这个位置下面去，Eclipse中启动的tomcat其实是访问的这个位置。所以当WebContent里的内容比较多的时候，就会花较长时间复制。</p>
</li>
<li>
<p>因为第3条的原因，第1条在build里生成的类和配置文件，也会被复制到第3条所说的位置</p>
</li>
</ol>
<h4 id="步骤-17-右上角可运行项目"><a class="header-anchor" href="#步骤-17-右上角可运行项目">¶</a>步骤 17 : 右上角可运行项目</h4>
<p>如果自己实在搞不出来，可以试试右上角的可运行项目j2ee.rar</p>
<h3 id="2、切换"><a class="header-anchor" href="#2、切换">¶</a>2、切换</h3>
<h4 id="步骤-1-切换到动态Web项目"><a class="header-anchor" href="#步骤-1-切换到动态Web项目">¶</a>步骤 1 : 切换到动态Web项目</h4>
<p>前一个教程[创建]讲了如何从头创建一个Web动态项目，这个教程讲解如何把一个现成的Java Project项目，切换成Web 动态项目格式</p>
<h4 id="步骤-2-准备java-project"><a class="header-anchor" href="#步骤-2-准备java-project">¶</a>步骤 2 : 准备java project</h4>
<p>在[开发servlet]的右上角，下载j2ee.rar, 并解压后，作为java project项目创建在eclipse中</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5681.png" alt></p>
<h4 id="步骤-3-项目转换"><a class="header-anchor" href="#步骤-3-项目转换">¶</a>步骤 3 : 项目转换</h4>
<p>右键项目j2ee-&gt;properties-&gt;Project Facets-&gt;Convert to faceted form…</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5682.png" alt></p>
<h4 id="步骤-4-设置content-directory"><a class="header-anchor" href="#步骤-4-设置content-directory">¶</a>步骤 4 : 设置content directory</h4>
<ol>
<li>勾选Dynamic Web Module</li>
<li>勾选之后，会出现 Furthe configuration available …, 点击</li>
<li>动态web项目的默认内容目录是WebContent,而 j2ee这个项目的对应目录是 web, 所以这里要输入web</li>
<li>点击ok</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5683.png" alt></p>
<h4 id="步骤-5-点击确认"><a class="header-anchor" href="#步骤-5-点击确认">¶</a>步骤 5 : 点击确认</h4>
<p>点击Ok就行了， 不用管Revert和Apply按钮</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5684.png" alt></p>
<h4 id="步骤-6-转换成功"><a class="header-anchor" href="#步骤-6-转换成功">¶</a>步骤 6 : 转换成功</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5685.png" alt></p>
<h3 id="3、导入"><a class="header-anchor" href="#3、导入">¶</a>3、导入</h3>
<h4 id="步骤-1-导入动态Web"><a class="header-anchor" href="#步骤-1-导入动态Web">¶</a>步骤 1 : 导入动态Web</h4>
<p>在前面讲解了如何从零开始[创建动态Web项目], 有时候会拿到一个完整项目，而其类型本来就是动态Web项目，那么这里就会讲解如何导入到Eclipse中，并用Tomcat启动部署起来。</p>
<h4 id="步骤-2-下载动态Web项目"><a class="header-anchor" href="#步骤-2-下载动态Web项目">¶</a>步骤 2 : 下载动态Web项目</h4>
<p>首先下载右上角的j2ee.rar，他就是一个动态Web项目</p>
<h4 id="步骤-3-导入到Eclipse中1"><a class="header-anchor" href="#步骤-3-导入到Eclipse中1">¶</a>步骤 3 : 导入到Eclipse中1</h4>
<p>菜单-&gt;File-&gt;Import-&gt;General-&gt;Existing Projects Into Workspace</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5839.png" alt></p>
<h4 id="步骤-4-导入到Eclipse中2"><a class="header-anchor" href="#步骤-4-导入到Eclipse中2">¶</a>步骤 4 : 导入到Eclipse中2</h4>
<p>在Select root directory中输入[下载动态Web项目]步骤中解压出来的目录。</p>
<p>**注：**如图所示，会发现无法点击Finish,此时只需要点一下 Brower 就可以点击Finish了。 如果怎么也点不出来，是因为Eclipse里面已经管理着一个同名项目，把那个同名项目从Eclipse删除掉就好了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5840.png" alt></p>
<h4 id="步骤-5-动态Web项目J2EE"><a class="header-anchor" href="#步骤-5-动态Web项目J2EE">¶</a>步骤 5 : 动态Web项目J2EE</h4>
<p>这样就可以看到是动态Web项目格式的视图</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5841.png" alt></p>
<h4 id="步骤-6-启动Tomcat"><a class="header-anchor" href="#步骤-6-启动Tomcat">¶</a>步骤 6 : 启动Tomcat</h4>
<p>接下来，就可以跟着[创建新的动态Web项目]中的[通过Eclipse启动Tomcat-Run On Server] 步骤进行下去啦。</p>
<h3 id="4、无法配置Tomcat"><a class="header-anchor" href="#4、无法配置Tomcat">¶</a>4、无法配置Tomcat</h3>
<h4 id="步骤-1-现象"><a class="header-anchor" href="#步骤-1-现象">¶</a>步骤 1 : 现象</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5559.png" alt></p>
<h4 id="步骤-2-解决办法"><a class="header-anchor" href="#步骤-2-解决办法">¶</a>步骤 2 : 解决办法</h4>
<p>定位到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\project\.metadata\.plugins\org.eclipse.core.runtime\.settings</span><br></pre></td></tr></table></figure>
<p>删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.eclipse.wst.server.core.prefs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.eclipse.jst.server.tomcat.core.prefs</span><br></pre></td></tr></table></figure>
<p>接着重启eclipse即可</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5560.png" alt></p>
<h3 id="5、无法启动Tomcat"><a class="header-anchor" href="#5、无法启动Tomcat">¶</a>5、无法启动Tomcat</h3>
<h4 id="步骤-1-现象-v2"><a class="header-anchor" href="#步骤-1-现象-v2">¶</a>步骤 1 : 现象</h4>
<p>有时候点击Eclipse中的Tomcat启动，会弹出这么个对话框，表示启动失败</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5871.png" alt></p>
<h4 id="步骤-2-解决办法-v2"><a class="header-anchor" href="#步骤-2-解决办法-v2">¶</a>步骤 2 : 解决办法</h4>
<p>解决办法粗暴一点：菜单-Window-&gt;Show View-&gt;Other-&gt;Server-&gt;Servers 此时会出现如图所示的Tomcat v7.0 Server…</p>
<p>右键点击，选择Delete</p>
<p>然后再重新配置 [通过Eclipse启动Tomcat-Run On Server]即可~</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5872.png" alt></p>
<h3 id="6、idea"><a class="header-anchor" href="#6、idea">¶</a>6、idea</h3>
<p>前几个教程使用Eclipse下的Web Dynamic Web Project风格创建，可是有部分同学更倾向于使用idea来启动web项目，不过在idea导入eclipse的Dynamic Web Project风格项目的时候由常常走不通，为此专门制作了：[如何使用IDEA导入并启动Eclipse下的的 Dynamic Web Project]，协助学习曲线更平滑些。</p>
<h2 id="三、CRUD"><a class="header-anchor" href="#三、CRUD">¶</a>三、CRUD</h2>
<h3 id="1、查询"><a class="header-anchor" href="#1、查询">¶</a>1、查询</h3>
<p>CRUD是常见的页面功能，即我们常说的增删改查<br>
C - Creation 增加<br>
R - Retrieve 查询<br>
U - Update 修改<br>
D - DELETE 删除</p>
<p>本章节将介绍如何与JDBC结合，通过servlet查询数据库，根据查询结果，得到一个html页面，显示数据库中的内容。</p>
<p>本例借助JDBC章节的Hero类和[HeroDAO类]进行数据库查询</p>
<h4 id="步骤-1-先运行，看到效果，再学习-v7"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v7">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v7"><a class="header-anchor" href="#步骤-2-模仿和排错-v7">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-效果"><a class="header-anchor" href="#步骤-3-效果">¶</a>步骤 3 : 效果</h4>
<p>这样就把表Hero里的数据都查出来了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3921.png" alt></p>
<h4 id="步骤-4-准备实体类Hero"><a class="header-anchor" href="#步骤-4-准备实体类Hero">¶</a>步骤 4 : 准备实体类Hero</h4>
<p>Hero类有id,name,hp,damage等属性。</p>
<p>并且为每一个属性提供public的getter和setter。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> damage;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getHp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHp</span><span class="params">(<span class="keyword">float</span> hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDamage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> damage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDamage</span><span class="params">(<span class="keyword">int</span> damage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.damage = damage;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-准备DAO-类-HeroDAO"><a class="header-anchor" href="#步骤-5-准备DAO-类-HeroDAO">¶</a>步骤 5 : 准备DAO 类 HeroDAO</h4>
<p>准备一个HeroDAO，提供增加，删除，修改，查询等常规数据库操作方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroDAO</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroDAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>, <span class="string">"root"</span>,</span><br><span class="line">                <span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">  </span><br><span class="line">            String sql = <span class="string">"select count(*) from hero"</span>;</span><br><span class="line">  </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                total = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">  </span><br><span class="line">            System.out.println(<span class="string">"total:"</span> + total);</span><br><span class="line">  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String sql = <span class="string">"insert into hero values(null,?,?,?)"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">  </span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">  </span><br><span class="line">            ps.execute();</span><br><span class="line">  </span><br><span class="line">            ResultSet rs = ps.getGeneratedKeys();</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        String sql = <span class="string">"update hero set name= ?, hp = ? , damage = ? where id = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">  </span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, hero.id);</span><br><span class="line">  </span><br><span class="line">            ps.execute();</span><br><span class="line">  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">  </span><br><span class="line">            String sql = <span class="string">"delete from hero where id = "</span> + id;</span><br><span class="line">  </span><br><span class="line">            s.execute(sql);</span><br><span class="line">  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Hero <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Hero hero = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">  </span><br><span class="line">            String sql = <span class="string">"select * from hero where id = "</span> + id;</span><br><span class="line">  </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line">  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hero;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list(<span class="number">0</span>, Short.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;Hero&gt;();</span><br><span class="line">  </span><br><span class="line">        String sql = <span class="string">"select * from hero order by id desc limit ?,? "</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">  </span><br><span class="line">            ps.setInt(<span class="number">1</span>, start);</span><br><span class="line">            ps.setInt(<span class="number">2</span>, count);</span><br><span class="line">  </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                heros.add(hero);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heros;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-创建表Hero的SQL"><a class="header-anchor" href="#步骤-6-创建表Hero的SQL">¶</a>步骤 6 : 创建表Hero的SQL</h4>
<p>用于创建表Hero的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS &#96;hero&#96;;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE &#96;hero&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;name&#96; varchar(30) DEFAULT NULL,</span><br><span class="line">  &#96;hp&#96; float DEFAULT NULL,</span><br><span class="line">  &#96;damage&#96; int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-为web应用导入mysql-jdbc的jar包"><a class="header-anchor" href="#步骤-7-为web应用导入mysql-jdbc的jar包">¶</a>步骤 7 : 为web应用导入mysql-jdbc的jar包</h4>
<p>为web应用导入mysql-jdbc的jar包与[为项目导入mysql-jdbc的jar包]不同，其作用的web应用在tomcat中运行起来后，能够找到jar包中的类。<br>
所以需要把 mysql 的jar包放在WEB-INF/lib 目录下。</p>
<p><strong>注：</strong> mysql-connector-java-5.0.8-bin.jar 可以在右侧下载<br>
<strong>注： 放在WEB-INF/lib 下指的是能够web应用中找到对应的class，如果要在eclipse中做调试，还是需要为项目添加该jar才可以。</strong></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1618.png" alt></p>
<h4 id="步骤-8-编写-HeroListServlet"><a class="header-anchor" href="#步骤-8-编写-HeroListServlet">¶</a>步骤 8 : 编写 HeroListServlet</h4>
<p>做一个Hero的维护页面需要一些通用的操作，比如增加，删除，编辑，修改，查询等。</p>
<p>每个不同的操作，都需要一个对应的Servlet，除了做Hero之外，还会做到其他的一些表的相关操作，所以好的规范会对将来的维护更有好处。</p>
<p>一般会这样命名,以查询为例 HeroListServlet ： [表][行为]Servlet 这样一种命名规则。</p>
<p>所以对于Hero而言就会如此命名：<br>
增加 HeroAddServlet<br>
删除 HeroDeleteServlet<br>
编辑 HeroEditServlet<br>
修改 HeroUpdateServlet<br>
查询 HeroListServlet</p>
<p>在HeroListServlet中，会使用HeroDAO把数据查询出来，然后拼接成一个table用于显示其内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">         </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line"> </span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        sb.append(<span class="string">"&lt;table align='center' border='1' cellspacing='0'&gt;\r\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;tr&gt;&lt;td&gt;id&lt;/td&gt;&lt;td&gt;name&lt;/td&gt;&lt;td&gt;hp&lt;/td&gt;&lt;td&gt;damage&lt;/td&gt;&lt;/tr&gt;\r\n"</span>);</span><br><span class="line"> </span><br><span class="line">        String trFormat = <span class="string">"&lt;tr&gt;&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%f&lt;/td&gt;&lt;td&gt;%d&lt;/td&gt;&lt;/tr&gt;\r\n"</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Hero hero : heros) &#123;</span><br><span class="line">            String tr = String.format(trFormat, hero.getId(), hero.getName(), hero.getHp(), hero.getDamage());</span><br><span class="line">            sb.append(tr);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        sb.append(<span class="string">"&lt;/table&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        response.getWriter().write(sb.toString());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-配置web-xml"><a class="header-anchor" href="#步骤-9-配置web-xml">¶</a>步骤 9 : 配置web.xml</h4>
<p>在web.xml中把路径 listHero映射到HeroListServlet上。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-10-重启tomcat，访问http-127-0-0-1-listHero"><a class="header-anchor" href="#步骤-10-重启tomcat，访问http-127-0-0-1-listHero">¶</a>步骤 10 : 重启tomcat，访问http://127.0.0.1/listHero</h4>
<p>重启tomcat，访问</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/listHero</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1621.png" alt></p>
<h3 id="2、增加"><a class="header-anchor" href="#2、增加">¶</a>2、增加</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v8"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v8">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v8"><a class="header-anchor" href="#步骤-2-模仿和排错-v8">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-准备增加的页面-addHero-html"><a class="header-anchor" href="#步骤-3-准备增加的页面-addHero-html">¶</a>步骤 3 : 准备增加的页面 addHero.html</h4>
<p>在web目录下增加addHero.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表示用UTF-8显示中文，同时浏览器也会使用UTF-8编码提交中文</p>
<p>form:<br>
action设置为addHero路径<br>
method设置为post 也是为了提交中文</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1622.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"addHero"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">     名字 ： <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">血量 ： <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"hp"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">伤害： <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"damage"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"增加 "</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-编写-HeroAddServlet"><a class="header-anchor" href="#步骤-4-编写-HeroAddServlet">¶</a>步骤 4 : 编写 HeroAddServlet</h4>
<p>HeroAddServlet 中根据浏览器传过来的参数，创建一个Hero对象。 接着通过HeroDAO把该对象保存到数据库中。<br>
最后使用客户端跳转到listHero查看所有的Hero，就能看到新加入的Hero对象了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>表示使用UTF-8的方式获取浏览器传过来的中文</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1623.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">        hero.setName(request.getParameter(<span class="string">"name"</span>));</span><br><span class="line">        hero.setHp(Float.parseFloat(request.getParameter(<span class="string">"hp"</span>)));</span><br><span class="line">        hero.setDamage(Integer.parseInt(request.getParameter(<span class="string">"damage"</span>)));</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">new</span> HeroDAO().add(hero);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listHero"</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-配置web-xml-v2"><a class="header-anchor" href="#步骤-5-配置web-xml-v2">¶</a>步骤 5 : 配置web.xml</h4>
<p>在web.xml中设置路径addHero对应HeroAddServlet</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-测试"><a class="header-anchor" href="#步骤-6-测试">¶</a>步骤 6 : 测试</h4>
<p>重启tomcat,访问增加页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/addHero.html</span></span><br></pre></td></tr></table></figure>
<p>提交数据，接着客户端跳转到/listHero，就可以显示新增加的这条数据了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3036.png" alt></p>
<h3 id="3、删除"><a class="header-anchor" href="#3、删除">¶</a>3、删除</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v9"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v9">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v9"><a class="header-anchor" href="#步骤-2-模仿和排错-v9">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-提供delete超链"><a class="header-anchor" href="#步骤-3-提供delete超链">¶</a>步骤 3 : 提供delete超链</h4>
<p>修改HeroLIstServlet，多一个单元格，是一个超链</p>
<p>超链的href属性指向地址 /deleteHero?id=217(每条不同的记录id不一样)</p>
<p>可以在左下角的浏览器状态栏里看到</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1626.png" alt></p>
<h4 id="步骤-4-修改HeroListServlet"><a class="header-anchor" href="#步骤-4-修改HeroListServlet">¶</a>步骤 4 : 修改HeroListServlet</h4>
<p>为table新增加一列delete,对于每条hero数据，增加一个delete超链</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">         </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line"> </span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        sb.append(<span class="string">"&lt;table align='center' border='1' cellspacing='0'&gt;\r\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;tr&gt;&lt;td&gt;id&lt;/td&gt;&lt;td&gt;name&lt;/td&gt;&lt;td&gt;hp&lt;/td&gt;&lt;td&gt;damage&lt;/td&gt;&lt;td&gt;delete&lt;/td&gt;&lt;/tr&gt;\r\n"</span>);</span><br><span class="line"> </span><br><span class="line">        String trFormat = <span class="string">"&lt;tr&gt;&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%f&lt;/td&gt;&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;&lt;a href='deleteHero?id=%d'&gt;delete&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\r\n"</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Hero hero : heros) &#123;</span><br><span class="line">            String tr = String.format(trFormat, hero.getId(), hero.getName(), hero.getHp(), hero.getDamage(),hero.getId());</span><br><span class="line">            sb.append(tr);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        sb.append(<span class="string">"&lt;/table&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        response.getWriter().write(sb.toString());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-配置web-xml-v3"><a class="header-anchor" href="#步骤-5-配置web-xml-v3">¶</a>步骤 5 : 配置web.xml</h4>
<p>配置web.xml 把/deleteHero指向 HeroDeleteServlet</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/deleteHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-编写HeroDeleteServlet"><a class="header-anchor" href="#步骤-6-编写HeroDeleteServlet">¶</a>步骤 6 : 编写HeroDeleteServlet</h4>
<p>首先获取参数id<br>
然后通过HeroDAO根据id，删除该对象<br>
然后客户端跳转到 /listHero</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroDeleteServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">new</span> HeroDAO().delete(id);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listHero"</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-测试"><a class="header-anchor" href="#步骤-7-测试">¶</a>步骤 7 : 测试</h4>
<p>重启tomcat,首先访问查询页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/listHero</span></span><br></pre></td></tr></table></figure>
<p>然后点击删除，可以观察到某条数据被删除了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3037.png" alt></p>
<h3 id="4、编辑"><a class="header-anchor" href="#4、编辑">¶</a>4、编辑</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v10"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v10">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v10"><a class="header-anchor" href="#步骤-2-模仿和排错-v10">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-修改HeroListServlet"><a class="header-anchor" href="#步骤-3-修改HeroListServlet">¶</a>步骤 3 : 修改HeroListServlet</h4>
<p>新增加一列 edit，里面放上指向 /editHero的超链</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1628.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">         </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line"> </span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        sb.append(<span class="string">"&lt;table align='center' border='1' cellspacing='0'&gt;\r\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;tr&gt;&lt;td&gt;id&lt;/td&gt;&lt;td&gt;name&lt;/td&gt;&lt;td&gt;hp&lt;/td&gt;&lt;td&gt;damage&lt;/td&gt;&lt;td&gt;edit&lt;/td&gt;&lt;td&gt;delete&lt;/td&gt;&lt;/tr&gt;\r\n"</span>);</span><br><span class="line"> </span><br><span class="line">        String trFormat = <span class="string">"&lt;tr&gt;&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%f&lt;/td&gt;&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;&lt;a href='editHero?id=%d'&gt;edit&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href='deleteHero?id=%d'&gt;delete&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\r\n"</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Hero hero : heros) &#123;</span><br><span class="line">            String tr = String.format(trFormat, hero.getId(), hero.getName(), hero.getHp(), hero.getDamage(),hero.getId(),hero.getId());</span><br><span class="line">             </span><br><span class="line">            sb.append(tr);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        sb.append(<span class="string">"&lt;/table&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        response.getWriter().write(sb.toString());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-配置web-xml"><a class="header-anchor" href="#步骤-4-配置web-xml">¶</a>步骤 4 : 配置web.xml</h4>
<p>在web.xml中把 /editHero路径映射到 HeroEditServlet类上</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/deleteHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/editHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-准备HeroEditServlet"><a class="header-anchor" href="#步骤-5-准备HeroEditServlet">¶</a>步骤 5 : 准备HeroEditServlet</h4>
<p>HeroEditServlet 根据浏览器传过来的id获取一个hero对象</p>
<p>然后根据这个hero对象，准备一个类似add.html的页面，不同之处在于每个输入框都是有值的。</p>
<p>最后还会提供一个type=&quot;hidden&quot;的input,用于提交id到路径/updateHero</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1629.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroEditServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line"> </span><br><span class="line">        Hero hero = <span class="keyword">new</span> HeroDAO().get(id);</span><br><span class="line"> </span><br><span class="line">        StringBuffer format = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        format.append(<span class="string">"&lt;!DOCTYPE html&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        format.append(<span class="string">"&lt;form action='updateHero' method='post'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"名字 ： &lt;input type='text' name='name' value='%s' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"血量 ： &lt;input type='text' name='hp'  value='%f' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"伤害： &lt;input type='text' name='damage'  value='%d' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;input type='hidden' name='id' value='%d'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;input type='submit' value='更新'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;/form&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">        String html = String.format(format.toString(), hero.getName(), hero.getHp(), hero.getDamage(), hero.getId());</span><br><span class="line"> </span><br><span class="line">        response.getWriter().write(html);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、更新"><a class="header-anchor" href="#5、更新">¶</a>5、更新</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v11"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v11">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v11"><a class="header-anchor" href="#步骤-2-模仿和排错-v11">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-编写-HeroUpdateServlet"><a class="header-anchor" href="#步骤-3-编写-HeroUpdateServlet">¶</a>步骤 3 : 编写 HeroUpdateServlet</h4>
<p>HeroUpdateServlet<br>
根据浏览器提交的id name hp damage创建一个Hero对象<br>
然后调用HeroDAO的update，进行更新</p>
<p>更新结束后，客户端跳转到 /listHero</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroUpdateServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">        hero.setId(Integer.parseInt(request.getParameter(<span class="string">"id"</span>)));</span><br><span class="line">        hero.setName(request.getParameter(<span class="string">"name"</span>));</span><br><span class="line">        hero.setHp(Float.parseFloat(request.getParameter(<span class="string">"hp"</span>)));</span><br><span class="line">        hero.setDamage(Integer.parseInt(request.getParameter(<span class="string">"damage"</span>)));</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">new</span> HeroDAO().update(hero);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listHero"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-配置web-xml-v2"><a class="header-anchor" href="#步骤-4-配置web-xml-v2">¶</a>步骤 4 : 配置web.xml</h4>
<p>新增对路径 /updateHero的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>10<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/register<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/deleteHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroEditServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/editHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroUpdateServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroUpdateServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroUpdateServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/updateHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6、弊端"><a class="header-anchor" href="#6、弊端">¶</a>6、弊端</h3>
<h4 id="步骤-1-使用Servlet进行CRUD开发的弊端"><a class="header-anchor" href="#步骤-1-使用Servlet进行CRUD开发的弊端">¶</a>步骤 1 : 使用Servlet进行CRUD开发的弊端</h4>
<p>用到这里，大家对使用Servlet进行CRUD开发就有比较全面感性认识了。 其中一个比较明显的弊端就是在Servlet编写html代码很痛苦，效率不高，可读性差，难以维护。</p>
<p>最好可以在html文件里面写html代码，同时又能在里面调用java的变量，那么这样就需要学习[JSP]了。</p>
<h2 id="四、JSON"><a class="header-anchor" href="#四、JSON">¶</a>四、JSON</h2>
<h3 id="1、提交数据"><a class="header-anchor" href="#1、提交数据">¶</a>1、提交数据</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v12"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v12">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v12"><a class="header-anchor" href="#步骤-2-模仿和排错-v12">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-效果-v2"><a class="header-anchor" href="#步骤-3-效果-v2">¶</a>步骤 3 : 效果</h4>
<p>访问地址，提交数据</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/submit.html</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5537.png" alt></p>
<h4 id="步骤-4-资源"><a class="header-anchor" href="#步骤-4-资源">¶</a>步骤 4 : 资源</h4>
<p>要运行起来需要jquery.min.js，各种jar包，都在右上角的j2ee.rar中提供，请自行下载解压获取。</p>
<h4 id="步骤-5-submit-html"><a class="header-anchor" href="#步骤-5-submit-html">¶</a>步骤 5 : submit.html</h4>
<p>点击提交之后，把form中的数据取出来，组织成json的格式，用ajax发送出去。<br>
这里用的ajax方式是 jquery的post函数, 请参考：[使用post方式提交ajax]</p>
<p>JSON.stringify函数的作用是将一个javascript对象，转换为JSON格式的字符串。</p>
<p>提交之后，将会看到如图所示的对话框</p>
<p>这里还用到了jquery.min.js，请在右上角下载</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5538.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式提交数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> &gt;</span> </span><br><span class="line">       名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"name"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span> </span><br><span class="line">        血量：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"hp"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">id</span>=<span class="string">"sender"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"messageDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="javascript">    $(<span class="string">'#sender'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> name=<span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value; </span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> hp=<span class="built_in">document</span>.getElementById(<span class="string">'hp'</span>).value; </span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> hero=&#123;<span class="string">"name"</span>:name,<span class="string">"hp"</span>:hp&#125;; </span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> url=<span class="string">"submitServlet"</span>; </span></span><br><span class="line">           </span><br><span class="line"><span class="javascript">        $.post(</span></span><br><span class="line">                url,</span><br><span class="line"><span class="javascript">                &#123;<span class="string">"data"</span>:<span class="built_in">JSON</span>.stringify(hero)&#125;,</span></span><br><span class="line"><span class="actionscript">                <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123; </span></span><br><span class="line"><span class="actionscript">                     alert(<span class="string">"提交成功，请在Tomcat控制台查看服务端接收到的数据"</span>);</span></span><br><span class="line">         &#125;);  </span><br><span class="line"> </span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-SubmitServlet"><a class="header-anchor" href="#步骤-6-SubmitServlet">¶</a>步骤 6 : SubmitServlet</h4>
<ol>
<li>获取浏览器提交的字符串</li>
<li>把字符串转换为JSON对象</li>
<li>把JSON对象转换为Hero对象</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5539.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Hero.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hp;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHp</span><span class="params">(<span class="keyword">int</span> hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hero [name="</span> + name + <span class="string">", hp="</span> + hp + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SubmitServlet.java</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject; </span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubmitServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String data =request.getParameter(<span class="string">"data"</span>);</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"服务端接收到的数据是："</span> +data);</span><br><span class="line">  </span><br><span class="line">        JSONObject json=JSONObject.fromObject(data); </span><br><span class="line">          </span><br><span class="line">        System.out.println(<span class="string">"转换为JSON对象之后是："</span>+ json);</span><br><span class="line">           </span><br><span class="line">        Hero hero = (Hero)JSONObject.toBean(json,Hero<span class="class">.<span class="keyword">class</span>)</span>; </span><br><span class="line">        System.out.println(<span class="string">"转换为Hero对象之后是："</span>+hero);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-web-xml"><a class="header-anchor" href="#步骤-7-web-xml">¶</a>步骤 7 : web.xml</h4>
<p>配置映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/submitServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试"><a class="header-anchor" href="#步骤-8-测试">¶</a>步骤 8 : 测试</h4>
<p>重启tomcat，访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/submit.html</span></span><br></pre></td></tr></table></figure>
<h3 id="2、获取一个对象"><a class="header-anchor" href="#2、获取一个对象">¶</a>2、获取一个对象</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v13"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v13">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v13"><a class="header-anchor" href="#步骤-2-模仿和排错-v13">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-效果-v3"><a class="header-anchor" href="#步骤-3-效果-v3">¶</a>步骤 3 : 效果</h4>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/getOne.html</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5544.png" alt></p>
<h4 id="步骤-4-资源-v2"><a class="header-anchor" href="#步骤-4-资源-v2">¶</a>步骤 4 : 资源</h4>
<p>要运行起来需要jquery.min.js，各种jar包，都在右上角的j2ee.rar中提供，请自行下载解压获取。</p>
<h4 id="步骤-5-GetOneServlet"><a class="header-anchor" href="#步骤-5-GetOneServlet">¶</a>步骤 5 : GetOneServlet</h4>
<ol>
<li>创建一个Hero对象</li>
<li>创建一个JSONObject 对象</li>
<li>把Hero对象转换为JSONObject 对象，并放在上一个JSONObject对象上，key是&quot;hero&quot;</li>
<li>设置编码方式为UTF-8</li>
<li>通过response返回</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Writer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject; </span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetOneServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">          </span><br><span class="line">        Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">        hero.setName(<span class="string">"盖伦"</span>);</span><br><span class="line">        hero.setHp(<span class="number">353</span>);</span><br><span class="line">         </span><br><span class="line">        JSONObject json= <span class="keyword">new</span> JSONObject();</span><br><span class="line">   </span><br><span class="line">        json.put(<span class="string">"hero"</span>, JSONObject.fromObject(hero));</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>); </span><br><span class="line">        response.getWriter().print(json);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-web-xml"><a class="header-anchor" href="#步骤-6-web-xml">¶</a>步骤 6 : web.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/submitServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/getOneServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-getOne-html"><a class="header-anchor" href="#步骤-7-getOne-html">¶</a>步骤 7 : getOne.html</h4>
<ol>
<li>点击按钮之后，通过ajax访问getOneServlet</li>
<li>获取都数据后，通过JSON.parse 转换为json对象</li>
<li>获取name和hp</li>
<li>显示在div里</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式获取数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"通过AJAX获取一个Hero对象"</span> <span class="attr">id</span>=<span class="string">"sender"</span>&gt;</span>  </span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"messageDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="javascript">    $(<span class="string">'#sender'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> url=<span class="string">"getOneServlet"</span>; </span></span><br><span class="line"><span class="javascript">        $.post(</span></span><br><span class="line">                url,</span><br><span class="line"><span class="actionscript">                <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                     <span class="keyword">var</span> json=<span class="built_in">JSON</span>.parse(data); </span></span><br><span class="line"><span class="actionscript">                     <span class="keyword">var</span> name =json.hero.name; </span></span><br><span class="line"><span class="actionscript">                     <span class="keyword">var</span> hp = json.hero.hp;</span></span><br><span class="line"><span class="javascript">                     $(<span class="string">"#messageDiv"</span>).html(<span class="string">"英雄名称："</span>+name + <span class="string">"&lt;br&gt;英雄血量:"</span> +hp );</span></span><br><span class="line">                      </span><br><span class="line">         &#125;);  </span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试-v2"><a class="header-anchor" href="#步骤-8-测试-v2">¶</a>步骤 8 : 测试</h4>
<p>重启Tomcat,访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/getOne.html</span></span><br></pre></td></tr></table></figure>
<h3 id="3、获取多个对象"><a class="header-anchor" href="#3、获取多个对象">¶</a>3、获取多个对象</h3>
<h4 id="步骤-1-先运行，看到效果，再学习-v14"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v14">¶</a>步骤 1 : 先运行，看到效果，再学习</h4>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h4 id="步骤-2-模仿和排错-v14"><a class="header-anchor" href="#步骤-2-模仿和排错-v14">¶</a>步骤 2 : 模仿和排错</h4>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h4 id="步骤-3-效果-v4"><a class="header-anchor" href="#步骤-3-效果-v4">¶</a>步骤 3 : 效果</h4>
<p>访问地址：<br>
<a href="http://127.0.0.1:8080/getMany.html" target="_blank" rel="noopener">http://127.0.0.1:8080/getMany.html</a></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/5551.png" alt></p>
<h4 id="步骤-4-资源-v3"><a class="header-anchor" href="#步骤-4-资源-v3">¶</a>步骤 4 : 资源</h4>
<p>要运行起来需要jquery.min.js，各种jar包，都在右上角的j2ee.rar中提供，请自行下载解压获取。</p>
<h4 id="步骤-5-GetManyServlet"><a class="header-anchor" href="#步骤-5-GetManyServlet">¶</a>步骤 5 : GetManyServlet</h4>
<ol>
<li>准备一个集合</li>
<li>向集合中放入 10个Hero对象</li>
<li>通过JSONSerializer.toJSON(heros)把集合转换为JSON字符串</li>
<li>返回给浏览器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONSerializer; </span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetManyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">            hero.setName(<span class="string">"name"</span>+i);</span><br><span class="line">            hero.setHp(<span class="number">500</span>+i);</span><br><span class="line">            heros.add(hero);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        String result =JSONSerializer.toJSON(heros).toString();</span><br><span class="line"> </span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>); </span><br><span class="line">        response.getWriter().print(result);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">            hero.setName(<span class="string">"name"</span>+i);</span><br><span class="line">            hero.setHp(<span class="number">500</span>+i);</span><br><span class="line">            heros.add(hero);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(JSONSerializer.toJSON(heros).toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-web-xml-v2"><a class="header-anchor" href="#步骤-6-web-xml-v2">¶</a>步骤 6 : web.xml</h4>
<p>配置映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SubmitServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/submitServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetOneServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/getOneServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetManyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>GetManyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetManyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/getManyServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-getMany-html"><a class="header-anchor" href="#步骤-7-getMany-html">¶</a>步骤 7 : getMany.html</h4>
<ol>
<li>通过ajax访问getManyServlet</li>
<li>把返回的数据，通过 $.parseJSON 转换为json数组</li>
<li>遍历数组，显示在div中</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式获取数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"通过AJAX获取多个Hero对象"</span> <span class="attr">id</span>=<span class="string">"sender"</span>&gt;</span>  </span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"messageDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="javascript">    $(<span class="string">'#sender'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> url=<span class="string">"getManyServlet"</span>; </span></span><br><span class="line"><span class="javascript">        $.post(</span></span><br><span class="line">                url,</span><br><span class="line"><span class="actionscript">                <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> heros = $.parseJSON(data);</span></span><br><span class="line">                     for(i in heros)&#123;</span><br><span class="line"><span class="javascript">                         <span class="keyword">var</span> old = $(<span class="string">"#messageDiv"</span>).html();</span></span><br><span class="line"><span class="actionscript">                         <span class="keyword">var</span> hero = heros[i];</span></span><br><span class="line"><span class="javascript">                         $(<span class="string">"#messageDiv"</span>).html(old + <span class="string">"&lt;br&gt;"</span>+hero.name+<span class="string">"   -----   "</span>+hero.hp); </span></span><br><span class="line">                     &#125;</span><br><span class="line">         &#125;);  </span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试-v3"><a class="header-anchor" href="#步骤-8-测试-v3">¶</a>步骤 8 : 测试</h4>
<p>重启tomcat，并测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/getMany.html</span></span><br></pre></td></tr></table></figure>
<h1 id="叁、HTTP协议"><a class="header-anchor" href="#叁、HTTP协议">¶</a>叁、HTTP协议</h1>
<h2 id="一、基础-v3"><a class="header-anchor" href="#一、基础-v3">¶</a>一、基础</h2>
<h3 id="1、协议概念"><a class="header-anchor" href="#1、协议概念">¶</a>1、协议概念</h3>
<p>HTTP 超文本传输协议 <strong>H</strong>yper <strong>T</strong>ext <strong>T</strong>ransfer <strong>P</strong>rotocol</p>
<p>当我们在浏览器的地址栏输入一个地址的时候，就能够访问服务器的某个页面</p>
<p>这个过程本身就是两个应用程序之间的交互，一个应用程序是浏览器，另一个应用程序是服务器。</p>
<p><strong>协议是什么？</strong> 协议就是不同的应用程序之间按照事先做好的约定进行的通信。 这样就能互相<strong>读懂</strong>对方的意思。</p>
<p>浏览器和WEB服务器之间，使用的就是一种叫做HTTP的协议。 这样是BS (Browser Server )架构模型的基础</p>
<h4 id="步骤-1-HTTP协议"><a class="header-anchor" href="#步骤-1-HTTP协议">¶</a>步骤 1 : HTTP协议</h4>
<p>HTTP协议由请求和响应两种类型组成</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1633.png" alt></p>
<h3 id="2、调试工具"><a class="header-anchor" href="#2、调试工具">¶</a>2、调试工具</h3>
<p>对于HTTP协议的学习，我们将借助火狐浏览器FIREFOX的调试工具来实际观察浏览器和服务器之间传输数据的具体内容</p>
<h4 id="步骤-1-下载-FireFox"><a class="header-anchor" href="#步骤-1-下载-FireFox">¶</a>步骤 1 : 下载 FireFox</h4>
<p>下载火狐浏览器，打开[Firefox下载页面]，在右侧下载</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1634.png" alt></p>
<h4 id="步骤-2-打开调试工具"><a class="header-anchor" href="#步骤-2-打开调试工具">¶</a>步骤 2 : 打开调试工具</h4>
<p>快捷键 F12</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1635.png" alt></p>
<h4 id="步骤-3-观察-request-response"><a class="header-anchor" href="#步骤-3-观察-request-response">¶</a>步骤 3 : 观察 request response</h4>
<p>打开某个网页<br>
就可以看到浏览器和服务器传输的协议内容了<br>
接下来的章节会分别对[请求消息]和[响应消息]做讲解</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1636.png" alt></p>
<h3 id="3、请求协议"><a class="header-anchor" href="#3、请求协议">¶</a>3、请求协议</h3>
<p>请求消息 由 请求行，请求头部，空行和请求数据4部分组成</p>
<h4 id="示例-1-请求行"><a class="header-anchor" href="#示例-1-请求行">¶</a>示例 1 : 请求行</h4>
<p>打开网页 ，并新增一条英雄数据</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/addHero.html</span></span><br></pre></td></tr></table></figure>
<p>通过调试工具可以看到两个重要信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST addHero</span><br></pre></td></tr></table></figure>
<p>提交的method是<strong>POST</strong>，访问的路径是addHero</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1637.png" alt></p>
<h4 id="示例-2-请求头部"><a class="header-anchor" href="#示例-2-请求头部">¶</a>示例 2 : 请求头部</h4>
<p>请求头部信息提供了如下信息:<br>
Host: 主机名<br>
User-Agent: 浏览器基本资料<br>
Accept: 浏览器能够识别的响应类型<br>
Accept-Language: 浏览器默认语言<br>
Accept-Encoding: 浏览器能够识别的压缩方式<br>
Referer: 来路页面， /addHero 这个路径是通过addHero.html这个页面跳转过来的。<br>
Connecton：是否保持连接</p>
<p>这些信息，也可以在HeroAddServlet中，通过 [request对象获取]</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1638.png" alt></p>
<h4 id="示例-3-请求数据"><a class="header-anchor" href="#示例-3-请求数据">¶</a>示例 3 : 请求数据</h4>
<p>点开Params页，可以看到本次提交数据所传递的参数</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1640.png" alt></p>
<h3 id="4、响应协议"><a class="header-anchor" href="#4、响应协议">¶</a>4、响应协议</h3>
<p>响应信息由状态行，消息报头，响应正文组成</p>
<h4 id="示例-1-状态行"><a class="header-anchor" href="#示例-1-状态行">¶</a>示例 1 : 状态行</h4>
<p>访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/listHero</span></span><br></pre></td></tr></table></figure>
<p>可以看到响应代码是 <strong>200 OK</strong>，即表示响应成功</p>
<p>除了200还有很多其他常用的代码，请查看 [响应代码] 章节</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1647.png" alt></p>
<h4 id="示例-2-消息报头"><a class="header-anchor" href="#示例-2-消息报头">¶</a>示例 2 : 消息报头</h4>
<p>消息报头中提供如下信息：<br>
Content-Length: 表示长度<br>
Content-Type: 内容格式<br>
Date: 日期<br>
Server: 服务器类型</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1648.png" alt></p>
<h4 id="示例-3-响应正文"><a class="header-anchor" href="#示例-3-响应正文">¶</a>示例 3 : 响应正文</h4>
<p>如图所示，在响应正文里就会是具体的html内容了。<br>
当然访问不同的页面，就不一定是html，有可能是css, js,甚至图片了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1649.png" alt></p>
<h3 id="5、响应代码"><a class="header-anchor" href="#5、响应代码">¶</a>5、响应代码</h3>
<p>http协议中的响应代码从 1xx ~ 5xx，一共有41种，不过很多状态码很少会接触到。 下面把开发过程中常接触到的讲解一遍</p>
<h4 id="步骤-1-200"><a class="header-anchor" href="#步骤-1-200">¶</a>步骤 1 : 200</h4>
<p>200 表示响应成功了，比如打开页面, 就会看到200响应码</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/login.html</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1641.png" alt></p>
<h4 id="步骤-2-301"><a class="header-anchor" href="#步骤-2-301">¶</a>步骤 2 : 301</h4>
<p>301 表示客户端跳转，永久性的跳转</p>
<p>为了实现301跳转，在Servlet中应该使用如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setStatus(<span class="number">301</span>);</span><br><span class="line">response.setHeader(<span class="string">"Location"</span>, <span class="string">"fail.html"</span>);</span><br></pre></td></tr></table></figure>
<p>请参考 [301或者302客户端跳转]</p>
<h4 id="步骤-3-302"><a class="header-anchor" href="#步骤-3-302">¶</a>步骤 3 : 302</h4>
<p>302 客户端跳转，临时性的跳转</p>
<p>比如访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/addHero.html</span></span><br></pre></td></tr></table></figure>
<p>提交数据会访问addHero，addHero把数据加到数据库后，就会302跳转到listHero来显示新增加的Hero。</p>
<p>在Servlet的代码实现要比301简单点，直接使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"/listHero"</span>)</span><br></pre></td></tr></table></figure>
<p>请参考 [301或者302客户端跳转]</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1643.png" alt></p>
<h4 id="步骤-4-304"><a class="header-anchor" href="#步骤-4-304">¶</a>步骤 4 : 304</h4>
<p>304 表示资源未被修改。</p>
<p>当不是第一次访问一个静态页面或者图片的时候，就会得到这么一个提示。这是服务端提示浏览器，这个<strong>资源没有发生改变</strong>，你直接使用上一次下载的就行了，不需要重新下载。 这样就节约了带宽，并且浏览器的加载速度也更快。</p>
<p>第二次访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/addHero.html</span></span><br></pre></td></tr></table></figure>
<p>就会看到304</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1644.png" alt></p>
<h4 id="步骤-5-404"><a class="header-anchor" href="#步骤-5-404">¶</a>步骤 5 : 404</h4>
<p>404表示访问的页面不存在</p>
<p>比如访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/addHero2.html</span></span><br></pre></td></tr></table></figure>
<p>这是一个不存在的页面，就会得到404响应码<br>
这表示一个浏览器的错误，就是服务端没提供这个服务，但是你却去访问。 这个锅要算到浏览器头上，不能算在服务器头上。</p>
<p>当然，有的时候是因为服务器没有配置这个路径，所以浏览器访问不到对应的资源。 比如在web.xml中，没有配置listHero，就会得到404错误。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1645.png" alt></p>
<h4 id="步骤-6-500"><a class="header-anchor" href="#步骤-6-500">¶</a>步骤 6 : 500</h4>
<p>500 表示服务端的错误</p>
<p>比如增加新的英雄的时候，血量应该是一个数字，但是提交的数据是“100a&quot;。 而在服务端，使用Float.parseFloat() 试图把它转换为数字的时候，就会抛出异常。 这个就属于服务端的问题。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1646.png" alt></p>
<h4 id="步骤-7-更多代码一一览。。。"><a class="header-anchor" href="#步骤-7-更多代码一一览。。。">¶</a>步骤 7 : 更多代码一一览。。。</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/7019.png" alt></p>
<h1 id="肆、JSP"><a class="header-anchor" href="#肆、JSP">¶</a>肆、JSP</h1>
<h2 id="一、基础-v4"><a class="header-anchor" href="#一、基础-v4">¶</a>一、基础</h2>
<h3 id="1、Hello-JSP"><a class="header-anchor" href="#1、Hello-JSP">¶</a>1、Hello JSP</h3>
<p>通过[Servlet]进行整个网站的开发是可以的。 不过在Servlet中输出html代码，特别是稍微复杂一点的html代码，就会给人一种很<strong>酸爽</strong>的感觉。</p>
<p>如果能够直接使用Html代码，然后在html中写java代码，就好了~</p>
<p>JSP … 就可以干这个事情。</p>
<h4 id="步骤-1-hello-jsp"><a class="header-anchor" href="#步骤-1-hello-jsp">¶</a>步骤 1 : hello.jsp</h4>
<p>在web目录下下新建一个文件hello.jsp</p>
<p>访问网页</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/hello.jsp</span></span><br></pre></td></tr></table></figure>
<p><strong>注： 不需要重启tomcat</strong></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1650.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">你好 JSP</span><br><span class="line"> </span><br><span class="line">&lt;br&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=<span class="keyword">new</span> Date().toLocaleString()%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-代码解释"><a class="header-anchor" href="#步骤-2-代码解释">¶</a>步骤 2 : 代码解释</h4>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> contentType=<span class="string">"text/html; charset=UTF-8"</span>  pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>是JSP的**&lt;%@page指令**</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br></pre></td></tr></table></figure>
<p>相当于response.setContentType(“text/html; charset=UTF-8”); 通知浏览器以UTF-8进行中文解码</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pageEncoding=<span class="string">"UTF-8"</span></span><br></pre></td></tr></table></figure>
<p>如果jsp文件中出现了中文，这些中文使用UTF-8进行编码</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>=<span class="string">"java.util.*</span></span><br></pre></td></tr></table></figure>
<p>导入其他类，如果导入多个类，彼此用,逗号隔开，像这样 <strong>import=&quot;java.util.*,java.sql.*&quot;</strong></p>
<h4 id="步骤-3"><a class="header-anchor" href="#步骤-3">¶</a>步骤 3 : &lt;%=</h4>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=<span class="keyword">new</span> Date().toLocaleString()%&gt;</span><br></pre></td></tr></table></figure>
<p>输出当前时间，相当于在Servlet中使用[response.getWriter()]进行输出</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.getWriter().println(<span class="keyword">new</span> Date().toLocaleString());</span><br></pre></td></tr></table></figure>
<h3 id="2、执行过程"><a class="header-anchor" href="#2、执行过程">¶</a>2、执行过程</h3>
<p>为什么JSP可以在html中运行java代码？ 这是因为JSP被转译成了[Servlet]</p>
<h4 id="步骤-1-执行过程"><a class="header-anchor" href="#步骤-1-执行过程">¶</a>步骤 1 : 执行过程</h4>
<ol>
<li>
<p>把 hello.jsp<strong>转译</strong>为hello_jsp.java</p>
</li>
<li>
<p>hello_jsp.java 位于<br>
d:\tomcat\work\Catalina\localhost_\org\apache\jsp</p>
</li>
<li>
<p>hello_jsp.java<strong>是一个servlet</strong></p>
</li>
<li>
<p>把hello_jsp.java <strong>编译</strong>为hello_jsp.class</p>
</li>
<li>
<p>执行hello_jsp，生成html</p>
</li>
<li>
<p>通过http协议把html 响应返回给浏览器</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1655.png" alt></p>
<h4 id="步骤-2-hello-jsp-java-为什么是Servlet"><a class="header-anchor" href="#步骤-2-hello-jsp-java-为什么是Servlet">¶</a>步骤 2 : hello_jsp.java 为什么是Servlet</h4>
<p>在[Servlet]章节中，我们说HelloServlet是一个Servlet，不是因为它的类名里有一个&quot;Servlet&quot;，而是因为它继承了 <strong>HttpServlet</strong></p>
<p>打开转译hello.jsp 后得到的hello_jsp.java，可以发现它继承了类<br>
(D:\tomcat\work\Catalina\localhost_\org\apache\jsp\hello_jsp.java)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.jasper.runtime.HttpJspBase</span><br></pre></td></tr></table></figure>
<p>而HttpJspBase 继承了HttpServlet</p>
<p>所以我们说hello_.jsp.java 是一个Servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Generated by the Jasper component of Apache Tomcat</span></span><br><span class="line"><span class="comment"> * Version: Apache Tomcat/7.0.64</span></span><br><span class="line"><span class="comment"> * Generated at: 2017-01-07 01:45:17 UTC</span></span><br><span class="line"><span class="comment"> * Note: The last modified time of this file was set to</span></span><br><span class="line"><span class="comment"> *       the last modified time of the source file after</span></span><br><span class="line"><span class="comment"> *       generation to assist with modification tracking.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> org.apache.jsp;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">hello_jsp</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">HttpJspBase</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">JspSourceDependent</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> javax.servlet.jsp.JspFactory _jspxFactory =</span><br><span class="line">          javax.servlet.jsp.JspFactory.getDefaultFactory();</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; _jspx_dependants;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> javax.el.ExpressionFactory _el_expressionfactory;</span><br><span class="line">  <span class="keyword">private</span> org.apache.tomcat.InstanceManager _jsp_instancemanager;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; getDependants() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_dependants;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();</span><br><span class="line">    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(<span class="keyword">final</span> javax.servlet.http.HttpServletRequest request, <span class="keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException, javax.servlet.ServletException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">final</span> javax.servlet.jsp.PageContext pageContext;</span><br><span class="line">    javax.servlet.http.HttpSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletContext application;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletConfig config;</span><br><span class="line">    javax.servlet.jsp.JspWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> java.lang.Object page = <span class="keyword">this</span>;</span><br><span class="line">    javax.servlet.jsp.JspWriter _jspx_out = <span class="keyword">null</span>;</span><br><span class="line">    javax.servlet.jsp.PageContext _jspx_page_context = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">                <span class="keyword">null</span>, <span class="keyword">true</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      session = pageContext.getSession();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line"> </span><br><span class="line">      out.write(<span class="string">"\r\n"</span>);</span><br><span class="line">      out.write(<span class="string">" \r\n"</span>);</span><br><span class="line">      out.write(<span class="string">"你好 JSP\r\n"</span>);</span><br><span class="line">      out.write(<span class="string">" \r\n"</span>);</span><br><span class="line">      out.write(<span class="string">"&lt;br&gt;\r\n"</span>);</span><br><span class="line">      out.write(<span class="string">" \r\n"</span>);</span><br><span class="line">      out.print(<span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.Throwable t) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(t <span class="keyword">instanceof</span> javax.servlet.jsp.SkipPageException))&#123;</span><br><span class="line">        out = _jspx_out;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="keyword">null</span> &amp;&amp; out.getBufferSize() != <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response.isCommitted()) &#123;</span><br><span class="line">              out.flush();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              out.clearBuffer();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (java.io.IOException e) &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (_jspx_page_context != <span class="keyword">null</span>) _jspx_page_context.handlePageException(t);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(t);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      _jspxFactory.releasePageContext(_jspx_page_context);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、页面元素"><a class="header-anchor" href="#3、页面元素">¶</a>3、页面元素</h3>
<h4 id="步骤-1-页面元素"><a class="header-anchor" href="#步骤-1-页面元素">¶</a>步骤 1 : 页面元素</h4>
<p>jsp由这些页面元素组成：</p>
<ol>
<li>静态内容<br>
就是html,css,javascript等内容</li>
<li>指令<br>
以&lt;%@开始 %&gt; 结尾，比如&lt;%@page import=“java.util.*”%&gt;</li>
<li>表达式 &lt;%=%&gt;<br>
用于输出一段html</li>
<li>Scriptlet<br>
在&lt;%%&gt; 之间，可以写任何java 代码</li>
<li>声明<br>
在&lt;%!%&gt; 之间可以声明字段或者方法。但是不建议这么做。</li>
<li>动作<br>
&lt;jsp:include page=“Filename” &gt; 在jsp页面中包含另一个页面。在包含的章节有详细的讲解</li>
<li>注释 &lt;%-- – %&gt;<br>
不同于 html的注释 <!-- --> 通过jsp的注释，浏览器也看不到相应的代码，相当于在servlet中注释掉了</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1657.png" alt></p>
<h4 id="步骤-2-和-out-println"><a class="header-anchor" href="#步骤-2-和-out-println">¶</a>步骤 2 : &lt;%=%&gt;和 &lt;%out.println()%&gt;</h4>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=<span class="string">"hello jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>就相当于</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%out.println(<span class="string">"hello jsp"</span>);%&gt;</span><br></pre></td></tr></table></figure>
<p>out是jsp的隐式对象，可以直接使用。一共有9种隐式对象，请参考 [隐式对象] 章节</p>
<p><strong>注:</strong> &lt;%=%&gt; 不需要分号结尾，&lt;%%&gt; 需要以分号结尾，和java代码一样</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=<span class="string">"hello jsp"</span>%&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;% out.println(<span class="string">"hello jsp"</span>);%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-for循环"><a class="header-anchor" href="#步骤-3-for循环">¶</a>步骤 3 : for循环</h4>
<p>结合for循环在jsp里输出html是常见的做法。 只是第一次这么写会稍显别扭</p>
<p>下面是一段实例，以供参考</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1659.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    words.add(<span class="string">"today"</span>);</span><br><span class="line">    words.add(<span class="string">"is"</span>);</span><br><span class="line">    words.add(<span class="string">"a"</span>);</span><br><span class="line">    words.add(<span class="string">"great"</span>);</span><br><span class="line">    words.add(<span class="string">"day"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;table width=<span class="string">"200px"</span> align=<span class="string">"center"</span> border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%<span class="keyword">for</span> (String word : words) &#123;%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;&lt;%=word%&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%&#125;%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4、include"><a class="header-anchor" href="#4、include">¶</a>4、include</h3>
<p>每个网页的最下方都有 版权声明等信息。 如果不使用包含，那么每个网页都需要单独写，如果版权声明要修改，则需要很大的工作量。</p>
<p>使用include的办法，只需要准备一个footer.jsp，然后在其他页面包含footer.jsp即可。</p>
<p>修改的时候，只需要修改footer.jsp所有的页面就都修改了，维护成本降低了很多。</p>
<p>include有两种方式[指令include]和[动作include]</p>
<h4 id="步骤-1-首先准备一个footer-jsp"><a class="header-anchor" href="#步骤-1-首先准备一个footer-jsp">¶</a>步骤 1 : 首先准备一个footer.jsp</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1662.png" alt></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"text-align:center"</span>&gt;</span>copyright@2016</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-指令include"><a class="header-anchor" href="#步骤-2-指令include">¶</a>步骤 2 : 指令include</h4>
<p>通过指令</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"footer.jsp"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>在hello.jsp中包含该页面</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1660.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">你好  JSP</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"footer.jsp"</span> %&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-动作include"><a class="header-anchor" href="#步骤-3-动作include">¶</a>步骤 3 : 动作include</h4>
<p>通过动作</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">"footer.jsp"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>在hello.jsp中包含该页面</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1661.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">你好  JSP</span><br><span class="line"> </span><br><span class="line">&lt;jsp:include page=<span class="string">"footer.jsp"</span> /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-指令include和动作include的区别"><a class="header-anchor" href="#步骤-4-指令include和动作include的区别">¶</a>步骤 4 : 指令include和动作include的区别</h4>
<p>通过之前的学习知道，JSP最后会被转译成Servlet</p>
<p>如果是指令include</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"footer.jsp"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>footer.jsp的内容<strong>会被插入到</strong> hello.jsp 转译 成的hello_jsp.java中，最后<strong>只会生成一个hello_jsp.java文件</strong></p>
<p>如果是动作include</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">"footer.jsp"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>footer.jsp的内容<strong>不会被插入到</strong> hello.jsp 转译 成的hello_jsp.java中，<strong>还会有一个footer_jsp.java独立存在</strong>。 hello_jsp.java 会在服务端访问footer_jsp.java,然后把返回的结果，嵌入到响应中。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1663.png" alt></p>
<h4 id="步骤-5-传参"><a class="header-anchor" href="#步骤-5-传参">¶</a>步骤 5 : 传参</h4>
<p>因为指令&lt;%@include 会导致两个jsp合并成为同一个java文件，所以就不存在传参的问题，在发出hello.jsp 里定义的变量，直接可以在footer.jsp中访问。</p>
<p>而动作&lt;jsp:include /&gt;其实是对footer.jsp进行了一次独立的访问，那么就有传参的需要。</p>
<p>如本例：</p>
<ol>
<li>在hello.jsp中使用动作&lt;<strong>jsp:include</strong>，并通过**&lt;jsp:param** 带上参数</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">"footer.jsp"</span>&gt;</span><br><span class="line">	&lt;jsp:param  name=<span class="string">"year"</span> value=<span class="string">"2017"</span> /&gt;</span><br><span class="line">&lt;/jsp:include&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在footer.jsp中，使用**request.getParameter(“year”)**取出year</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello.jsp</span></span><br><span class="line">&lt;%<span class="meta">@page</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">你好 JSP</span><br><span class="line">&lt;%=<span class="keyword">new</span> Date().toLocaleString()%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;jsp:include page=<span class="string">"footer.jsp"</span>&gt;</span><br><span class="line">    &lt;jsp:param  name=<span class="string">"year"</span> value=<span class="string">"2017"</span> /&gt;</span><br><span class="line">&lt;/jsp:include&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//footer.jsp</span></span><br><span class="line">&lt;hr&gt;</span><br><span class="line">    &lt;p style=<span class="string">"text-align:center"</span>&gt;copyright@&lt;%=request.getParameter(<span class="string">"year"</span>)%&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5、跳转"><a class="header-anchor" href="#5、跳转">¶</a>5、跳转</h3>
<p>和[Servlet的跳转]一样，JSP的跳转也分服务端跳转和客户端跳转。</p>
<h4 id="示例-1-首先准备-jump-jsp"><a class="header-anchor" href="#示例-1-首先准备-jump-jsp">¶</a>示例 1 : 首先准备 jump.jsp</h4>
<p>首先准备一个jump.jsp 来分别演示客户端跳转和服务端跳转</p>
<h4 id="示例-2-客户端跳转"><a class="header-anchor" href="#示例-2-客户端跳转">¶</a>示例 2 : 客户端跳转</h4>
<p>jsp的客户端跳转和Servlet中是一样的。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"hello.jsp"</span>);</span><br></pre></td></tr></table></figure>
<p>可以通过[firefox的调试工具]可以观察到访问jump.jsp返回302(临时客户端跳转)，跳转到了hello.jsp</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1664.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    response.sendRedirect(<span class="string">"hello.jsp"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="示例-3-服务端跳转"><a class="header-anchor" href="#示例-3-服务端跳转">¶</a>示例 3 : 服务端跳转</h4>
<p>与[Servlet的服务端跳转]一样，也可以使用</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"hello.jsp"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>
<p>或者使用动作，简化代码</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=<span class="string">"hello.jsp"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1666.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=<span class="string">"hello.jsp"</span>/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="6、cookie"><a class="header-anchor" href="#6、cookie">¶</a>6、cookie</h3>
<h4 id="步骤-1-cookie-在平时生活中的运用"><a class="header-anchor" href="#步骤-1-cookie-在平时生活中的运用">¶</a>步骤 1 : cookie 在平时生活中的运用</h4>
<p>有的网站，登陆的时候，会出现一个选项，问你是否要一周内或者一个月内保持登陆状态。<br>
如果你选了，那么一周之内，都不需要再输入账号密码。<br>
这个功能，就是靠cookie来实现的</p>
<h4 id="步骤-2-什么是cookie"><a class="header-anchor" href="#步骤-2-什么是cookie">¶</a>步骤 2 : 什么是cookie</h4>
<p>Cookie是一种浏览器和服务器交互数据的方式。</p>
<p>Cookie是由服务器端创建，但是<strong>不会保存在服务器</strong>。</p>
<p>创建好之后，发送给浏览器。浏览器<strong>保存在用户本地</strong>。</p>
<p>下一次访问网站的时候，就会把该Cookie发送给服务器。</p>
<h4 id="步骤-3-setCookie-jsp"><a class="header-anchor" href="#步骤-3-setCookie-jsp">¶</a>步骤 3 : setCookie.jsp</h4>
<p>在web目录下创建一个文件 setCookie.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie c = <span class="keyword">new</span> Cookie(<span class="string">"name"</span>, <span class="string">"Gareen"</span>);</span><br></pre></td></tr></table></figure>
<p>创建了一个cookie,名字是&quot;name&quot; 值是&quot;Gareen&quot;</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.setMaxAge(<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br></pre></td></tr></table></figure>
<p>表示这个cookie可以保留一天，如果是0，表示浏览器一关闭就销毁</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.setPath(<span class="string">"/"</span>);</span><br></pre></td></tr></table></figure>
<p>Path表示访问服务器的所有应用都会提交这个cookie到服务端，如果其值是 /a, 那么就表示仅仅访问 /a 路径的时候才会提交 cookie</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.addCookie(c);</span><br></pre></td></tr></table></figure>
<p>通过response把这个cookie保存在浏览器端</p>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/setCookie.jsp</span></span><br></pre></td></tr></table></figure>
<p>通过[HTTP调试工具]也可以在Cookies这一栏看到</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1668.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"javax.servlet.http.Cookie"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    Cookie c = <span class="keyword">new</span> Cookie(<span class="string">"name"</span>, <span class="string">"Gareen"</span>);</span><br><span class="line">    c.setMaxAge(<span class="number">60</span> * <span class="number">24</span> * <span class="number">60</span>);</span><br><span class="line">    c.setPath(<span class="string">"/"</span>);</span><br><span class="line">    response.addCookie(c);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;a href="getCookie.jsp"&gt;跳转到获取cookie的页面&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-getCookie-jsp"><a class="header-anchor" href="#步骤-4-getCookie-jsp">¶</a>步骤 4 : getCookie.jsp</h4>
<p>在web目录下创建文件getCookie.jsp<br>
然后访问网页:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/getCookie.jsp</span></span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies  = request.getCookies();</span><br></pre></td></tr></table></figure>
<p>表示获取所有浏览器传递过来的cookie</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != cookies )</span><br></pre></td></tr></table></figure>
<p>如果浏览器端没有任何cookie，得到的Cookie数组是null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt;= cookies.length - <span class="number">1</span>; d++) &#123;</span><br><span class="line">   out.print(cookies[d].getName() + <span class="string">":"</span> + cookies[d].getValue() + <span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>遍历所有的cookie</p>
<p>可以看到name:Gareen，这个在setCookie.jsp中设置的cookie</p>
<p>注； JSESSIONID 这个不是我们自己设置的cookie，这是tomcat设置的cookie，会在下一章[session]的学习中用到<br>
通过[HTTP调试工具]也可以看到浏览器在请求信息里提交了这个Cookie。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1669.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"javax.servlet.http.Cookie"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    Cookie[] cookies = request.getCookies();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != cookies)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt;= cookies.length - <span class="number">1</span>; d++) &#123;</span><br><span class="line">            out.print(cookies[d].getName() + <span class="string">":"</span> + cookies[d].getValue() + <span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-cookie原理示意图"><a class="header-anchor" href="#步骤-5-cookie原理示意图">¶</a>步骤 5 : cookie原理示意图</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1675.png" alt></p>
<h3 id="7、session"><a class="header-anchor" href="#7、session">¶</a>7、session</h3>
<h4 id="步骤-1-健身房的储物柜"><a class="header-anchor" href="#步骤-1-健身房的储物柜">¶</a>步骤 1 : 健身房的储物柜</h4>
<p>考虑这个场景：<br>
李佳汜到健身房去练胸肌，<strong>首先领了钥匙</strong>，然后进了更衣间，把衣服，裤子，手机，钱包都放在盒子里面。</p>
<p>毛竞也到健身房，去练<strong>翘臀</strong>。<strong>首先领了钥匙</strong>，然后 进了更衣间，把衣服，裤子，手机，《Java 21天从入门到精通》也放在了一个盒子里，但是这个盒子是和李佳汜的是不同的。</p>
<p>健身房，就相当于服务器，盒子，就是会话Session。</p>
<p>切换到我们常见的购物网站的场景<br>
李佳汜登陆天猫之后，在购物车里看到的物品是蜡烛和皮鞭<br>
毛竞登陆天猫之后，在购物车里看到的物品是手铐和《Java 21天从入门到精通》</p>
<h4 id="步骤-2-什么是Session"><a class="header-anchor" href="#步骤-2-什么是Session">¶</a>步骤 2 : 什么是Session</h4>
<p>Session对应的中文翻译是会话。<br>
<strong>会话</strong>指的是从用户打开浏览器访问一个网站开始，无论在这个网站中访问了多少页面，点击了多少链接，都属于同一个会话。 直到该用户关闭浏览器为止，都属于同一个会话。</p>
<h4 id="步骤-3-setSession-jsp"><a class="header-anchor" href="#步骤-3-setSession-jsp">¶</a>步骤 3 : setSession.jsp</h4>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.setAttribute(<span class="string">"name"</span>, <span class="string">"teemo"</span>);</span><br></pre></td></tr></table></figure>
<p>session对象保存数据的方式，有点像Map的键值对(key-value)<br>
&quot;name&quot;是键，“teemo” 是值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"javax.servlet.http.Cookie"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">   session.setAttribute(<span class="string">"name"</span>, <span class="string">"teemo"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;a href="getSession.jsp"&gt;跳转到获取session的页面&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-getSession-jsp"><a class="header-anchor" href="#步骤-4-getSession-jsp">¶</a>步骤 4 : getSession.jsp</h4>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.getAttribute(<span class="string">"name"</span>);</span><br></pre></td></tr></table></figure>
<p>通过session,根据&quot;name&quot; 取出对应的名称</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1672.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"javax.servlet.http.Cookie"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    String name = (String)session.getAttribute(<span class="string">"name"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">session中的name: &lt;%=name%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-Session和Cookie的关系"><a class="header-anchor" href="#步骤-5-Session和Cookie的关系">¶</a>步骤 5 : Session和Cookie的关系</h4>
<p>回到[健身房的储物柜]这一段：</p>
<p>李佳汜和毛竞都有自己的盒子，那么他们怎么知道哪个盒子是自己的呢？<br>
通过钥匙就能找到自己的盒子了。</p>
<p>盒子对应服务器上的Session。<br>
钥匙对应浏览器上的Cookie。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1673.png" alt></p>
<h4 id="步骤-7-如果没有cookie，session如何工作"><a class="header-anchor" href="#步骤-7-如果没有cookie，session如何工作">¶</a>步骤 7 : 如果没有cookie，session如何工作</h4>
<p>如果浏览器把cookie功能关闭，那么服务端就无法获取jsessionid,每一次访问，都会生成一个新的session对象。</p>
<p>为了解决这个问题，可以使用</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.encodeURL(<span class="string">"getSession.jsp"</span>)</span><br></pre></td></tr></table></figure>
<p>response.encodeURL方法会把getSession.jsp这个url转换为</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getSession.jsp;jsessionid=<span class="number">22424</span>AEA86ADBE89F335EEB649D997A8</span><br></pre></td></tr></table></figure>
<p>通过这个方式，提交jsessionid到服务器。 服务器根据这个jsessionid匹配到对应的session. 与session相关的功能，就可以正常工作了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1674.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"javax.servlet.http.Cookie"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">   session.setAttribute(<span class="string">"name"</span>, <span class="string">"teemo"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;a href="&lt;%=response.encodeURL("getSession.jsp")%&gt;"&gt;跳转到获取session的页面&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-session的有效期"><a class="header-anchor" href="#步骤-8-session的有效期">¶</a>步骤 8 : session的有效期</h4>
<p>比如登录一个网站，登录后，在短时间内，依然可以继续访问而不用重新登录。</p>
<p>但是较长时间不登录，依然会要求重新登录，这是因为服务端的session在一段时间不使用后，就失效了。</p>
<p>这个时间，在Tomcat默认配置下，是30分钟。</p>
<p>可以通过 d:/tomcat/conf/web.xml 中的session-config 配置进行调整</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1676.png" alt></p>
<h3 id="8、作用域"><a class="header-anchor" href="#8、作用域">¶</a>8、作用域</h3>
<p>JSP有4个作用域，分别是<br>
<strong>pageContext</strong> 当前页面<br>
<strong>requestContext</strong> 一次请求<br>
<strong>sessionContext</strong> 当前会话<br>
<strong>applicationContext</strong> 全局，所有用户共享</p>
<h4 id="步骤-1-pageContext"><a class="header-anchor" href="#步骤-1-pageContext">¶</a>步骤 1 : pageContext</h4>
<p>准备setContext.jsp和getContext.jsp，分别表示<strong>向作用域设置数据</strong>，和<strong>从作用域获取数据</strong>。</p>
<p>pageContext表示<strong>当前页面作用域</strong></p>
<p>通过pageContext.setAttribute(key,value)的数据，只能在当前页面访问，在其他页面就不能访问了。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1678.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    pageContext.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=pageContext.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=pageContext.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-requestContext"><a class="header-anchor" href="#步骤-2-requestContext">¶</a>步骤 2 : requestContext</h4>
<p>requestContext <strong>表示一次请求</strong>。随着本次请求结束，其中的数据也就被回收。</p>
<p>常用写法是</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>); </span><br><span class="line">request.getAttribute(<span class="string">"name"</span>)</span><br></pre></td></tr></table></figure>
<p>但是也可以用pageContext来做，写成</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pageContext.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>,pageContext.REQUEST_SCOPE);</span><br><span class="line">pageContext.getAttribute(<span class="string">"name"</span>,pageContext.REQUEST_SCOPE)</span><br></pre></td></tr></table></figure>
<p>不过不常用</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%=request.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=request.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-requestContext与服务端跳转"><a class="header-anchor" href="#步骤-3-requestContext与服务端跳转">¶</a>步骤 3 : requestContext与服务端跳转</h4>
<p>requestContext指的是<strong>一次请求</strong><br>
如果发生了<strong>服务端跳转</strong>，从setContext.jsp跳转到getContext.jsp，这其实，<strong>还是一次请求</strong>。 所以在getContext.jsp中，可以取到在requestContext中设置的值</p>
<p>这也是一种<strong>页面间传递数据的方式</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;jsp:forward page=<span class="string">"getContext.jsp"</span>/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=request.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-requestContext与客户端跳转"><a class="header-anchor" href="#步骤-4-requestContext与客户端跳转">¶</a>步骤 4 : requestContext与客户端跳转</h4>
<p>客户端跳转，浏览器会发生一次新的访问，新的访问会产生一个<strong>新的request对象。</strong></p>
<p>所以页面间<strong>客户端跳转</strong>的情况下，是<strong>无法通过request传递数据</strong>的。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">    response.sendRedirect(<span class="string">"getContext.jsp"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=request.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-sessionContext"><a class="header-anchor" href="#步骤-5-sessionContext">¶</a>步骤 5 : sessionContext</h4>
<p>sessionContext 指的是会话，从<strong>一个用户</strong>打开网站的那一刻起，无论访问了多少网页，链接都属于同一个会话，直到浏览器关闭。</p>
<p>所以页面间传递数据，也是可以通过session传递的。</p>
<p>但是，不同用户对应的session是不一样的，所以session无法在不同的用户之间共享数据。</p>
<p>与requestContext类似的，也可以用如下方式来做</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pageContext.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>,pageContext.SESSION_SCOPE);</span><br><span class="line">pageContext.getAttribute(<span class="string">"name"</span>,pageContext.SESSION_SCOPE)</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    session.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">    response.sendRedirect(<span class="string">"getContext.jsp"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=session.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-applicationContext"><a class="header-anchor" href="#步骤-6-applicationContext">¶</a>步骤 6 : applicationContext</h4>
<p>applicationContext 指的是全局，所有用户共享同一个数据</p>
<p>在JSP中使用application对象， application对象是<strong>ServletContext接口的实例</strong><br>
也可以通过 request.getServletContext()来获取。<br>
所以 application == request.getServletContext() 会返回true<br>
application映射的就是web应用本身。</p>
<p>与requestContext类似的，也可以用如下方式来做</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pageContext.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>,pageContext.APPLICATION_SCOPE);</span><br><span class="line">pageContext.getAttribute(<span class="string">"name"</span>,pageContext.APPLICATION_SCOPE)</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    application.setAttribute(<span class="string">"name"</span>,<span class="string">"gareen"</span>);</span><br><span class="line">    System.out.println(application == request.getServletContext());</span><br><span class="line">    response.sendRedirect(<span class="string">"getContext.jsp"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getContext.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%=application.getAttribute(<span class="string">"name"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="9、隐式对象"><a class="header-anchor" href="#9、隐式对象">¶</a>9、隐式对象</h3>
<p>JSP的隐式对象指的是不需要显示定义，直接就可以使用的对象，比如request,response</p>
<p>JSP一共有9个隐式对象，分别是<br>
request,response,out</p>
<p>pageContext, session,application</p>
<p>page,config,exception</p>
<h4 id="步骤-1-request-response-out"><a class="header-anchor" href="#步骤-1-request-response-out">¶</a>步骤 1 : request,response,out</h4>
<p>这三个已经很熟悉了<br>
request 代表<strong>请求</strong> 请参考 [request常见方法]<br>
response 代表<strong>响应</strong> 请参考 [response 用法]<br>
out 代表 <strong>输出</strong></p>
<h4 id="步骤-2-pageContext-session-application"><a class="header-anchor" href="#步骤-2-pageContext-session-application">¶</a>步骤 2 : pageContext, session,application</h4>
<p><strong>pageContext</strong> 代表当<strong>前页面作用域</strong></p>
<p><strong>session</strong> 代表当<strong>会话作用域</strong></p>
<p><strong>application</strong> 代表当<strong>全局作用域</strong></p>
<p>更多的关于作用域的请参考 [作用域]</p>
<h4 id="步骤-3-page"><a class="header-anchor" href="#步骤-3-page">¶</a>步骤 3 : page</h4>
<p>page 对象即表示当前对象<br>
JSP 会被编译为一个Servlet类 ，运行的时候是一个Servlet实例。 page即代表<strong>this</strong></p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1685.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">      </span><br><span class="line">page:&lt;%=page%&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line"><span class="keyword">this</span>:&lt;%=<span class="keyword">this</span>%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-config"><a class="header-anchor" href="#步骤-4-config">¶</a>步骤 4 : config</h4>
<p>config可以获取一些在web.xml中初始化的参数。<br>
在JSP中使用config比较复杂，需要如下几个步骤</p>
<ol>
<li>在web.xml中进行配置</li>
<li>创建一个testconfig.jsp<br>
通过config.getInitParameter(“database-ip”) 获取参数</li>
<li>访问路径，获取web.xml中配置的参数</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/testconfig</span></span><br></pre></td></tr></table></figure>
<p><strong>注1:</strong> 不能通过 <a href="http://127.0.0.1/testconfig.jsp" target="_blank" rel="noopener">http://127.0.0.1/testconfig.jsp</a> 获取参数，只能通过/testconfig路径<br>
**注2：**这种用法不常见，<strong>不推荐使用</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//web.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 把 testconfig.jsp配置为一个 servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testconfig<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-file</span>&gt;</span>/testconfig.jsp<span class="tag">&lt;/<span class="name">jsp-file</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置初始化参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>database-ip<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将路径 testconfig映射到testconfig.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>testconfig<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/testconfig<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//testconfig.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">      </span><br><span class="line">database-ip: &lt;%=config.getInitParameter(<span class="string">"database-ip"</span>)%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-exception"><a class="header-anchor" href="#步骤-5-exception">¶</a>步骤 5 : exception</h4>
<p>exception 对象只有当前页面的&lt;%@page 指令设置为isErrorPage=&quot;true&quot;的时候才可以使用。</p>
<p>同时，在其他页面也需要设置 &lt;%@page 指令 errorPage=&quot;&quot; 来指定一个专门处理异常的页面。</p>
<ol>
<li>
<p>准备一个try.jsp<br>
设置errorPage=“catch.jsp”，表示有异常产生的话，就交给catch.jsp处理<br>
故意在里面造成数组越界异常</p>
</li>
<li>
<p>准备一个catch.jsp<br>
设置 isErrorPage=“true”，表示当前页面可以使用exception对象</p>
</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//try.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> errorPage=<span class="string">"catch.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">    a[<span class="number">20</span>] = <span class="number">5</span>;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//catch.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isErrorPage=<span class="string">"true"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;%=exception%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10、JSTL"><a class="header-anchor" href="#10、JSTL">¶</a>10、JSTL</h3>
<p>JSTL JSP Standard Tag Library 标准标签库</p>
<p>JSTL允许开人员可以像使用HTML[标签] 那样在JSP中开发Java功能。</p>
<p>JSTL库有core, i18n, fmt, sql 等等。</p>
<p>i18n和sql用的很少，core和fmt在工作中会用到，本章节主要讲解core和fmt</p>
<h4 id="步骤-1-导入jar包"><a class="header-anchor" href="#步骤-1-导入jar包">¶</a>步骤 1 : 导入jar包</h4>
<p>为了能够在JSP 中使用JSTL，首先需要两个jar包，分别是jstl.jar 和standard.jar</p>
<p>可以在右侧下载</p>
<p>把这两个jar包放在web/WEB-INF/lib 下</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1689.png" alt></p>
<h4 id="步骤-2-set-out-remove"><a class="header-anchor" href="#步骤-2-set-out-remove">¶</a>步骤 2 : set out remove</h4>
<p>在页面中使用JSTL需要在jsp中 通过指令进行设置</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>prefix=“c” 表示后续的标签使用都会以&lt;c: 开头</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen'&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>在作用域request中设置name,相当于<br>
&lt;%request.setAttribute(“name”,“gareen”)%&gt;</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:out value=<span class="string">"$&#123;name&#125;"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>相当于 &lt;%=request.getAttribute(“name”)%&gt;</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:remove <span class="keyword">var</span>=<span class="string">"name"</span> scope=<span class="string">"request"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>在作用域request中删掉name,相当于<br>
&lt;%request.removeAttribute(“name”)%&gt;</p>
<p>作用域可以是pageContext, request, session, application, 参考 [作用域]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen'&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">通过标签获取name: &lt;c:out value=<span class="string">"$&#123;name&#125;"</span> /&gt; &lt;br&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:remove <span class="keyword">var</span>=<span class="string">"name"</span> scope=<span class="string">"request"</span> /&gt; &lt;br&gt;</span><br><span class="line"> </span><br><span class="line">通过标签获取name: &lt;c:out value=<span class="string">"$&#123;name&#125;"</span> /&gt; &lt;br&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-if-else"><a class="header-anchor" href="#步骤-3-if-else">¶</a>步骤 3 : if else</h4>
<p>JSTL通过**&lt;c:if test=&quot;&quot;&gt;** 进行条件判断</p>
<p>但是JSTL<strong>没有&lt;c:else</strong>，所以常用的办法是在&lt;c:if的条件里取反</p>
<p>配合if使用的还有通过<strong>empty</strong>进行为空判断<br>
empty可以判断对象是否为null,字符串长度是否为0，集合长度是否为0</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"hp"</span> value=<span class="string">"$&#123;10&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;hp&lt;5&#125;"</span>&gt;</span><br><span class="line">    &lt;p&gt;这个英雄要挂了&lt;/p&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!(hp&lt;5)&#125;"</span>&gt;</span><br><span class="line">    &lt;p&gt;这个英雄觉得自己还可以再抢救抢救&lt;/p&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    pageContext.setAttribute(<span class="string">"weapon"</span>, <span class="keyword">null</span>);</span><br><span class="line">    pageContext.setAttribute(<span class="string">"lastwords"</span>, <span class="string">""</span>);</span><br><span class="line">    pageContext.setAttribute(<span class="string">"items"</span>, <span class="keyword">new</span> ArrayList());</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty weapon&#125;"</span>&gt;</span><br><span class="line">    &lt;p&gt;没有装备武器&lt;/p&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty lastwords&#125;"</span>&gt;</span><br><span class="line">    &lt;p&gt;挂了也没有遗言&lt;/p&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty items&#125;"</span>&gt;</span><br><span class="line">    &lt;p&gt;物品栏为空&lt;/p&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-choose"><a class="header-anchor" href="#步骤-4-choose">¶</a>步骤 4 : choose</h4>
<p>虽然JSTL没有提供else标签，但是提供了一个else功能的标签</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">        &lt;c:when test=<span class="string">"$&#123;hp&lt;5&#125;"</span>&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">	&lt;c:otherwise&gt;</span><br><span class="line">	&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>
<p>我个人觉得看上去繁琐，还是习惯用&lt;c:if test=&quot;!&quot; 来表示else</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"hp"</span> value=<span class="string">"$&#123;3&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"$&#123;hp&lt;5&#125;"</span>&gt;</span><br><span class="line">        &lt;p&gt;这个英雄要挂了&lt;/p&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">        &lt;p&gt;这个英雄觉得自己还可以再抢救抢救&lt;/p&gt;</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-forEach"><a class="header-anchor" href="#步骤-5-forEach">¶</a>步骤 5 : forEach</h4>
<p>可以在[JSP中使用for循环]，但是其可读性很差。 借助JSTL的<strong>c:forEach</strong>标签，可以改善可读性</p>
<p>在本例中，分别使用for循环和&lt;c:forEach标签来演示遍历一个List的区别</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>  &gt;</span><br></pre></td></tr></table></figure>
<p><strong>items=&quot;${heros}&quot;</strong> 表示遍历的集合<br>
<strong>var=“hero”</strong> 表示把每一个集合中的元素放在hero上<br>
<strong>varStatus=“st”</strong> 表示遍历的状态</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    List&lt;String&gt; heros = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    heros.add(<span class="string">"塔姆"</span>);</span><br><span class="line">    heros.add(<span class="string">"艾克"</span>);</span><br><span class="line">    heros.add(<span class="string">"巴德"</span>);</span><br><span class="line">    heros.add(<span class="string">"雷克赛"</span>);</span><br><span class="line">    heros.add(<span class="string">"卡莉丝塔"</span>);</span><br><span class="line">    request.setAttribute(<span class="string">"heros"</span>,heros);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!-- 使用jsp中的<span class="keyword">for</span>循环来遍历List --&gt;</span><br><span class="line">&lt;table width=<span class="string">"200px"</span> align=<span class="string">"center"</span> border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;英雄&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">   </span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">int</span> i =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (String hero : heros) &#123;</span><br><span class="line">i++;</span><br><span class="line">%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;&lt;%=i%&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;%=hero%&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%&#125;%&gt;</span><br><span class="line">   </span><br><span class="line">&lt;/table&gt;</span><br><span class="line"> </span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;!-- 使用JSTL中的c:forEach 循环来遍历List --&gt;</span><br><span class="line">&lt;table width=<span class="string">"200px"</span> align=<span class="string">"center"</span> border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;英雄&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">   </span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>  &gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;c:out value="$&#123;st.count&#125;" /&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;c:out value="$&#123;hero&#125;" /&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-forTokens"><a class="header-anchor" href="#步骤-6-forTokens">¶</a>步骤 6 : forTokens</h4>
<p><strong>&lt;c:forTokens</strong>专门用于字符串拆分，并且可以指定多个分隔符</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"heros"</span> value=<span class="string">"塔姆,艾克;巴德|雷克赛!卡莉丝塔"</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:forTokens items=<span class="string">"$&#123;heros&#125;"</span> delims=<span class="string">":;|!"</span> <span class="keyword">var</span>=<span class="string">"hero"</span>&gt;</span><br><span class="line">    &lt;c:out value=<span class="string">"$&#123;hero&#125;"</span> /&gt; &lt;br /&gt;</span><br><span class="line">&lt;/c:forTokens&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-fmt-formatNumber-格式化数字"><a class="header-anchor" href="#步骤-7-fmt-formatNumber-格式化数字">¶</a>步骤 7 : fmt:formatNumber 格式化数字</h4>
<p>fmt 标签常用来进行格式化，其中fmt:formatNumber用于格式化数字<br>
使用之前要加上</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span>  prefix=<span class="string">'fmt'</span> %&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;money&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p><strong>&lt;fmt:formatNumber</strong> 表示格式化数字<br>
<strong>minFractionDigits</strong> 小数点至少要有的位数<br>
<strong>maxFractionDigits</strong> 小数点最多能有的位数</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1695.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span>  prefix=<span class="string">'fmt'</span> %&gt; </span><br><span class="line"> </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"money"</span> value=<span class="string">"888.8"</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"pi"</span> value=<span class="string">"3.1415926"</span> /&gt;</span><br><span class="line">最少两个小数点:</span><br><span class="line">&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;money&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">最多两个小数点:</span><br><span class="line">&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;pi&#125;"</span> maxFractionDigits=<span class="string">"2"</span> /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-fmt-formatDate-格式化日期"><a class="header-anchor" href="#步骤-8-fmt-formatDate-格式化日期">¶</a>步骤 8 : fmt:formatDate 格式化日期</h4>
<p>fmt 标签常用来进行格式化，其中fmt:formatDate 用于格式化日期<br>
和[fmt:formatNumber 格式化数字]一样，使用之前要加上</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span>  prefix=<span class="string">'fmt'</span> %&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;fmt:formatDate value=<span class="string">"$&#123;now&#125;"</span> pattern=<span class="string">"G yyyy年MM月dd日 E"</span>/&gt;</span><br><span class="line">&lt;fmt:formatDate value=<span class="string">"$&#123;now&#125;"</span> pattern=<span class="string">"a HH:mm:ss.S z"</span>/&gt;</span><br><span class="line">&lt;fmt:formatDate value=<span class="string">"$&#123;now&#125;"</span> pattern=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p><strong>&lt;fmt:formatDate</strong> 表示格式化日期<br>
<strong>yyyy</strong> 表示年份<br>
<strong>MM</strong> 表示月份<br>
<strong>dd</strong> 表示日期<br>
<strong>E</strong> 表示星期几</p>
<p><strong>a</strong> 表示是上午还是下午<br>
<strong>HH</strong> 表示小时<br>
<strong>mm</strong> 表示分钟<br>
<strong>ss</strong> 表示秒<br>
<strong>S</strong> 表示毫秒<br>
<strong>z</strong> 表示时区</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/2893.png" alt></p>
<h4 id="步骤-9-fn"><a class="header-anchor" href="#步骤-9-fn">¶</a>步骤 9 : fn:</h4>
<p>fn标签提供各种实用功能，首先使用之前使用加入如下指令</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>用法举例：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;fn:substring(name, <span class="number">0</span>, <span class="number">5</span>)&#125;</span><br></pre></td></tr></table></figure>
<p>获取name的前5位</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>函数</strong></th>
<th style="text-align:center"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">fn:contains(string, substring)</td>
<td style="text-align:center">如果参数string中包含参数substring，返回true</td>
</tr>
<tr>
<td style="text-align:center">fn:containsIgnoreCase(string, substring)</td>
<td style="text-align:center">如果参数string中包含参数substring（忽略大小写），返回true</td>
</tr>
<tr>
<td style="text-align:center">fn:endsWith(string, suffix)</td>
<td style="text-align:center">如果参数 string 以参数suffix结尾，返回true</td>
</tr>
<tr>
<td style="text-align:center">fn:escapeXml(string)</td>
<td style="text-align:center">将有特殊意义的XML (和HTML)转换为对应的XML character entity code，并返回</td>
</tr>
<tr>
<td style="text-align:center">fn:indexOf(string, substring)</td>
<td style="text-align:center">返回参数substring在参数string中第一次出现的位置</td>
</tr>
<tr>
<td style="text-align:center">fn:join(array, separator)</td>
<td style="text-align:center">将一个给定的数组array用给定的间隔符separator串在一起，组成一个新的字符串并返回。</td>
</tr>
<tr>
<td style="text-align:center">fn:length(item)</td>
<td style="text-align:center">返回参数item中包含元素的数量。参数Item类型是数组、collection或者String。如果是String类型,返回值是String中的字符数。</td>
</tr>
<tr>
<td style="text-align:center">fn:replace(string, before, after)</td>
<td style="text-align:center">返回一个String对象。用参数after字符串替换参数string中所有出现参数before字符串的地方，并返回替换后的结果</td>
</tr>
<tr>
<td style="text-align:center">fn:split(string, separator)</td>
<td style="text-align:center">返回一个数组，以参数separator 为分割符分割参数string，分割后的每一部分就是数组的一个元素</td>
</tr>
<tr>
<td style="text-align:center">fn:startsWith(string, prefix)</td>
<td style="text-align:center">如果参数string以参数prefix开头，返回true</td>
</tr>
<tr>
<td style="text-align:center">fn:substring(string, begin, end)</td>
<td style="text-align:center">返回参数string部分字符串, 从参数begin开始到参数end位置，包括end位置的字符</td>
</tr>
<tr>
<td style="text-align:center">fn:substringAfter(string, substring)</td>
<td style="text-align:center">返回参数substring在参数string中后面的那一部分字符串</td>
</tr>
<tr>
<td style="text-align:center">fn:substringBefore(string, substring)</td>
<td style="text-align:center">返回参数substring在参数string中前面的那一部分字符串</td>
</tr>
<tr>
<td style="text-align:center">fn:toLowerCase(string)</td>
<td style="text-align:center">将参数string所有的字符变为小写，并将其返回</td>
</tr>
<tr>
<td style="text-align:center">fn:toUpperCase(string)</td>
<td style="text-align:center">将参数string所有的字符变为大写，并将其返回</td>
</tr>
<tr>
<td style="text-align:center">fn:trim(string)</td>
<td style="text-align:center">去除参数string 首尾的空格，并将其返回</td>
</tr>
</tbody>
</table>
<h3 id="11、EL表达式语言"><a class="header-anchor" href="#11、EL表达式语言">¶</a>11、EL表达式语言</h3>
<p>EL表达式非常好用，<strong>好用的吓死人 ~</strong></p>
<h4 id="示例-1-取值"><a class="header-anchor" href="#示例-1-取值">¶</a>示例 1 : 取值</h4>
<p>不同版本的tomcat是否默认开启对EL表达式的支持，是不一定的。</p>
<p>所以为了保证EL表达式能够正常使用，需要在&lt;%@page 标签里加上<strong>isELIgnored=&quot;false&quot;</strong></p>
<p>使用EL表达式，非常简单</p>
<p>比如使用JSTL输出要写成</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:out value=<span class="string">"$&#123;name&#125;"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>但是用EL只需要</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1696.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen'&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br><span class="line">  </span><br><span class="line">通过标签获取name: &lt;c:out value=<span class="string">"$&#123;name&#125;"</span> /&gt; &lt;br&gt;</span><br><span class="line"> </span><br><span class="line">通过 EL 获取name: $&#123;name&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-2-作用域优先级"><a class="header-anchor" href="#示例-2-作用域优先级">¶</a>示例 2 : 作用域优先级</h4>
<p>EL表达式可以从pageContext,request,session,application[四个作用域]中取到值，如果4个作用域都有name属性怎么办？</p>
<p>EL会按照从高到低的优先级顺序获取<br>
pageContext&gt;request&gt;session&gt;application</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1697.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen-pageContext'&#125;"</span> scope=<span class="string">"page"</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen-request'&#125;"</span> scope=<span class="string">"request"</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen-session'&#125;"</span> scope=<span class="string">"session"</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"$&#123;'gareen-application'&#125;"</span> scope=<span class="string">"application"</span> /&gt;</span><br><span class="line">  </span><br><span class="line"><span class="number">4</span>个作用域都有name,优先获取出来的是 ： $&#123;name&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-3-JavaBean概念"><a class="header-anchor" href="#示例-3-JavaBean概念">¶</a>示例 3 : JavaBean概念</h4>
<p>EL可以很方便的访问JavaBean的属性，那么JavaBean是什么呢？</p>
<p>JavaBean的标准</p>
<ol>
<li>提供无参public的构造方法(默认提供)</li>
<li>每个属性，都有public的getter和setter</li>
<li>如果属性是boolean,那么就对应is和setter方法</li>
</ol>
<p>比如示例代码中的Hero类，默认提供了一个无参的public的构造方法。 同时每个属性都有getter和setter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> damage;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getHp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHp</span><span class="params">(<span class="keyword">float</span> hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDamage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> damage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDamage</span><span class="params">(<span class="keyword">int</span> damage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.damage = damage;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-4-获取JavaBean的属性"><a class="header-anchor" href="#示例-4-获取JavaBean的属性">¶</a>示例 4 : 获取JavaBean的属性</h4>
<p>获取JavaBean的属性，只需要通过.符号操作就可以了。</p>
<p>像这样 ${<a href="http://hero.name" target="_blank" rel="noopener">hero.name</a>} ，就会自动调用getName方法了</p>
<p><strong>注：</strong> 如果属性是boolean类型，那么就会自动调用isXXX方法了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1699.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span> <span class="keyword">import</span>=<span class="string">"bean.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%</span><br><span class="line">    Hero hero =<span class="keyword">new</span> Hero();</span><br><span class="line">    hero.setName(<span class="string">"盖伦"</span>);</span><br><span class="line">    hero.setHp(<span class="number">616</span>);</span><br><span class="line">     </span><br><span class="line">    request.setAttribute(<span class="string">"hero"</span>, hero);</span><br><span class="line">%&gt;</span><br><span class="line">  </span><br><span class="line">英雄名字 ： $&#123;hero.name&#125; &lt;br&gt;</span><br><span class="line">英雄血量 ： $&#123;hero.hp&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-5-结合JSTL的-c-forEach"><a class="header-anchor" href="#示例-5-结合JSTL的-c-forEach">¶</a>示例 5 : 结合JSTL的&lt;c:forEach</h4>
<p>EL还可以结合 JSTL的&lt;c:forEach 使用，进一步简化代码</p>
<p>原代码中的</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:out value=<span class="string">"$&#123;hero&#125;"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>可以简写为</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;hero&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1700.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%</span><br><span class="line">    List&lt;String&gt; heros = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    heros.add(<span class="string">"塔姆"</span>);</span><br><span class="line">    heros.add(<span class="string">"艾克"</span>);</span><br><span class="line">    heros.add(<span class="string">"巴德"</span>);</span><br><span class="line">    heros.add(<span class="string">"雷克赛"</span>);</span><br><span class="line">    heros.add(<span class="string">"卡莉丝塔"</span>);</span><br><span class="line">    request.setAttribute(<span class="string">"heros"</span>,heros);</span><br><span class="line">%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;table width=<span class="string">"200px"</span> align=<span class="string">"center"</span> border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;英雄&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">    </span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>  &gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;st.count&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;hero&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="示例-6-取参"><a class="header-anchor" href="#示例-6-取参">¶</a>示例 6 : 取参</h4>
<p>EL表达式还可以做到request.getParameter(“name”) 这样的形式获取浏览器传递过来的参数<br>
先把jstl.jsp代码改为如例所示，然后访问如下地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/jstl.jsp?name=abc</span><br></pre></td></tr></table></figure>
<p>可以观察到获取了参数 name</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">$&#123;param.name&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例-7-eq"><a class="header-anchor" href="#示例-7-eq">¶</a>示例 7 : eq</h4>
<p>进行条件判断，大大简化了 JSTL的 [c:if] 和 [c:choose] 代码</p>
<p>如例，一行代码就能起到其他好几行代码的效果</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;killNumber ge <span class="number">10</span>? <span class="string">"超神"</span>:<span class="string">"还没超神"</span> &#125;</span><br></pre></td></tr></table></figure>
<p>例子中讲的是大于等于，除此之外的其他用法如下：<br>
eq相等 ne、neq不相等，<br>
gt大于， lt小于<br>
gt大于， lt小于<br>
gte、ge大于等于<br>
lte、le 小于等于<br>
not非 mod求模<br>
is [not] div by是否能被某数整除<br>
is [not] even是否为偶数<br>
is [not] odd是否为奇</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">request.setAttribute(<span class="string">"killNumber"</span>, <span class="string">"10"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">c:<span class="keyword">if</span> 的用法，运行结果：</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;killNumber&gt;=10&#125;"</span>&gt;</span><br><span class="line">超神</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;killNumber&lt;10&#125;"</span>&gt;</span><br><span class="line">还没超神</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">c:choose 的用法，运行结果：</span><br><span class="line"> </span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"$&#123;killNumber&gt;=10&#125;"</span>&gt;</span><br><span class="line">        超神</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">        还没超神</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">EL表达式eq的用法，运行结果：</span><br><span class="line">$&#123;killNumber ge <span class="number">10</span>? <span class="string">"超神"</span>:<span class="string">"还没超神"</span> &#125;</span><br></pre></td></tr></table></figure>
<h1 id="伍、MVC"><a class="header-anchor" href="#伍、MVC">¶</a>伍、MVC</h1>
<h2 id="一、基础-v5"><a class="header-anchor" href="#一、基础-v5">¶</a>一、基础</h2>
<h3 id="1、Hello-MVC"><a class="header-anchor" href="#1、Hello-MVC">¶</a>1、Hello MVC</h3>
<p>MVC是一种分层的设计模式，本章节从Servlet和JSP的局限性谈起，慢慢引入MVC的概念。</p>
<h4 id="步骤-1-仅仅使用Servlet的短处"><a class="header-anchor" href="#步骤-1-仅仅使用Servlet的短处">¶</a>步骤 1 : 仅仅使用Servlet的短处</h4>
<p>在Servlet的章节中，使用了[编辑Hero]的Servlet<br>
根据浏览器提交的id，通过HeroDAO找到对应的Hero,然后在Servlet中组织html显示出来。</p>
<p>可以看到这个Servlet不仅要准备数据，还要准备html。 尤其是准备html，可读性非常差，维护起来也很麻烦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroEditServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">  </span><br><span class="line">        Hero hero = <span class="keyword">new</span> HeroDAO().get(id);</span><br><span class="line">  </span><br><span class="line">        StringBuffer format = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">  </span><br><span class="line">        format.append(<span class="string">"&lt;!DOCTYPE html&gt;"</span>);</span><br><span class="line">  </span><br><span class="line">        format.append(<span class="string">"&lt;form action='updateHero' method='post'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"名字 ： &lt;input type='text' name='name' value='%s' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"血量 ： &lt;input type='text' name='hp'  value='%f' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"伤害： &lt;input type='text' name='damage'  value='%d' &gt; &lt;br&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;input type='hidden' name='id' value='%d'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;input type='submit' value='更新'&gt;"</span>);</span><br><span class="line">        format.append(<span class="string">"&lt;/form&gt;"</span>);</span><br><span class="line">  </span><br><span class="line">        String html = String.format(format.toString(), hero.getName(), hero.getHp(), hero.getDamage(), hero.getId());</span><br><span class="line">  </span><br><span class="line">        response.getWriter().write(html);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-仅仅使用JSP的短处"><a class="header-anchor" href="#步骤-2-仅仅使用JSP的短处">¶</a>步骤 2 : 仅仅使用JSP的短处</h4>
<p>因为在Servlet中编写html有这样的短板，所以索性直接在JSP中开发编辑Hero这个功能</p>
<p>这时会发现，虽然编写html方便了，但是写java代码不如在Servlet中那么方便</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*,bean.*,java.sql.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">    Hero hero = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">     </span><br><span class="line">        Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line">     </span><br><span class="line">        Statement s = c.createStatement();</span><br><span class="line">     </span><br><span class="line">        String sql = <span class="string">"select * from hero where id = "</span> + id;</span><br><span class="line">     </span><br><span class="line">        ResultSet rs = s.executeQuery(sql);</span><br><span class="line">     </span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            hero = <span class="keyword">new</span> Hero();</span><br><span class="line">            String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">            <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">            hero.name = name;</span><br><span class="line">            hero.hp = hp;</span><br><span class="line">            hero.damage = damage;</span><br><span class="line">            hero.id = id;</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">        s.close();</span><br><span class="line">     </span><br><span class="line">        c.close();</span><br><span class="line">     </span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;form action=<span class="string">'updateHero'</span> method=<span class="string">'post'</span>&gt;</span><br><span class="line">    名字 ： &lt;input type=<span class="string">'text'</span> name=<span class="string">'name'</span> value=<span class="string">'&lt;%=hero.getName()%&gt;'</span>&gt; &lt;br&gt;</span><br><span class="line">    血量 ：&lt;input type=<span class="string">'text'</span> name=<span class="string">'hp'</span> value=<span class="string">'&lt;%=hero.getHp()%&gt;'</span>&gt; &lt;br&gt;</span><br><span class="line">    伤害： &lt;input type=<span class="string">'text'</span> name=<span class="string">'damage'</span> value=<span class="string">'&lt;%=hero.getDamage()%&gt;'</span>&gt; &lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">'hidden'</span> name=<span class="string">'id'</span> value=<span class="string">'&lt;%=hero.getId()%&gt;'</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">'submit'</span> value=<span class="string">'更新'</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-结合Servlet和JSP"><a class="header-anchor" href="#步骤-3-结合Servlet和JSP">¶</a>步骤 3 : 结合Servlet和JSP</h4>
<p>既然Servlet和JSP都有各自的优势和短板，那么为什么不结合起来扬长避短呢？<br>
<strong>HeroEditServlet</strong>：只用来从数据库中查询Hero对象，然后跳转到JSP页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">"hero"</span>, hero);</span><br></pre></td></tr></table></figure>
<p>在request中设置hero</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"editHero.jsp"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>
<p>服务端跳转到editHero.jsp，因为是服务端跳转，都属于<strong>同一次请求</strong>，所以可以在editHero.jsp通过request取出来</p>
<p><strong>editHero.jsp:</strong> 不做查询数据库的事情，直接获取从HeroEditServlet传过来的Hero对象，通过EL表达式把request中的hero显示出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HeroEditServlet.java</span></span><br><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroEditServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">        Hero hero = <span class="keyword">new</span> HeroDAO().get(id);</span><br><span class="line">        request.setAttribute(<span class="string">"hero"</span>, hero);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">"editHero.jsp"</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//editHero.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*,bean.*,java.sql.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;form action=<span class="string">'updateHero'</span> method=<span class="string">'post'</span>&gt;</span><br><span class="line">    名字 ： &lt;input type=<span class="string">'text'</span> name=<span class="string">'name'</span> value=<span class="string">'$&#123;hero.name&#125;'</span>&gt; &lt;br&gt;</span><br><span class="line">    血量 ：&lt;input type=<span class="string">'text'</span> name=<span class="string">'hp'</span> value=<span class="string">'$&#123;hero.hp&#125;'</span>&gt; &lt;br&gt;</span><br><span class="line">    伤害： &lt;input type=<span class="string">'text'</span> name=<span class="string">'damage'</span> value=<span class="string">'$&#123;hero.damage&#125;'</span>&gt; &lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">'hidden'</span> name=<span class="string">'id'</span> value=<span class="string">'$&#123;hero.id&#125;'</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">'submit'</span> value=<span class="string">'更新'</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-MVC设计模式"><a class="header-anchor" href="#步骤-4-MVC设计模式">¶</a>步骤 4 : MVC设计模式</h4>
<p>上述例子中结合Serlvet和JSP进行数据的显示，就是一种MVC的思想。</p>
<p>M 代表 模型（<strong>Model</strong>）<br>
V 代表 视图（<strong>View</strong>）<br>
C 代表 控制器（<strong>controller</strong>)</p>
<p>模型是什么呢？ 模型就是数据，就是dao,bean</p>
<p>视图是什么呢？ 就是网页, JSP，用来展示模型中的数据</p>
<p>控制器是什么？ 控制器用来把不同的数据，显示在不同的视图上。 在这个例子的，Servlet就是充当控制器的角色，把Hero对象，显示在JSP上。</p>
<p>控制器的作用就是把不同的数据(Model)，显示在不同的视图(View)上。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1701.png" alt></p>
<h3 id="2、查询"><a class="header-anchor" href="#2、查询">¶</a>2、查询</h3>
<p>使用MVC的思想，结合Servlet和JSP进行查询操作</p>
<h4 id="步骤-1-实体类Hero"><a class="header-anchor" href="#步骤-1-实体类Hero">¶</a>步骤 1 : 实体类Hero</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> damage;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getHp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHp</span><span class="params">(<span class="keyword">float</span> hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDamage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> damage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDamage</span><span class="params">(<span class="keyword">int</span> damage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.damage = damage;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-HeroDAO"><a class="header-anchor" href="#步骤-2-HeroDAO">¶</a>步骤 2 : HeroDAO</h4>
<p>使用在前面教程中用到的HeroDAO用于从数据库查询数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroDAO</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroDAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>, <span class="string">"root"</span>,</span><br><span class="line">                <span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">   </span><br><span class="line">            String sql = <span class="string">"select count(*) from hero"</span>;</span><br><span class="line">   </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                total = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">   </span><br><span class="line">            System.out.println(<span class="string">"total:"</span> + total);</span><br><span class="line">   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">        String sql = <span class="string">"insert into hero values(null,?,?,?)"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">   </span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">   </span><br><span class="line">            ps.execute();</span><br><span class="line">   </span><br><span class="line">            ResultSet rs = ps.getGeneratedKeys();</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">        String sql = <span class="string">"update hero set name= ?, hp = ? , damage = ? where id = ?"</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">   </span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, hero.id);</span><br><span class="line">   </span><br><span class="line">            ps.execute();</span><br><span class="line">   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">   </span><br><span class="line">            String sql = <span class="string">"delete from hero where id = "</span> + id;</span><br><span class="line">   </span><br><span class="line">            s.execute(sql);</span><br><span class="line">   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Hero <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Hero hero = <span class="keyword">null</span>;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line">   </span><br><span class="line">            String sql = <span class="string">"select * from hero where id = "</span> + id;</span><br><span class="line">   </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">   </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line">   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hero;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list(<span class="number">0</span>, Short.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;Hero&gt;();</span><br><span class="line">   </span><br><span class="line">        String sql = <span class="string">"select * from hero order by id desc limit ?,? "</span>;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line">   </span><br><span class="line">            ps.setInt(<span class="number">1</span>, start);</span><br><span class="line">            ps.setInt(<span class="number">2</span>, count);</span><br><span class="line">   </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line">   </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                heros.add(hero);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heros;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-HeroListServlet"><a class="header-anchor" href="#步骤-3-HeroListServlet">¶</a>步骤 3 : HeroListServlet</h4>
<p>作为控制器的HeroListServlet，其作用就是通过dao获取所有的heros对象，然后放在request中，跳转到listHero.jsp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-web-xml"><a class="header-anchor" href="#步骤-4-web-xml">¶</a>步骤 4 : web.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-listHero-jsp"><a class="header-anchor" href="#步骤-5-listHero-jsp">¶</a>步骤 5 : listHero.jsp</h4>
<p>作为视图的listHero.jsp，其作用就是把控制器传过来的数据显示出来</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1706.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3、分页"><a class="header-anchor" href="#3、分页">¶</a>3、分页</h3>
<p>随着数据中记录的增多，网页上显示的数据会越来越多。</p>
<p>当多到一定程度的时候，就会影响用户的体验。</p>
<p>解决办法是通过分页技术，一次只显示数据库中的部分数据，如果要看其他数据，可以通过&quot;下一页&quot; “最后一页” 等翻页操作实现</p>
<h4 id="步骤-1-首先准备-DAO"><a class="header-anchor" href="#步骤-1-首先准备-DAO">¶</a>步骤 1 : 首先准备 DAO</h4>
<p>在DAO中提供方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span></span></span><br></pre></td></tr></table></figure>
<p>start表示开始的个数，count表示取多少条<br>
比如 list(0, 5) ， 即表示第一页，每页有5条数据<br>
比如 list(5, 5) ， 即表示第二页，每页有5条数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroDAO</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            Statement s = c.createStatement();</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select count(*) from hero"</span>;</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                total = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            System.out.println(<span class="string">"total:"</span> + total);</span><br><span class="line"> </span><br><span class="line">            s.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"insert into hero values(null,?,?,?)"</span>;</span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line"> </span><br><span class="line">            ps.execute();</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = ps.getGeneratedKeys();</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"update hero set name= ?, hp = ? , damage = ? where id = ?"</span>;</span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, hero.id);</span><br><span class="line"> </span><br><span class="line">            ps.execute();</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            Statement s = c.createStatement();</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"delete from hero where id = "</span> + id;</span><br><span class="line"> </span><br><span class="line">            s.execute(sql);</span><br><span class="line"> </span><br><span class="line">            s.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Hero <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Hero hero = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            Statement s = c.createStatement();</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from hero where id = "</span> + id;</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            s.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hero;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list(<span class="number">0</span>, Short.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;Hero&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from hero order by id desc limit ?,? "</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line">            ps.setInt(<span class="number">1</span>, start);</span><br><span class="line">            ps.setInt(<span class="number">2</span>, count);</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">"hp"</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                heros.add(hero);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heros;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-只显示5条数据"><a class="header-anchor" href="#步骤-2-只显示5条数据">¶</a>步骤 2 : 只显示5条数据</h4>
<p>修改HeroListServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line">List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br></pre></td></tr></table></figure>
<p>即表示只获取5条数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-下一页"><a class="header-anchor" href="#步骤-3-下一页">¶</a>步骤 3 : 下一页</h4>
<p><strong>HeroListServlet :</strong><br>
通过参数获取start，如果浏览器没有传递参数，就设置为0。<br>
根据start，计算next. next的值就是start+count.<br>
然后把next传递给listHero.jsp</p>
<p><strong>listHero.jsp</strong><br>
在最后面增加一个超链</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?start=$&#123;next&#125;"</span>&gt;</span>[下一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>start=${next} 从服务器传递过来的next值</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1709.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = Integer.parseInt(request.getParameter(<span class="string">"start"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">// 当浏览器没有传参数start时</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> next = start + count;</span><br><span class="line"> </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"next"</span>, next);</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"6"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;next&#125;"&gt;[下一页]&lt;/a&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-上一页"><a class="header-anchor" href="#步骤-4-上一页">¶</a>步骤 4 : 上一页</h4>
<p><strong>HeroListServlet:</strong><br>
根据start，计算pre. pre的值就是start-count.<br>
然后把pre传递给listHero.jsp</p>
<p><strong>listHero.jsp</strong><br>
在下一页前增加一个超链</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?start=$&#123;pre&#125;"</span>&gt;</span>[上一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>start=${pre} 从服务器传递过来的pre值</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1710.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = Integer.parseInt(request.getParameter(<span class="string">"start"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">// 当浏览器没有传参数start时</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> next = start + count;</span><br><span class="line">        <span class="keyword">int</span> pre = start - count;</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"next"</span>, next);</span><br><span class="line">        request.setAttribute(<span class="string">"pre"</span>, pre);</span><br><span class="line"> </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"6"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;pre&#125;"&gt;[上一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;next&#125;"&gt;[下一页]&lt;/a&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-第一页"><a class="header-anchor" href="#步骤-5-第一页">¶</a>步骤 5 : 第一页</h4>
<p>只需要修改listHero.jsp即可</p>
<p>增加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?start=0"</span>&gt;</span>[首  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为首页的start永远都是0</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1711.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"6"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">            &lt;a href="?start=0"&gt;[首  页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;pre&#125;"&gt;[上一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;next&#125;"&gt;[下一页]&lt;/a&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-最后一页"><a class="header-anchor" href="#步骤-6-最后一页">¶</a>步骤 6 : 最后一页</h4>
<p><strong>HeroListServlet:</strong><br>
在HeroListServlet中计算<strong>last</strong><br>
last需要根据总数<strong>total</strong>和每页有多少条数据<strong>count</strong>来计算得出。</p>
<p>同时，还要看total是否能够整除count<br>
假设总数是50，是能够被5整除的，那么最后一页的开始就是45</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">  last = total - count;</span><br></pre></td></tr></table></figure>
<p>假设总数是51，不能够被5整除的，那么最后一页的开始就是50</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last = total - total % count;</span><br></pre></td></tr></table></figure>
<p><strong>listHero.jsp</strong><br>
在下一页后增加一个超链</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?start=$&#123;last&#125;"</span>&gt;</span>[末 页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>start=${last} 从服务器传递过来的last值</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1712.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = Integer.parseInt(request.getParameter(<span class="string">"start"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">// 当浏览器没有传参数start时</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> next = start + count;</span><br><span class="line">        <span class="keyword">int</span> pre = start - count;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> total = <span class="keyword">new</span> HeroDAO().getTotal();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> last;</span><br><span class="line">        <span class="comment">// 假设总数是50，是能够被5整除的，那么最后一页的开始就是45</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">            last = total - count;</span><br><span class="line">        <span class="comment">// 假设总数是51，不能够被5整除的，那么最后一页的开始就是50</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = total - total % count;</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"next"</span>, next);</span><br><span class="line">        request.setAttribute(<span class="string">"pre"</span>, pre);</span><br><span class="line">        request.setAttribute(<span class="string">"last"</span>, last);</span><br><span class="line"> </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"6"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">            &lt;a href="?start=0"&gt;[首  页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;pre&#125;"&gt;[上一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;next&#125;"&gt;[下一页]&lt;/a&gt;</span><br><span class="line">            &lt;a href="?start=$&#123;last&#125;"&gt;[末  页]&lt;/a&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-边界处理"><a class="header-anchor" href="#步骤-7-边界处理">¶</a>步骤 7 : 边界处理</h4>
<p>上一页，下一页有一个问题，<br>
如果在第一页点击上一页，就会看不到数据了，因为在第一页的时候，pre=-5,也就导致传递到serlvet的start=-5;<br>
同样的在最后一页的时候，点击下一页，也有类似的问题。</p>
<p>解决办法是进行边界处理：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pre = pre &lt; <span class="number">0</span> ? <span class="number">0</span> : pre;</span><br></pre></td></tr></table></figure>
<p>如果pre是负数了，就使用0</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next = next &gt; last ? last : next;</span><br></pre></td></tr></table></figure>
<p>如果next大于last，就使用last</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = Integer.parseInt(request.getParameter(<span class="string">"start"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">// 当浏览器没有传参数start时</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> next = start + count;</span><br><span class="line">        <span class="keyword">int</span> pre = start - count;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> total = <span class="keyword">new</span> HeroDAO().getTotal();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> last;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">            last = total - count;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = total - total % count;</span><br><span class="line"> </span><br><span class="line">        pre = pre &lt; <span class="number">0</span> ? <span class="number">0</span> : pre;</span><br><span class="line">        next = next &gt; last ? last : next;</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"next"</span>, next);</span><br><span class="line">        request.setAttribute(<span class="string">"pre"</span>, pre);</span><br><span class="line">        request.setAttribute(<span class="string">"last"</span>, last);</span><br><span class="line"> </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-套上Bootstrap"><a class="header-anchor" href="#步骤-8-套上Bootstrap">¶</a>步骤 8 : 套上Bootstrap</h4>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3044.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;script src="https://how2j.cn/study/js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">"https://how2j.cn/study/css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">&lt;script src="https://how2j.cn/study/js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">     </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"a"</span>).addClass(<span class="string">"btn btn-default btn-xs"</span>);</span><br><span class="line">     </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;table style=<span class="string">"width:500px; margin:44px auto"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span> align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;heros&#125;"</span> <span class="keyword">var</span>=<span class="string">"hero"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="editHero?id=$&#123;hero.id&#125;"&gt;编辑&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteHero?id=$&#123;hero.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/table&gt;</span><br><span class="line">        &lt;nav&gt;</span><br><span class="line">          &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pager"</span>&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;li&gt;&lt;a href="?start=0"&gt;首  页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href="?start=$&#123;pre&#125;"&gt;上一页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href="?start=$&#123;next&#125;"&gt;下一页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href="?start=$&#123;last&#125;"&gt;末  页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;           </span><br><span class="line">        &lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4、用户是否登录"><a class="header-anchor" href="#4、用户是否登录">¶</a>4、用户是否登录</h3>
<p>比如网站提供Hero查询服务，但是前提是用户要登录过才能使用。</p>
<p>如果用户登陆过了，访问listHero，就让用户正常访问，否则就跳转到登陆界面。</p>
<p>这是非常常见的场景，通过使用 [session] 来实现这个功能。</p>
<p>在处理登录的[loginServlet] 中使用将用户名保存在session中。</p>
<p>在[HeroListServlet] 中查看session中是否为空。如果为空，就表示用户没有登陆过，就跳转到登陆页面</p>
<h4 id="步骤-1-在LoginServlet-把验证成功的用户加入到-Session"><a class="header-anchor" href="#步骤-1-在LoginServlet-把验证成功的用户加入到-Session">¶</a>步骤 1 : 在LoginServlet 把验证成功的用户加入到 Session</h4>
<p>如果用户输入正确的账号密码，就跳转到 listHero，并且把用户名以&quot;userName&quot;放进session</p>
<p>如果用户输入错误的账号密码，就跳转到 login.html，让用户重新登陆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(name) &amp;&amp; <span class="string">"123"</span>.equals(password)) &#123;</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"userName"</span>, name);</span><br><span class="line">            response.sendRedirect(<span class="string">"listHero"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-在HeroListServlet判断Session中是否有数据"><a class="header-anchor" href="#步骤-2-在HeroListServlet判断Session中是否有数据">¶</a>步骤 2 : 在HeroListServlet判断Session中是否有数据</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String userName = (String) request.getSession().getAttribute(<span class="string">"userName"</span>);</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">null</span> == userName) &#123;</span><br><span class="line">   response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从session中取出userName，如果是空，就表示用户没有登录，或者登录已经超过了30分钟。 客户端跳转到login.html，让用户重新登陆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String userName = (String) request.getSession().getAttribute(<span class="string">"userName"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == userName) &#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = Integer.parseInt(request.getParameter(<span class="string">"start"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="comment">// 当浏览器没有传参数start时</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> next = start + count;</span><br><span class="line">        <span class="keyword">int</span> pre = start - count;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> total = <span class="keyword">new</span> HeroDAO().getTotal();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> last;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">            last = total - count;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = total - total % count;</span><br><span class="line"> </span><br><span class="line">        pre = pre &lt; <span class="number">0</span> ? <span class="number">0</span> : pre;</span><br><span class="line">        next = next &gt; last ? last : next;</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"next"</span>, next);</span><br><span class="line">        request.setAttribute(<span class="string">"pre"</span>, pre);</span><br><span class="line">        request.setAttribute(<span class="string">"last"</span>, last);</span><br><span class="line"> </span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list(start, count);</span><br><span class="line">        request.setAttribute(<span class="string">"heros"</span>, heros);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listHero.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、CRUD"><a class="header-anchor" href="#5、CRUD">¶</a>5、CRUD</h3>
<p>CRUD需要的步骤比较繁琐，无法在一个知识点讲清楚，所以。。。直接给出了我做好的CRUD 可运行项目</p>
<h1 id="陆、FILTER"><a class="header-anchor" href="#陆、FILTER">¶</a>陆、FILTER</h1>
<h2 id="一、基础-v6"><a class="header-anchor" href="#一、基础-v6">¶</a>一、基础</h2>
<h3 id="1、Hello-Filter"><a class="header-anchor" href="#1、Hello-Filter">¶</a>1、Hello Filter</h3>
<h4 id="步骤-1-Filter概念"><a class="header-anchor" href="#步骤-1-Filter概念">¶</a>步骤 1 : Filter概念</h4>
<p>Filter就像一个一个哨卡，用户的请求需要经过Filter<br>
并且可以有多个过滤器</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1719.png" alt></p>
<h4 id="步骤-2-编写-FirstFilter"><a class="header-anchor" href="#步骤-2-编写-FirstFilter">¶</a>步骤 2 : 编写 FirstFilter</h4>
<p>开发一个简单的FirstFilter，用来打印用户访问ip地址和访问的页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpServletRequest request = (HttpServletRequest) req;</span><br></pre></td></tr></table></figure>
<p>doFilter()方法中的req参数的类型是ServletRequest，需要转换为HttpServletRequest类型方便调用某些方法 (参考[request常见方法])</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String ip = request.getRemoteAddr();</span><br></pre></td></tr></table></figure>
<p>获取来路用户的ip地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url = request.getRequestURL().toString();</span><br></pre></td></tr></table></figure>
<p>获取用户访问的页面地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(<span class="string">"%s %s 访问了 %s%n"</span>, date, ip, url);</span><br></pre></td></tr></table></figure>
<p>在控制台打印出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chain.doFilter(request, response);</span><br></pre></td></tr></table></figure>
<p>过滤器<strong>放行</strong>，表示继续运行下一个过滤器，或者最终访问的某个servlet,jsp,html等等</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1717.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"> </span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line">        String url = request.getRequestURL().toString();</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        Date d = <span class="keyword">new</span> Date();</span><br><span class="line">        String date = sdf.format(d);</span><br><span class="line"> </span><br><span class="line">        System.out.printf(<span class="string">"%s %s 访问了 %s%n"</span>, date, ip, url);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-配置web-xml"><a class="header-anchor" href="#步骤-3-配置web-xml">¶</a>步骤 3 : 配置web.xml</h4>
<p>在web.xml中进行filter的配置，和servlet的配置很类似</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表示所有的访问都会过滤</p>
<p>如果配置成</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>就表示只过滤jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;FirstFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;filter-class&gt;filter.FirstFilter&lt;&#x2F;filter-class&gt;</span><br><span class="line">&lt;&#x2F;filter&gt;</span><br><span class="line"> </span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">    &lt;filter-name&gt;FirstFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;&#x2F;*&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;&#x2F;filter-mapping&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-访问页面"><a class="header-anchor" href="#步骤-4-访问页面">¶</a>步骤 4 : 访问页面</h4>
<p>重启tomcat,所有用户的访问信息，都可以打印出来</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1720.png" alt></p>
<h4 id="步骤-5-init-方法"><a class="header-anchor" href="#步骤-5-init-方法">¶</a>步骤 5 : init() 方法</h4>
<p>与Servlet需要配置[自启动]才会随着tomcat的启动而执行init()方法不一样。</p>
<p>Filter<strong>一定</strong>会随着tomcat的启动自启动。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1721.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"> </span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line">        String url = request.getRequestURL().toString();</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        Date d = <span class="keyword">new</span> Date();</span><br><span class="line">        String date = sdf.format(d);</span><br><span class="line"> </span><br><span class="line">        System.out.printf(<span class="string">"%s %s 访问了 %s%n"</span>, date, ip, url);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"First Filter init()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-Filter启动失败"><a class="header-anchor" href="#步骤-6-Filter启动失败">¶</a>步骤 6 : Filter启动失败</h4>
<p>Filter是web应用非常重要的一个环节，如果Filter启动失败，或者本身有编译错误，<strong>不仅这个Filter不能使用</strong>，<strong>整个web应用会启动失败</strong>，导致用户无法访问页面</p>
<p>在启动tomcat过程中，也会看到这样的字样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">严重: Context [] startup failed due to previous errors</span><br></pre></td></tr></table></figure>
<p>这常常用于提示Filter启动失败了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1722.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"> </span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line">        String url = request.getRequestURL().toString();</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        Date d = <span class="keyword">new</span> Date();</span><br><span class="line">        String date = sdf.format(d);</span><br><span class="line"> </span><br><span class="line">        System.out.printf(<span class="string">"%s %s 访问了 %s%n"</span>, date, ip, url);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"故意造成一个异常"</span>);</span><br><span class="line"> </span><br><span class="line">        Object o = <span class="keyword">null</span>;</span><br><span class="line">        o.toString();</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、中文处理"><a class="header-anchor" href="#2、中文处理">¶</a>2、中文处理</h3>
<h4 id="步骤-1-使用Servlet处理的局限性"><a class="header-anchor" href="#步骤-1-使用Servlet处理的局限性">¶</a>步骤 1 : 使用Servlet处理的局限性</h4>
<p>在[通过Servlet获取中文参数] 的章节中知道，可以通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>正确获取UTF-8编码的中文，但是如果有很多servlet都需要获取中文，那么就必须<strong>在每个Servlet中增加这段代码。</strong></p>
<p>有一个简便的办法，那就是通过Filter过滤器进行中文处理 ，那么所有的Servlet都不需要单独处理了。</p>
<h4 id="步骤-2-使用Filter处理"><a class="header-anchor" href="#步骤-2-使用Filter处理">¶</a>步骤 2 : 使用Filter处理</h4>
<p>创建一个 EncodingFilter ，设置如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>doFilter方法的第一个参数req,是ServletRequest 类型的，不支持setCharacterEncoding，所以要先强制转换为HttpServletRequest</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"> </span><br><span class="line">        request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-配置web-xml-v2"><a class="header-anchor" href="#步骤-3-配置web-xml-v2">¶</a>步骤 3 : 配置web.xml</h4>
<p>配置EncodingFilter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表示为所有的访问都使用该Filter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>EncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>filter.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>EncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-测试"><a class="header-anchor" href="#步骤-4-测试">¶</a>步骤 4 : 测试</h4>
<p>测试前，记得把HeroAddServlet中的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<p>注释掉</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1726.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Hero;</span><br><span class="line"><span class="keyword">import</span> dao.HeroDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// request.setCharacterEncoding("UTF-8");</span></span><br><span class="line"> </span><br><span class="line">        Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">        hero.setName(request.getParameter(<span class="string">"name"</span>));</span><br><span class="line">        hero.setHp(Float.parseFloat(request.getParameter(<span class="string">"hp"</span>)));</span><br><span class="line">        hero.setDamage(Integer.parseInt(request.getParameter(<span class="string">"damage"</span>)));</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">new</span> HeroDAO().add(hero);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listHero"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、登陆验证"><a class="header-anchor" href="#3、登陆验证">¶</a>3、登陆验证</h3>
<h4 id="步骤-1-在Servlet中进行登陆验证的局限性"><a class="header-anchor" href="#步骤-1-在Servlet中进行登陆验证的局限性">¶</a>步骤 1 : 在Servlet中进行登陆验证的局限性</h4>
<p>在[用户是否登陆的验证]中，我们可以通过在HeroListServlet中增加对session的判断代码来做到登陆验证。</p>
<p>但是按照这样的做法，所有的Servlet都要加上一样的代码，就会显得比较累赘。</p>
<p>与通过[Filter处理中文问题]一样，也可以通过Filter一次性解决所有的登陆验证问题</p>
<h4 id="步骤-2-使用Filter处理-v2"><a class="header-anchor" href="#步骤-2-使用Filter处理-v2">¶</a>步骤 2 : 使用Filter处理</h4>
<p>创建一个AuthFilter 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String uri = request.getRequestURI();</span><br><span class="line"><span class="keyword">if</span> (uri.endsWith(<span class="string">"login.html"</span>) || uri.endsWith(<span class="string">"login"</span>)) &#123;</span><br><span class="line">	chain.doFilter(request, response);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先判断是否是访问的login.html和loginHero，因为这两个页面就是在还<strong>没有登陆之前就需要访问的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String userName = (String) request.getSession().getAttribute(<span class="string">"userName"</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> == userName) &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从Session中获取userName，如果没有，就表示不曾登陆过，跳转到登陆页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"> </span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        <span class="keyword">if</span> (uri.endsWith(<span class="string">"login.html"</span>) || uri.endsWith(<span class="string">"login"</span>)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        String userName = (String) request.getSession().getAttribute(<span class="string">"userName"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == userName) &#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-配置web-xml-v3"><a class="header-anchor" href="#步骤-3-配置web-xml-v3">¶</a>步骤 3 : 配置web.xml</h4>
<p>配置AuthFilter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>AuthFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>filter.AuthFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>AuthFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-练习-在login-jsp页面的js-css和图片文件"><a class="header-anchor" href="#步骤-4-练习-在login-jsp页面的js-css和图片文件">¶</a>步骤 4 : 练习-在login.jsp页面的js,css和图片文件</h4>
<p>因为这个过滤器的存在，在登陆之前所有的资源都不能访问。 所以在login.jsp上如果有图片，js和css，也不能够正常显示和工作。</p>
<p>这样做当然是不行的，那么如何让js css和图片文件即使在不登陆的情况下，也可以访问呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line">  </span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//如果访问的资源是以css或者js结尾的，那么就不需要判断是否登录</span></span><br><span class="line">        <span class="keyword">if</span> (uri.endsWith(<span class="string">".css"</span>) || uri.endsWith(<span class="string">".js"</span>)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;        </span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span> (uri.endsWith(<span class="string">"login.html"</span>) || uri.endsWith(<span class="string">"login"</span>)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        String userName = (String) request.getSession().getAttribute(<span class="string">"userName"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == userName) &#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"login.html"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="柒、LISTENER"><a class="header-anchor" href="#柒、LISTENER">¶</a>柒、LISTENER</h1>
<h2 id="一、基础-v7"><a class="header-anchor" href="#一、基础-v7">¶</a>一、基础</h2>
<h3 id="1、Hello-Listener"><a class="header-anchor" href="#1、Hello-Listener">¶</a>1、Hello Listener</h3>
<p>Listener 的作用是用于监听 web应用的创建和销毁，以及在其上attribute发生的变化。</p>
<p>web应用即ServletContext对象(jsp的[隐式对象application])</p>
<p>除了对[web应用]的监听外，还能监听[session]和[request]的生命周期，以及他们的attribute发生的变化。</p>
<h3 id="2、监听-CONTEXT"><a class="header-anchor" href="#2、监听-CONTEXT">¶</a>2、监听 CONTEXT</h3>
<p>对Context的监听分生命周期的监听，和Context上Attribute变化的监听两种。</p>
<h4 id="步骤-1-编写-ContextListener"><a class="header-anchor" href="#步骤-1-编写-ContextListener">¶</a>步骤 1 : 编写 ContextListener</h4>
<p>ContextListener 实现接口ServletContextListener<br>
有两个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent arg0)</span></span></span><br></pre></td></tr></table></figure>
<p>对应当前web应用的销毁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent arg0)</span></span></span><br></pre></td></tr></table></figure>
<p>对应当前web应用的初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"web 应用销毁  "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"web 应用初始化 "</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-配置-web-xml"><a class="header-anchor" href="#步骤-2-配置-web-xml">¶</a>步骤 2 : 配置 web.xml</h4>
<p>配置监听器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.ContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-测试"><a class="header-anchor" href="#步骤-3-测试">¶</a>步骤 3 : 测试</h4>
<p>在启动tomcat以及当前web应用重载的时候可以观察到<br>
web应用的自动重载需要如下前提：</p>
<ol>
<li>
<p>配置： server.xml中对应的**&lt;context**配置 的属性 @reloadable=“true”</p>
</li>
<li>
<p>某个servlet 发生了变化，导致这个web应用自动重启</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1794.png" alt></p>
<h4 id="步骤-4-编写-ContextAttributeListener"><a class="header-anchor" href="#步骤-4-编写-ContextAttributeListener">¶</a>步骤 4 : 编写 ContextAttributeListener</h4>
<p>ContextAttributeListener 实现接口ServletContextAttributeListener，<br>
分别提供如下方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletContextAttributeEvent e)</span></span></span><br></pre></td></tr></table></figure>
<p>监听属性的增加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletContextAttributeEvent e)</span></span></span><br></pre></td></tr></table></figure>
<p>监听属性的移除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletContextAttributeEvent e)</span></span></span><br></pre></td></tr></table></figure>
<p>监听属性的替换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeListener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextAttributeListener</span> <span class="keyword">implements</span> <span class="title">ServletContextAttributeListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletContextAttributeEvent e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"增加属性 "</span>);</span><br><span class="line">        System.out.println(<span class="string">"属性是"</span> + e.getName());</span><br><span class="line">        System.out.println(<span class="string">"值是"</span> + e.getValue());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletContextAttributeEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"移除属性 "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletContextAttributeEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"替换属性"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-配置web-xml-v4"><a class="header-anchor" href="#步骤-5-配置web-xml-v4">¶</a>步骤 5 : 配置web.xml</h4>
<p>配置ContextAttributeListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.ContextAttributeListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-testContext-jsp"><a class="header-anchor" href="#步骤-6-testContext-jsp">¶</a>步骤 6 : testContext.jsp</h4>
<p>故意造成Context属性的增加，替换和移除</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    application.setAttribute(<span class="string">"test"</span>, <span class="number">1</span>);</span><br><span class="line">    application.setAttribute(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">    application.removeAttribute(<span class="string">"test"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-测试-v2"><a class="header-anchor" href="#步骤-7-测试-v2">¶</a>步骤 7 : 测试</h4>
<p>访问页面进行测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/testContext.jsp</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1798.png" alt></p>
<h3 id="3、监听-Session"><a class="header-anchor" href="#3、监听-Session">¶</a>3、监听 Session</h3>
<p>对Session的监听分生命周期的监听，和Session上Attribute变化的监听两种。</p>
<h4 id="步骤-1-编写-SessionListener"><a class="header-anchor" href="#步骤-1-编写-SessionListener">¶</a>步骤 1 : 编写 SessionListener</h4>
<p>SessionListener 实现了接口 HttpSessionListener</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessionCreated()</span><br></pre></td></tr></table></figure>
<p>表示session创建的时候执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessionDestroyed()</span><br></pre></td></tr></table></figure>
<p>表示session销毁的时候执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent e)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"监听到 session 创建, sessionid 是： "</span> + e.getSession().getId());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent e)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"监听到 session 销毁, sessionid 是： "</span> + e.getSession().getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-配置web-xml"><a class="header-anchor" href="#步骤-2-配置web-xml">¶</a>步骤 2 : 配置web.xml</h4>
<p>配置SessionListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.SessionListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-测试-v2"><a class="header-anchor" href="#步骤-3-测试-v2">¶</a>步骤 3 : 测试</h4>
<p>随意访问任意页面<br>
如果是第一次访问，都会触发session创建，后续访问不会触发session的创建</p>
<p>关闭浏览器，再访问，也会触发session的创建。 但是有的浏览器，即便是关闭了，下一次打开，也会发送以前sessionid到服务器，这样服务器就不会创建新的session。 请参考 [session原理示意图]</p>
<p>session的销毁不易观察到，一般说来[服务器会设置session存活时间为30分钟]。所以需要等待才能观察到销毁</p>
<p><strong>注：</strong> 在重启tomcat测试之前， 要删除<strong>D:\tomcat\work\Catalina\localhost_\SESSIONS.ser</strong> 这个文件。 这个文件是tomcat存放以前的session的，为了观察到创建session的活动，需要tomcat重启之前把以前的session都清除掉，才能观察到新创建session的活动</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1801.png" alt></p>
<h4 id="步骤-4-编写-SessionAttributeListener"><a class="header-anchor" href="#步骤-4-编写-SessionAttributeListener">¶</a>步骤 4 : 编写 SessionAttributeListener</h4>
<p>SessionAttributeListener 实现接口 HttpSessionAttributeListener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeAdded()</span><br></pre></td></tr></table></figure>
<p>当在session中增加属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeRemoved()</span><br></pre></td></tr></table></figure>
<p>当在session中移除属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeReplaced()</span><br></pre></td></tr></table></figure>
<p>当替换session中的属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionAttributeListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionAttributeListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(HttpSessionBindingEvent e)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"session 增加属性 "</span>);</span><br><span class="line">        System.out.println(<span class="string">"属性是"</span> + e.getName());</span><br><span class="line">        System.out.println(<span class="string">"值是"</span> + e.getValue());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(HttpSessionBindingEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"session 移除属性 "</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(HttpSessionBindingEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"session 替换属性 "</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-配置web-xml-v5"><a class="header-anchor" href="#步骤-5-配置web-xml-v5">¶</a>步骤 5 : 配置web.xml</h4>
<p>配置 listener.SessionAttributeListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.SessionAttributeListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-testSession-jsp"><a class="header-anchor" href="#步骤-6-testSession-jsp">¶</a>步骤 6 : testSession.jsp</h4>
<p>在testSession.jsp中，设置session属性 test=1,test=2, 接着删除</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    session.setAttribute(<span class="string">"test"</span>, <span class="number">1</span>);</span><br><span class="line">    session.setAttribute(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">    session.removeAttribute(<span class="string">"test"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-测试-v3"><a class="header-anchor" href="#步骤-7-测试-v3">¶</a>步骤 7 : 测试</h4>
<p>访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/testSession.jsp</span></span><br></pre></td></tr></table></figure>
<p>观察结果</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1805.png" alt></p>
<h3 id="4、监听-Request"><a class="header-anchor" href="#4、监听-Request">¶</a>4、监听 Request</h3>
<p>对Request的监听分生命周期的监听，和Request上Attribute变化的监听两部分。</p>
<h4 id="步骤-1-编写-RequestListener"><a class="header-anchor" href="#步骤-1-编写-RequestListener">¶</a>步骤 1 : 编写 RequestListener</h4>
<p>RequestListener 实现接口 ServletRequestListener和ServletRequestAttributeListener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requestInitialized()</span><br></pre></td></tr></table></figure>
<p>当新创建了一个Request的时候触发，只要访问了服务端的资源，就会创建一个Request，无论是jsp,servlet还是html</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requestDestroyed()</span><br></pre></td></tr></table></figure>
<p>当本次请求结束的时候触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeAdded</span><br></pre></td></tr></table></figure>
<p>当有新增属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeReplaced</span><br></pre></td></tr></table></figure>
<p>当有替换属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributeRemoved</span><br></pre></td></tr></table></figure>
<p>当有移除属性时触发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestListener</span> <span class="keyword">implements</span> <span class="title">ServletRequestListener</span>, <span class="title">ServletRequestAttributeListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"销毁了一个Request "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建了一个Request "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletRequestAttributeEvent e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"request 增加属性 "</span>);</span><br><span class="line">        System.out.println(<span class="string">"属性是"</span> + e.getName());</span><br><span class="line">        System.out.println(<span class="string">"值是"</span> + e.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletRequestAttributeEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"request 移除属性 "</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletRequestAttributeEvent arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"request 替换属性 "</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-配置web-xml-v2"><a class="header-anchor" href="#步骤-2-配置web-xml-v2">¶</a>步骤 2 : 配置web.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.RequestListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-testRequest-jsp"><a class="header-anchor" href="#步骤-3-testRequest-jsp">¶</a>步骤 3 : testRequest.jsp</h4>
<p>测试页面，先在request中设置test,然后替换，最后移出掉test</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">"test"</span>, <span class="number">1</span>);</span><br><span class="line">    request.setAttribute(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">    request.removeAttribute(<span class="string">"test"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-测试-v2"><a class="header-anchor" href="#步骤-4-测试-v2">¶</a>步骤 4 : 测试</h4>
<p>访问页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/testRequest.jsp</span></span><br></pre></td></tr></table></figure>
<p>观察测试结果</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1809.png" alt></p>
<h3 id="5、统计在线人数"><a class="header-anchor" href="#5、统计在线人数">¶</a>5、统计在线人数</h3>
<p>HTTP协议是短链接的，所以无法在服务端根据建立了多少连接来统计当前有多少人在线。 不过可以通过统计session有多少来估计在线人数。</p>
<p>一旦一个用户访问服务器，就会创建一个session. 如果该用户持续访问，那么该session会持续有效。</p>
<p>如果经历了[30分钟]，该用户也没有做任何操作，就表示该用户“下线” 了，其对应的session也会被销毁。</p>
<p>所以可以通过统计有多少session被保留来估计当前在线人数。</p>
<h4 id="步骤-1-编写-OnlineNumberListener"><a class="header-anchor" href="#步骤-1-编写-OnlineNumberListener">¶</a>步骤 1 : 编写 OnlineNumberListener</h4>
<p>OnlineNumberListener 实现接口HttpSessionListener</p>
<p>当创建一个session的时候，就把数字+1，并且放在application里。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServletContext application = e.getSession().getServletContext();</span><br></pre></td></tr></table></figure>
<p>这就是[jsp里的application]</p>
<p><strong>注:</strong> 第一次从application里取数据的时候，是空的，要设置为0。</p>
<p>当销毁一个session的时候，把这个数字-1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> listener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnlineNumberListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent e)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        ServletContext application = e.getSession().getServletContext();</span><br><span class="line"> </span><br><span class="line">        Integer online_number = (Integer) application.getAttribute(<span class="string">"online_number"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == online_number)</span><br><span class="line">            online_number = <span class="number">0</span>;</span><br><span class="line">        online_number++;</span><br><span class="line">        application.setAttribute(<span class="string">"online_number"</span>, online_number);</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"新增一位在线用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent e)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        ServletContext application = e.getSession().getServletContext();</span><br><span class="line"> </span><br><span class="line">        Integer online_number = (Integer) application.getAttribute(<span class="string">"online_number"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==online_number)&#123;</span><br><span class="line">            online_number = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            online_number--;</span><br><span class="line">        application.setAttribute(<span class="string">"online_number"</span>, online_number);</span><br><span class="line">        System.out.println(<span class="string">"一位用户离线"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-配置web-xml-v3"><a class="header-anchor" href="#步骤-2-配置web-xml-v3">¶</a>步骤 2 : 配置web.xml</h4>
<p>配置 listener.OnlineNumberListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>listener.OnlineNumberListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-checkOnlineNumber-jsp"><a class="header-anchor" href="#步骤-3-checkOnlineNumber-jsp">¶</a>步骤 3 : checkOnlineNumber.jsp</h4>
<p>通过[EL表达式]，直接获取application中的值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line"> 当前 在线人数 ： $&#123;online_number&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-测试-v3"><a class="header-anchor" href="#步骤-4-测试-v3">¶</a>步骤 4 : 测试</h4>
<p>访问网页</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/checkOnlineNumber.jsp</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 在重启tomcat测试之前， 要删除<strong>D:\tomcat\work\Catalina\localhost_\SESSIONS.ser</strong> 这个文件。 这个文件是tomcat存放以前的session的，为了观察到创建session的活动，需要tomcat重启之前把以前的session都清除掉，才能观察到新创建session的活动</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/../../Blog-Hexo/source/_posts/J2EE%E3%80%90HOW2J%E3%80%91/1813.png" alt></p>
<h1 id="捌、购物车"><a class="header-anchor" href="#捌、购物车">¶</a>捌、购物车</h1>
<h2 id="一、基础-v8"><a class="header-anchor" href="#一、基础-v8">¶</a>一、基础</h2>
<h3 id="1、类关系"><a class="header-anchor" href="#1、类关系">¶</a>1、类关系</h3>
<p>在开发购物车之前，首先要把几个关键类之间的关系理清楚</p>
<h4 id="步骤-1-类图"><a class="header-anchor" href="#步骤-1-类图">¶</a>步骤 1 : 类图</h4>
<p>首先各个类的意义：</p>
<ol>
<li>
<p>Product 产品</p>
</li>
<li>
<p>User 用户</p>
</li>
<li>
<p>Order 订单</p>
</li>
<li>
<p>OrderItem 订单项</p>
</li>
</ol>
<p>前3者都好理解，<strong>订单项</strong>需要解释一下。</p>
<p>比如阁下在某宝下了<strong>一次订单</strong>，这个订单包括了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">黑色的丝袜 一条</span><br><span class="line">充气娃娃 两个</span><br><span class="line">皮鞭 三根</span><br><span class="line">蜡烛 四个</span><br></pre></td></tr></table></figure>
<p>一条记录就是一个订单项，对应一种商品，以及购买数量。</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1756.png" alt></p>
<h4 id="步骤-2-类关系图"><a class="header-anchor" href="#步骤-2-类关系图">¶</a>步骤 2 : 类关系图</h4>
<ol>
<li>
<p>产品和订单项的关系是 <strong>一对多</strong><br>
一种产品，对应多条订单项。<br>
一条订单项，对应一种产品</p>
</li>
<li>
<p>订单项和订单的关系 <strong>多对一</strong><br>
一个订单里有多条订单项<br>
一个订单项，只会出现在一个订单里</p>
</li>
<li>
<p>订单和用户的关系： <strong>多对一</strong><br>
一个订单，只能属于一个用户<br>
一个用户，可以下多个订单</p>
</li>
</ol>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1751.png" alt></p>
<h3 id="2、产品模块"><a class="header-anchor" href="#2、产品模块">¶</a>2、产品模块</h3>
<p>因为本章节主要讲解如何开发一个购物车，所以产品部分，只提供与购物车相关的产品查询功能。不提供全面的增加，删除，修改，以免分散学习的注意力。</p>
<h4 id="步骤-1-新建一个项目"><a class="header-anchor" href="#步骤-1-新建一个项目">¶</a>步骤 1 : 新建一个项目</h4>
<p>在eclipse中新建一个java项目，项目名称<strong>cart</strong></p>
<h4 id="步骤-2-SQL"><a class="header-anchor" href="#步骤-2-SQL">¶</a>步骤 2 : SQL</h4>
<p>本章节主要讲解如何开发购物车，所以会把重点放在与购物车紧密相关的查询功能方面，不会全面地提供CRUD(增删改查)功能，如果对CRUD还不够熟悉，请参考 [Servlet CRUD ]</p>
<p>在开始之前，需要做一些数据库方面的准备工作.</p>
<ol>
<li>
<p>创建数据库 cart</p>
</li>
<li>
<p>在cart 数据库中创建表product</p>
</li>
<li>
<p>为product准备4条数据</p>
</li>
</ol>
<p>**注：**插入中文的时候，如果失败,要记得把表的编码方式修改为UTF-8</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1762.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database cart;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS &#96;product&#96;;</span><br><span class="line">CREATE TABLE &#96;product&#96; (</span><br><span class="line">  &#96;id&#96; int(11) DEFAULT NULL,</span><br><span class="line">  &#96;name&#96; varchar(50) DEFAULT NULL,</span><br><span class="line">  &#96;price&#96; float DEFAULT NULL</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into product values(1,&#39;黑色的丝袜&#39;,500);</span><br><span class="line">insert into product values(2,&#39;充气娃娃&#39;,2500);</span><br><span class="line">insert into product values(3,&#39;皮鞭&#39;,180);</span><br><span class="line">insert into product values(4,&#39;蜡烛&#39;,0.20);</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-Product"><a class="header-anchor" href="#步骤-3-Product">¶</a>步骤 3 : Product</h4>
<p>Product类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> price;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-ProductDAO"><a class="header-anchor" href="#步骤-4-ProductDAO">¶</a>步骤 4 : ProductDAO</h4>
<p>ProductDAO提供对Product的查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDAO</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="keyword">new</span> ProductDAO().ListProduct().size());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">ListProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;Product&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/cart?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from product order by id desc"</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Product product = <span class="keyword">new</span> Product();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> price = rs.getFloat(<span class="number">3</span>);</span><br><span class="line"> </span><br><span class="line">                product.setId(id);</span><br><span class="line">                product.setName(name);</span><br><span class="line">                product.setPrice(price);</span><br><span class="line">                products.add(product);</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-ProductListServlet"><a class="header-anchor" href="#步骤-5-ProductListServlet">¶</a>步骤 5 : ProductListServlet</h4>
<p>ProductListServlet的作用是通过ProductDAO把product从数据库查出来，然后通过listProduct.jsp显示出来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"><span class="keyword">import</span> dao.ProductDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ProductDAO().ListProduct();</span><br><span class="line"> </span><br><span class="line">        request.setAttribute(<span class="string">"products"</span>, products);</span><br><span class="line"> </span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listProduct.jsp"</span>).forward(request, response);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-listProduct-jsp"><a class="header-anchor" href="#步骤-6-listProduct-jsp">¶</a>步骤 6 : listProduct.jsp</h4>
<p>显示产品名称，价格，并为每种商品提供一个购买按钮。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;价格&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;购买&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"product"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;form action=<span class="string">"addOrderItem"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">             </span><br><span class="line">            数量&lt;input type=<span class="string">"text"</span> value=<span class="string">"1"</span> name=<span class="string">"num"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"pid"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"购买"</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-配置web-xml"><a class="header-anchor" href="#步骤-7-配置web-xml">¶</a>步骤 7 : 配置web.xml</h4>
<p>进行产品查询Servlet的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.ProductListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listProduct<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试-v4"><a class="header-anchor" href="#步骤-8-测试-v4">¶</a>步骤 8 : 测试</h4>
<p>访问网页</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/listProduct</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 要记得访问路径/listProduct，<strong>别直接访问jsp文件</strong> listProduct.jsp</p>
<p>这样就做好进行购买的准备工作，虽然简单，但是足以支持购物车的核心功能了</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1763.png" alt></p>
<h3 id="3、用户模块"><a class="header-anchor" href="#3、用户模块">¶</a>3、用户模块</h3>
<p>要进行购买，还需要用户处于登陆状态，因为后续生成的订单，需要挂在某个用户的名下。</p>
<h4 id="步骤-1-SQL"><a class="header-anchor" href="#步骤-1-SQL">¶</a>步骤 1 : SQL</h4>
<p>与[Product模块]类似的，不提供完整的用户CRUD(增 删 改 查) 也是通过SQL准备User数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int,</span><br><span class="line">name varchar(50),</span><br><span class="line">password varchar(50)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into user values(1,&#39;tom&#39;,&#39;123&#39;);</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-User"><a class="header-anchor" href="#步骤-2-User">¶</a>步骤 2 : User</h4>
<p>User 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-UserDAO"><a class="header-anchor" href="#步骤-3-UserDAO">¶</a>步骤 3 : UserDAO</h4>
<p>根据name和password查询表user,如果有数据就表示账号密码正确</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDAO</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="keyword">new</span> UserDAO().getUser(<span class="string">"tom"</span>, <span class="string">"123"</span>).getId());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">        User result = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/cart?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from user where name = ? and password = ?"</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">            ps.setString(<span class="number">1</span>, name);</span><br><span class="line">            ps.setString(<span class="number">2</span>, password);</span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next())&#123;</span><br><span class="line">                result = <span class="keyword">new</span> User();</span><br><span class="line">                result.setId(rs.getInt(<span class="number">1</span>));</span><br><span class="line">                result.setPassword(password);</span><br><span class="line">                result.setName(name);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-login-jsp"><a class="header-anchor" href="#步骤-4-login-jsp">¶</a>步骤 4 : login.jsp</h4>
<p>登陆页面</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1767.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;form action=<span class="string">"login"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    账号： &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt; &lt;br&gt;</span><br><span class="line">    密码： &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt; &lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-UserLoginServlet"><a class="header-anchor" href="#步骤-5-UserLoginServlet">¶</a>步骤 5 : UserLoginServlet</h4>
<p>登陆Servlet， 通过name和password获取user对象</p>
<p>如果对象不为空，就表示账号密码正确，跳转到产品显示界面 /listProduct<br>
如果对象为空，就跳转到登陆界面，重新登陆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.User;</span><br><span class="line"><span class="keyword">import</span> dao.UserDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">        User user = <span class="keyword">new</span> UserDAO().getUser(name, password);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != user) &#123;</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">            response.sendRedirect(<span class="string">"/listProduct"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            response.sendRedirect(<span class="string">"/login.jsp"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-配置web-xml-v2"><a class="header-anchor" href="#步骤-6-配置web-xml-v2">¶</a>步骤 6 : 配置web.xml</h4>
<p>在web.xml中为路径/login加上相关配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.ProductListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listProduct<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-listProduct-jsp"><a class="header-anchor" href="#步骤-7-listProduct-jsp">¶</a>步骤 7 : listProduct.jsp</h4>
<p>修改listProduct.jsp，如果用户登陆了，就显示用户的名字</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty user&#125;"</span>&gt;</span><br><span class="line">  &lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">	当前用户: $&#123;user.name&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1769.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty user&#125;"</span>&gt;</span><br><span class="line">  &lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">    当前用户: $&#123;user.name&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;价格&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;购买&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"product"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;form action=<span class="string">"addOrderItem"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">             </span><br><span class="line">            数量&lt;input type=<span class="string">"text"</span> value=<span class="string">"1"</span> name=<span class="string">"num"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"pid"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> value=<span class="string">"购买"</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">              </span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试-v5"><a class="header-anchor" href="#步骤-8-测试-v5">¶</a>步骤 8 : 测试</h4>
<p>访问登陆页面，输入账号密码： tom: 123</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/login.jsp</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/3061.png" alt></p>
<h3 id="4、购物车模块"><a class="header-anchor" href="#4、购物车模块">¶</a>4、购物车模块</h3>
<p>从开发者的角度来看，购买行为 就是创建一条一条的<strong>订单项</strong><br>
而显示购物车，也就是把这些订单项显示在页面上。</p>
<p>在这个阶段，订单项都会保存在[session]中，直到最后生成订单的时候，才会把这些订单项保存在数据库中。</p>
<h4 id="步骤-1-SQL-v2"><a class="header-anchor" href="#步骤-1-SQL-v2">¶</a>步骤 1 : SQL</h4>
<p>暂时不需要为OrderItem创建表，因为在这个环节OrderItem还是保存在Session中的</p>
<h4 id="步骤-2-OrderItem"><a class="header-anchor" href="#步骤-2-OrderItem">¶</a>步骤 2 : OrderItem</h4>
<p>OrderItem使用属性Product类型的product，而非int类型的pid，因为在后续[显示购物车]的时候，可以很简单的通过el表达式就显示商品名称和价格了</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;oi.product.name&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-ProductDAO"><a class="header-anchor" href="#步骤-3-ProductDAO">¶</a>步骤 3 : ProductDAO</h4>
<p>因为购买的时候，提交到服务器的是pid, 而OrderItem类的product属性是一个Product类型</p>
<p>所以ProductDAO需要根据id获取Product对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDAO</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="keyword">new</span> ProductDAO().getProduct(<span class="number">1</span>).getName());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Product result = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/cart?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from product where id = ?"</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line">            ps.setInt(<span class="number">1</span>, id);</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                result = <span class="keyword">new</span> Product();</span><br><span class="line">                result.setId(id);</span><br><span class="line"> </span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> price = rs.getFloat(<span class="number">3</span>);</span><br><span class="line"> </span><br><span class="line">                result.setName(name);</span><br><span class="line">                result.setPrice(price);</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">ListProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;Product&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/cart?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"select * from product order by id desc"</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Product product = <span class="keyword">new</span> Product();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> price = rs.getFloat(<span class="number">3</span>);</span><br><span class="line"> </span><br><span class="line">                product.setId(id);</span><br><span class="line">                product.setName(name);</span><br><span class="line">                product.setPrice(price);</span><br><span class="line">                products.add(product);</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-购买商品"><a class="header-anchor" href="#步骤-4-购买商品">¶</a>步骤 4 : 购买商品</h4>
<p>购买行为本身就是创建一个OrderItem对象<br>
在负责购买商品的OrderItemAddServlet 中，进行如下流程</p>
<ol>
<li>获取购买数量</li>
<li>获取购买商品的id</li>
<li>根据id获取商品对象</li>
<li>创建一个新的OrderItem对象</li>
<li>从session中取出一个List , 这个List里面存放陆续购买的商品。<br>
如果是第一次从session中获取该List,那么它会是空的，需要创建一个ArrayList</li>
<li>把新创建的OrderItem对象放入该List 中</li>
<li>跳转到显示购物车的listOrderItem</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.OrderItem;</span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"><span class="keyword">import</span> dao.ProductDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(request.getParameter(<span class="string">"num"</span>));</span><br><span class="line">        <span class="keyword">int</span> pid = Integer.parseInt(request.getParameter(<span class="string">"pid"</span>));</span><br><span class="line">        Product p = <span class="keyword">new</span> ProductDAO().getProduct(pid);</span><br><span class="line"> </span><br><span class="line">        OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line"> </span><br><span class="line">        oi.setNum(num);</span><br><span class="line">        oi.setProduct(p);</span><br><span class="line"> </span><br><span class="line">        List&lt;OrderItem&gt; ois = (List&lt;OrderItem&gt;) request.getSession().getAttribute(<span class="string">"ois"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == ois) &#123;</span><br><span class="line">            ois = <span class="keyword">new</span> ArrayList&lt;OrderItem&gt;();</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"ois"</span>, ois);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        ois.add(oi);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listOrderItem"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-显示购物车内容"><a class="header-anchor" href="#步骤-5-显示购物车内容">¶</a>步骤 5 : 显示购物车内容</h4>
<p>显示购物车的OrderItemListServlet 其实什么也没做，因为数据已经在session准备好了，直接服务端跳转到listOrderItem.jsp</p>
<p>在listOrderItem.jsp中，从session中遍历出所有的OrderItem。 因为保存在OrderItem 上的是一个Product对象，所以很容易就可以通过EL表达式遍历出商品的名称和价格。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;oi.product.name&#125;</span><br><span class="line">$&#123;oi.product.price&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/1771.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"><span class="keyword">import</span> dao.ProductDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.getRequestDispatcher(<span class="string">"listOrderItem.jsp"</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//listOrderItem.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;h1 align="center" &gt;购物车&lt;/h1&gt;</span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;商品名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;单价&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;数量&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;小计&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;ois&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.num&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price*oi.num&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-购买相同商品"><a class="header-anchor" href="#步骤-6-购买相同商品">¶</a>步骤 6 : 购买相同商品</h4>
<p>遍历session中所有的OrderItem</p>
<p>如果找到对应的product.id一样的条目，就调整其数量<br>
如果没有找到，就新增加一条</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.OrderItem;</span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"><span class="keyword">import</span> dao.ProductDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(request.getParameter(<span class="string">"num"</span>));</span><br><span class="line">        <span class="keyword">int</span> pid = Integer.parseInt(request.getParameter(<span class="string">"pid"</span>));</span><br><span class="line">        Product p = <span class="keyword">new</span> ProductDAO().getProduct(pid);</span><br><span class="line"> </span><br><span class="line">        OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line"> </span><br><span class="line">        oi.setNum(num);</span><br><span class="line">        oi.setProduct(p);</span><br><span class="line"> </span><br><span class="line">        List&lt;OrderItem&gt; ois = (List&lt;OrderItem&gt;) request.getSession().getAttribute(<span class="string">"ois"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == ois) &#123;</span><br><span class="line">            ois = <span class="keyword">new</span> ArrayList&lt;OrderItem&gt;();</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"ois"</span>, ois);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span> (orderItem.getProduct().getId() == oi.getProduct().getId()) &#123;</span><br><span class="line">                orderItem.setNum(orderItem.getNum() + oi.getNum());</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (!found)</span><br><span class="line">            ois.add(oi);</span><br><span class="line"> </span><br><span class="line">        response.sendRedirect(<span class="string">"/listOrderItem"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-配置web-xml-v2"><a class="header-anchor" href="#步骤-7-配置web-xml-v2">¶</a>步骤 7 : 配置web.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.ProductListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listProduct<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addOrderItem<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listOrderItem<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-测试-v6"><a class="header-anchor" href="#步骤-8-测试-v6">¶</a>步骤 8 : 测试</h4>
<p>从登陆页面开始，登陆后到产品显示页面，然后修改购买数量，最后点击购买</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1/login.jsp</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-练习-删除订单项"><a class="header-anchor" href="#步骤-9-练习-删除订单项">¶</a>步骤 9 : 练习-删除订单项</h4>
<p>在订单项后面增加一个删除按钮，表示可以删除这个订单项</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;h1 align="center" &gt;购物车&lt;/h1&gt;</span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;商品名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;单价&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;数量&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;小计&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;ois&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.num&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price*oi.num&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href="deleteOrderItem?pid=$&#123;oi.product.id&#125;"&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty ois&#125;"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"5"</span> align=<span class="string">"right"</span>&gt;</span><br><span class="line">                &lt;a href="createOrder"&gt;生成订单&lt;/a&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> bean.OrderItem;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemDeleteServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> pid = Integer.parseInt(request.getParameter(<span class="string">"pid"</span>));</span><br><span class="line"> </span><br><span class="line">        List&lt;OrderItem&gt; ois = (List&lt;OrderItem&gt;) request.getSession().getAttribute(<span class="string">"ois"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois4Delete =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=ois)&#123;</span><br><span class="line">        	<span class="keyword">for</span> (OrderItem io : ois) &#123;</span><br><span class="line">				<span class="keyword">if</span>(io.getProduct().getId()==pid)&#123;</span><br><span class="line">					ois4Delete.add(io);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ois.removeAll(ois4Delete);</span><br><span class="line">        response.sendRedirect(<span class="string">"/listOrderItem"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-10-练习-加入购物车"><a class="header-anchor" href="#步骤-10-练习-加入购物车">¶</a>步骤 10 : 练习-加入购物车</h4>
<p>目前是购买，并且跳转到购物车页面。</p>
<p>修改为&quot;加入购物车“，点击之后，&quot;加入购物车“几个字变灰，不可点。 当前页面也不跳转。 通过ajax把这个数据提交到后台，加入购物车。</p>
<p>要准备一个显示购物车连接。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src="/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line"></span><br><span class="line">$(<span class="string">"input.addCartButton"</span>).removeAttr(<span class="string">"disabled"</span>);</span><br><span class="line">$(<span class="string">"input.addCartButton"</span>).click(function()&#123;</span><br><span class="line">	$(<span class="keyword">this</span>).attr(<span class="string">"disabled"</span>,<span class="string">"disabled"</span>);</span><br><span class="line">	<span class="keyword">var</span> button = $(<span class="keyword">this</span>);</span><br><span class="line">	<span class="keyword">var</span> pid = $(<span class="keyword">this</span>).attr(<span class="string">"pid"</span>);</span><br><span class="line">	<span class="keyword">var</span> number = $(<span class="string">"input.number[pid="</span>+pid+<span class="string">"]"</span>).val();</span><br><span class="line">	<span class="keyword">var</span> page = <span class="string">"/addOrderItem"</span>;</span><br><span class="line">       $.get(</span><br><span class="line">           page,</span><br><span class="line">           &#123;<span class="string">"num"</span>:number,<span class="string">"pid"</span>:pid&#125;,</span><br><span class="line">           function(result)&#123;</span><br><span class="line">        	   $(<span class="string">"#addCartSuccessMessage"</span>).fadeIn(<span class="number">1200</span>);</span><br><span class="line">        	   $(<span class="string">"#addCartSuccessMessage"</span>).fadeOut(<span class="number">1200</span>,function()&#123;</span><br><span class="line">        		   button.removeAttr(<span class="string">"disabled"</span>) ;   </span><br><span class="line">        	   &#125;);</span><br><span class="line">        	   </span><br><span class="line">        	   </span><br><span class="line">           &#125;</span><br><span class="line">       );</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#addCartSuccessMessage"</span>).hide();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty user&#125;"</span>&gt;</span><br><span class="line">  &lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">    当前用户: $&#123;user.name&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;div  align=<span class="string">"center"</span> style=<span class="string">"height:20px;margin:20px;"</span> &gt;</span><br><span class="line">	&lt;span style="color:Chartreuse" id="addCartSuccessMessage"&gt;加入购物车成功&lt;/span&gt; </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;价格&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;购买&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"product"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">             </span><br><span class="line">			            数量&lt;input pid=<span class="string">"$&#123;product.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"number"</span> type=<span class="string">"text"</span> value=<span class="string">"1"</span> name=<span class="string">"num"</span>&gt;</span><br><span class="line">	            &lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"addCartButton"</span> pid=<span class="string">"$&#123;product.id&#125;"</span> type=<span class="string">"submit"</span> value=<span class="string">"加入购物车"</span>&gt;</span><br><span class="line">              </span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    	&lt;tr&gt;</span><br><span class="line">    		&lt;td colspan="4"&gt;&lt;a href="/listOrderItem"&gt;查看购物车&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">    	</span><br><span class="line">    	&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5、订单模块"><a class="header-anchor" href="#5、订单模块">¶</a>5、订单模块</h3>
<p>在购物车页面，增加一个创建订单的超链</p>
<p>通过创建订单，在Order表里新增一条数据，同时把session中的订单条目都保存到数据库中。</p>
<h4 id="步骤-1-SQL-v3"><a class="header-anchor" href="#步骤-1-SQL-v3">¶</a>步骤 1 : SQL</h4>
<p>创建order表，里面有一个uid字段用于表明该订单属于哪个用户<br>
<strong>注：</strong> order是关键字，不能直接用作表名，通常的做法是加一个下划线<strong>order_</strong></p>
<p>创建orderitem,表里有id,pid,num,oid等字段。 分别表示主键，商品对应的id,购买数量以及订单id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table order_(</span><br><span class="line">  id int AUTO_INCREMENT,</span><br><span class="line">  uid int,</span><br><span class="line">  primary key(id)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">create table orderitem(</span><br><span class="line">  id int AUTO_INCREMENT,</span><br><span class="line">  pid int,</span><br><span class="line">  num int,</span><br><span class="line">  oid int,</span><br><span class="line">  primary key(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="步骤-2-Order"><a class="header-anchor" href="#步骤-2-Order">¶</a>步骤 2 : Order</h4>
<p>与[OrderItem]类似的，会有一个User属性，而不是使用int类型的uid。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    User user;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-3-OrderItem"><a class="header-anchor" href="#步骤-3-OrderItem">¶</a>步骤 3 : OrderItem</h4>
<p>OrderItem在原来的基础上，增加一个Order属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-4-OrderDAO"><a class="header-anchor" href="#步骤-4-OrderDAO">¶</a>步骤 4 : OrderDAO</h4>
<p>OrderDAO把订单对象保存到数据库中。</p>
<p>这里需要注意的是，Order对象保存到数据库中后，该对象就会有对应的id，这个id，在后续保存OrderItem的时候，是作为order id存在的。</p>
<p>所以在保存的数据库的时候，要[获取自增长id]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ResultSet rs = ps.getGeneratedKeys();</span><br><span class="line">   <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">   <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">   o.setId(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-5-OrderItemDAO"><a class="header-anchor" href="#步骤-5-OrderItemDAO">¶</a>步骤 5 : OrderItemDAO</h4>
<p>将OrderItem保存到数据库中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.OrderItem;</span><br><span class="line"><span class="keyword">import</span> bean.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemDAO</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(OrderItem oi)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"> </span><br><span class="line">            Connection c = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/cart?characterEncoding=UTF-8"</span>,</span><br><span class="line">                    <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line"> </span><br><span class="line">            String sql = <span class="string">"insert into orderitem values(null,?,?,?)"</span>;</span><br><span class="line"> </span><br><span class="line">            PreparedStatement ps = c.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">            ps.setInt(<span class="number">1</span>,oi.getProduct().getId());</span><br><span class="line">            ps.setInt(<span class="number">2</span>,oi.getNum());</span><br><span class="line">            ps.setInt(<span class="number">3</span>,oi.getOrder().getId());</span><br><span class="line">             </span><br><span class="line">            ps.execute();</span><br><span class="line"> </span><br><span class="line">            ps.close();</span><br><span class="line"> </span><br><span class="line">            c.close();</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-6-listOrderItem-jsp"><a class="header-anchor" href="#步骤-6-listOrderItem-jsp">¶</a>步骤 6 : listOrderItem.jsp</h4>
<p>在listOrderItem.jsp页面新增加一个&quot;生成订单&quot;的链接</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty ois&#125;"</span>&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td colspan=<span class="string">"4"</span> align=<span class="string">"right"</span>&gt;</span><br><span class="line">				&lt;a href="/createOrder"&gt;生成订单&lt;/a&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;h1 align="center" &gt;购物车&lt;/h1&gt;</span><br><span class="line">&lt;table align=<span class="string">'center'</span> border=<span class="string">'1'</span> cellspacing=<span class="string">'0'</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;商品名称&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;单价&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;数量&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;小计&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;ois&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.num&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;oi.product.price*oi.num&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty ois&#125;"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"4"</span> align=<span class="string">"right"</span>&gt;</span><br><span class="line">                &lt;a href="createOrder"&gt;生成订单&lt;/a&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-7-OrderCreateServlet"><a class="header-anchor" href="#步骤-7-OrderCreateServlet">¶</a>步骤 7 : OrderCreateServlet</h4>
<p>OrderCreateServlet创建订单的Servlet</p>
<ol>
<li>首选判断用户是否登陆，如果没有登陆跳转到登陆页面</li>
<li>创建一个订单对象，并设置其所属用户</li>
<li>把该订单对象保存到数据库中</li>
<li>遍历session中所有的订单项，设置他们的Order。 然后保存到数据库中</li>
<li>清空session中的订单项</li>
<li>最后打印订单创建成功</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> bean.Order;</span><br><span class="line"><span class="keyword">import</span> bean.OrderItem;</span><br><span class="line"><span class="keyword">import</span> bean.User;</span><br><span class="line"><span class="keyword">import</span> dao.OrderDAO;</span><br><span class="line"><span class="keyword">import</span> dao.OrderItemDAO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderCreateServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        User u = (User) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"/login.jsp"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        Order o = <span class="keyword">new</span> Order();</span><br><span class="line">        o.setUser(u);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">new</span> OrderDAO().insert(o);</span><br><span class="line"> </span><br><span class="line">        List&lt;OrderItem&gt; ois = (List&lt;OrderItem&gt;) request.getSession().getAttribute(<span class="string">"ois"</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            oi.setOrder(o);</span><br><span class="line">            <span class="keyword">new</span> OrderItemDAO().insert(oi);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        ois.clear();</span><br><span class="line">         </span><br><span class="line">        response.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">"订单创建成功"</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤-8-配置web-xml"><a class="header-anchor" href="#步骤-8-配置web-xml">¶</a>步骤 8 : 配置web.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.ProductListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ProductListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listProduct<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserLoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemAddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/addOrderItem<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderItemListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listOrderItem<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderCreateServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.OrderCreateServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>OrderCreateServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/createOrder<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="步骤-9-测试"><a class="header-anchor" href="#步骤-9-测试">¶</a>步骤 9 : 测试</h4>
<p>点击创建订单后，在数据库中的orderitem表观察到插入的数据</p>
<p><img src="/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/../../Blog-Hexo/source/_posts/J2EE%E3%80%90HOW2J%E3%80%91/1786.png" alt></p>
<h1 id="玖、Thymeleaf"><a class="header-anchor" href="#玖、Thymeleaf">¶</a>玖、Thymeleaf</h1>
<h2 id="一、基础-v9"><a class="header-anchor" href="#一、基础-v9">¶</a>一、基础</h2>
<h3 id="1、简介"><a class="header-anchor" href="#1、简介">¶</a>1、简介</h3>
<h4 id="步骤-1-Thymeleaf"><a class="header-anchor" href="#步骤-1-Thymeleaf">¶</a>步骤 1 : Thymeleaf</h4>
<p>Thymeleaf 是一种模板语言，可以达到和JSP一样的效果，但是比起JSP 对于前端测试更加友好，毕竟JSP需要运行起来才能看到效果，而 Thymeleaf 本身就是 html格式，无需服务器也能看到效果，这样前端测试就方便多了。</p>
<h4 id="步骤-2-系列教程"><a class="header-anchor" href="#步骤-2-系列教程">¶</a>步骤 2 : 系列教程</h4>
<p>Thymeleaf 一般都是和 springboot 一起用的，所以 Thymeleaf 教程就放到 springboot 那里去了，方便与 springboot 进行整合。<br>
Thymeleaf 系列教程请移步： [thymeleaf 系列教材]</p>
<h1 id="拾、前后端分离"><a class="header-anchor" href="#拾、前后端分离">¶</a>拾、前后端分离</h1>
<h2 id="一、基础-v10"><a class="header-anchor" href="#一、基础-v10">¶</a>一、基础</h2>
<h3 id="1、前后端分离"><a class="header-anchor" href="#1、前后端分离">¶</a>1、前后端分离</h3>
<h4 id="步骤-1-什么是前后端分离"><a class="header-anchor" href="#步骤-1-什么是前后端分离">¶</a>步骤 1 : 什么是前后端分离</h4>
<p>要搞清楚前后端分离概念，必须先搞清楚什么是<strong>非</strong>前后端分离。<br>
在传统的做法里，比如servlet, springmvc,struts， tomcat 都会在后台运行 Java 代码，然后在后台生成<strong>全部的html 代码</strong>，接着通过 http 协议把 html 代码传输到浏览器。<br>
这样做的问题是：</p>
<ol>
<li>
<p>在后台运行的时候，如果要连接很多数据库才能把需要的数据查出来，那么这个准备 html 的过程就会比较缓慢，同时生成的 html 也相对较大， 用户就有可能感受比较慢。</p>
</li>
<li>
<p>前后端开发的联调耦合度也很高，有时候必须互相等待，这样双方的开发效率都降低了。</p>
</li>
</ol>
<p>那么前后端分离什么概念呢？ html 页面的内容可以简单看成 包含数据部分和不包含数据部分。 所以先准备一个不包含数据的html， 把它传给浏览器，这个速度本身会非常快，因为没有最占时间的数据库操作部分。 然后再通过 Ajax 技术，仅仅从服务器获取“纯数据”，然后把纯数据显示在html上。<br>
这样做的好处：</p>
<ol>
<li>
<p>即便是后台数据库比较花时间，但是用户体验也比前面的方式好，因为用户会先看到部分页面，过一小会儿再看到数据，比在空白页面打圈圈等待体验好。</p>
</li>
<li>
<p>后端只提供数据，所以前后端开发耦合度降低了很多，整体开发效率可以得到较大提高。</p>
</li>
</ol>
<h4 id="步骤-2-相关教程"><a class="header-anchor" href="#步骤-2-相关教程">¶</a>步骤 2 : 相关教程</h4>
<p>本站陆陆续续提供了各种技术实现的前后端分离，但是比较分散，导致很多同学误以为没有提供相关教程，本知识点就把这些前后端分离的教程归纳一下，方便大家学习。<br>
前端部分需要掌握： AJAX和JSON<br>
前后交互有3种实现： J2EE, SSM 和 Springboot。</p>
<h4 id="步骤-3-前端"><a class="header-anchor" href="#步骤-3-前端">¶</a>步骤 3 : 前端</h4>
<p>Ajax分原生和JQuery两种： [原生 Ajax]，[JQuery中的Ajax]</p>
<p>JSON是数据传输格式： [JSON 教程]</p>
<h4 id="步骤-4-J2EE-方式"><a class="header-anchor" href="#步骤-4-J2EE-方式">¶</a>步骤 4 : J2EE 方式</h4>
<p>J2EE 方式 指通过 Servlet来做服务端： [J2EE方式做前后端分离]</p>
<h4 id="步骤-5-SSM-方式"><a class="header-anchor" href="#步骤-5-SSM-方式">¶</a>步骤 5 : SSM 方式</h4>
<p>SSM 方式 指通过 SpringMVC来做服务端： [SSM方式做前后端分离]</p>
<h4 id="步骤-6-Springboot-方式"><a class="header-anchor" href="#步骤-6-Springboot-方式">¶</a>步骤 6 : Springboot 方式</h4>
<p>Springboot 方式本质上也是通过 SpringMVC来做服务端： [Springboot 方式做前后端分离]</p>
<h4 id="步骤-7-vue-springboot"><a class="header-anchor" href="#步骤-7-vue-springboot">¶</a>步骤 7 : vue + springboot</h4>
<p>[VUE.JS + RESTFUL + PAGEHELPER + THYMELEAF + SPRINGBOOT 前后端分离 CRUD 教程]</p>

      
    </div>
    
    
    

    <div>
     
         <div>
 
  <div style="text-align:center;color:#bfbfbf;font-size:16px;">
   <span>-------- 本文结束 </span>
   <i class="fa fa-paw"></i>
   <span> 感谢阅读 --------</span>
  </div>
 
</div>
     
    </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="潇 卟 甸 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="潇 卟 甸 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <!-- JS库 clipboard 拷贝内容到粘贴板-->
<script src="https://cdn.bootcss.com/clipboard.js/2.0.1/clipboard.min.js"></script>

<!-- JS库 sweetalert 显示提示信息-->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<ul class="post-copyright">
<!-- 本文标题 -->
<li>
  <strong>本文标题： </strong>
  J2EE【HOW2J】
</li>

<!-- 本文作者 -->
<li class="post-copyright-author">
  <strong>本文作者： </strong>
  
</li>

<!-- 创建时间 -->
<li>
  <strong>创建时间： </strong>
  2020年08月21日 - 09时08分
</li>

<!-- 修改时间 -->
<li>
  <strong>修改时间： </strong>
  2020年08月27日 - 17时08分
</li>

<!-- 引用链接 -->
<li class="post-copyright-link">
  <strong>本文链接：</strong>
  <a href="http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/" title="J2EE【HOW2J】"
    >http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/</a
  >
  <span class="copy-path" title="点击复制引用链接"
    ><i
      style="cursor: pointer"
      class="fa fa-clipboard"
      data-clipboard-text="['s Blog | J2EE【HOW2J】](http://yoursite.com/2020/08/21/J2EE%E3%80%90HOW2J%E3%80%91/)"
      aria-label="复制成功"
    ></i
  ></span>
</li>

<!-- 版权声明 -->
<li class="post-copyright-license">
  <strong
    >版权声明：
  </strong>
  本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
</li>
</ul>

<script>
var clipboard = new ClipboardJS(".fa-clipboard");
clipboard.on("success", function(target) {
  var message = document.createElement("div");
  message.innerHTML =
    '<i class="fa fa-check-circle message-icon"></i><span class="message-content">' +
    target.trigger.getAttribute("aria-label") +
    "</span>";
  swal({
    content: message,
    className: "copy-success-message",
    timer: 1000,
    button: false
  });
});
</script>
      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 编程</a>
          
            <a href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag"><i class="fa fa-tag"></i> 源代码</a>
          
            <a href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag"><i class="fa fa-tag"></i> Java实践</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/27/%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86%E3%80%90HOW2J%E3%80%91/" rel="next" title="前端部分【HOW2J】">
                <i class="fa fa-chevron-left"></i> 前端部分【HOW2J】
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/09/08/Java%E6%A1%86%E6%9E%B6%E3%80%90HOW2J%E3%80%91/" rel="prev" title="Java框架【HOW2J】">
                Java框架【HOW2J】 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <a href="/">
              <img class="site-author-image" itemprop="image"
                src="/uploads/picture.jpg"
                alt="潇 卟 甸" />
              </a>
            
              <p class="site-author-name" itemprop="name">潇 卟 甸</p>
              <p class="site-description motion-element" itemprop="description">总结自己一些知识，一些事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">88</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

			
				<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
				<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
				<div class="widget-wrap">
					<div id="myCanvasContainer" class="widget tagcloud">
						<canvas width="250" height="250" id="resCanvas" style="width=100%">
							<ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">62</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag">Java实践</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/b%E7%AB%99%E8%A7%86%E9%A2%91/" rel="tag">b站视频</a><span class="tag-list-count">45</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E7%BA%A7/" rel="tag">中级</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85/" rel="tag">喜马拉雅</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a><span class="tag-list-count">40</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E8%AF%AD/" rel="tag">日语</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag">源代码</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">电子书</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a><span class="tag-list-count">76</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BE%8E%E5%8C%96/" rel="tag">美化</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD/" rel="tag">英语</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" rel="tag">计算机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E6%8E%A8%E8%8D%90/" rel="tag">读书推荐</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E9%98%B6/" rel="tag">进阶</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">7</span></li></ul>
						</canvas>
					</div>
				</div>
			

          </nav>

          

          
		  
		  <!-- 添加近期文章 -->
			
				<div class="links-of-blogroll motion-element links-of-blogroll-block">
				<div class="links-of-blogroll-title">
				<!-- modify icon to fire by szw -->
				<i class="fa fa-history fa-" aria-hidden="true"></i>
				近期文章
				</div>
				<ul class="links-of-blogroll-list">
				
				
					<li>
					<a href="/2021/09/14/%E5%B0%9A%E7%A1%85%E8%B0%B7-Web%E5%89%8D%E7%AB%AFES6%E6%95%99%E7%A8%8B/" title="尚硅谷-Web前端ES6教程" target="_blank">尚硅谷-Web前端ES6教程</a>
					</li>
				
					<li>
					<a href="/2021/08/31/%E5%B0%9A%E7%A1%85%E8%B0%B7-%E5%AF%86%E7%A0%81%E5%AD%A6%E6%95%99%E7%A8%8B/" title="尚硅谷-密码学教程" target="_blank">尚硅谷-密码学教程</a>
					</li>
				
					<li>
					<a href="/2021/08/31/%E5%B0%9A%E7%A1%85%E8%B0%B7-Elasticsearch%E6%95%99%E7%A8%8B/" title="尚硅谷-Elasticsearch教程" target="_blank">尚硅谷-Elasticsearch教程</a>
					</li>
				
					<li>
					<a href="/2021/08/26/Java%E9%9D%A2%E8%AF%95300%E9%A2%98%EF%BC%88%E4%B8%8B%EF%BC%89/" title="Java面试300题（下）" target="_blank">Java面试300题（下）</a>
					</li>
				
					<li>
					<a href="/2021/08/26/Java%E9%9D%A2%E8%AF%95300%E9%A2%98%EF%BC%88%E4%B8%AD%EF%BC%89/" title="Java面试300题（中）" target="_blank">Java面试300题（中）</a>
					</li>
				
				</ul>
			</div>
			

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sushan102.top/posts/1410804403/" title="博客搭建" target="_blank">博客搭建</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://how2j.cn?p=154642" title="HOW2J" target="_blank">HOW2J</a>
                  </li>
                
              </ul>
            </div>
          
		  
		  
			
		  
		  <div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>


        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#壹、Tomcat"><span class="nav-text">壹、Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、Hello-Tomcat"><span class="nav-text">1、Hello Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-不使用tomcat访问html"><span class="nav-text">步骤 1 : 不使用tomcat访问html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-使用tomcat后，访问html"><span class="nav-text">步骤 2 : 使用tomcat后，访问html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-如何启动tomcat"><span class="nav-text">步骤 3 : 如何启动tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-如何部署网页"><span class="nav-text">步骤 4 : 如何部署网页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-8080是什么鬼？"><span class="nav-text">步骤 5 : 8080是什么鬼？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、改端口"><span class="nav-text">2、改端口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-server-xml"><span class="nav-text">步骤 1 : server.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-80端口"><span class="nav-text">步骤 2 : 80端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-80端口被占用"><span class="nav-text">步骤 3 : 80端口被占用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、问题排查"><span class="nav-text">3、问题排查</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-JAVA-HOME"><span class="nav-text">步骤 1 : JAVA_HOME</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-CATALINA-HOME未设置"><span class="nav-text">步骤 2 : CATALINA_HOME未设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-CATALINA-HOME错误设置"><span class="nav-text">步骤 3 : CATALINA_HOME错误设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-端口冲突"><span class="nav-text">步骤 4 : 端口冲突</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-localhost-yyyy-mm-dd-log"><span class="nav-text">步骤 5 : localhost.yyyy-mm-dd.log</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-Error-FilterStart"><span class="nav-text">步骤 6 : Error FilterStart</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-JDK版本"><span class="nav-text">步骤 7 : JDK版本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、-404问题排查"><span class="nav-text">4、 404问题排查</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-404问题"><span class="nav-text">步骤 1 : 404问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-正确的端口号"><span class="nav-text">步骤 2 : 正确的端口号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-环境变量"><span class="nav-text">步骤 3 : 环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-确定Web应用是否成功启动"><span class="nav-text">步骤 4 : 确定Web应用是否成功启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-webapps下的ROOT目录"><span class="nav-text">步骤 5 : webapps下的ROOT目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-访问地址的时候是否加了web应用的名称"><span class="nav-text">步骤 6 : 访问地址的时候是否加了web应用的名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-是否访问对资源了"><span class="nav-text">步骤 7 : 是否访问对资源了</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-不能访问WEB-INF目录下的资源"><span class="nav-text">步骤 8 : 不能访问WEB-INF目录下的资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-访问地址后面多加了一个斜杠"><span class="nav-text">步骤 9 : 访问地址后面多加了一个斜杠</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、端口被占用"><span class="nav-text">5、端口被占用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-查看80端口被哪些程序占用了"><span class="nav-text">步骤 1 : 查看80端口被哪些程序占用了</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-根据pid（进程id）-查询对应的应用程序"><span class="nav-text">步骤 2 : 根据pid（进程id） 查询对应的应用程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-根据名称-结束该程序"><span class="nav-text">步骤 3 : 根据名称 结束该程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、持久化异常"><span class="nav-text">6、持久化异常</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-启动报错"><span class="nav-text">步骤 1 : 启动报错</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、纯净版-TOMCAT"><span class="nav-text">7、纯净版 TOMCAT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-80端口的，纯净版tomcat"><span class="nav-text">步骤 1 : 80端口的，纯净版tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-8080端口的，纯净版tomcat"><span class="nav-text">步骤 2 : 8080端口的，纯净版tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-注意"><span class="nav-text">步骤 3 : 注意</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、部署"><span class="nav-text">8、部署</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-本知识点目的"><span class="nav-text">步骤 1 : 本知识点目的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-下载"><span class="nav-text">步骤 2 : 下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-测试端口"><span class="nav-text">步骤 3 : 测试端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-成功启动截图"><span class="nav-text">步骤 4 : 成功启动截图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-下载一个J2EE应用"><span class="nav-text">步骤 5 : 下载一个J2EE应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-部署"><span class="nav-text">步骤 6 : 部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-重启tomcat-并测试"><span class="nav-text">步骤 7 : 重启tomcat,并测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#贰、Servlet"><span class="nav-text">贰、Servlet</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v2"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、开发第一个SERVLET"><span class="nav-text">1、开发第一个SERVLET</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-创建一个java项目j2ee"><span class="nav-text">步骤 3 : 创建一个java项目j2ee</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-导入必须的servlet-api-jar包"><span class="nav-text">步骤 4 : 导入必须的servlet-api.jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-编写HelloServlet"><span class="nav-text">步骤 5 : 编写HelloServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-配置web-xml"><span class="nav-text">步骤 6 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-指定项目输出到classes目录"><span class="nav-text">步骤 7 : 指定项目输出到classes目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-配置tomcat的server-xml-中的-context"><span class="nav-text">步骤 8 : 配置tomcat的server.xml 中的&lt;context&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-删除tomcat-webapps下的ROOT目录"><span class="nav-text">步骤 9 : 删除tomcat webapps下的ROOT目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-重启tomcat，访问http-127-0-0-1-hello"><span class="nav-text">步骤 10 : 重启tomcat，访问http:&#x2F;&#x2F;127.0.0.1&#x2F;hello</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-11-完整项目"><span class="nav-text">步骤 11 : 完整项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、获取参数"><span class="nav-text">2、获取参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v2"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-创建-login-html"><span class="nav-text">步骤 3 : 创建 login.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-创建-LoginServlet"><span class="nav-text">步骤 4 : 创建 LoginServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-映射LoginServlet到路径login"><span class="nav-text">步骤 5 : 映射LoginServlet到路径login</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-在页面提交数据"><span class="nav-text">步骤 6 : 在页面提交数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、返回响应"><span class="nav-text">3、返回响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v3"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v3"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-LoginServlet"><span class="nav-text">步骤 3 : LoginServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-重启tomcat，提交数据"><span class="nav-text">步骤 4 : 重启tomcat，提交数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、调用流程"><span class="nav-text">4、调用流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-流程图"><span class="nav-text">步骤 1 : 流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-login-html"><span class="nav-text">步骤 2 : login.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-login路径"><span class="nav-text">步骤 3 : &#x2F;login路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-找到对应的Servlet"><span class="nav-text">步骤 4 : 找到对应的Servlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-实例化Servlet对象"><span class="nav-text">步骤 5 : 实例化Servlet对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-调用doGet或者doPost"><span class="nav-text">步骤 6 : 调用doGet或者doPost</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-request获取参数"><span class="nav-text">步骤 7 : request获取参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-response设置响应"><span class="nav-text">步骤 8 : response设置响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-tomcat把html传递给浏览器"><span class="nav-text">步骤 9 : tomcat把html传递给浏览器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、service"><span class="nav-text">5、service()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-doGet"><span class="nav-text">步骤 1 : doGet()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-doPost"><span class="nav-text">步骤 2 : doPost()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-service"><span class="nav-text">步骤 3 : service()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、中文问题"><span class="nav-text">6、中文问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-获取中文的参数"><span class="nav-text">示例 1 : 获取中文的参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-返回中文的响应"><span class="nav-text">示例 2 : 返回中文的响应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、生命周期"><span class="nav-text">7、生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-生命周期"><span class="nav-text">步骤 1 : 生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-实例化"><span class="nav-text">步骤 2 : 实例化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-初始化"><span class="nav-text">步骤 3 : 初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-提供服务"><span class="nav-text">步骤 4 : 提供服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-销毁"><span class="nav-text">步骤 5 : 销毁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-被回收"><span class="nav-text">步骤 6 : 被回收</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、跳转"><span class="nav-text">8、跳转</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-首先准备两个页面-success-html-fail-html"><span class="nav-text">步骤 1 : 首先准备两个页面 success.html fail.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-服务端跳转"><span class="nav-text">步骤 2 : 服务端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-客户端跳转"><span class="nav-text">步骤 3 : 客户端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-服务端跳转与客户端跳转图示"><span class="nav-text">步骤 4 : 服务端跳转与客户端跳转图示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9、自启动"><span class="nav-text">9、自启动</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v4"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v4"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-load-on-startup"><span class="nav-text">步骤 3 : load-on-startup</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10、request常见用法"><span class="nav-text">10、request常见用法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-先运行，看到效果，再学习"><span class="nav-text">示例 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-模仿和排错"><span class="nav-text">示例 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-request的常见方法"><span class="nav-text">示例 3 : request的常见方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-4-获取参数"><span class="nav-text">示例 4 : 获取参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-5-获取头信息"><span class="nav-text">示例 5 : 获取头信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-6-服务端传参"><span class="nav-text">示例 6 : 服务端传参</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11、response-用法"><span class="nav-text">11、response 用法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-设置响应内容"><span class="nav-text">示例 1 : 设置响应内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-设置响应格式"><span class="nav-text">示例 2 : 设置响应格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-设置响应编码"><span class="nav-text">示例 3 : 设置响应编码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-4-301或者302客户端跳转"><span class="nav-text">示例 4 : 301或者302客户端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-5-设置不使用缓存"><span class="nav-text">示例 5 : 设置不使用缓存</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12、上传文件"><span class="nav-text">12、上传文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v5"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v5"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-首先准备上传页面-upload-html"><span class="nav-text">步骤 3 : 首先准备上传页面 upload.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-接着准备-UploadPhotoServlet"><span class="nav-text">步骤 4 : 接着准备 UploadPhotoServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-配置web-xml"><span class="nav-text">步骤 5 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-复制jar包"><span class="nav-text">步骤 6 : 复制jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-在项目中导入jar包"><span class="nav-text">步骤 7 : 在项目中导入jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-上传测试"><span class="nav-text">步骤 8 : 上传测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-如何处理其他非File字段"><span class="nav-text">步骤 9 : 如何处理其他非File字段</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、动态Web项目"><span class="nav-text">二、动态Web项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、创建"><span class="nav-text">1、创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v6"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v6"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-说明"><span class="nav-text">步骤 3 : 说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-新建Dynamic-Web-Project"><span class="nav-text">步骤 4 : 新建Dynamic Web Project</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-Servlet类"><span class="nav-text">步骤 5 : Servlet类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-解决HttpServlet找不到问题"><span class="nav-text">步骤 6 : 解决HttpServlet找不到问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-刷新项目"><span class="nav-text">步骤 7 : 刷新项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-web-xml"><span class="nav-text">步骤 8 : web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-通过Eclipse启动Tomcat-Run-On-Server"><span class="nav-text">步骤 9 : 通过Eclipse启动Tomcat-Run On Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-通过Eclipse启动Tomcat-服务器选择Tomcat-v7-0-Server"><span class="nav-text">步骤 10 : 通过Eclipse启动Tomcat-服务器选择Tomcat v7.0 Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-11-通过Eclipse启动Tomcat-指定Tomcat服务器地址"><span class="nav-text">步骤 11 : 通过Eclipse启动Tomcat-指定Tomcat服务器地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-12-通过Eclipse启动Tomcat-部署"><span class="nav-text">步骤 12 : 通过Eclipse启动Tomcat-部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-13-测试"><span class="nav-text">步骤 13 : 测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-14-关闭Eclipse中的Tomcat"><span class="nav-text">步骤 14 : 关闭Eclipse中的Tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-15-Eclipse中启动Tomcat问题-端口"><span class="nav-text">步骤 15 : Eclipse中启动Tomcat问题-端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-16-需要注意的几点"><span class="nav-text">步骤 16 : 需要注意的几点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-17-右上角可运行项目"><span class="nav-text">步骤 17 : 右上角可运行项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、切换"><span class="nav-text">2、切换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-切换到动态Web项目"><span class="nav-text">步骤 1 : 切换到动态Web项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-准备java-project"><span class="nav-text">步骤 2 : 准备java project</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-项目转换"><span class="nav-text">步骤 3 : 项目转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-设置content-directory"><span class="nav-text">步骤 4 : 设置content directory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-点击确认"><span class="nav-text">步骤 5 : 点击确认</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-转换成功"><span class="nav-text">步骤 6 : 转换成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、导入"><span class="nav-text">3、导入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-导入动态Web"><span class="nav-text">步骤 1 : 导入动态Web</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-下载动态Web项目"><span class="nav-text">步骤 2 : 下载动态Web项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-导入到Eclipse中1"><span class="nav-text">步骤 3 : 导入到Eclipse中1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-导入到Eclipse中2"><span class="nav-text">步骤 4 : 导入到Eclipse中2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-动态Web项目J2EE"><span class="nav-text">步骤 5 : 动态Web项目J2EE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-启动Tomcat"><span class="nav-text">步骤 6 : 启动Tomcat</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、无法配置Tomcat"><span class="nav-text">4、无法配置Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-现象"><span class="nav-text">步骤 1 : 现象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-解决办法"><span class="nav-text">步骤 2 : 解决办法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、无法启动Tomcat"><span class="nav-text">5、无法启动Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-现象-v2"><span class="nav-text">步骤 1 : 现象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-解决办法-v2"><span class="nav-text">步骤 2 : 解决办法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、idea"><span class="nav-text">6、idea</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、CRUD"><span class="nav-text">三、CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、查询"><span class="nav-text">1、查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v7"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v7"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-效果"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-准备实体类Hero"><span class="nav-text">步骤 4 : 准备实体类Hero</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-准备DAO-类-HeroDAO"><span class="nav-text">步骤 5 : 准备DAO 类 HeroDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-创建表Hero的SQL"><span class="nav-text">步骤 6 : 创建表Hero的SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-为web应用导入mysql-jdbc的jar包"><span class="nav-text">步骤 7 : 为web应用导入mysql-jdbc的jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-编写-HeroListServlet"><span class="nav-text">步骤 8 : 编写 HeroListServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-配置web-xml"><span class="nav-text">步骤 9 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-重启tomcat，访问http-127-0-0-1-listHero"><span class="nav-text">步骤 10 : 重启tomcat，访问http:&#x2F;&#x2F;127.0.0.1&#x2F;listHero</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、增加"><span class="nav-text">2、增加</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v8"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v8"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-准备增加的页面-addHero-html"><span class="nav-text">步骤 3 : 准备增加的页面 addHero.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-编写-HeroAddServlet"><span class="nav-text">步骤 4 : 编写 HeroAddServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-配置web-xml-v2"><span class="nav-text">步骤 5 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-测试"><span class="nav-text">步骤 6 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、删除"><span class="nav-text">3、删除</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v9"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v9"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-提供delete超链"><span class="nav-text">步骤 3 : 提供delete超链</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-修改HeroListServlet"><span class="nav-text">步骤 4 : 修改HeroListServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-配置web-xml-v3"><span class="nav-text">步骤 5 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-编写HeroDeleteServlet"><span class="nav-text">步骤 6 : 编写HeroDeleteServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-测试"><span class="nav-text">步骤 7 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、编辑"><span class="nav-text">4、编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v10"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v10"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-修改HeroListServlet"><span class="nav-text">步骤 3 : 修改HeroListServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-配置web-xml"><span class="nav-text">步骤 4 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-准备HeroEditServlet"><span class="nav-text">步骤 5 : 准备HeroEditServlet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、更新"><span class="nav-text">5、更新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v11"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v11"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-编写-HeroUpdateServlet"><span class="nav-text">步骤 3 : 编写 HeroUpdateServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-配置web-xml-v2"><span class="nav-text">步骤 4 : 配置web.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、弊端"><span class="nav-text">6、弊端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-使用Servlet进行CRUD开发的弊端"><span class="nav-text">步骤 1 : 使用Servlet进行CRUD开发的弊端</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、JSON"><span class="nav-text">四、JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、提交数据"><span class="nav-text">1、提交数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v12"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v12"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-效果-v2"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-资源"><span class="nav-text">步骤 4 : 资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-submit-html"><span class="nav-text">步骤 5 : submit.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-SubmitServlet"><span class="nav-text">步骤 6 : SubmitServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-web-xml"><span class="nav-text">步骤 7 : web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试"><span class="nav-text">步骤 8 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、获取一个对象"><span class="nav-text">2、获取一个对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v13"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v13"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-效果-v3"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-资源-v2"><span class="nav-text">步骤 4 : 资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-GetOneServlet"><span class="nav-text">步骤 5 : GetOneServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-web-xml"><span class="nav-text">步骤 6 : web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-getOne-html"><span class="nav-text">步骤 7 : getOne.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试-v2"><span class="nav-text">步骤 8 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、获取多个对象"><span class="nav-text">3、获取多个对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v14"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-模仿和排错-v14"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-效果-v4"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-资源-v3"><span class="nav-text">步骤 4 : 资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-GetManyServlet"><span class="nav-text">步骤 5 : GetManyServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-web-xml-v2"><span class="nav-text">步骤 6 : web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-getMany-html"><span class="nav-text">步骤 7 : getMany.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试-v3"><span class="nav-text">步骤 8 : 测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#叁、HTTP协议"><span class="nav-text">叁、HTTP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v3"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、协议概念"><span class="nav-text">1、协议概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-HTTP协议"><span class="nav-text">步骤 1 : HTTP协议</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、调试工具"><span class="nav-text">2、调试工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-下载-FireFox"><span class="nav-text">步骤 1 : 下载 FireFox</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-打开调试工具"><span class="nav-text">步骤 2 : 打开调试工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-观察-request-response"><span class="nav-text">步骤 3 : 观察 request response</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、请求协议"><span class="nav-text">3、请求协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-请求行"><span class="nav-text">示例 1 : 请求行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-请求头部"><span class="nav-text">示例 2 : 请求头部</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-请求数据"><span class="nav-text">示例 3 : 请求数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、响应协议"><span class="nav-text">4、响应协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-状态行"><span class="nav-text">示例 1 : 状态行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-消息报头"><span class="nav-text">示例 2 : 消息报头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-响应正文"><span class="nav-text">示例 3 : 响应正文</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、响应代码"><span class="nav-text">5、响应代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-200"><span class="nav-text">步骤 1 : 200</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-301"><span class="nav-text">步骤 2 : 301</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-302"><span class="nav-text">步骤 3 : 302</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-304"><span class="nav-text">步骤 4 : 304</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-404"><span class="nav-text">步骤 5 : 404</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-500"><span class="nav-text">步骤 6 : 500</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-更多代码一一览。。。"><span class="nav-text">步骤 7 : 更多代码一一览。。。</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#肆、JSP"><span class="nav-text">肆、JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v4"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、Hello-JSP"><span class="nav-text">1、Hello JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-hello-jsp"><span class="nav-text">步骤 1 : hello.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-代码解释"><span class="nav-text">步骤 2 : 代码解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3"><span class="nav-text">步骤 3 : &lt;%&#x3D;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、执行过程"><span class="nav-text">2、执行过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-执行过程"><span class="nav-text">步骤 1 : 执行过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-hello-jsp-java-为什么是Servlet"><span class="nav-text">步骤 2 : hello_jsp.java 为什么是Servlet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、页面元素"><span class="nav-text">3、页面元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-页面元素"><span class="nav-text">步骤 1 : 页面元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-和-out-println"><span class="nav-text">步骤 2 : &lt;%&#x3D;%&gt;和 &lt;%out.println()%&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-for循环"><span class="nav-text">步骤 3 : for循环</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、include"><span class="nav-text">4、include</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-首先准备一个footer-jsp"><span class="nav-text">步骤 1 : 首先准备一个footer.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-指令include"><span class="nav-text">步骤 2 : 指令include</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-动作include"><span class="nav-text">步骤 3 : 动作include</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-指令include和动作include的区别"><span class="nav-text">步骤 4 : 指令include和动作include的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-传参"><span class="nav-text">步骤 5 : 传参</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、跳转"><span class="nav-text">5、跳转</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-首先准备-jump-jsp"><span class="nav-text">示例 1 : 首先准备 jump.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-客户端跳转"><span class="nav-text">示例 2 : 客户端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-服务端跳转"><span class="nav-text">示例 3 : 服务端跳转</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、cookie"><span class="nav-text">6、cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-cookie-在平时生活中的运用"><span class="nav-text">步骤 1 : cookie 在平时生活中的运用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-什么是cookie"><span class="nav-text">步骤 2 : 什么是cookie</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-setCookie-jsp"><span class="nav-text">步骤 3 : setCookie.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-getCookie-jsp"><span class="nav-text">步骤 4 : getCookie.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-cookie原理示意图"><span class="nav-text">步骤 5 : cookie原理示意图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、session"><span class="nav-text">7、session</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-健身房的储物柜"><span class="nav-text">步骤 1 : 健身房的储物柜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-什么是Session"><span class="nav-text">步骤 2 : 什么是Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-setSession-jsp"><span class="nav-text">步骤 3 : setSession.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-getSession-jsp"><span class="nav-text">步骤 4 : getSession.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-Session和Cookie的关系"><span class="nav-text">步骤 5 : Session和Cookie的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-如果没有cookie，session如何工作"><span class="nav-text">步骤 7 : 如果没有cookie，session如何工作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-session的有效期"><span class="nav-text">步骤 8 : session的有效期</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、作用域"><span class="nav-text">8、作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-pageContext"><span class="nav-text">步骤 1 : pageContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-requestContext"><span class="nav-text">步骤 2 : requestContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-requestContext与服务端跳转"><span class="nav-text">步骤 3 : requestContext与服务端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-requestContext与客户端跳转"><span class="nav-text">步骤 4 : requestContext与客户端跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-sessionContext"><span class="nav-text">步骤 5 : sessionContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-applicationContext"><span class="nav-text">步骤 6 : applicationContext</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9、隐式对象"><span class="nav-text">9、隐式对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-request-response-out"><span class="nav-text">步骤 1 : request,response,out</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-pageContext-session-application"><span class="nav-text">步骤 2 : pageContext, session,application</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-page"><span class="nav-text">步骤 3 : page</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-config"><span class="nav-text">步骤 4 : config</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-exception"><span class="nav-text">步骤 5 : exception</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10、JSTL"><span class="nav-text">10、JSTL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-导入jar包"><span class="nav-text">步骤 1 : 导入jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-set-out-remove"><span class="nav-text">步骤 2 : set out remove</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-if-else"><span class="nav-text">步骤 3 : if else</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-choose"><span class="nav-text">步骤 4 : choose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-forEach"><span class="nav-text">步骤 5 : forEach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-forTokens"><span class="nav-text">步骤 6 : forTokens</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-fmt-formatNumber-格式化数字"><span class="nav-text">步骤 7 : fmt:formatNumber 格式化数字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-fmt-formatDate-格式化日期"><span class="nav-text">步骤 8 : fmt:formatDate 格式化日期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-fn"><span class="nav-text">步骤 9 : fn:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11、EL表达式语言"><span class="nav-text">11、EL表达式语言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1-取值"><span class="nav-text">示例 1 : 取值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-2-作用域优先级"><span class="nav-text">示例 2 : 作用域优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-3-JavaBean概念"><span class="nav-text">示例 3 : JavaBean概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-4-获取JavaBean的属性"><span class="nav-text">示例 4 : 获取JavaBean的属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-5-结合JSTL的-c-forEach"><span class="nav-text">示例 5 : 结合JSTL的&lt;c:forEach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-6-取参"><span class="nav-text">示例 6 : 取参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-7-eq"><span class="nav-text">示例 7 : eq</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#伍、MVC"><span class="nav-text">伍、MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v5"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、Hello-MVC"><span class="nav-text">1、Hello MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-仅仅使用Servlet的短处"><span class="nav-text">步骤 1 : 仅仅使用Servlet的短处</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-仅仅使用JSP的短处"><span class="nav-text">步骤 2 : 仅仅使用JSP的短处</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-结合Servlet和JSP"><span class="nav-text">步骤 3 : 结合Servlet和JSP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-MVC设计模式"><span class="nav-text">步骤 4 : MVC设计模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、查询"><span class="nav-text">2、查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-实体类Hero"><span class="nav-text">步骤 1 : 实体类Hero</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-HeroDAO"><span class="nav-text">步骤 2 : HeroDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-HeroListServlet"><span class="nav-text">步骤 3 : HeroListServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-web-xml"><span class="nav-text">步骤 4 : web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-listHero-jsp"><span class="nav-text">步骤 5 : listHero.jsp</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、分页"><span class="nav-text">3、分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-首先准备-DAO"><span class="nav-text">步骤 1 : 首先准备 DAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-只显示5条数据"><span class="nav-text">步骤 2 : 只显示5条数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-下一页"><span class="nav-text">步骤 3 : 下一页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-上一页"><span class="nav-text">步骤 4 : 上一页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-第一页"><span class="nav-text">步骤 5 : 第一页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-最后一页"><span class="nav-text">步骤 6 : 最后一页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-边界处理"><span class="nav-text">步骤 7 : 边界处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-套上Bootstrap"><span class="nav-text">步骤 8 : 套上Bootstrap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、用户是否登录"><span class="nav-text">4、用户是否登录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-在LoginServlet-把验证成功的用户加入到-Session"><span class="nav-text">步骤 1 : 在LoginServlet 把验证成功的用户加入到 Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-在HeroListServlet判断Session中是否有数据"><span class="nav-text">步骤 2 : 在HeroListServlet判断Session中是否有数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、CRUD"><span class="nav-text">5、CRUD</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#陆、FILTER"><span class="nav-text">陆、FILTER</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v6"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、Hello-Filter"><span class="nav-text">1、Hello Filter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-Filter概念"><span class="nav-text">步骤 1 : Filter概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-编写-FirstFilter"><span class="nav-text">步骤 2 : 编写 FirstFilter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-配置web-xml"><span class="nav-text">步骤 3 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-访问页面"><span class="nav-text">步骤 4 : 访问页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-init-方法"><span class="nav-text">步骤 5 : init() 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-Filter启动失败"><span class="nav-text">步骤 6 : Filter启动失败</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、中文处理"><span class="nav-text">2、中文处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-使用Servlet处理的局限性"><span class="nav-text">步骤 1 : 使用Servlet处理的局限性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-使用Filter处理"><span class="nav-text">步骤 2 : 使用Filter处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-配置web-xml-v2"><span class="nav-text">步骤 3 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-测试"><span class="nav-text">步骤 4 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、登陆验证"><span class="nav-text">3、登陆验证</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-在Servlet中进行登陆验证的局限性"><span class="nav-text">步骤 1 : 在Servlet中进行登陆验证的局限性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-使用Filter处理-v2"><span class="nav-text">步骤 2 : 使用Filter处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-配置web-xml-v3"><span class="nav-text">步骤 3 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-练习-在login-jsp页面的js-css和图片文件"><span class="nav-text">步骤 4 : 练习-在login.jsp页面的js,css和图片文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#柒、LISTENER"><span class="nav-text">柒、LISTENER</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v7"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、Hello-Listener"><span class="nav-text">1、Hello Listener</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、监听-CONTEXT"><span class="nav-text">2、监听 CONTEXT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-编写-ContextListener"><span class="nav-text">步骤 1 : 编写 ContextListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-配置-web-xml"><span class="nav-text">步骤 2 : 配置 web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-测试"><span class="nav-text">步骤 3 : 测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-编写-ContextAttributeListener"><span class="nav-text">步骤 4 : 编写 ContextAttributeListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-配置web-xml-v4"><span class="nav-text">步骤 5 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-testContext-jsp"><span class="nav-text">步骤 6 : testContext.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-测试-v2"><span class="nav-text">步骤 7 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、监听-Session"><span class="nav-text">3、监听 Session</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-编写-SessionListener"><span class="nav-text">步骤 1 : 编写 SessionListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-配置web-xml"><span class="nav-text">步骤 2 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-测试-v2"><span class="nav-text">步骤 3 : 测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-编写-SessionAttributeListener"><span class="nav-text">步骤 4 : 编写 SessionAttributeListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-配置web-xml-v5"><span class="nav-text">步骤 5 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-testSession-jsp"><span class="nav-text">步骤 6 : testSession.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-测试-v3"><span class="nav-text">步骤 7 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、监听-Request"><span class="nav-text">4、监听 Request</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-编写-RequestListener"><span class="nav-text">步骤 1 : 编写 RequestListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-配置web-xml-v2"><span class="nav-text">步骤 2 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-testRequest-jsp"><span class="nav-text">步骤 3 : testRequest.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-测试-v2"><span class="nav-text">步骤 4 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、统计在线人数"><span class="nav-text">5、统计在线人数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-编写-OnlineNumberListener"><span class="nav-text">步骤 1 : 编写 OnlineNumberListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-配置web-xml-v3"><span class="nav-text">步骤 2 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-checkOnlineNumber-jsp"><span class="nav-text">步骤 3 : checkOnlineNumber.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-测试-v3"><span class="nav-text">步骤 4 : 测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#捌、购物车"><span class="nav-text">捌、购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v8"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、类关系"><span class="nav-text">1、类关系</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-类图"><span class="nav-text">步骤 1 : 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-类关系图"><span class="nav-text">步骤 2 : 类关系图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、产品模块"><span class="nav-text">2、产品模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-新建一个项目"><span class="nav-text">步骤 1 : 新建一个项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-SQL"><span class="nav-text">步骤 2 : SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-Product"><span class="nav-text">步骤 3 : Product</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-ProductDAO"><span class="nav-text">步骤 4 : ProductDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-ProductListServlet"><span class="nav-text">步骤 5 : ProductListServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-listProduct-jsp"><span class="nav-text">步骤 6 : listProduct.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-配置web-xml"><span class="nav-text">步骤 7 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试-v4"><span class="nav-text">步骤 8 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、用户模块"><span class="nav-text">3、用户模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-SQL"><span class="nav-text">步骤 1 : SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-User"><span class="nav-text">步骤 2 : User</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-UserDAO"><span class="nav-text">步骤 3 : UserDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-login-jsp"><span class="nav-text">步骤 4 : login.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-UserLoginServlet"><span class="nav-text">步骤 5 : UserLoginServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-配置web-xml-v2"><span class="nav-text">步骤 6 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-listProduct-jsp"><span class="nav-text">步骤 7 : listProduct.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试-v5"><span class="nav-text">步骤 8 : 测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、购物车模块"><span class="nav-text">4、购物车模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-SQL-v2"><span class="nav-text">步骤 1 : SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-OrderItem"><span class="nav-text">步骤 2 : OrderItem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-ProductDAO"><span class="nav-text">步骤 3 : ProductDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-购买商品"><span class="nav-text">步骤 4 : 购买商品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-显示购物车内容"><span class="nav-text">步骤 5 : 显示购物车内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-购买相同商品"><span class="nav-text">步骤 6 : 购买相同商品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-配置web-xml-v2"><span class="nav-text">步骤 7 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-测试-v6"><span class="nav-text">步骤 8 : 测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-练习-删除订单项"><span class="nav-text">步骤 9 : 练习-删除订单项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-10-练习-加入购物车"><span class="nav-text">步骤 10 : 练习-加入购物车</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、订单模块"><span class="nav-text">5、订单模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-SQL-v3"><span class="nav-text">步骤 1 : SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-Order"><span class="nav-text">步骤 2 : Order</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-OrderItem"><span class="nav-text">步骤 3 : OrderItem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-OrderDAO"><span class="nav-text">步骤 4 : OrderDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-OrderItemDAO"><span class="nav-text">步骤 5 : OrderItemDAO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-listOrderItem-jsp"><span class="nav-text">步骤 6 : listOrderItem.jsp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-OrderCreateServlet"><span class="nav-text">步骤 7 : OrderCreateServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-8-配置web-xml"><span class="nav-text">步骤 8 : 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-9-测试"><span class="nav-text">步骤 9 : 测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#玖、Thymeleaf"><span class="nav-text">玖、Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v9"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、简介"><span class="nav-text">1、简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-Thymeleaf"><span class="nav-text">步骤 1 : Thymeleaf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-系列教程"><span class="nav-text">步骤 2 : 系列教程</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#拾、前后端分离"><span class="nav-text">拾、前后端分离</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、基础-v10"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、前后端分离"><span class="nav-text">1、前后端分离</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-1-什么是前后端分离"><span class="nav-text">步骤 1 : 什么是前后端分离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-2-相关教程"><span class="nav-text">步骤 2 : 相关教程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-3-前端"><span class="nav-text">步骤 3 : 前端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-4-J2EE-方式"><span class="nav-text">步骤 4 : J2EE 方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-5-SSM-方式"><span class="nav-text">步骤 5 : SSM 方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-6-Springboot-方式"><span class="nav-text">步骤 6 : Springboot 方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤-7-vue-springboot"><span class="nav-text">步骤 7 : vue + springboot</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script
  async
  src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"
></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潇 卟 甸</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
     我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
  

  
    <span class="site-pv">
     历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz',
        appKey: 'NMGzUaGqmpzSiSItkHBQGUaA',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz", "NMGzUaGqmpzSiSItkHBQGUaA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  


  

 <script src="/js/src/activate-power-mode.js"></script>
 <script>
   POWERMODE.colorful = true;
   POWERMODE.shake = false;
   document.body.addEventListener('input', POWERMODE);
 </script>




<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20200610,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span style="color:#1890ff">$&</span>');
    div.innerHTML = `我已在此等候你 ${ages}`;
  }
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>




<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>


  
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
<!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
