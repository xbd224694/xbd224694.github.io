<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,编程,源代码,Java实践," />










<meta name="description" content="https:&#x2F;&#x2F;how2j.cn&#x2F;k&#x2F;tmall-ssh&#x2F;tmall-ssh-1160&#x2F;1160.html">
<meta property="og:type" content="article">
<meta property="og:title" content="Java实践-天猫整站SSH">
<meta property="og:url" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/index.html">
<meta property="og:site_name" content="伶仃浩瀚">
<meta property="og:description" content="https:&#x2F;&#x2F;how2j.cn&#x2F;k&#x2F;tmall-ssh&#x2F;tmall-ssh-1160&#x2F;1160.html">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4656.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4657.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4658.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4659.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4660.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4661.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4662.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4663.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4664.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4665.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4666.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4667.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4668.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4669.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4670.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4671.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4672.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4673.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4674.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4675.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4676.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4685.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4686.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4680.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4683.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5365.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4687.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4688.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4689.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4690.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5124.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4694.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4695.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4696.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4697.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4698.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4699.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4691.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4692.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4693.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4700.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4701.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4702.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4703.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4704.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4705.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4706.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4707.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4708.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4709.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4710.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4956.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4957.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4958.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4959.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4960.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4961.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4962.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4963.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4963.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4965.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4972.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4973.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4966.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4967.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4968.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4970.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4969.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4711.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4712.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4713.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4714.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4716.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4717.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4718.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4719.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4720.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4721.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4722.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4723.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4725.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4726.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4727.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4728.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4729.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4730.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4733.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4735.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4749.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4750.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4751.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4752.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4753.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4754.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4755.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4756.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4757.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4978.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5019.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5020.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5021.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5022.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5146.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5147.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5162.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5164.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5153.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5156.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5157.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5158.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5535.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5014.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5016.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5017.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4991.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4997.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5174.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4998.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4999.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5005.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5008.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5190.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5012.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5204.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5366.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5205.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5221.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4852.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4857.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4858.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4859.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4860.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4861.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4862.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4863.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4866.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4871.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4872.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4873.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4874.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4875.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4878.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5260.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4882.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4883.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4884.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5267.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4887.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5280.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4891.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4892.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4896.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4900.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4904.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4909.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4910.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4758.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4759.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4912.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4915.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4916.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4917.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4918.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4919.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4920.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4921.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5299.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5301.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4937.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5302.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4930.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4932.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4935.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4940.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4941.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4942.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4943.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4944.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4945.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5028.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5031.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5034.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5035.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5322.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5023.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5036.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5041.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5042.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5062.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5044.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5050.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5051.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5052.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5069.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5070.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5071.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5073.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5100.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5102.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5104.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5075.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5077.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5105.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5109.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5353.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5357.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5079.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5081.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5082.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5083.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5121.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5084.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5085.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5088.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5089.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5090.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5094.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5110.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5112.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5113.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5116.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5117.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5119.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5120.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4947.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5374.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5377.png">
<meta property="og:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5378.png">
<meta property="article:published_time" content="2020-06-23T14:26:56.000Z">
<meta property="article:modified_time" content="2020-10-10T07:07:13.276Z">
<meta property="article:author" content="潇 卟 甸">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="源代码">
<meta property="article:tag" content="Java实践">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4656.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/06/23/Java实践-天猫整站SSH/"/>







<script>
    (function(){
        if('224694'){
            if (prompt('请输入文章密码') !== '224694'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>

  <title>Java实践-天猫整站SSH | 伶仃浩瀚</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://xbd224694.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">伶仃浩瀚</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潇 卟 甸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/picture.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="伶仃浩瀚">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java实践-天猫整站SSH</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建时间" itemprop="dateCreated datePublished" datetime="2020-06-23T22:26:56+08:00">
                2020-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/How2j/" itemprop="url" rel="index">
                    <span itemprop="name">How2j</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/" class="leancloud_visitors" data-flag-title="Java实践-天猫整站SSH">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度 </span>
               
                 <span class="leancloud-visitors-count"></span>
	 <span> ℃ </span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  124.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  627 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://how2j.cn/k/tmall-ssh/tmall-ssh-1160/1160.html" target="_blank" rel="noopener">https://how2j.cn/k/tmall-ssh/tmall-ssh-1160/1160.html</a></p>
<a id="more"></a>
<h1 id="一、基础"><a class="header-anchor" href="#一、基础">¶</a>一、基础</h1>
<h2 id="1、项目简介"><a class="header-anchor" href="#1、项目简介">¶</a>1、项目简介</h2>
<p>在学习完[模仿天猫前端教程]之后， 接下来，我们就要做这么一个[模仿天猫整站 SSH版]项目。</p>
<p><strong>成熟的项目规划与设计</strong><br>
本教程作者，也就是我~ 有8年企业开发管理经验，7年教学经验，曾参与管理开发几十个商业项目。将展示如何合理设计与规划这样一个规模的电商项目，既做到功能丰富，又让开发节奏有条不紊。</p>
<p><strong>基于SSH框架技术</strong><br>
本项目使用SSH框架进行系统设计与开发，同学们可以观察并模仿到SSH是如何成熟，并高效率地实现各种业务场景的。</p>
<p><strong>由浅入深</strong><br>
以动手为主，代码驱动，从简单功能开始，逐一展开，配合图文视频讲解，由浅入深，迭代开发，享受一个项目的从无到有的构建过程</p>
<p><strong>编程思想</strong><br>
不仅用到了经典的SSH解决方案，还在此基础之上进行了<strong>多次重构</strong>，弥补SSH框架本身的不足之处，观察，模仿与学习这个重构的过程，将非常有助于在编程思想方面的提升。</p>
<p><strong>典型场景</strong><br>
一个完整的JAVA WEB应用包含的各种典型商务应用场景的需求，展示相应的解决思路与办法</p>
<p><strong>简历中的亮点</strong><br>
一份能获得面试机会的简历，必须要有项目经验的。 踏踏实实地把这个项目跟完，让<strong>简历多一个亮点，多一项谈资，多一层砝码，多一些薪水</strong></p>
<h2 id="2、功能一览-前台"><a class="header-anchor" href="#2、功能一览-前台">¶</a>2、功能一览-前台</h2>
<p>我们的学习都是反过来的，由终至始，先看看最后要做成什么样子：</p>
<p>模仿天猫整站分[前端]和[后端]两部分，这里是对<strong>前端</strong>功能截图一览。</p>
<p>实际运行的模仿天猫前端，[点击访问]</p>
<p><strong>注：</strong> 这里是项目介绍环节，真正的卷起袖子开始干，是从后续章节的表结构设计开始，同学不要误以为现在已经开始撸代码了。</p>
<h3 id="步骤-1-首页"><a class="header-anchor" href="#步骤-1-首页">¶</a>步骤 1 : 首页</h3>
<p>首页很长，为了加快图片的加载速度，只截取了一部分首页的内容。 完整的首页查看这里：<br>
[模仿天猫前端]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4656.png" alt></p>
<h3 id="步骤-2-分类页"><a class="header-anchor" href="#步骤-2-分类页">¶</a>步骤 2 : 分类页</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4657.png" alt></p>
<h3 id="步骤-3-查询结果页"><a class="header-anchor" href="#步骤-3-查询结果页">¶</a>步骤 3 : 查询结果页</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4658.png" alt></p>
<h3 id="步骤-4-产品页"><a class="header-anchor" href="#步骤-4-产品页">¶</a>步骤 4 : 产品页</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4659.png" alt></p>
<h3 id="步骤-5-结算页面"><a class="header-anchor" href="#步骤-5-结算页面">¶</a>步骤 5 : 结算页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4660.png" alt></p>
<h3 id="步骤-6-支付页面"><a class="header-anchor" href="#步骤-6-支付页面">¶</a>步骤 6 : 支付页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4661.png" alt></p>
<h3 id="步骤-7-支付成功页面"><a class="header-anchor" href="#步骤-7-支付成功页面">¶</a>步骤 7 : 支付成功页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4662.png" alt></p>
<h3 id="步骤-8-购物车页面"><a class="header-anchor" href="#步骤-8-购物车页面">¶</a>步骤 8 : 购物车页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4663.png" alt></p>
<h3 id="步骤-9-我的订单页面"><a class="header-anchor" href="#步骤-9-我的订单页面">¶</a>步骤 9 : 我的订单页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4664.png" alt></p>
<h3 id="步骤-10-确认收货页面"><a class="header-anchor" href="#步骤-10-确认收货页面">¶</a>步骤 10 : 确认收货页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4665.png" alt></p>
<h3 id="步骤-11-确认收货成功页面"><a class="header-anchor" href="#步骤-11-确认收货成功页面">¶</a>步骤 11 : 确认收货成功页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4666.png" alt></p>
<h3 id="步骤-12-进行评价页面"><a class="header-anchor" href="#步骤-12-进行评价页面">¶</a>步骤 12 : 进行评价页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4667.png" alt></p>
<h3 id="步骤-13-登录页面"><a class="header-anchor" href="#步骤-13-登录页面">¶</a>步骤 13 : 登录页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4668.png" alt></p>
<h3 id="步骤-14-注册页面"><a class="header-anchor" href="#步骤-14-注册页面">¶</a>步骤 14 : 注册页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4669.png" alt></p>
<h2 id="3、功能一览-后台"><a class="header-anchor" href="#3、功能一览-后台">¶</a>3、功能一览-后台</h2>
<p>模仿天猫整站分[前端]和[后端]两部分，这里是对<strong>后端</strong>功能截图一览</p>
<p>实际运行的模仿天猫后端，[点击访问]</p>
<p><strong>注：</strong> 这里是项目介绍环节，真正的卷起袖子开始干，是从后续章节的表结构设计开始，同学不要误以为现在已经开始撸代码了。</p>
<h3 id="步骤-1-分类管理"><a class="header-anchor" href="#步骤-1-分类管理">¶</a>步骤 1 : 分类管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4670.png" alt></p>
<h3 id="步骤-2-分类属性管理"><a class="header-anchor" href="#步骤-2-分类属性管理">¶</a>步骤 2 : 分类属性管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4671.png" alt></p>
<h3 id="步骤-3-产品管理"><a class="header-anchor" href="#步骤-3-产品管理">¶</a>步骤 3 : 产品管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4672.png" alt></p>
<h3 id="步骤-4-产品属性设置"><a class="header-anchor" href="#步骤-4-产品属性设置">¶</a>步骤 4 : 产品属性设置</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4673.png" alt></p>
<h3 id="步骤-5-产品图片管理"><a class="header-anchor" href="#步骤-5-产品图片管理">¶</a>步骤 5 : 产品图片管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4674.png" alt></p>
<h3 id="步骤-6-用户管理"><a class="header-anchor" href="#步骤-6-用户管理">¶</a>步骤 6 : 用户管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4675.png" alt></p>
<h3 id="步骤-7-订单管理"><a class="header-anchor" href="#步骤-7-订单管理">¶</a>步骤 7 : 订单管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4676.png" alt></p>
<h2 id="4、本地演示"><a class="header-anchor" href="#4、本地演示">¶</a>4、本地演示</h2>
<h3 id="步骤-1-下载并运行"><a class="header-anchor" href="#步骤-1-下载并运行">¶</a>步骤 1 : 下载并运行</h3>
<p>学习一个项目，首先要确保这个项目是可以跑得起来的，这样有助于建立学习的信心。 不然像百度那样，收到很多的教程，跑都跑不起来，那不是耽搁时间嘛。</p>
<p>为了方便同学观看演示效果，准备了一个无需安装JDK,无需配置TOMCAT,无需安装配置数据库的可运行演示。<br>
下载右上角的tomcat_with_jdk_hsqldb_tmall_ssh.rar，解压后运行 bin目录里的 startup.bat</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4685.png" alt></p>
<h3 id="步骤-2-访问地址"><a class="header-anchor" href="#步骤-2-访问地址">¶</a>步骤 2 : 访问地址</h3>
<p>考虑到同学的机器上已经有tomcat，可能已经占用了80,8080端口，所以这个Tomcat是用了3030端口，避免和其他端口冲突。<br>
请访问如下地址：<br>
前台</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:3030/tmall_ssh/</span></span><br></pre></td></tr></table></figure>
<p>后台</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:3030/tmall_ssh/admin</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4686.png" alt></p>
<h2 id="5、下载并配置运行"><a class="header-anchor" href="#5、下载并配置运行">¶</a>5、下载并配置运行</h2>
<h3 id="步骤-1-请观看视频"><a class="header-anchor" href="#步骤-1-请观看视频">¶</a>步骤 1 : 请观看视频</h3>
<p>这一步请尽量观看视频，视频是<strong>在网吧没有任何环境的的基础上</strong>，从0开始安装jdk,mysql,mysql-front,eclispe,配置tomcat, 从而达到可以在本地运行模仿天猫项目的效果。</p>
<p>需要的文件都在右上角下载，推荐直接下载最后一个tmall_ssh_together.rar 就把需要的都一次性下载了。</p>
<h3 id="步骤-2-JDK1-8"><a class="header-anchor" href="#步骤-2-JDK1-8">¶</a>步骤 2 : JDK1.8</h3>
<p>因为天猫SSH 版本使用了挺多的JDK1.8的新特性，为了正常运行，请务必确认当前java环境是 JDK1.8.<br>
在命令行中输入<strong>java -version</strong>进行校验</p>
<p>参考JDK下载以及配置办法： [JDK1.8以及更高版本下载和环境变量配置]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4680.png" alt></p>
<h3 id="步骤-3-导入数据"><a class="header-anchor" href="#步骤-3-导入数据">¶</a>步骤 3 : 导入数据</h3>
<p>tmall_ssh.rar只包含了项目必须的代码，但是没有数据，为了看到运行效果，还必须导入数据。</p>
<p>在右侧下载 sql 文件，然后使用如下的 命令行方式导入。如果没有安装mysql,可以参考[安装mysql-server]<br>
<strong>注：</strong> 不要用 navicat,mysql-front 等工具导入，因为数据量大，这些工具处理不了，会报奇奇怪怪的错误。</p>
<p><strong>本tmall_ssh.sql 包含17个分类，每种分类下5个产品，总计85件产品。 每个产品下有20余张图片，总计1777张图片，以及属性和属性值等信息。</strong><br>
<strong>注:</strong> 在导入数据之前，需要mysql服务器上存在tmall_ssh这个数据库，如果没有请执行以下sql语句：<br>
先登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe"</span> -u root -padmin</span><br></pre></td></tr></table></figure>
<p>然后执行创建数据库的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE tmall_ssh DEFAULT CHARACTER SET utf8;</span><br></pre></td></tr></table></figure>
<p>然后在当前 mysql 环境下输入 <strong>exit 退出 mysql 环境</strong>，才能进行下面的在cmd环境下的导入<br>
考虑到要导入的tmall_ssh.sql文件比较大，通过工具如mysql-front导入的时候，可能会出错导致失败，建议使用命令行导入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe"</span> -u root -padmin --<span class="keyword">default</span>-character-set=utf8 tmall_ssh &lt; d:\tmall_ssh.sql</span><br></pre></td></tr></table></figure>
<p><strong>注:</strong> 账号密码是root，admin，导入数据以及项目运行所使用的账号密码都是这个，如果不是，请将mysql的root账号密码修改为admin,参考 [修改root密码]<br>
<strong>注:</strong> D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe 这个路径是我的mysql.exe的路径，根据实际情况换成自己的mysql运行路径<br>
<strong>注:</strong> tmall_ssh.sql下载后，放在 d:\tmall_ssh.sql 这个位置<br>
<strong>注:</strong> tmall_ssh.sql 总计有14700行，所以导入是比较耗时的，预计3-5分钟左右, 视机器配置而定<br>
**注：**导入过程中，有可能提示的 Unknown table engine ‘InnoDB’， 这是因为当前数据库未支持InnoDB。 解决办法请参考[启动MySQL InnoDB模式]</p>
<h3 id="步骤-4-下载项目"><a class="header-anchor" href="#步骤-4-下载项目">¶</a>步骤 4 : 下载项目</h3>
<ol>
<li>
<p>下载右上角的tmall_ssh_altogether.rar, 里面有一个tmall_ssh.rar</p>
</li>
<li>
<p>解压到<strong>e:/project/tmall_ssh</strong></p>
</li>
</ol>
<p><strong>注：</strong> 一定要解压到<strong>e:/project/tmall_ssh</strong>,因为其路径依赖是居于这个目录的，倘若放在其他目录，会导致项目jar包导入路径异常<br>
<strong>注：</strong> 这个下载包里只包含了WebContent目录，用于支持运行，并不包含源代码。<br>
包含源代码的完整项目在[这里下载]</p>
<h3 id="步骤-5-导入Web动态项目"><a class="header-anchor" href="#步骤-5-导入Web动态项目">¶</a>步骤 5 : 导入Web动态项目</h3>
<p>本项目是按照Web动态项目的风格创建，如果不熟悉，请事先学习相关教程： [创建]。</p>
<p><strong>注：</strong> 如果没有eclipse,请在这里下载 [下载 Eclipse]</p>
<p>因为是已经存在的Web动态项目，所以不能通过创建一个新的Web动态项目 tmall_ssh来使用它，只能通过导入的方式。</p>
<p>导入办法：<br>
菜单-&gt; File-&gt;Import-&gt;General-&gt;Existing Projects into Workspace-&gt;Brower-&gt;粘贴路径&quot;E:\project\tmall_ssh&quot; -&gt;Finish。</p>
<p><strong>注：</strong> 假如是直接把路径“E:\project\tmall_ssh” 粘贴在&quot;Select root directory:&quot; 对应的输入框里，会导致如图所示的Finish按钮不可点击。 这个时候，点一下Brower按钮即可。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4683.png" alt></p>
<h3 id="步骤-6-启动Tomcat"><a class="header-anchor" href="#步骤-6-启动Tomcat">¶</a>步骤 6 : 启动Tomcat</h3>
<p>启动Tomcat办法：<br>
过程较多，如果不熟悉的同学，请参考：[通过Eclipse启动Tomcat-Run On Server]，里面有如何配置，经测试可以使用的tomcat下载等关键步骤和信息。</p>
<p><strong>注意：</strong> 用eclipse内的Tomcat启动本项目，第一次会比较花时间，因为它要把200多兆的图片文件复制到另一个目录下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\project\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\tmall_ssh</span><br></pre></td></tr></table></figure>
<p>在eclipse的右下角，将看到如图所示的进度条，请耐心等待</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5365.png" alt></p>
<h3 id="步骤-7-访问"><a class="header-anchor" href="#步骤-7-访问">¶</a>步骤 7 : 访问</h3>
<p>Tomcat启动成功之后</p>
<ol>
<li>访问前台页面</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>访问后台页面</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> Eclipse内置浏览器有BUG，请使用独立浏览器比如火狐或者chrome</p>
<h3 id="步骤-8-idea"><a class="header-anchor" href="#步骤-8-idea">¶</a>步骤 8 : idea</h3>
<p>本教程使用Eclipse下的Web Dynamic Web Project风格创建，可是有部分同学更倾向于使用idea来启动web项目，不过在idea导入eclipse的Dynamic Web Project风格项目的时候由常常走不通，为此专门制作了：[如何使用IDEA导入并启动Eclipse下的的 Dynamic Web Project]，协助学习曲线更平滑些。</p>
<h2 id="6、开发流程"><a class="header-anchor" href="#6、开发流程">¶</a>6、开发流程</h2>
<h3 id="步骤-1-技术准备"><a class="header-anchor" href="#步骤-1-技术准备">¶</a>步骤 1 : 技术准备</h3>
<p>为了完成这个j2ee项目，需要掌握如下技术，当然也可以以本项目为驱动，<strong>哪里不懂，学哪里</strong>，其实这也是最好的学习方式(带着目标去学习)<br>
Java：<br>
[Java基础] 和 [Java中级] 的大部分内容以及[Java高级中的反射和注解]<br>
前端：<br>
[HTML], [CSS], [JAVASCRIPT], [JQUERY],[AJAX], [JQuery], [Bootstrap]<br>
J2EE：<br>
[TOMCAT], [SERVLET], [JSP], [Filter]<br>
框架：<br>
[Hibernate]，[Struts]，[Spring]，[SSH整合]<br>
数据库：<br>
[MySQL]</p>
<h3 id="步骤-2-开发流程"><a class="header-anchor" href="#步骤-2-开发流程">¶</a>步骤 2 : 开发流程</h3>
<p>模仿天猫整站SSH版 是一个比较大的项目，将按照商业项目的开发流程有条不紊的一一展开：</p>
<ol>
<li>
<p>需求分析<br>
首先确定要做哪些功能，需求分析包括[前台]和[后台]。<br>
前台又分为单纯要展示的那些功能-[需求分析-展示]，以及会提交数据到服务端的哪些功能-[需求分析-交互]。</p>
</li>
<li>
<p>表结构设计<br>
接着是表结构设计，表结构设计是围绕功能需求进行，如果表结构设计有问题，那么将会影响功能的实现。除了[表与表关系]，[建表SQL语句]之外，为了更好的帮助大家理解表结构以及关系，还特意把[表与页面功能]一一对应起来</p>
</li>
<li>
<p>原型<br>
接着是界面原型，与客户沟通顺畅的项目设计流程里一定会有原型这个环节。 借助界面原型，可以<strong>低成本，高效率</strong>的与客户达成需求的一致性。 同样的，原型分为了[前台原型]和[后台原型]。</p>
</li>
<li>
<p>后台-分类管理<br>
接下来开始进行功能开发，按照模块之间的依赖关系，首先进行[后台-分类管理]功能开发。严格来说，这是开发的第一个功能，所以讲解的十分详细，不仅提供了[可运行的项目]，还详细解释了其中用到的[JSP包含关系]，以及每个具体的功能： [查询]，[分页]，[增加]，[删除]，[编辑]，[修改]。 把每个细节都掰的很细，可以更好的理解，消化和吸收。 在把[后台-分类管理] 吃透之后，后续的其他后台管理功能，做起来就会更加顺畅。</p>
</li>
<li>
<p>项目重构<br>
在完成了分类管理之后，会发现使用SSH框架存在的一些问题，比如Service层的重复，Action层的繁琐，这些问题既会导致开发效率降低，也容易诱发更多编码错误。通过重构不仅解决了上述问题，更可以观察到站长是从什么角度思考这类问题的，改进自己的编程思路。</p>
</li>
<li>
<p>后台-其他管理<br>
在把[后台-分类管理]消化吸收之后，就可以加速进行 [后台其他页面]的学习。</p>
</li>
<li>
<p>前台-首页<br>
前台也包括许多功能， 与[后台-分类管理]类似的，首先把[前台-首页]这个功能单独拿出来，进行精讲。[前台-首页]消化吸收好之后，再进行其他前台功能的开发。</p>
</li>
<li>
<p>前台无需登录<br>
从前台模块之间的依赖性，以及开发顺序的合理性来考虑，把前台功能分为了 [无需登录] 即可使用的功能，和[需要登录]才能访问的功能。 建立在前一步[前台-首页]的基础之上，开始进行一系列的[无需登录]功能开发。</p>
</li>
<li>
<p>前台需要登录<br>
最后是需要登录的前台功能。 这部分功能基本上都是和购物相关的。 因此，一开始先把[购物流程]单独拿出来捋清楚，其中还特别注明了[购物流程环节与表关系]，这样能够更好的建立对前端购物功能的理解。随着这部分功能的开发，就会进入订单生成部分，在此之前，先准备了一个 [订单状态图]，在理解了这个图之后，可以更好的进行订单相关功能的开发。</p>
</li>
<li>
<p>总结<br>
最后总结整个项目的项目结构，都实现了哪些典型场景，运用了哪些设计模式，把学习到的知识都沉淀下来，转换，消化，吸收为自己的技能</p>
</li>
</ol>
<h2 id="7、各个版本区别"><a class="header-anchor" href="#7、各个版本区别">¶</a>7、各个版本区别</h2>
<h3 id="步骤-1-各个版本区别"><a class="header-anchor" href="#步骤-1-各个版本区别">¶</a>步骤 1 : 各个版本区别</h3>
<p>模仿天猫整站实践项目教程目前有 4 个版本，分别是 [J2EE版]， [SSH版]、[SSM版]， [Springboot版] 以下列出了各个版本之间的区别。</p>
<p>同一个项目，特意采用了不同的技术实现，大体上涵盖了目前JAVA用到的各类主流技术。采用不同的开发环境，启动部署方式，项目风格，以各种不同的方式实现了同一个项目里的各类业务功能。 掌握了这些内容之后，能够比较明显地提高参加工作时的适应能力。</p>
<table>
<thead>
<tr>
<th style="text-align:center">模仿天猫整站个版本区别</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">J2EE版</td>
<td style="text-align:center">SSH 版</td>
<td style="text-align:center">SSM 版</td>
<td style="text-align:center">SPRINGBOOT 版</td>
</tr>
<tr>
<td style="text-align:center">前台功能</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
</tr>
<tr>
<td style="text-align:center">后台功能</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
<td style="text-align:center">齐备</td>
</tr>
<tr>
<td style="text-align:center">存储层技术</td>
<td style="text-align:center">JDBC</td>
<td style="text-align:center">Hibernate</td>
<td style="text-align:center">Mybatis</td>
<td style="text-align:center">JPA</td>
</tr>
<tr>
<td style="text-align:center">控制层技术</td>
<td style="text-align:center">Servlet+反射</td>
<td style="text-align:center">Struts2</td>
<td style="text-align:center">Spring MVC</td>
<td style="text-align:center">Spring MVC</td>
</tr>
<tr>
<td style="text-align:center">教程使用的IDE</td>
<td style="text-align:center">Eclipse</td>
<td style="text-align:center">Eclipse</td>
<td style="text-align:center">IntelliJ IDEA(无缝兼容Eclipse)</td>
<td style="text-align:center">IntelliJ IDEA(无缝兼容Eclipse)</td>
</tr>
<tr>
<td style="text-align:center">是否Maven项目</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
</tr>
<tr>
<td style="text-align:center">项目格式</td>
<td style="text-align:center">标准 Java 项目</td>
<td style="text-align:center">动态Web项目</td>
<td style="text-align:center">Maven Web项目</td>
<td style="text-align:center">Maven 项目</td>
</tr>
<tr>
<td style="text-align:center">启动方式</td>
<td style="text-align:center">Tomcat独立配置启动</td>
<td style="text-align:center">Eclipse内置Tomcat启动</td>
<td style="text-align:center">IntelliJ IDEA内置Tomcat启动</td>
<td style="text-align:center">Springboot 自带Tomcat</td>
</tr>
<tr>
<td style="text-align:center">模板技术</td>
<td style="text-align:center">JSP</td>
<td style="text-align:center">JSP</td>
<td style="text-align:center">JSP</td>
<td style="text-align:center">Thymeleaf</td>
</tr>
<tr>
<td style="text-align:center">前端框架</td>
<td style="text-align:center">Bootstrap</td>
<td style="text-align:center">Bootstrap</td>
<td style="text-align:center">Bootstrap</td>
<td style="text-align:center">Bootstrap, Vue.js</td>
</tr>
<tr>
<td style="text-align:center">前后端分离</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
</tr>
<tr>
<td style="text-align:center">异步处理技术</td>
<td style="text-align:center">JQuery</td>
<td style="text-align:center">JQuery</td>
<td style="text-align:center">JQuery</td>
<td style="text-align:center">Axios.js</td>
</tr>
<tr>
<td style="text-align:center">RESTFUL</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">标准 RESTFUL 风格</td>
</tr>
<tr>
<td style="text-align:center">动静分离</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">通过 nginx 实现</td>
</tr>
<tr>
<td style="text-align:center">安全框架</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">通过 shiro 实现</td>
</tr>
<tr>
<td style="text-align:center">缓存</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">通过 redis 实现</td>
</tr>
<tr>
<td style="text-align:center">搜索引擎</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">通过 elastic search 实现</td>
</tr>
<tr>
<td style="text-align:center">部署到Linux</td>
<td style="text-align:center"><a href="https://how2j.cn/k/1591" target="_blank" rel="noopener">提供独立免费教程-如何把J2EE应用部署到Linux系列教程</a></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h1 id="二、需求分析-展示"><a class="header-anchor" href="#二、需求分析-展示">¶</a>二、需求分析-展示</h1>
<p>需求简单理解就是要做成什么样子，这些需求都是基于[模仿天猫整站]整理出来的，主要分为3类</p>
<h2 id="1、概述"><a class="header-anchor" href="#1、概述">¶</a>1、概述</h2>
<ol>
<li>
<p>前端展示<br>
在前端页面上显示数据库中的数据，如首页，产品页，购物车，分类页面等等。<br>
至于这些前端页面如何组织显示，页面布局，css样式设置，Javascript交互代码等教学，在单独的[模仿天猫前端教程]中详细讲解。<br>
分开学习和讲解，降低学习的难度，避免全部前后端混杂在一起学带来的困扰。</p>
</li>
<li>
<p>前端交互<br>
这里的前端交互，与[模仿天猫前端教程]里的交互，不是同一个概念。 [模仿天猫前端教程]里的交互，仅仅停留在浏览器上的javascript交互，这里的交互指的是通过POST,GET等http协议，与服务端进行同步或者异步数据交互。 比如购买，购物车，生成订单，登录等等功能。</p>
</li>
<li>
<p>后台功能<br>
对支撑整站需要用到的数据，进行管理维护。 比如分类管理，分类属性管理， 产品管理，产品图片管理，用户管理，订单管理等等。</p>
</li>
</ol>
<h2 id="2、首页"><a class="header-anchor" href="#2、首页">¶</a>2、首页</h2>
<h3 id="步骤-1-在横向导航栏上提供4个分类连接"><a class="header-anchor" href="#步骤-1-在横向导航栏上提供4个分类连接">¶</a>步骤 1 : 在横向导航栏上提供4个分类连接</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4687.png" alt></p>
<h3 id="步骤-2-在纵向导航栏上提供全部17个分类连接"><a class="header-anchor" href="#步骤-2-在纵向导航栏上提供全部17个分类连接">¶</a>步骤 2 : 在纵向导航栏上提供全部17个分类连接</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4688.png" alt></p>
<h3 id="步骤-3-当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品"><a class="header-anchor" href="#步骤-3-当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品">¶</a>步骤 3 : 当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4689.png" alt></p>
<h3 id="步骤-4-按照每种分类显示5个商品的方式，显示所有17种分类"><a class="header-anchor" href="#步骤-4-按照每种分类显示5个商品的方式，显示所有17种分类">¶</a>步骤 4 : 按照每种分类显示5个商品的方式，显示所有17种分类</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4690.png" alt></p>
<h3 id="步骤-5-先看整体效果"><a class="header-anchor" href="#步骤-5-先看整体效果">¶</a>步骤 5 : 先看整体效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5124.png" alt></p>
<h2 id="3、产品页"><a class="header-anchor" href="#3、产品页">¶</a>3、产品页</h2>
<h3 id="步骤-1-显示分辨率为950x100的当前商品对应的分类图片"><a class="header-anchor" href="#步骤-1-显示分辨率为950x100的当前商品对应的分类图片">¶</a>步骤 1 : 显示分辨率为950x100的当前商品对应的分类图片</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4694.png" alt></p>
<h3 id="步骤-2-显示本商品的5个单独图片"><a class="header-anchor" href="#步骤-2-显示本商品的5个单独图片">¶</a>步骤 2 : 显示本商品的5个单独图片</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4695.png" alt></p>
<h3 id="步骤-3-商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等"><a class="header-anchor" href="#步骤-3-商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等">¶</a>步骤 3 : 商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4696.png" alt></p>
<h3 id="步骤-4-商品详情"><a class="header-anchor" href="#步骤-4-商品详情">¶</a>步骤 4 : 商品详情</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4697.png" alt></p>
<h3 id="步骤-5-评价信息"><a class="header-anchor" href="#步骤-5-评价信息">¶</a>步骤 5 : 评价信息</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4698.png" alt></p>
<h3 id="步骤-6-5张商品详细图片"><a class="header-anchor" href="#步骤-6-5张商品详细图片">¶</a>步骤 6 : 5张商品详细图片</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4699.png" alt></p>
<h2 id="4、分类页"><a class="header-anchor" href="#4、分类页">¶</a>4、分类页</h2>
<h3 id="步骤-1-显示分辨率为950x100的当前分类图片"><a class="header-anchor" href="#步骤-1-显示分辨率为950x100的当前分类图片">¶</a>步骤 1 : 显示分辨率为950x100的当前分类图片</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4691.png" alt></p>
<h3 id="步骤-2-显示本分类下的所有产品"><a class="header-anchor" href="#步骤-2-显示本分类下的所有产品">¶</a>步骤 2 : 显示本分类下的所有产品</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4692.png" alt></p>
<h2 id="5、搜索结果页"><a class="header-anchor" href="#5、搜索结果页">¶</a>5、搜索结果页</h2>
<h3 id="步骤-1-显示满足查询条件的商品"><a class="header-anchor" href="#步骤-1-显示满足查询条件的商品">¶</a>步骤 1 : 显示满足查询条件的商品</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4693.png" alt></p>
<h2 id="6、购物车查看页"><a class="header-anchor" href="#6、购物车查看页">¶</a>6、购物车查看页</h2>
<h3 id="步骤-1-在购物车中显示订单项"><a class="header-anchor" href="#步骤-1-在购物车中显示订单项">¶</a>步骤 1 : 在购物车中显示订单项</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4700.png" alt></p>
<h2 id="7、结算页"><a class="header-anchor" href="#7、结算页">¶</a>7、结算页</h2>
<h3 id="步骤-1-在结算页面显示被选中的订单项"><a class="header-anchor" href="#步骤-1-在结算页面显示被选中的订单项">¶</a>步骤 1 : 在结算页面显示被选中的订单项</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4701.png" alt></p>
<h2 id="8、确认支付页"><a class="header-anchor" href="#8、确认支付页">¶</a>8、确认支付页</h2>
<h3 id="步骤-1-确认支付页面显示本次订单的金额总数"><a class="header-anchor" href="#步骤-1-确认支付页面显示本次订单的金额总数">¶</a>步骤 1 : 确认支付页面显示本次订单的金额总数</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4702.png" alt></p>
<h2 id="9、支付成功页"><a class="header-anchor" href="#9、支付成功页">¶</a>9、支付成功页</h2>
<h3 id="步骤-1-付款成功时，显示本次付款金额"><a class="header-anchor" href="#步骤-1-付款成功时，显示本次付款金额">¶</a>步骤 1 : 付款成功时，显示本次付款金额</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4703.png" alt></p>
<h2 id="10、我的订单页"><a class="header-anchor" href="#10、我的订单页">¶</a>10、我的订单页</h2>
<h3 id="步骤-1-显示所有订单，以及对应的订单项"><a class="header-anchor" href="#步骤-1-显示所有订单，以及对应的订单项">¶</a>步骤 1 : 显示所有订单，以及对应的订单项</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4704.png" alt></p>
<h2 id="11、确认收货页"><a class="header-anchor" href="#11、确认收货页">¶</a>11、确认收货页</h2>
<h3 id="步骤-1-显示订单项内容"><a class="header-anchor" href="#步骤-1-显示订单项内容">¶</a>步骤 1 : 显示订单项内容</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4705.png" alt></p>
<h3 id="步骤-2-显示订单信息，收货人地址等"><a class="header-anchor" href="#步骤-2-显示订单信息，收货人地址等">¶</a>步骤 2 : 显示订单信息，收货人地址等</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4706.png" alt></p>
<h2 id="12、评价页"><a class="header-anchor" href="#12、评价页">¶</a>12、评价页</h2>
<h3 id="步骤-1-显示要评价的商品信息，商品当前的总评价数"><a class="header-anchor" href="#步骤-1-显示要评价的商品信息，商品当前的总评价数">¶</a>步骤 1 : 显示要评价的商品信息，商品当前的总评价数</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4707.png" alt></p>
<h3 id="步骤-2-评价成功后，显示当前商品所有的评价信息"><a class="header-anchor" href="#步骤-2-评价成功后，显示当前商品所有的评价信息">¶</a>步骤 2 : 评价成功后，显示当前商品所有的评价信息</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4708.png" alt></p>
<h2 id="13、页头信息展示"><a class="header-anchor" href="#13、页头信息展示">¶</a>13、页头信息展示</h2>
<h3 id="步骤-1-未登录状态"><a class="header-anchor" href="#步骤-1-未登录状态">¶</a>步骤 1 : 未登录状态</h3>
<p>请登录连接，免费注册连接，购物车是0件。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4709.png" alt></p>
<h3 id="步骤-2-已登录状态"><a class="header-anchor" href="#步骤-2-已登录状态">¶</a>步骤 2 : 已登录状态</h3>
<p>用户名称，退出超链以及购物车中的数量</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4710.png" alt></p>
<h1 id="三、需求分析-交互"><a class="header-anchor" href="#三、需求分析-交互">¶</a>三、需求分析-交互</h1>
<h2 id="1、概述-v2"><a class="header-anchor" href="#1、概述-v2">¶</a>1、概述</h2>
<p>这里的前端交互，与[模仿天猫前端教程]里的交互，不是同一个概念。 模仿天猫前端教程里的交互，仅仅停留在浏览器上的javascript交互，这里的交互指的是通过POST,GET等http协议，与服务端进行同步或者异步数据交互。 比如购买，购物车，生成订单，登录等等功能。</p>
<h2 id="2、分类页排序"><a class="header-anchor" href="#2、分类页排序">¶</a>2、分类页排序</h2>
<h3 id="步骤-1-按照综合，人气，新品，销量，价格排序"><a class="header-anchor" href="#步骤-1-按照综合，人气，新品，销量，价格排序">¶</a>步骤 1 : 按照综合，人气，新品，销量，价格排序</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4956.png" alt></p>
<h3 id="步骤-2-进行价格筛选，这个不算，这个是做在浏览器端的，并不是和服务器端的交互"><a class="header-anchor" href="#步骤-2-进行价格筛选，这个不算，这个是做在浏览器端的，并不是和服务器端的交互">¶</a>步骤 2 : 进行价格筛选，这个不算，这个是做在浏览器端的，并不是和服务器端的交互</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4957.png" alt></p>
<h2 id="3、立即购买"><a class="header-anchor" href="#3、立即购买">¶</a>3、立即购买</h2>
<h3 id="步骤-1-在产品页，未登录状态时候，点击立即购买"><a class="header-anchor" href="#步骤-1-在产品页，未登录状态时候，点击立即购买">¶</a>步骤 1 : 在产品页，未登录状态时候，点击立即购买</h3>
<p>在产品页，未登录状态时候，点击立即购买，会弹出登录模态窗口</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4958.png" alt></p>
<h3 id="步骤-2-在产品页，如果已经登录，点击购买"><a class="header-anchor" href="#步骤-2-在产品页，如果已经登录，点击购买">¶</a>步骤 2 : 在产品页，如果已经登录，点击购买</h3>
<p>在产品页，如果已经登录，点击购买，会提交数据到服务端，生成订单项，并且跳转到结算页面</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4959.png" alt></p>
<h2 id="4、加入购物车"><a class="header-anchor" href="#4、加入购物车">¶</a>4、加入购物车</h2>
<h3 id="步骤-1-在未登录状态，点击加入购物车"><a class="header-anchor" href="#步骤-1-在未登录状态，点击加入购物车">¶</a>步骤 1 : 在未登录状态，点击加入购物车</h3>
<p>在未登录状态，点击加入购物车，会弹出模态窗口</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4960.png" alt="4960"></p>
<h3 id="步骤-2-在已登录状态，点击加入购物车"><a class="header-anchor" href="#步骤-2-在已登录状态，点击加入购物车">¶</a>步骤 2 : 在已登录状态，点击加入购物车</h3>
<p>在已登录状态，点击加入购物车，使用ajax异步提交数据到服务端，生成订单项，并且使当前 “加入购物车” 按钮变得不可点击</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4961.png" alt></p>
<h2 id="5、调整订单项数量"><a class="header-anchor" href="#5、调整订单项数量">¶</a>5、调整订单项数量</h2>
<h3 id="步骤-1-在购物车页面，调整订单项数量"><a class="header-anchor" href="#步骤-1-在购物车页面，调整订单项数量">¶</a>步骤 1 : 在购物车页面，调整订单项数量</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4962.png" alt></p>
<h2 id="6、删除订单项"><a class="header-anchor" href="#6、删除订单项">¶</a>6、删除订单项</h2>
<h3 id="步骤-1-在购物车页面，删除订单项"><a class="header-anchor" href="#步骤-1-在购物车页面，删除订单项">¶</a>步骤 1 : 在购物车页面，删除订单项</h3>
<p>在购物车页面，删除订单项，首先弹出模态窗口确认是否要删除，如果要删除，则通过Ajax异步发送指令到服务端，并且在当前页面删除该条订单项</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4963.png" alt></p>
<h2 id="7、生成订单"><a class="header-anchor" href="#7、生成订单">¶</a>7、生成订单</h2>
<h3 id="步骤-1-在结算页面，提交订单"><a class="header-anchor" href="#步骤-1-在结算页面，提交订单">¶</a>步骤 1 : 在结算页面，提交订单</h3>
<p>在结算页面，提交订单时候，根据结算页面的收货人信息，订单项信息，生成订单数据</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4963.png" alt></p>
<h2 id="8、订单页功能"><a class="header-anchor" href="#8、订单页功能">¶</a>8、订单页功能</h2>
<h3 id="步骤-1-我的订单页面"><a class="header-anchor" href="#步骤-1-我的订单页面">¶</a>步骤 1 : 我的订单页面</h3>
<p>订单页面上有3个按钮，付款，确认收货和评价，这些按钮都没有提交数据到服务端，而是提交到下一个页面的二次操作，才提交数据到服务端的。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4965.png" alt></p>
<h2 id="9、确认付款"><a class="header-anchor" href="#9、确认付款">¶</a>9、确认付款</h2>
<h3 id="步骤-1-确认付款"><a class="header-anchor" href="#步骤-1-确认付款">¶</a>步骤 1 : 确认付款</h3>
<p>点击确认支付，提交本信息到服务端，服务端修改订单中的支付日期</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4972.png" alt></p>
<h2 id="10、确认收货"><a class="header-anchor" href="#10、确认收货">¶</a>10、确认收货</h2>
<h3 id="步骤-1-确认收货"><a class="header-anchor" href="#步骤-1-确认收货">¶</a>步骤 1 : 确认收货</h3>
<p>确认收货页面，点击确认支付，提交数据到服务端，并且修改订单中的确认收货日期</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4973.png" alt></p>
<h2 id="11、提交评价信息"><a class="header-anchor" href="#11、提交评价信息">¶</a>11、提交评价信息</h2>
<h3 id="步骤-1-评价页面，提交评价信息"><a class="header-anchor" href="#步骤-1-评价页面，提交评价信息">¶</a>步骤 1 : 评价页面，提交评价信息</h3>
<p>提交评价信息到服务端</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4966.png" alt></p>
<h2 id="12、登录"><a class="header-anchor" href="#12、登录">¶</a>12、登录</h2>
<h3 id="步骤-1-登录页面"><a class="header-anchor" href="#步骤-1-登录页面">¶</a>步骤 1 : 登录页面</h3>
<p>输入正确账号密码，登录成功后跳转到首页，失败提示错误信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4967.png" alt></p>
<h2 id="13、注册"><a class="header-anchor" href="#13、注册">¶</a>13、注册</h2>
<h3 id="步骤-1-注册页面"><a class="header-anchor" href="#步骤-1-注册页面">¶</a>步骤 1 : 注册页面</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4968.png" alt></p>
<h2 id="14、退出"><a class="header-anchor" href="#14、退出">¶</a>14、退出</h2>
<h3 id="步骤-1-退出"><a class="header-anchor" href="#步骤-1-退出">¶</a>步骤 1 : 退出</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4970.png" alt></p>
<h2 id="15、搜索"><a class="header-anchor" href="#15、搜索">¶</a>15、搜索</h2>
<h3 id="步骤-1-搜索"><a class="header-anchor" href="#步骤-1-搜索">¶</a>步骤 1 : 搜索</h3>
<p>提交关键字到服务端，服务端查询数据库，并返回匹配的产品</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4969.png" alt></p>
<h2 id="16、前台需求列表"><a class="header-anchor" href="#16、前台需求列表">¶</a>16、前台需求列表</h2>
<h3 id="步骤-1-前端页面需求列表清单"><a class="header-anchor" href="#步骤-1-前端页面需求列表清单">¶</a>步骤 1 : 前端页面需求列表清单</h3>
<p>绿色表示<strong>展示</strong>的需求<br>
红色表示与服务器有<strong>交互</strong>的需求</p>
<ol>
<li>
<p>首页</p>
</li>
<li>
<ul>
<li><font color="green">在横向导航栏上提供4个分类连接</font></li>
<li><font color="green">在纵向导航栏上提供全部17个分类连接</font></li>
<li><font color="green">当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</font></li>
<li><font color="green">按照每种分类，显示5个商品的方式显示所有17种分类</font></li>
</ul>
</li>
<li>
<p>产品页</p>
</li>
<li>
<ul>
<li><font color="green">显示分辨率为950x100的当前商品对应的分类图片</font></li>
<li><font color="green">显示本商品的5个单独图片</font></li>
<li><font color="green">商品的基本信息，如标题，小标题，加个，销量，评价数量，库存等</font></li>
<li><font color="green">商品详情</font></li>
<li><font color="green">评价信息</font></li>
<li><font color="green">5张商品详细图片</font></li>
<li><font color="red">立即购买</font></li>
<li><font color="red">加入购物车</font></li>
</ul>
</li>
<li>
<p>分类页</p>
</li>
<li>
<ul>
<li><font color="green">显示分辨率为950x100的当前分类图片</font></li>
<li><font color="green">显示本分类下的所有产品</font></li>
<li><font color="red">分类页排序</font></li>
</ul>
</li>
<li>
<p>搜索结果页</p>
</li>
<li>
<ul>
<li><font color="green">显示满足查询条件的商品</font></li>
</ul>
</li>
<li>
<p>购物车查看页</p>
</li>
<li>
<ul>
<li><font color="green">在购物车中显示订单项</font></li>
<li><font color="red">调整订单项数量</font></li>
<li><font color="red">删除订单项</font></li>
</ul>
</li>
<li>
<p>结算页</p>
</li>
<li>
<ul>
<li><font color="green">在结算页面显示被选中的订单项</font></li>
<li><font color="red">生成订单</font></li>
</ul>
</li>
<li>
<p>确认支付页</p>
</li>
<li>
<ul>
<li><font color="green">确认支付页面显示本次订单的金额总数</font></li>
<li><font color="red">确认付款</font></li>
</ul>
</li>
<li>
<p>支付成功页</p>
</li>
<li>
<ul>
<li><font color="green">付款成功时，显示本次付款金额</font></li>
</ul>
</li>
<li>
<p>我的订单页</p>
</li>
<li>
<ul>
<li><font color="green">显示所有订单，以及对应的订单项</font></li>
</ul>
</li>
<li>
<p>确认收货页</p>
</li>
<li>
<ul>
<li><font color="green">显示订单项内容</font></li>
<li><font color="green">显示订单信息，收货人地址等</font></li>
<li><font color="red">确认收货</font></li>
</ul>
</li>
<li>
<p>评价页</p>
</li>
<li>
<ul>
<li><font color="green">显示要评价的商品信息，商品当前的总评价数</font></li>
<li><font color="green">评价成功后，显示当前商品所有的评价信息</font></li>
<li><font color="red">提交评价信息</font></li>
</ul>
</li>
<li>
<p>页头信息展示</p>
</li>
<li>
<ul>
<li><font color="green">未登录状态</font></li>
<li><font color="green">已登录状态</font></li>
<li><font color="red">登录</font></li>
<li><font color="red">注册</font></li>
<li><font color="red">退出</font></li>
</ul>
</li>
<li>
<p>所有页面</p>
</li>
<li>
<ul>
<li><font color="red">搜索</font></li>
</ul>
</li>
</ol>
<h1 id="四、需求分析-后台"><a class="header-anchor" href="#四、需求分析-后台">¶</a>四、需求分析-后台</h1>
<h2 id="1、概述-v3"><a class="header-anchor" href="#1、概述-v3">¶</a>1、概述</h2>
<p>对支撑整站需要用到的数据，进行管理维护。 比如分类管理，分类属性管理， 产品管理，产品图片管理，用户管理，订单管理等等。</p>
<h2 id="2、分类管理"><a class="header-anchor" href="#2、分类管理">¶</a>2、分类管理</h2>
<h3 id="步骤-1-分页查询"><a class="header-anchor" href="#步骤-1-分页查询">¶</a>步骤 1 : 分页查询</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4711.png" alt></p>
<h3 id="步骤-2-新增分类"><a class="header-anchor" href="#步骤-2-新增分类">¶</a>步骤 2 : 新增分类</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4712.png" alt></p>
<h3 id="步骤-3-编辑修改"><a class="header-anchor" href="#步骤-3-编辑修改">¶</a>步骤 3 : 编辑修改</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4713.png" alt></p>
<h3 id="步骤-4-删除"><a class="header-anchor" href="#步骤-4-删除">¶</a>步骤 4 : 删除</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4714.png" alt></p>
<h2 id="3、属性管理"><a class="header-anchor" href="#3、属性管理">¶</a>3、属性管理</h2>
<h3 id="步骤-1-属性概念"><a class="header-anchor" href="#步骤-1-属性概念">¶</a>步骤 1 : 属性概念</h3>
<p>这里的属性，指的是产品属性。<br>
比如<strong>太阳镜</strong>这种产品，有镜片材质，适合脸型，眼镜配件类型等属性。<br>
而<strong>平板电视</strong>这种产品，有操作系统，能效等级，网络连接方式等属性。</p>
<p>不同的产品，有不同的属性，以及对应的属性值。</p>
<p>按照传统的数据库的设计方式，就会在产品表里设置不同的字段，而天猫的产品五花八门，有成百上千种不同的属性，难道给一张产品表设置成百上千的字段吗？</p>
<p>这样做出来的系统，肯定是不具备维护性的。</p>
<p>为了解决这个问题，引入了产品属性这个概念，假定同一类产品，都有相同的属性。<br>
比如所有的<strong>女装</strong>，都有 材质成分，尺码，上市年份季节等等属性。 具体到某一件女装，其区别只是在于属性值不一样。</p>
<p>这样在一个分类下，就可以维护一系列的产品属性，针对于不同的产品，再设置不同的值，即可达到保存和维护大量产品属性值的效果。</p>
<h3 id="步骤-2-分页查询"><a class="header-anchor" href="#步骤-2-分页查询">¶</a>步骤 2 : 分页查询</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4716.png" alt></p>
<h3 id="步骤-3-新增属性"><a class="header-anchor" href="#步骤-3-新增属性">¶</a>步骤 3 : 新增属性</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4717.png" alt></p>
<h3 id="步骤-4-编辑修改"><a class="header-anchor" href="#步骤-4-编辑修改">¶</a>步骤 4 : 编辑修改</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4718.png" alt></p>
<h3 id="步骤-5-删除"><a class="header-anchor" href="#步骤-5-删除">¶</a>步骤 5 : 删除</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4719.png" alt></p>
<h2 id="4、产品管理"><a class="header-anchor" href="#4、产品管理">¶</a>4、产品管理</h2>
<h3 id="步骤-1-分页查询-v2"><a class="header-anchor" href="#步骤-1-分页查询-v2">¶</a>步骤 1 : 分页查询</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4720.png" alt></p>
<h3 id="步骤-2-新增产品"><a class="header-anchor" href="#步骤-2-新增产品">¶</a>步骤 2 : 新增产品</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4721.png" alt></p>
<h3 id="步骤-3-编辑修改-v2"><a class="header-anchor" href="#步骤-3-编辑修改-v2">¶</a>步骤 3 : 编辑修改</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4722.png" alt></p>
<h3 id="步骤-4-删除-v2"><a class="header-anchor" href="#步骤-4-删除-v2">¶</a>步骤 4 : 删除</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4723.png" alt></p>
<h2 id="5、产品图片管理"><a class="header-anchor" href="#5、产品图片管理">¶</a>5、产品图片管理</h2>
<h3 id="步骤-1-产品图片概念"><a class="header-anchor" href="#步骤-1-产品图片概念">¶</a>步骤 1 : 产品图片概念</h3>
<p>一件产品，对应多条 <strong>单个图片</strong><br>
一件产品，对应多条 <strong>详情图片</strong></p>
<p>所以这部分单独做一个页面进行管理</p>
<h3 id="步骤-2-产品图片管理"><a class="header-anchor" href="#步骤-2-产品图片管理">¶</a>步骤 2 : 产品图片管理</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4725.png" alt></p>
<h2 id="6、产品属性设置"><a class="header-anchor" href="#6、产品属性设置">¶</a>6、产品属性设置</h2>
<h3 id="步骤-1-产品属性值设置"><a class="header-anchor" href="#步骤-1-产品属性值设置">¶</a>步骤 1 : 产品属性值设置</h3>
<p>根据[属性管理]中的讲解，一种产品所具备的属性，在其对应的分类中进行了维护。</p>
<p>那么，要修改产品的这些属性值，就在本页面进行。</p>
<p>这里采用异步提交方式，编辑即修改,修改成功用绿色边框表示</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4726.png" alt></p>
<h2 id="7、用户管理"><a class="header-anchor" href="#7、用户管理">¶</a>7、用户管理</h2>
<h3 id="步骤-1-分页查询-v3"><a class="header-anchor" href="#步骤-1-分页查询-v3">¶</a>步骤 1 : 分页查询</h3>
<p>用户管理就提供了一个分页查询，做的比较简约，几个原因：</p>
<ol>
<li>用户是不能删除的</li>
<li>用户信息的修改，应该交由前端由客户自己修改，比如密码，基本信息等</li>
<li>用户的增加，是前端注册导致的，后台不负责用户的增加</li>
</ol>
<p>所以，增，删，改功能在后台就不提供了，仅仅提供一个分页查询</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4727.png" alt></p>
<h2 id="8、订单管理"><a class="header-anchor" href="#8、订单管理">¶</a>8、订单管理</h2>
<h3 id="步骤-1-订单分页查询"><a class="header-anchor" href="#步骤-1-订单分页查询">¶</a>步骤 1 : 订单分页查询</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4728.png" alt></p>
<h3 id="步骤-2-查看详情"><a class="header-anchor" href="#步骤-2-查看详情">¶</a>步骤 2 : 查看详情</h3>
<p>查看本订单都由哪些订单项组成</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4729.png" alt></p>
<h3 id="步骤-3-发货"><a class="header-anchor" href="#步骤-3-发货">¶</a>步骤 3 : 发货</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4730.png" alt></p>
<h2 id="9、后台需求列表"><a class="header-anchor" href="#9、后台需求列表">¶</a>9、后台需求列表</h2>
<h3 id="步骤-1-后台需求列表清单"><a class="header-anchor" href="#步骤-1-后台需求列表清单">¶</a>步骤 1 : 后台需求列表清单</h3>
<ol>
<li>
<p>分类管理</p>
</li>
<li>
<ul>
<li><font color="green">分页查询</font></li>
<li><font color="green">新增分类</font></li>
<li><font color="green">编辑修改</font></li>
<li><font color="green">删除</font></li>
</ul>
</li>
<li>
<p>属性管理</p>
</li>
<li>
<ul>
<li><font color="green">属性概念</font></li>
<li><font color="green">分页查询</font></li>
<li><font color="green">新增属性</font></li>
<li><font color="green">编辑修改</font></li>
<li><font color="green">删除</font></li>
</ul>
</li>
<li>
<p>产品管理</p>
</li>
<li>
<ul>
<li><font color="green">分页查询</font></li>
<li><font color="green">新增产品</font></li>
<li><font color="green">编辑修改</font></li>
<li><font color="green">删除</font></li>
</ul>
</li>
<li>
<p>产品图片管理</p>
</li>
<li>
<ul>
<li><font color="green">产品图片概念</font></li>
<li><font color="green">产品图片管理</font></li>
</ul>
</li>
<li>
<p>产品属性设置</p>
</li>
<li>
<ul>
<li><font color="green">产品属性值设置</font></li>
</ul>
</li>
<li>
<p>用户管理</p>
</li>
<li>
<ul>
<li><font color="green">分页查询</font></li>
</ul>
</li>
<li>
<p>订单管理</p>
</li>
<li>
<ul>
<li><font color="green">订单分页查询</font></li>
<li><font color="green">查看详情</font></li>
<li><font color="green">发货</font></li>
</ul>
</li>
</ol>
<h1 id="五、表结构设计"><a class="header-anchor" href="#五、表结构设计">¶</a>五、表结构设计</h1>
<h2 id="1、概述-v4"><a class="header-anchor" href="#1、概述-v4">¶</a>1、概述</h2>
<p>在需求分析结束之后，接下来要做的不是马上开发功能，而是进行表结构的设计。<br>
只有把表结构设计正确了，才能支撑软件后续的功能开发，这一步是非常重要的。<br>
为了便于大家理解表结构设计的过程，把设计过程分解成了</p>
<ol>
<li>
<p>[数据库的创建]</p>
</li>
<li>
<p>[表与表关系]</p>
</li>
<li>
<p>[建表SQL语句]</p>
</li>
<li>
<p>[表与页面]</p>
</li>
</ol>
<p>这么几个步骤，然后再把几个步骤[放在一起]做一遍。方便大家理解</p>
<h2 id="2、数据库"><a class="header-anchor" href="#2、数据库">¶</a>2、数据库</h2>
<h3 id="步骤-1-数据库tmall-ssh"><a class="header-anchor" href="#步骤-1-数据库tmall-ssh">¶</a>步骤 1 : 数据库tmall_ssh</h3>
<p>创建数据库:tmall_ssh<br>
并且将数据库的编码设置为utf8，便于存放中文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS tmall_ssh;</span><br><span class="line">CREATE DATABASE tmall_ssh DEFAULT CHARACTER SET utf8;</span><br></pre></td></tr></table></figure>
<h2 id="3、表与表关系"><a class="header-anchor" href="#3、表与表关系">¶</a>3、表与表关系</h2>
<h3 id="步骤-1-表关系图"><a class="header-anchor" href="#步骤-1-表关系图">¶</a>步骤 1 : 表关系图</h3>
<p>在这张表关系图上，列出了模仿天猫整站一共需要用到的9张表，以及表之间的关系。接下来，对每张表做介绍，并讲解表与表之间的关系</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4733.png" alt></p>
<h3 id="步骤-2-表"><a class="header-anchor" href="#步骤-2-表">¶</a>步骤 2 : 表</h3>
<table>
<thead>
<tr>
<th style="text-align:center">表名</th>
<th style="text-align:center">中文含义</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Category</td>
<td style="text-align:center">分类表</td>
<td style="text-align:center">存放分类信息，如女装，平板电视，沙发等</td>
</tr>
<tr>
<td style="text-align:center">Property</td>
<td style="text-align:center">属性表</td>
<td style="text-align:center">存放属性信息，如颜色，重量，品牌，厂商，型号等</td>
</tr>
<tr>
<td style="text-align:center">Product</td>
<td style="text-align:center">产品表</td>
<td style="text-align:center">存放产品信息，如LED40EC平板电视机，海尔EC6005热水器</td>
</tr>
<tr>
<td style="text-align:center">PropertyValue</td>
<td style="text-align:center">属性值表</td>
<td style="text-align:center">存放属性值信息，如重量是900g,颜色是粉红色</td>
</tr>
<tr>
<td style="text-align:center">ProductImage</td>
<td style="text-align:center">产品图片表</td>
<td style="text-align:center">存放产品图片信息，如产品页显示的5个图片</td>
</tr>
<tr>
<td style="text-align:center">Review</td>
<td style="text-align:center">评论表</td>
<td style="text-align:center">存放评论信息，如买回来的蜡烛很好用，么么哒</td>
</tr>
<tr>
<td style="text-align:center">User</td>
<td style="text-align:center">用户表</td>
<td style="text-align:center">存放用户信息，如斩手狗，千手小粉红</td>
</tr>
<tr>
<td style="text-align:center">Order</td>
<td style="text-align:center">订单表</td>
<td style="text-align:center">存放订单信息，包括邮寄地址，点好号码等信息</td>
</tr>
<tr>
<td style="text-align:center">OrderItem</td>
<td style="text-align:center">订单项表</td>
<td style="text-align:center">存放订单项信息，包括购买产品种类，数量等</td>
</tr>
</tbody>
</table>
<h3 id="步骤-3-正确的分析表与表之间的关系的方法"><a class="header-anchor" href="#步骤-3-正确的分析表与表之间的关系的方法">¶</a>步骤 3 : 正确的分析表与表之间的关系的方法</h3>
<p>表与表之间的关系，基本上是3种<br>
一对一<br>
一对多<br>
多对一<br>
那么怎么判断关系到底是什么呢？<br>
以分类和产品为例子，分类表里有多条数据，产品表里也有多条数据，那么他们的关系是多对多吗？ 从经验上讲，我们知道这个结果是不正确的。</p>
<p>正确的分析表与表之间的关系的方法是这样：<br>
<strong>一个</strong>分类对应 <strong>多个</strong> 产品<br>
<strong>一个</strong>产品对应 <strong>一个</strong> 分类</p>
<p>所以分类和产品之间的关系是<strong>一对多</strong></p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4735.png" alt></p>
<h3 id="步骤-4-表关系"><a class="header-anchor" href="#步骤-4-表关系">¶</a>步骤 4 : 表关系</h3>
<p>从最上面的表关系图中可以看到，有关系的表之间，都是一对多关系(反过来就是多对一关系)，并没有一对一关系，和多对多关系。</p>
<p>所以本表列出了所有的一对多关系</p>
<p>**注：**产品和用户之间其实是多对多关系，即一个用户可以购买多种产品，一种产品可以被多个用户购买。 但是他们的多对多关系是间接的建立在订单项表(OrderItem)上的。</p>
<table>
<thead>
<tr>
<th style="text-align:center">一</th>
<th style="text-align:center">多</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Category-分类</td>
<td style="text-align:center">Product-产品</td>
</tr>
<tr>
<td style="text-align:center">Category-分类</td>
<td style="text-align:center">Property-属性</td>
</tr>
<tr>
<td style="text-align:center">Property-属性</td>
<td style="text-align:center">PropertyValue-属性值</td>
</tr>
<tr>
<td style="text-align:center">Product-产品</td>
<td style="text-align:center">PropertyValue-属性值</td>
</tr>
<tr>
<td style="text-align:center">Product-产品</td>
<td style="text-align:center">ProductImage-产品图片</td>
</tr>
<tr>
<td style="text-align:center">Product-产品</td>
<td style="text-align:center">Review-评价</td>
</tr>
<tr>
<td style="text-align:center">User-用户</td>
<td style="text-align:center">Order-订单</td>
</tr>
<tr>
<td style="text-align:center">Product-产品</td>
<td style="text-align:center">OrderItem-订单项</td>
</tr>
<tr>
<td style="text-align:center">User-用户</td>
<td style="text-align:center">OrderItem-订单项</td>
</tr>
<tr>
<td style="text-align:center">Order-订单</td>
<td style="text-align:center">OrderItem-订单项</td>
</tr>
<tr>
<td style="text-align:center">User-用户</td>
<td style="text-align:center">User-评价</td>
</tr>
</tbody>
</table>
<h2 id="4、建表SQL语句"><a class="header-anchor" href="#4、建表SQL语句">¶</a>4、建表SQL语句</h2>
<h3 id="步骤-1-建表顺序"><a class="header-anchor" href="#步骤-1-建表顺序">¶</a>步骤 1 : 建表顺序</h3>
<p>在建表过程中，会设置外键约束，所以表和表之间有依赖关系。 因此会先建立被外键指向的表，比如User,Category，然后再是其他表</p>
<h3 id="步骤-2-用户表"><a class="header-anchor" href="#步骤-2-用户表">¶</a>步骤 2 : 用户表</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  password varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-分类表"><a class="header-anchor" href="#步骤-3-分类表">¶</a>步骤 3 : 分类表</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE category (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-属性表"><a class="header-anchor" href="#步骤-4-属性表">¶</a>步骤 4 : 属性表</h3>
<p>从这个表开始， 既有外键约束了。<br>
本表的外键cid，指向分类表的id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE property (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_property_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-产品表"><a class="header-anchor" href="#步骤-5-产品表">¶</a>步骤 5 : 产品表</h3>
<p>产品表字段稍多，讲解一下<br>
name: 产品名称<br>
subTitle: 小标题<br>
originalPrice: 原始价格<br>
promotePrice: 优惠价格<br>
stock: 库存<br>
createDate: 创建日期</p>
<p>本表的外键cid，指向分类表的id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE product (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  subTitle varchar(255) DEFAULT NULL,</span><br><span class="line">  originalPrice float DEFAULT NULL,</span><br><span class="line">  promotePrice float DEFAULT NULL,</span><br><span class="line">  stock int(11) DEFAULT NULL,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_product_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-属性值表"><a class="header-anchor" href="#步骤-6-属性值表">¶</a>步骤 6 : 属性值表</h3>
<p>本表有两个外键<br>
外键ptid，指向属性表的id字段<br>
外键pid，指向产品表的id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE propertyvalue (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  ptid int(11) DEFAULT NULL,</span><br><span class="line">  value varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_property FOREIGN KEY (ptid) REFERENCES property (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_product FOREIGN KEY (pid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-产品图片表"><a class="header-anchor" href="#步骤-7-产品图片表">¶</a>步骤 7 : 产品图片表</h3>
<p>type表示类型，产品图片分<strong>单个</strong>图片和<strong>详情</strong>图片两种</p>
<p>本表的外键pid，指向产品表的id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE productimage (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  type varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_productimage_product FOREIGN KEY (pid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-评价表"><a class="header-anchor" href="#步骤-8-评价表">¶</a>步骤 8 : 评价表</h3>
<p>外键pid，指向产品表的id字段<br>
外键uid，指向用户表的id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE review (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  content varchar(4000) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_review_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">    CONSTRAINT fk_review_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-订单表"><a class="header-anchor" href="#步骤-9-订单表">¶</a>步骤 9 : 订单表</h3>
<p>订单表的字段也比较多，讲解一下：<br>
orderCode： 订单号<br>
address:收货地址<br>
post: 邮编<br>
receiver: 收货人信息<br>
mobile: 手机号码<br>
userMessage: 用户备注信息<br>
createDate: 订单创建日期<br>
payDate: 支付日期<br>
deliveryDate: 发货日期<br>
confirmDate：确认收货日期<br>
status: 订单状态<br>
外键uid，指向用户表id字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE order_ (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  orderCode varchar(255) DEFAULT NULL,</span><br><span class="line">  address varchar(255) DEFAULT NULL,</span><br><span class="line">  post varchar(255) DEFAULT NULL,</span><br><span class="line">  receiver varchar(255) DEFAULT NULL,</span><br><span class="line">  mobile varchar(255) DEFAULT NULL,</span><br><span class="line">  userMessage varchar(255) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  payDate datetime DEFAULT NULL,</span><br><span class="line">  deliveryDate datetime DEFAULT NULL,</span><br><span class="line">  confirmDate datetime DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  status varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_order_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-订单项表"><a class="header-anchor" href="#步骤-10-订单项表">¶</a>步骤 10 : 订单项表</h3>
<p>这个表是外键最多的一个表<br>
外键pid，指向产品表id字段<br>
外键oid，指向订单表id字段<br>
外键uid，指向用户表id字段<br>
number字段表示购买数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE orderitem (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  oid int(11) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  number int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_user FOREIGN KEY (uid) REFERENCES user (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_order FOREIGN KEY (oid) REFERENCES order_ (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h2 id="5、表与页面"><a class="header-anchor" href="#5、表与页面">¶</a>5、表与页面</h2>
<h3 id="步骤-1-表与页面"><a class="header-anchor" href="#步骤-1-表与页面">¶</a>步骤 1 : 表与页面</h3>
<p>为了协助大家更好的理解这些表，本章节把这些表对应的部分页面一一对照起来。 如此便于大家把<strong>表中的数据与界面效果关联起来</strong>。</p>
<h3 id="步骤-2-用户表-v2"><a class="header-anchor" href="#步骤-2-用户表-v2">¶</a>步骤 2 : 用户表</h3>
<p>登录页面采集用户的账号和密码</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4749.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  password varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-分类表-v2"><a class="header-anchor" href="#步骤-3-分类表-v2">¶</a>步骤 3 : 分类表</h3>
<p>首页的竖状导航栏显示所有17种分类信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4750.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE category (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-属性表-v2"><a class="header-anchor" href="#步骤-4-属性表-v2">¶</a>步骤 4 : 属性表</h3>
<p>在产品页的<strong>商品详情</strong>标签下，显示本产品对应分类所设置的所有属性。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4751.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE property (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_property_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-产品表-v2"><a class="header-anchor" href="#步骤-5-产品表-v2">¶</a>步骤 5 : 产品表</h3>
<p>产品页的产品信息里显示本产品的名称，小标题，原始价格，促销价，销量，库存等信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4752.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE product (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  subTitle varchar(255) DEFAULT NULL,</span><br><span class="line">  orignalPrice float DEFAULT NULL,</span><br><span class="line">  promotePrice float DEFAULT NULL,</span><br><span class="line">  stock int(11) DEFAULT NULL,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_product_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-属性值表-v2"><a class="header-anchor" href="#步骤-6-属性值表-v2">¶</a>步骤 6 : 属性值表</h3>
<p>在产品页的<strong>商品详情</strong>标签下，显示本产品的所有<strong>属性值</strong></p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4753.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE propertyvalue (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  ptid int(11) DEFAULT NULL,</span><br><span class="line">  value varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_property FOREIGN KEY (pid) REFERENCES property (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_product FOREIGN KEY (ptid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-产品图片表-v2"><a class="header-anchor" href="#步骤-7-产品图片表-v2">¶</a>步骤 7 : 产品图片表</h3>
<p>在产品页显示5个<strong>单个</strong>图片</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4754.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE productimage (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  type varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_productimage_product FOREIGN KEY (pid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-评价表-v2"><a class="header-anchor" href="#步骤-8-评价表-v2">¶</a>步骤 8 : 评价表</h3>
<p>产品页显示评价信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4755.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  content varchar(4000) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_review_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">    CONSTRAINT fk_review_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-订单表-v2"><a class="header-anchor" href="#步骤-9-订单表-v2">¶</a>步骤 9 : 订单表</h3>
<p>在后台的订单管理页面看到的订单信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4756.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE order_ (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  orderCode varchar(255) DEFAULT NULL,</span><br><span class="line">  address varchar(255) DEFAULT NULL,</span><br><span class="line">  post varchar(255) DEFAULT NULL,</span><br><span class="line">  receiver varchar(255) DEFAULT NULL,</span><br><span class="line">  mobile varchar(255) DEFAULT NULL,</span><br><span class="line">  userMessage varchar(255) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  payDate datetime DEFAULT NULL,</span><br><span class="line">  deliveryDate datetime DEFAULT NULL,</span><br><span class="line">  confirmDate datetime DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  status varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_order_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-订单项表-v2"><a class="header-anchor" href="#步骤-10-订单项表-v2">¶</a>步骤 10 : 订单项表</h3>
<p>在购物车中看到的订单项信息</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4757.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE orderitem (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  oid int(11) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  number int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_user FOREIGN KEY (uid) REFERENCES user (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_order FOREIGN KEY (oid) REFERENCES order_ (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h2 id="6、整理在一起"><a class="header-anchor" href="#6、整理在一起">¶</a>6、整理在一起</h2>
<h3 id="步骤-1-tmall-ssh-sql"><a class="header-anchor" href="#步骤-1-tmall-ssh-sql">¶</a>步骤 1 : tmall_ssh.sql</h3>
<p>一般说来，对于一个新项目，建表的时候，会把sql语句都准备好，一次性执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS tmall_ssh;</span><br><span class="line">CREATE DATABASE tmall_ssh DEFAULT CHARACTER SET utf8;</span><br><span class="line">USE tmall_ssh;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE user (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  password varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE category (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE property (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_property_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE product (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  name varchar(255) DEFAULT NULL,</span><br><span class="line">  subTitle varchar(255) DEFAULT NULL,</span><br><span class="line">  originalPrice float DEFAULT NULL,</span><br><span class="line">  promotePrice float DEFAULT NULL,</span><br><span class="line">  stock int(11) DEFAULT NULL,</span><br><span class="line">  cid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_product_category FOREIGN KEY (cid) REFERENCES category (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE propertyvalue (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  ptid int(11) DEFAULT NULL,</span><br><span class="line">  value varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_property FOREIGN KEY (ptid) REFERENCES property (id),</span><br><span class="line">  CONSTRAINT fk_propertyvalue_product FOREIGN KEY (pid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE productimage (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  type varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_productimage_product FOREIGN KEY (pid) REFERENCES product (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE review (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  content varchar(4000) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_review_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">    CONSTRAINT fk_review_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE order_ (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  orderCode varchar(255) DEFAULT NULL,</span><br><span class="line">  address varchar(255) DEFAULT NULL,</span><br><span class="line">  post varchar(255) DEFAULT NULL,</span><br><span class="line">  receiver varchar(255) DEFAULT NULL,</span><br><span class="line">  mobile varchar(255) DEFAULT NULL,</span><br><span class="line">  userMessage varchar(255) DEFAULT NULL,</span><br><span class="line">  createDate datetime DEFAULT NULL,</span><br><span class="line">  payDate datetime DEFAULT NULL,</span><br><span class="line">  deliveryDate datetime DEFAULT NULL,</span><br><span class="line">  confirmDate datetime DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  status varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_order_user FOREIGN KEY (uid) REFERENCES user (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">   </span><br><span class="line">CREATE TABLE orderitem (</span><br><span class="line">  id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  pid int(11) DEFAULT NULL,</span><br><span class="line">  oid int(11) DEFAULT NULL,</span><br><span class="line">  uid int(11) DEFAULT NULL,</span><br><span class="line">  number int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_user FOREIGN KEY (uid) REFERENCES user (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_product FOREIGN KEY (pid) REFERENCES product (id),</span><br><span class="line">  CONSTRAINT fk_orderitem_order FOREIGN KEY (oid) REFERENCES order_ (id)</span><br><span class="line">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>
<h1 id="六、原型-后端"><a class="header-anchor" href="#六、原型-后端">¶</a>六、原型-后端</h1>
<h2 id="1、概述-v5"><a class="header-anchor" href="#1、概述-v5">¶</a>1、概述</h2>
<p>接下来是后端的原型界面。 并不是所有的后端，都需要原型，特别是比较典型的CRUD维护管理页面，开发人员基于现存的模板做起来也是比较快的。</p>
<p>不过本项目里的后端又不仅仅是CRUD维护管理页面，还有一些其他略复杂的功能，所以还是把这些原型界面都做出来。 后续开发功能的时候，就可以基于这些原型界面进行。</p>
<h2 id="2、分类管理-v2"><a class="header-anchor" href="#2、分类管理-v2">¶</a>2、分类管理</h2>
<h3 id="步骤-1-效果"><a class="header-anchor" href="#步骤-1-效果">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="3、属性管理-v2"><a class="header-anchor" href="#3、属性管理-v2">¶</a>3、属性管理</h2>
<h3 id="步骤-1-效果-v2"><a class="header-anchor" href="#步骤-1-效果-v2">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="4、产品管理-v2"><a class="header-anchor" href="#4、产品管理-v2">¶</a>4、产品管理</h2>
<h3 id="步骤-1-效果-v3"><a class="header-anchor" href="#步骤-1-效果-v3">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="5、产品图片管理-v2"><a class="header-anchor" href="#5、产品图片管理-v2">¶</a>5、产品图片管理</h2>
<h3 id="步骤-1-效果-v4"><a class="header-anchor" href="#步骤-1-效果-v4">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="6、产品属性设置-v2"><a class="header-anchor" href="#6、产品属性设置-v2">¶</a>6、产品属性设置</h2>
<h3 id="步骤-1-效果-v5"><a class="header-anchor" href="#步骤-1-效果-v5">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="7、用户管理-v2"><a class="header-anchor" href="#7、用户管理-v2">¶</a>7、用户管理</h2>
<h3 id="步骤-1-效果-v6"><a class="header-anchor" href="#步骤-1-效果-v6">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="8、订单管理-v2"><a class="header-anchor" href="#8、订单管理-v2">¶</a>8、订单管理</h2>
<h3 id="步骤-1-效果-v7"><a class="header-anchor" href="#步骤-1-效果-v7">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h1 id="七、后台-分类管理"><a class="header-anchor" href="#七、后台-分类管理">¶</a>七、后台-分类管理</h1>
<h2 id="1、概述-v6"><a class="header-anchor" href="#1、概述-v6">¶</a>1、概述</h2>
<p>到这里就开始讲解功能开发了。 开发整站的顺序，通常来说还是按照依赖性来进行，前端需要的数据，都要先通过后台的功能维护在数据库中，才可以拿到。<br>
所以，先进行后台功能的开发，然后再是前台功能的开发。</p>
<p>首先使用经典的SSH模式进行由浅入深地开发出第一个分类管理模块<br>
然后分析这种方式的弊端，对其进行[项目重构]，重构这一块大家可以学习到不少JAVA里的中高级处理手法，使得框架更加紧凑，后续开发更加便利和高效率。<br>
这也是作为架构师的常用利器，掌握这一手段对JAVA从业者是非常有价值的</p>
<p>为了便于大家理解和消化这部分知识，分类管理模块的开发采用<strong>循序渐进</strong>地方式</p>
<ol>
<li>
<p>首先下载一个只有分类管理的可运行项目，先跑起来看看效果</p>
</li>
<li>
<p>再以查询为例子，从零开始，按部就班地做出这么一个查询的功能来</p>
</li>
<li>
<p>接着分页功能单独拿出来讲解</p>
</li>
<li>
<p>最后讲解分类管理中其他的，增加，删除，编辑和修改功能</p>
</li>
</ol>
<h2 id="2、可运行的项目"><a class="header-anchor" href="#2、可运行的项目">¶</a>2、可运行的项目</h2>
<h3 id="步骤-1-可运行项目"><a class="header-anchor" href="#步骤-1-可运行项目">¶</a>步骤 1 : 可运行项目</h3>
<p>下载右侧的tmall_ssh.rar，并解压到<strong>e:/project/tmall</strong><br>
<strong>注：</strong> 必须是e:/project/tmall,因为项目配置文件里的jar包等配置，都是依赖这个路径<br>
<strong>注：</strong> 后续每个有新功能追加的知识点，都有一个可运行项目下载，并且都是指向 <strong>e:/project/tmall</strong>, 为了后续学习的顺畅，请务必使用这个目录<br>
<strong>注：</strong> 不要忘记导入数据库的[表结构]</p>
<h3 id="步骤-2-动态Web-Project方式运行"><a class="header-anchor" href="#步骤-2-动态Web-Project方式运行">¶</a>步骤 2 : 动态Web Project方式运行</h3>
<p>此项目采用 动态Web Project方式开发和部署，所以区别于[独立的Tomcat部署方式]， Tomcat是在eclipse中启动的。</p>
<p>为了能够正确地使用这个动态Web Project，请熟悉[使用DYNAMIC WEB PROJECT的方式开发J2EE应用]教程。</p>
<h3 id="步骤-3-启动Tomcat并观察效果"><a class="header-anchor" href="#步骤-3-启动Tomcat并观察效果">¶</a>步骤 3 : 启动Tomcat并观察效果</h3>
<p>通过Eclipse中的tomcat启动并部署项目之后，访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin</span></span><br></pre></td></tr></table></figure>
<p>将观察到如图的运行效果<br>
<strong>注：</strong> Eclipse内置浏览器有BUG，请使用独立浏览器比如火狐或者chrome<br>
<strong>注：</strong> 刚开始看不到分类数据，分类数据需要自己添加</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4978.png" alt></p>
<h2 id="3、静态资源"><a class="header-anchor" href="#3、静态资源">¶</a>3、静态资源</h2>
<p>接下来，解析这个可运行项目。<br>
首先从最简单的静态资源开始</p>
<h3 id="步骤-1-图片资源"><a class="header-anchor" href="#步骤-1-图片资源">¶</a>步骤 1 : 图片资源</h3>
<p>在img目录下的site目录放着所有要用到的静态图片，如猫耳朵什么的</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5019.png" alt></p>
<h3 id="步骤-2-css"><a class="header-anchor" href="#步骤-2-css">¶</a>步骤 2 : css</h3>
<p>在css目录里有3个子目录</p>
<ol>
<li>
<p>back<br>
这个目录里有一个style.css,这是后台界面用到的样式</p>
</li>
<li>
<p>bootstrap<br>
这里存放的是bootstrap的css样式文件</p>
</li>
<li>
<p>fore<br>
这个目录里<strong>也</strong>有一个style.css,这是前台界面用到的样式</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5020.png" alt></p>
<h3 id="步骤-3-js"><a class="header-anchor" href="#步骤-3-js">¶</a>步骤 3 : js</h3>
<p>js目录下有两个子目录<br>
/bootstrap<br>
bootstrap用到的js文件<br>
/jquery<br>
jquery用到的js文件</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5021.png" alt></p>
<h3 id="步骤-4-jars"><a class="header-anchor" href="#步骤-4-jars">¶</a>步骤 4 : jars</h3>
<p>除了图片资源外，还用到了各种第三方的jar包</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5022.png" alt></p>
<h2 id="4、开发思路"><a class="header-anchor" href="#4、开发思路">¶</a>4、开发思路</h2>
<p>接下来就按照查询，分页，增加，删除，编辑，修改的节奏，从无到有把分类管理这部分功能，由浅入深地一个一个做出来。</p>
<p><strong>注：</strong> 使用的开发方式是采用的eclipse 的dynamic web project的方式进行的，如果对这种方式不太熟悉，请先通过 [使用Dynamic Web Project的方式开发J2EE应用]教程进行预热</p>
<h2 id="5、查询"><a class="header-anchor" href="#5、查询">¶</a>5、查询</h2>
<p>先做没有分页效果的分类查询功能</p>
<h3 id="步骤-1-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>接下来就开始一步一步来，由浅入深地开发功能了。</p>
<p>因为项目用到了SSH技术，SSH技术本身较为复杂，涉及到了多个框架、多个类、多个配置文件。 不仅如此，模仿天猫业务也较为复杂，所以在进行项目开发之前，一定要先按照 [可运行的项目]的指导，先下载右上角的可运行项目，配置运行起来, 先自己跑起来，确认项目本身没有问题，建立对学习内容的信心，然后再跟着步骤，一步步做出来。</p>
<p><strong>十分不推荐一来就</strong>跟着步骤做下去，本知识点一共有15、6个步骤，只要任何一个步骤，跟着做的时候写错了，都有可能导致项目无法成功启动，影响学习情绪和学习效果。 所以一定要先按照 [可运行的项目]的指导，先下载右上角的可运行项目，配置运行起来,成功跑起来，然后再照着教程，一个一个地做下去，这样出了问题心里才有底，通过代码比较等手段，定位到问题所在，成功消化掉这个知识点。</p>
<h3 id="步骤-2-模仿和排错"><a class="header-anchor" href="#步骤-2-模仿和排错">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-新建项目"><a class="header-anchor" href="#步骤-3-新建项目">¶</a>步骤 3 : 新建项目</h3>
<p>本教程讲使用Dynamic Web Project的方式搭建项目，如果对Dynamic Web Project方式不太熟悉，请参考：[使用Dynamic Web Project的方式开发J2EE应用]。</p>
<p>首先新建Dynamic Web Project项目： <strong>tmall_ssh</strong></p>
<p>本教程依赖路径: <strong>e:\project</strong>, 请模仿的时候也放在这个位置，保证后续的学习更加顺畅</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5146.png" alt></p>
<h3 id="步骤-4-jar包"><a class="header-anchor" href="#步骤-4-jar包">¶</a>步骤 4 : jar包</h3>
<p>下载右上角的lib.rar，并解压到目录下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\project\tmall_ssh\WebContent\WEB-INF\lib</span><br></pre></td></tr></table></figure>
<p>然后刷新项目，使得当前的这个Dynamic Web Project识别这些jar包</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5147.png" alt></p>
<h3 id="步骤-5-Category类"><a class="header-anchor" href="#步骤-5-Category类">¶</a>步骤 5 : Category类</h3>
<p>准备Category实体类，并用Hibernate注解标示其对应的表，字段等信息。</p>
<p>这里采用的是注解方式配置Hibernate需要的信息，如果这一部分知识有欠缺，请前往相关章节学习[Hibernate 注解方式配置]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)   </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Category [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-dao-impl"><a class="header-anchor" href="#步骤-6-dao-impl">¶</a>步骤 6 : dao.impl</h3>
<p>DAO类：DAOImpl 。<br>
DAOImpl 继承了HibernateTemplate，从而提供了各种各样的CRUD方法，满足各种数据库操作的需要。</p>
<p>提供setSessionFactory()方法， 以用于注入SessionFactory</p>
<p><strong>注：</strong> 这里没有使用DAO接口，而是直接使用了DAOImpl 实现类的方式，否则还要为DAO接口声明各种DAOImpl 里的方法，反而显得画蛇添足。</p>
<p>这个知识点涉及到了 [Spring+Hibernate的整合]和[SSH注解方式的整合]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.dao.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate3.HibernateTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Repository</span>(<span class="string">"dao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAOImpl</span> <span class="keyword">extends</span> <span class="title">HibernateTemplate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"sf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setSessionFactory(sessionFactory);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-service"><a class="header-anchor" href="#步骤-7-service">¶</a>步骤 7 : service</h3>
<p>设计CategoryService接口，用于提供业务方法list()，即查询所有的分类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-service-impl"><a class="header-anchor" href="#步骤-8-service-impl">¶</a>步骤 8 : service.impl</h3>
<p>CategoryServiceImpl 实现了CategoryService 接口，提供list()方法的具体实现。<br>
同时自动装配(注入) 了DAOImpl的实例dao。</p>
<p>在list()方法中，通过dao获取所有的分类对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-action"><a class="header-anchor" href="#步骤-9-action">¶</a>步骤 9 : action</h3>
<p>CategoryAction 类作为MVC设计模式中的控制层起作用。</p>
<ol>
<li>
<p>使用basicstruts，与本知识点接下来会讲到的配置文件[struts.xml]中定义的basicstruts保持一致</p>
</li>
<li>
<p>在Result注解中，定义了返回的页面为/admin/listCategory.jsp</p>
</li>
<li>
<p>自动装配（注入）categoryService对象，用于从数据库获取所有分类对象的集合。</p>
</li>
<li>
<p>把对admin_category_list路径的访问映射到list方法上</p>
</li>
<li>
<p>list()方法通过categoryService获取到所有的分类对象，放在categorys属性中。</p>
</li>
<li>
<p>同时提供了 getCategorys() 方法，用于向[listCategory.jsp页面]传递数据</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        System.out.println(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-index-jsp"><a class="header-anchor" href="#步骤-10-index-jsp">¶</a>步骤 10 : index.jsp</h3>
<p>在WebContent目录下新建admin目录<br>
接着在admin目录下新建index.jsp文件<br>
这个文件的作用是访问如下地址的时候：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin</span></span><br></pre></td></tr></table></figure>
<p>会自动跳转到</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin_category_list</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5162.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    response.sendRedirect(<span class="string">"../admin_category_list"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-listCategory-jsp"><a class="header-anchor" href="#步骤-11-listCategory-jsp">¶</a>步骤 11 : listCategory.jsp</h3>
<p>接着在admin目录下新建listCategory.jsp文件，其作用是显示从[CategoryAction]中传递过来的集合中的分类信息。</p>
<p>作为视图，担当的角色是显示数据。所以关键就是从第43行开始，借助JSTL的c:forEach标签遍历从CategoryAction的list() 的传递过来的集合。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>为了使listCategory.jsp可以正常工作，还需要在WebContent目录下新建一个include目录，接着在include目录下新建admin目录，并且在其中创建4个被包含的文件:adminHeader.jsp,adminNavigator.jsp,adminPage.jsp,adminFooter.jsp。形成如图所示的目录结构</p>
<p>这个包含较为复杂，涉及到了多个文件的包含关系，为了便于消化，将会在稍后的知识点中专门详细讲解： [listCategory.jsp及其中的包含关系]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//listCategory.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"name"</span>,<span class="string">"分类名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"categoryPic"</span>,<span class="string">"分类上传图片"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;      </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;分类管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;分类管理&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;分类名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;属性管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;img height="40px" src="img/category/$&#123;c.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_property_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                   </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_product_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                  </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_category_edit?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;a deleteLink="true" href="admin_category_delete?category.id=$&#123;c.id&#125;"&gt;&lt;span class="  glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">     </span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="comment">//@include file="../include/admin/adminPage.jsp" %&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;新增分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_category_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="category.name" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//adminHeader.jsp</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix=<span class="string">'fmt'</span> %&gt;</span><br><span class="line">  </span><br><span class="line">&lt;html&gt;</span><br><span class="line">  </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src="js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/back/style.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">      </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">checkEmpty</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkNumber</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(isNaN(value))&#123;</span><br><span class="line">        alert(name+ <span class="string">"必须是数字"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkInt</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(parseInt(value)!=value)&#123;</span><br><span class="line">        alert(name+ <span class="string">"必须是整数"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> deleteLink = $(<span class="keyword">this</span>).attr(<span class="string">"deleteLink"</span>);</span><br><span class="line">        console.log(deleteLink);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"true"</span>==deleteLink)&#123;</span><br><span class="line">            <span class="keyword">var</span> confirmDelete = confirm(<span class="string">"确认要删除"</span>);</span><br><span class="line">            <span class="keyword">if</span>(confirmDelete)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">              </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//adminNavigator.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"navitagorDiv"</span>&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar navbar-default navbar-fixed-top navbar-inverse"</span>&gt;</span><br><span class="line">        &lt;img style=<span class="string">"margin-left:10px;margin-right:0px"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left"</span> src=<span class="string">"img/site/tmallbuy.png"</span> height=<span class="string">"45px"</span>&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="#nowhere"&gt;天猫后台&lt;/a&gt;</span><br><span class="line">          </span><br><span class="line">        &lt;a class="navbar-brand" href="admin_category_list"&gt;分类管理&lt;/a&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="admin_user_list"&gt;用户管理&lt;/a&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="admin_order_list"&gt;订单管理&lt;/a&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//adminPage.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"ul.pagination li.disabled a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pagination"</span>&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=0$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;   </span><br><span class="line">  </span><br><span class="line">    &lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">      </span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;status.count*page.count-page.start&lt;=20 &amp;&amp; status.count*page.count-page.start&gt;=-10&#125;"</span>&gt;</span><br><span class="line">            &lt;li &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">                &lt;a</span><br><span class="line">                href=<span class="string">"?page.start=$&#123;status.index*page.count&#125;$&#123;page.param&#125;"</span></span><br><span class="line">                &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="current"&lt;/c:if&gt;</span><br><span class="line">                &gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//adminFooter.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"footer"</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-静态资源"><a class="header-anchor" href="#步骤-12-静态资源">¶</a>步骤 12 : 静态资源</h3>
<p>接下来是各种静态资源，诸如jquery, bootstrap, css, 图片等，内容稍杂，就不挨个列出来了。<br>
这些静态资源打包在WebContent.rar里，放在右上角供下载，下载后解压即可，解压之后应该看到多出来如图所示的三个目录。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5164.png" alt></p>
<h3 id="步骤-13-web-xml"><a class="header-anchor" href="#步骤-13-web-xml">¶</a>步骤 13 : web.xml</h3>
<p>在WebContent的WEB-INF目录下新建web.xml。<br>
这个web.xml做了3件事情</p>
<ol>
<li>让所有请求都进入Struts2的过滤器StrutsPrepareAndExecuteFilter</li>
<li>对所有请求进行UTF-8编码</li>
<li>指定Spring配置文件的位置在classpath:applicationContext.xml</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5153.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</span><br><span class="line">             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>FORWARD<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>REQUEST<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-applicationContext-xml"><a class="header-anchor" href="#步骤-14-applicationContext-xml">¶</a>步骤 14 : applicationContext.xml</h3>
<p>Spring配置文件applicationContext.xml，在本文件中做了如下工作:</p>
<ol>
<li>启动注解配置</li>
<li>扫描com.how2java包下的类</li>
<li>配置注解驱动事务管理</li>
<li>管理Hibernate的SessionFactory</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context     </span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.how2java"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"sf"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"ds"</span> /&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="comment">&lt;!-- 注解扫描 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.how2java.*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"schemaUpdate"</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">                 </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                hibernate.dialect=org.hibernate.dialect.MySQLDialect</span><br><span class="line">                hibernate.show_sql=false</span><br><span class="line">                hbm2ddl.auto=update</span><br><span class="line">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>   </span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"ds"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/tmall_ssh?characterEncoding=UTF-8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"admin"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 配置事务管理器（声明式的事务） --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sf"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-struts-xml"><a class="header-anchor" href="#步骤-15-struts-xml">¶</a>步骤 15 : struts.xml</h3>
<p>Struts2的配置文件struts.xml，做了如下几件事情</p>
<ol>
<li>
<p>编码方式确定为UTF-8</p>
</li>
<li>
<p>对象的管理，交由Spring进行</p>
</li>
<li>
<p>使用basicstruts，与[CategoryAction] 中的相对应basicstruts相对应。</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.objectFactory"</span> <span class="attr">value</span>=<span class="string">"spring"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"basicstruts"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line"> <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-测试数据"><a class="header-anchor" href="#步骤-16-测试数据">¶</a>步骤 16 : 测试数据</h3>
<p>使用测试类向数据库中添加测试数据。（假设数据库中没有数据，假如已经通过前面的教程导入了数据了，那么这一步就可以省略了）</p>
<p>使用JUnit Test的方式运行TestTmall 类，其作用是当数据库中没有分类数据的时候，添加两条数据</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5156.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.test;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTmall</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DAOImpl dao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        List&lt;Category&gt; cs = dao.findByCriteria(dc);</span><br><span class="line">        <span class="keyword">for</span> (Category c : cs) &#123;</span><br><span class="line">            dao.delete(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        List&lt;Category&gt; cs = dao.findByCriteria(dc);</span><br><span class="line">        <span class="keyword">if</span> (cs.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                Category c = <span class="keyword">new</span> Category();</span><br><span class="line">                c.setName(<span class="string">"测试分类"</span> + (i + <span class="number">1</span>));</span><br><span class="line">                dao.save(c);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"成功添加10个测试分类"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-启动tomcat"><a class="header-anchor" href="#步骤-17-启动tomcat">¶</a>步骤 17 : 启动tomcat</h3>
<p>在Eclipse中启动Tomcat，为了成功地在Eclipse中启动Tomcat需要多个步骤，如果不熟悉请参考： [使用Dynamic Web Project的方式开发J2EE应用-通过Eclipse启动Tomcat]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5157.png" alt></p>
<h3 id="步骤-18-访问测试地址"><a class="header-anchor" href="#步骤-18-访问测试地址">¶</a>步骤 18 : 访问测试地址</h3>
<p>访问测试地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin_category_list</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 没有图片是正常的，上传图片将在后续讲解</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5158.png" alt></p>
<h3 id="步骤-19-思路图"><a class="header-anchor" href="#步骤-19-思路图">¶</a>步骤 19 : 思路图</h3>
<p>学习到这个步骤，那么上面的该做的行为都做掉了，这个时候来整理一下调用思路，以便后续的学习思路更加清晰一些。</p>
<ol>
<li>访问路径/admin_category_list</li>
<li>web.xml中的过滤器会将请求交由struts进行处理</li>
<li>struts根据listCategory创建对应的CategoryAction</li>
<li>创建CategoryAction的时候注入CategoryService</li>
<li>创建CategoryService的时候注入DAOImpl</li>
<li>Struts 调用CategoryAction的list方法</li>
<li>在list方法中调用注入好的DAOImpl，访问数据库，查询结果</li>
<li>跳转到listCategory.jsp显示数据</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5535.png" alt></p>
<h3 id="步骤-20-可运行项目"><a class="header-anchor" href="#步骤-20-可运行项目">¶</a>步骤 20 : 可运行项目</h3>
<p>在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问"listCategory"路径会返回到/admin/listCategory.jsp页面,所以需要通过struts进行拦截跳转</span></span><br><span class="line"><span class="comment"> * 所以要配置<span class="doctag">@ParentPackage</span>("basicstruts")和struts.xml。</span></span><br><span class="line"><span class="comment"> * 要获取查询的所有对象,就必须要实现CategoryService接口的list()方法,所以通过注入创建对象categoryService和</span></span><br><span class="line"><span class="comment"> * categorys,并创建categorys的set和get方法,</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//1.使用basicstruts,与本知识点接下来会讲到的配置文件struts.xml中定义的basicstructs保持一致</span></span><br><span class="line"><span class="comment">//2.在Result注解中,定义了返回的页面为/admin/listCategory.jsp</span></span><br><span class="line"><span class="comment">//3.自动装配(注入)categoryService对象,用于从数据库获取所有分类对象的集合。</span></span><br><span class="line"><span class="comment">//4.把对admin_category_list路径的访问映射到list方法上</span></span><br><span class="line"><span class="comment">//5.list()方法通过categoryService获取到所有的分类对象,放在categorys属性中。</span></span><br><span class="line"><span class="comment">//6.同时提供了getCategorys()方法,用于向listCategory.jsp页面传递数据。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struts.xml的内容代码如下: </span></span><br><span class="line"><span class="comment"> *  &lt;package name="basicstruts" extends="struts-default"&gt;</span></span><br><span class="line"><span class="comment"> * 类似于代码包,区分不同的action，要配置action,必须先写package标签，在package里面才能配置action</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@Namespace:表示访问路径</span></span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="comment">//@ParentPackage:父包注解,起到继承的作用,继承我们的struts.xml里面包名为basicstruts的struts-default,</span></span><br><span class="line"><span class="comment">//struts内置了很多拦截器和变量,只有继承它才能起作用。</span></span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>)</span><br><span class="line"><span class="comment">//表示访问name的路径返回location的jsp,如果有多个路径就将多个@Result逐一写入@Results里面</span></span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>,location=<span class="string">"/admin/listCategory.jsp"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        )</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="comment">//把对admin_category_list路径的访问映射到list方法上</span></span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="comment">//list()方法通过categoryService获取到所有的分类对象,放在categorys属性中。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        <span class="comment">//System.out.println(categorys);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">package</span> com.how2java.tmall.dao.impl;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="comment">//1.DAOImpl继承了HibernateTemplate,从而提供了各种各样的CRUD方法,</span></span><br><span class="line"><span class="comment">//满足数据库操作的需求</span></span><br><span class="line"><span class="comment">//2.提供setSessionFactory()方法,以用于注入SessionFactory</span></span><br><span class="line"><span class="comment">//3.该分类管理并没有创建使用DAO接口,而是采用了DAOImpl实现类的方式,如果使用DAO接口,</span></span><br><span class="line"><span class="comment">//那么还要为DAO接口声明各种DAOImpl里面的增删改查的方法,显得画蛇添足</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate3.HibernateTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="comment">//@Repository:一般注解在DAO实现类上,别人看到这个代码时,就知道这个类是一个跟数据存储有关的类,为DAO对象</span></span><br><span class="line"><span class="comment">//@Repository("dao")与@Repository(value="dao")同义,效果相同，@Repository("dao")默认使用value()方法</span></span><br><span class="line"><span class="comment">//当Service需要使用Spring创建的名字叫“dao”的DAOImpl实例时，就可以使用@Resource(name="dao")注解告诉Spring，</span></span><br><span class="line"><span class="comment">//Spring把创建好的dao注入给Service即可。如果@Repository没指定name那么Resource最好也不要指定那么。</span></span><br><span class="line"><span class="comment">//本案例中CategoryServiceImpl是@Autowired DAOImpl dao;</span></span><br><span class="line"><span class="meta">@Repository</span>(<span class="string">"dao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAOImpl</span> <span class="keyword">extends</span> <span class="title">HibernateTemplate</span></span>&#123;</span><br><span class="line">    <span class="comment">//@Resource(name="sf"):注入装配name为sf的bean</span></span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"sf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setSessionFactory(sessionFactory);</span><br><span class="line">    &#125;;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="comment">//准备Category(分类)的实体类,并用Hibernate注解表示其对应的表和字段等信息。</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="comment">//@Entity:表示这是一个实体类,用于映射</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">//@Table:表示映射的Mysql表格的名字叫category</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span></span>&#123;</span><br><span class="line">    <span class="comment">//@Id:表示这是主键</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="comment">//表示主键的自增长的方式使用mysql自带的</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">    <span class="comment">//@Column(name="id"):表示映射到表格对应的属性是id</span></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//@Override:如果想重写父类的方法,比如toString()方法的话,在方法前面加上</span></span><br><span class="line">    <span class="comment">//@Override,系统可以帮你检查方法的正确性</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Category[id="</span> + id + <span class="string">",name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"><span class="comment">//设计CategoryService接口,用于提供业务方法list(),即查询所有的分类</span></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"><span class="comment">//CategoryServiceImpl实现了CategoryService接口,提供list()方法的具体实现。</span></span><br><span class="line"><span class="comment">//同时自动装配(注入)了dao,在list方法中,通过dao获取所有的分类对象。/</span></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line"><span class="comment">//@Autowired:注入DAOImpl的实例dao,它和@Resource注入的区别是它默认是按byType而不是byName</span></span><br><span class="line">    <span class="comment">//在昨晚案例后使用@Resource(name="dao")测试一下是否能运行达到一样的效果。</span></span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//DetachedCriteria可以直接用class进行实例的创建查询,因为DetachedCriteria是离线的无需创建session</span></span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//addOrder表示查询排序(Order.desc:降序  Order.asc:升序)。   </span></span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="comment">//getHibernateTemplate().findByCriteria()用来返回查询结果</span></span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">    xmlns:tx=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">    xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/aop </span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/tx </span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/context      </span></span><br><span class="line"><span class="string">   http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;</span><br><span class="line">    &lt;!-- <span class="number">1</span>.启动注解配置 --&gt;</span><br><span class="line">    &lt;context:annotation-config /&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">"com.how2java"</span> /&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=<span class="string">"transactionManager"</span>/&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">   name:这个属性指定唯一的bean标识符。</span><br><span class="line">   <span class="class"><span class="keyword">class</span>：这个属性是必填的，常见对象所在的类的全路径。</span></span><br><span class="line">   property:通过Bean的set get方法注入。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!-- 创建sessionFactory的时候会注入数据源ds --&gt;</span><br><span class="line">    &lt;bean name=<span class="string">"sf"</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"dataSource"</span> ref=<span class="string">"ds"</span> /&gt;</span><br><span class="line">      </span><br><span class="line">        &lt;!-- <span class="number">2</span>.注解扫描,扫描com.how2java包下的类 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"packagesToScan"</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;com.how2java.*&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">   </span><br><span class="line">        &lt;property name=<span class="string">"schemaUpdate"</span>&gt; </span><br><span class="line">            &lt;value&gt;true&lt;/value&gt; </span><br><span class="line">        &lt;!--  hibernate其他常用配置 --&gt;</span><br><span class="line">        &lt;/property&gt; </span><br><span class="line">        &lt;property name=<span class="string">"hibernateProperties"</span>&gt;</span><br><span class="line">            &lt;value&gt;</span><br><span class="line">                &lt;!-- 这表示使用MYSQL方言 --&gt;</span><br><span class="line">                hibernate.dialect=org.hibernate.dialect.MySQLDialect</span><br><span class="line">                &lt;!--这表示是否在控制台显示执行的sql语句  --&gt;</span><br><span class="line">                hibernate.show_sql=<span class="keyword">false</span></span><br><span class="line">                &lt;!--这表示是否会自动更新数据库的表结构(自动创建表)  --&gt;</span><br><span class="line">                hbm2ddl.auto=update</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;   </span><br><span class="line">    &lt;!-- 数据库连接的参数配置 --&gt;</span><br><span class="line">     &lt;bean name=<span class="string">"ds"</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"driverClassName"</span> value=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">"url"</span> value=<span class="string">"jdbc:mysql://localhost:3306/tmall_ssh?characterEncoding=UTF-8"</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">"username"</span> value=<span class="string">"root"</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">"password"</span> value=<span class="string">"520131413"</span> /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;!-- <span class="number">3</span>.配置事务管理器（声明式的事务）,即配置注解驱动事务管理 --&gt; </span><br><span class="line">    &lt;!-- Hibernate TransactionManager：使用Hibernate <span class="number">3.0</span>进行持久化数据时使用 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"transactionManager"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt; </span><br><span class="line">        &lt;property name="sessionFactory" ref="sf"&gt;&lt;/property&gt; </span><br><span class="line">    &lt;/bean&gt; </span><br><span class="line">    &lt;/beans&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE struts PUBLIC</span><br><span class="line">    <span class="string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span><br><span class="line">    <span class="string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;struts&gt;</span><br><span class="line">&lt;!-- <span class="number">1</span>. 编码方式确定为UTF-<span class="number">8</span> --&gt;</span><br><span class="line">  &lt;constant name="struts.i18n.encoding" value="UTF-8"&gt;&lt;/constant&gt;</span><br><span class="line"> &lt;!--  <span class="number">2</span>. 对象的管理，交由Spring进行 --&gt;</span><br><span class="line">  &lt;constant name=<span class="string">"struts.objectFactory"</span> value=<span class="string">"spring"</span>/&gt;</span><br><span class="line"> &lt;!--  <span class="number">3</span>. 使用basicstruts，与CategoryAction 中的相对应basicstruts相对应。 --&gt;</span><br><span class="line">  &lt;<span class="keyword">package</span> name=<span class="string">"basicstruts"</span> extends=<span class="string">"struts-default"</span>&gt;</span><br><span class="line">         </span><br><span class="line"> &lt;/package&gt;</span><br><span class="line">&lt;/struts&gt;</span><br></pre></td></tr></table></figure>
<h2 id="6、JSP包含关系"><a class="header-anchor" href="#6、JSP包含关系">¶</a>6、JSP包含关系</h2>
<h3 id="步骤-1-分类查询对应的JSP文件"><a class="header-anchor" href="#步骤-1-分类查询对应的JSP文件">¶</a>步骤 1 : 分类查询对应的JSP文件</h3>
<p>分类查询对应的JSP文件是[listCategory.jsp]，其包含了多个公共JSP文件。</p>
<p>listCategory.jsp 用到了4个公共包含文件</p>
<ol>
<li>
<p>&lt;%@include file=&quot;…/include/admin/adminHeader.jsp&quot;%&gt;</p>
</li>
<li>
<p>&lt;%@include file=&quot;…/include/admin/adminNavigator.jsp&quot;%&gt;</p>
</li>
<li>
<p>&lt;%@include file=&quot;…/include/admin/adminPage.jsp&quot;%&gt;</p>
</li>
<li>
<p>&lt;%@include file=&quot;…/include/admin/adminFooter.jsp&quot;%&gt;</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5014.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"name"</span>,<span class="string">"分类名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"categoryPic"</span>,<span class="string">"分类图片"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;分类管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;分类管理&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;分类名称&lt;/th&gt;</span><br><span class="line">&lt;!--                     &lt;th&gt;属性管理&lt;/th&gt; --&gt;</span><br><span class="line">&lt;!--                     &lt;th&gt;产品管理&lt;/th&gt; --&gt;</span><br><span class="line">                    &lt;th&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;thecs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;img height="40px" src="img/category/$&#123;c.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">&lt;%--                     &lt;td&gt;&lt;a href="admin_property_list?cid=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                     --%&gt;</span><br><span class="line">&lt;%--                     &lt;td&gt;&lt;a href="admin_product_list?cid=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                    --%&gt;</span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_category_edit?id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;a deleteLink="true" href="admin_category_delete?id=$&#123;c.id&#125;"&gt;&lt;span class="   glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">     </span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span> %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;新增分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_category_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="name" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> accept=<span class="string">"image/*"</span> type=<span class="string">"file"</span> name=<span class="string">"filepath"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-adminHeader-jsp"><a class="header-anchor" href="#步骤-2-adminHeader-jsp">¶</a>步骤 2 : adminHeader.jsp</h3>
<p>每个后台页面都在一开始使用了adminHeader.jsp</p>
<ol>
<li>表示本页面会使用html5的技术</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>jsp指令</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>contentType=“text/html; charset=UTF-8” 告诉浏览器使用UTF-8进行中文编码识别<br>
pageEncoding=“UTF-8” 本jsp上的中文文字，使用UTF-8进行编码<br>
isELIgnored=“false” 本jsp上会使用EL表达式</p>
<ol start="3">
<li>引入JSTL</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix=<span class="string">'fmt'</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>使用c和fmt两种标准标签库</p>
<ol start="4">
<li>引入js和css</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src="js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">"css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">&lt;script src="js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">"css/back/style.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>预先定义一些判断输入框的函数，方便后面使用</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">checkEmpty</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">	<span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">		alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">		$(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkNumber</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">	<span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">		alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">		$(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(isNaN(value))&#123;</span><br><span class="line">		alert(name+ <span class="string">"必须是数字"</span>);</span><br><span class="line">		$(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkInt</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">	<span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">		alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">		$(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(parseInt(value)!=value)&#123;</span><br><span class="line">		alert(name+ <span class="string">"必须是整数"</span>);</span><br><span class="line">		$(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>对于删除超链，都需要进行确认操作</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(function()&#123;</span><br><span class="line">	$(<span class="string">"a"</span>).click(function()&#123;</span><br><span class="line">		<span class="keyword">var</span> deleteLink = $(<span class="keyword">this</span>).attr(<span class="string">"deleteLink"</span>);</span><br><span class="line">		console.log(deleteLink);</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"true"</span>==deleteLink)&#123;</span><br><span class="line">			<span class="keyword">var</span> confirmDelete = confirm(<span class="string">"确认要删除"</span>);</span><br><span class="line">			<span class="keyword">if</span>(confirmDelete)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix=<span class="string">'fmt'</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src="js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/back/style.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">     </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">checkEmpty</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkNumber</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(isNaN(value))&#123;</span><br><span class="line">        alert(name+ <span class="string">"必须是数字"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkInt</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">        alert(name+ <span class="string">"不能为空"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(parseInt(value)!=value)&#123;</span><br><span class="line">        alert(name+ <span class="string">"必须是整数"</span>);</span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> deleteLink = $(<span class="keyword">this</span>).attr(<span class="string">"deleteLink"</span>);</span><br><span class="line">        console.log(deleteLink);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"true"</span>==deleteLink)&#123;</span><br><span class="line">            <span class="keyword">var</span> confirmDelete = confirm(<span class="string">"确认要删除"</span>);</span><br><span class="line">            <span class="keyword">if</span>(confirmDelete)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-adminNavigator-jsp"><a class="header-anchor" href="#步骤-3-adminNavigator-jsp">¶</a>步骤 3 : adminNavigator.jsp</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5016.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"navitagorDiv"</span>&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar navbar-default navbar-fixed-top navbar-inverse"</span>&gt;</span><br><span class="line">        &lt;img style=<span class="string">"margin-left:10px;margin-right:0px"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left"</span> src=<span class="string">"img/site/tmallbuy.png"</span> height=<span class="string">"45px"</span>&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="#nowhere"&gt;天猫后台&lt;/a&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;a class="navbar-brand" href="admin_category_list"&gt;分类管理&lt;/a&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="admin_user_list"&gt;用户管理&lt;/a&gt;</span><br><span class="line">        &lt;a class="navbar-brand" href="admin_order_list"&gt;订单管理&lt;/a&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-adminPage-jsp"><a class="header-anchor" href="#步骤-4-adminPage-jsp">¶</a>步骤 4 : adminPage.jsp</h3>
<p>这是分页JSP。<br>
分页功能不仅仅有前端效果，还需要结合服务端传递过来的数据综合才能起作用。 所以对于adminPage.jsp不在此展开讲解，将在后面的[分页]部分，结合服务端，专门讲解</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5017.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"ul.pagination li.disabled a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pagination"</span>&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=0$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;   </span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;status.count*page.count-page.start&lt;=20 &amp;&amp; status.count*page.count-page.start&gt;=-10&#125;"</span>&gt;</span><br><span class="line">            &lt;li &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">                &lt;a </span><br><span class="line">                href=<span class="string">"?page.start=$&#123;status.index*page.count&#125;$&#123;page.param&#125;"</span></span><br><span class="line">                &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="current"&lt;/c:if&gt;</span><br><span class="line">                &gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-adminFooter-jsp"><a class="header-anchor" href="#步骤-5-adminFooter-jsp">¶</a>步骤 5 : adminFooter.jsp</h3>
<p>页脚部分，目前是留白。 大家掌握了之后，可以写自己的名字@myname, 年份，版本信息什么的。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"footer"</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="7、分页"><a class="header-anchor" href="#7、分页">¶</a>7、分页</h2>
<p>分页单独拿出来讲解</p>
<h3 id="步骤-1-先运行，看到效果，再学习-v2"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v2">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v2"><a class="header-anchor" href="#步骤-2-模仿和排错-v2">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果"><a class="header-anchor" href="#步骤-3-效果">¶</a>步骤 3 : 效果</h3>
<p>先观察效果，这是对分类管理做了分页功能之后的效果，每页显示5条，一共两页，当前是第一页。</p>
<p><strong>注:</strong> 没有图片是正常的，后续[增加分类]知识点会讲解如何上传图片</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4991.png" alt></p>
<h3 id="步骤-4-Page-java"><a class="header-anchor" href="#步骤-4-Page-java">¶</a>步骤 4 : Page.java</h3>
<p>Page这个类专门为分页提供必要信息<br>
属性：<br>
int start; 开始位置<br>
int count; 每页显示的数量<br>
int total; 总共有多少条数据<br>
String param; 参数(这个属性在后续有用到，但是分类的分页查询里并没有用到，请忽略)<br>
int defaultCount ; 默认每页显示5条</p>
<p>方法：<br>
getTotalPage 根据 每页显示的数量count以及总共有多少条数据total，计算出总共有多少页<br>
getLast 计算出最后一页的数值是多少<br>
isHasPreviouse 判断是否有前一页<br>
isHasNext 判断是否有后一页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.util;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Page</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">int</span> start; <span class="comment">//开始页数</span></span><br><span class="line">    <span class="keyword">int</span> count; <span class="comment">//每页显示个数</span></span><br><span class="line">    <span class="keyword">int</span> total; <span class="comment">//总个数</span></span><br><span class="line">    String param; <span class="comment">//参数</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> defaultCount = <span class="number">5</span>; <span class="comment">//默认每页显示5条</span></span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(<span class="keyword">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Page</span> <span class="params">()</span></span>&#123;</span><br><span class="line">        count = defaultCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Page</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHasPreviouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==getLast())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> totalPage;</span><br><span class="line">        <span class="comment">// 假设总数是50，是能够被5整除的，那么就有10页</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">            totalPage = total /count;</span><br><span class="line">        <span class="comment">// 假设总数是51，不能够被5整除的，那么就有11页</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            totalPage = total / count + <span class="number">1</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==totalPage)</span><br><span class="line">            totalPage = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> totalPage;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLast</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> last;</span><br><span class="line">        <span class="comment">// 假设总数是50，是能够被5整除的，那么最后一页的开始就是45</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == total % count)</span><br><span class="line">            last = total - count;</span><br><span class="line">        <span class="comment">// 假设总数是51，不能够被5整除的，那么最后一页的开始就是50</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = total - total % count;</span><br><span class="line">        last = last&lt;<span class="number">0</span>?<span class="number">0</span>:last;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Page [start="</span> + start + <span class="string">", count="</span> + count + <span class="string">", total="</span> + total + <span class="string">", getStart()="</span> + getStart()</span><br><span class="line">                + <span class="string">", getCount()="</span> + getCount() + <span class="string">", isHasPreviouse()="</span> + isHasPreviouse() + <span class="string">", isHasNext()="</span></span><br><span class="line">                + isHasNext() + <span class="string">", getTotalPage()="</span> + getTotalPage() + <span class="string">", getLast()="</span> + getLast() + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(<span class="keyword">int</span> total)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.param = param;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-CategoryService"><a class="header-anchor" href="#步骤-5-CategoryService">¶</a>步骤 5 : CategoryService</h3>
<p>CategoryService 在原来的基础上，新增加了total()和listByPage(Page page)方法，分别用于获取分类总数和分页查询结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryServiceImpl"><a class="header-anchor" href="#步骤-6-CategoryServiceImpl">¶</a>步骤 6 : CategoryServiceImpl</h3>
<p>CategoryServiceImpl 为total和listByPage方法添加了实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-CategoryAction"><a class="header-anchor" href="#步骤-7-CategoryAction">¶</a>步骤 7 : CategoryAction</h3>
<p>修改CategoryAction的list()方法，加上对分页的处理</p>
<ol>
<li>如果没有传递分页参数进来，那么就new一个分页对象，相当于查询第一页</li>
<li>获取总数</li>
<li>给分页对象page设置总数</li>
<li>根据page对象查询当前分页的分类集合数据。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line"> </span><br><span class="line">    Page page;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-listCategory-jsp"><a class="header-anchor" href="#步骤-8-listCategory-jsp">¶</a>步骤 8 : listCategory.jsp</h3>
<p>在第62行，取消原本对分页的注释adminPage.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"name"</span>,<span class="string">"分类名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"categoryPic"</span>,<span class="string">"分类上传图片"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;      </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;分类管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;分类管理&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;分类名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;属性管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;img height="40px" src="img/category/$&#123;c.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_property_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                   </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_product_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                  </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_category_edit?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;a deleteLink="true" href="admin_category_delete?category.id=$&#123;c.id&#125;"&gt;&lt;span class="  glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">     </span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span> %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;新增分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_category_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="category.name" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-为了便于理解，先来一个简化了的adminPage-jsp"><a class="header-anchor" href="#步骤-9-为了便于理解，先来一个简化了的adminPage-jsp">¶</a>步骤 9 : 为了便于理解，先来一个简化了的adminPage.jsp</h3>
<p>在listCategory.jsp页面包含了分页专用jsp:adminPage.jsp<br>
在其中，依据page对象，进行分页超链元素的显示<br>
[完整版的adminPage.jsp] 比较复杂，为了便于大家理解，我先把完整版的adminPage.jsp简化一下</p>
<p>首先，分页超链的效果，用的[Bootstrap的分页效果]来制作<br>
首页超链：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li&gt;</span><br><span class="line">  &lt;a  href=<span class="string">"?page.start=0"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">    &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>上一页超链：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li &gt;</span><br><span class="line">   &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">     &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">   &lt;/a&gt;</span><br><span class="line"> &lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>下一页超链：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li &gt;</span><br><span class="line">  &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">    &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>最后一页</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li &gt;</span><br><span class="line">  &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">    &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>中间页</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">  	&lt;a href="?page.start=$&#123;status.index*page.count&#125;" class="current"&gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"ul.pagination li.disabled a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pagination"</span>&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=0"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;   </span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;a href="?page.start=$&#123;status.index*page.count&#125;" class="current"&gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li &gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-完整版的adminPage-jsp"><a class="header-anchor" href="#步骤-10-完整版的adminPage-jsp">¶</a>步骤 10 : 完整版的adminPage.jsp</h3>
<p>[简化的adminPage.jsp]用于帮助大家理解，其存在的问题是，即便是没有下一页的数据了，下一页超链也可以点击，点出来的页面是空白的。(首页，上一页，下一页和最后一页都存在这个问题)</p>
<p>那么所谓的完整版的adminPage.jsp，就是对这些边界进行了处理。当没有下一页的时候，对应超链处于不可点击状态。</p>
<p>比如首页：<br>
当page.hasPreviouse为false的时候，为首页连接套用Bootstrap样式 disabled</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">  &lt;a  href=<span class="string">"?page.start=0$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">    &lt;span aria-hidden="true"&gt;&amp;laquo;&lt;/span&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> hasPreviouse会导致isHasPreviouse()方法被调用，请参考[EL表达式获取JavaBean的属性]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4997.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"ul.pagination li.disabled a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pagination"</span>&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=0$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;   </span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;status.count*page.count-page.start&lt;=20 &amp;&amp; status.count*page.count-page.start&gt;=-10&#125;"</span>&gt;</span><br><span class="line">            &lt;li &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">                &lt;a </span><br><span class="line">                href=<span class="string">"?page.start=$&#123;status.index*page.count&#125;$&#123;page.param&#125;"</span></span><br><span class="line">                &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="current"&lt;/c:if&gt;</span><br><span class="line">                &gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-自己做一遍"><a class="header-anchor" href="#步骤-11-自己做一遍">¶</a>步骤 11 : 自己做一遍</h3>
<p>下载上一个知识点[查询]右上角的tmall_ssh.rar, 在其基础之上，按照当前的步骤，自己做一遍，把效果做出来，理解和消化各个步骤的内容，转化为自己的技能。</p>
<h2 id="8、增加"><a class="header-anchor" href="#8、增加">¶</a>8、增加</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v3"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v3">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<p><strong>注：</strong> struts允许的文件默认只能允许2M 的大小，请勿上传大小超过2 M的图片。 如果希望调整上限，请通过如下教程进行：[上传文件最大值]</p>
<h3 id="步骤-2-模仿和排错-v3"><a class="header-anchor" href="#步骤-2-模仿和排错-v3">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图"><a class="header-anchor" href="#步骤-3-效果截图">¶</a>步骤 3 : 效果截图</h3>
<p>如图所示，新增加的分类，就是有图片的了。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5174.png" alt></p>
<h3 id="步骤-4-页面"><a class="header-anchor" href="#步骤-4-页面">¶</a>步骤 4 : 页面</h3>
<p>增加分类的页面是做在[listCategory.jsp]上的<br>
需要注意几点：</p>
<ol>
<li>
<p>form的action=“admin_category_add”，会导致访问CategoryAction的add()方法</p>
</li>
<li>
<p>method=“post” 用于保证中文的正确提交</p>
</li>
<li>
<p>必须有enctype=“multipart/form-data”，这样才能上传文件</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4998.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"name"</span>,<span class="string">"分类名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"categoryPic"</span>,<span class="string">"分类上传图片"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;      </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;分类管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;分类管理&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;分类名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;属性管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品管理&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;img height="40px" src="img/category/$&#123;c.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_property_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                   </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_product_list?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;                  </span><br><span class="line">                    &lt;td&gt;&lt;a href="admin_category_edit?category.id=$&#123;c.id&#125;"&gt;&lt;span class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;a deleteLink="true" href="admin_category_delete?category.id=$&#123;c.id&#125;"&gt;&lt;span class="  glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">     </span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span> %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;新增分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_category_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="category.name" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-为空判断"><a class="header-anchor" href="#步骤-5-为空判断">¶</a>步骤 5 : 为空判断</h3>
<p>对分类名称和分类图片做了为空判断，当为空的时候，不能提交</p>
<p>其中用到的函数checkEmpty，在[adminHeader.jsp] 中定义</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4999.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"name"</span>,<span class="string">"分类名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(!checkEmpty(<span class="string">"categoryPic"</span>,<span class="string">"分类图片"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryService"><a class="header-anchor" href="#步骤-6-CategoryService">¶</a>步骤 6 : CategoryService</h3>
<p>修改CategoryService，在原来的基础上增加save(Category category)方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-CategoryServiceImpl"><a class="header-anchor" href="#步骤-7-CategoryServiceImpl">¶</a>步骤 7 : CategoryServiceImpl</h3>
<p>修改CategoryServiceImpl，增加save(Category category)方法的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-ImageUtil"><a class="header-anchor" href="#步骤-8-ImageUtil">¶</a>步骤 8 : ImageUtil</h3>
<p>新增加一个ImageUtil类，提供了三个方法,在增加分类这个业务里用到了change2jpg()方法，其作用是把上传的文件，无论是bmp,jpg,png,gif都转换为真正格式的JPG文件，以确保浏览器可以正常地显示。</p>
<ol>
<li>
<p>change2jpg<br>
确保图片文件的二进制格式是jpg。<br>
仅仅通过ImageIO.write(img, “jpg”, file);不足以保证转换出来的jpg文件显示正常。这段转换代码，可以确保转换后jpg的图片显示正常，而不会出现暗红色( 有一定几率出现)。 我也是度娘上抄的，哈哈哈~ 不过找了很多代码哦，才找到这一段能真正生效，而且不会发生错误的。</p>
</li>
<li>
<p>后两种resizeImage用于改变图片大小，在上传产品图片的时候会用到。 这里不展开，到时候再讲</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.util;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.Image;</span><br><span class="line"><span class="keyword">import</span> java.awt.Toolkit;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.ColorModel;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.DataBuffer;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.DataBufferInt;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.DirectColorModel;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.PixelGrabber;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.Raster;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.RenderedImage;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.WritableRaster;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageUtil</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">change2jpg</span><span class="params">(File f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.awt.Image i = Toolkit.getDefaultToolkit().createImage(f.getAbsolutePath());</span><br><span class="line">            PixelGrabber pg = <span class="keyword">new</span> PixelGrabber(i, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, -<span class="number">1</span>, <span class="keyword">true</span>);</span><br><span class="line">            pg.grabPixels();</span><br><span class="line">            <span class="keyword">int</span> width = pg.getWidth(), height = pg.getHeight();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span>[] RGB_MASKS = &#123; <span class="number">0xFF0000</span>, <span class="number">0xFF00</span>, <span class="number">0xFF</span> &#125;;</span><br><span class="line">            <span class="keyword">final</span> ColorModel RGB_OPAQUE = <span class="keyword">new</span> DirectColorModel(<span class="number">32</span>, RGB_MASKS[<span class="number">0</span>], RGB_MASKS[<span class="number">1</span>], RGB_MASKS[<span class="number">2</span>]);</span><br><span class="line">            DataBuffer buffer = <span class="keyword">new</span> DataBufferInt((<span class="keyword">int</span>[]) pg.getPixels(), pg.getWidth() * pg.getHeight());</span><br><span class="line">            WritableRaster raster = Raster.createPackedRaster(buffer, width, height, width, RGB_MASKS, <span class="keyword">null</span>);</span><br><span class="line">            BufferedImage img = <span class="keyword">new</span> BufferedImage(RGB_OPAQUE, raster, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> img;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">resizeImage</span><span class="params">(File srcFile, <span class="keyword">int</span> width,<span class="keyword">int</span> height, File destFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Image i = ImageIO.read(srcFile);</span><br><span class="line">            i = resizeImage(i, width, height);</span><br><span class="line">            ImageIO.write((RenderedImage) i, <span class="string">"jpg"</span>, destFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Image <span class="title">resizeImage</span><span class="params">(Image srcImage, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            BufferedImage buffImg = <span class="keyword">null</span>;</span><br><span class="line">            buffImg = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">            buffImg.getGraphics().drawImage(srcImage.getScaledInstance(width, height, Image.SCALE_SMOOTH), <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> buffImg;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-CategoryAction"><a class="header-anchor" href="#步骤-9-CategoryAction">¶</a>步骤 9 : CategoryAction</h3>
<p>修改CategoryAction以支持增加分类的操作，做了如下改动</p>
<ol>
<li>
<p>新增属性Category category，以接受浏览器传递过来的分类名称</p>
</li>
<li>
<p>新增属性File image，以接受浏览器提交的图片文件</p>
</li>
<li>
<p>新增加Result：listCategoryPage， 用于客户端跳转到页面admin_category_list.</p>
</li>
<li>
<p>新增加方法add，以映射浏览器的访问地址：/admin_category_add<br>
4.1 把category对象保存到数据库<br>
4.2 根据category对象保存到数据库之后所获取的id， 计算其对应的图片文件的名称: id.jpg<br>
4.3 然后把 Struts 接受到的浏览器上传的临时文件，复制到 id.jpg。<br>
4.4 借助[ImageUtil]把这个文件的格式转换为真正的JPG格式。<br>
4.5 通过listCategoryPage，客户端跳转到admin_category_list 路径</p>
</li>
</ol>
<p>关于4.3的临时文件上传有不理解的地方，请参考：[Struts 文件上传教程]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">     </span><br><span class="line">    Category category;</span><br><span class="line">     </span><br><span class="line">    File img;</span><br><span class="line"> </span><br><span class="line">    Page page;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-中文问题"><a class="header-anchor" href="#步骤-10-中文问题">¶</a>步骤 10 : 中文问题</h3>
<p>中文问题，由web.xml中的过滤器和struts.xml中的编码设置来设置<br>
web.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>struts.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其他的配合动作</p>
<ol>
<li>在jsp中要加上</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>其中contentType=&quot;text/html; charset=UTF-8&quot;的作用是告诉浏览器提交数据的时候，使用UTF-8编码</p>
<ol start="2">
<li>在form里method=“post” 才能正确提交中文<br>
参考： [使用Filter处理中文问题， Struts中处理中文问题]</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</span><br><span class="line">             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>FORWARD<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>REQUEST<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.objectFactory"</span> <span class="attr">value</span>=<span class="string">"spring"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"basicstruts"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line"> <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="9、删除"><a class="header-anchor" href="#9、删除">¶</a>9、删除</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v4"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v4">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v4"><a class="header-anchor" href="#步骤-2-模仿和排错-v4">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果-v2"><a class="header-anchor" href="#步骤-3-效果-v2">¶</a>步骤 3 : 效果</h3>
<p>如图所示，本来存在的测试分类10被删除了</p>
<p>![](Java实践-天猫整站SSH/5180 (1).png)</p>
<h3 id="步骤-4-用于删除的超链"><a class="header-anchor" href="#步骤-4-用于删除的超链">¶</a>步骤 4 : 用于删除的超链</h3>
<p>用于删除的超链，指向地址admin_category_delete,并且会传递当前分类对象的id过去。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a deleteLink="true" href="admin_category_delete?category.id=$&#123;c.id&#125;"&gt;&lt;span class=" 	glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5005.png" alt></p>
<h3 id="步骤-5-删除前的确认操作"><a class="header-anchor" href="#步骤-5-删除前的确认操作">¶</a>步骤 5 : 删除前的确认操作</h3>
<p>在[adminHeader.jsp]中对所有的删除连接都进行了监听：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> deleteLink = $(<span class="keyword">this</span>).attr(<span class="string">"deleteLink"</span>);</span><br><span class="line">        console.log(deleteLink);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"true"</span>==deleteLink)&#123;</span><br><span class="line">            <span class="keyword">var</span> confirmDelete = confirm(<span class="string">"确认要删除"</span>);</span><br><span class="line">            <span class="keyword">if</span>(confirmDelete)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryService-v2"><a class="header-anchor" href="#步骤-6-CategoryService-v2">¶</a>步骤 6 : CategoryService</h3>
<p>为CategoryService接口新增加delete(Category category)方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-CategoryServiceImpl-v2"><a class="header-anchor" href="#步骤-7-CategoryServiceImpl-v2">¶</a>步骤 7 : CategoryServiceImpl</h3>
<p>CategoryServiceImpl 实现 delete() 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.delete(category);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-CategoryAction"><a class="header-anchor" href="#步骤-8-CategoryAction">¶</a>步骤 8 : CategoryAction</h3>
<p>CategoryAction新增方法用于映射对于路径admin_category_delete的访问</p>
<ol>
<li>通过categoryService删除Category对象</li>
<li>客户端跳转到listCategoryPage</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">  </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">      </span><br><span class="line">    Category category;</span><br><span class="line">      </span><br><span class="line">    File img;</span><br><span class="line">  </span><br><span class="line">    Page page;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10、编辑"><a class="header-anchor" href="#10、编辑">¶</a>10、编辑</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v5"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v5">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v5"><a class="header-anchor" href="#步骤-2-模仿和排错-v5">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果-v3"><a class="header-anchor" href="#步骤-3-效果-v3">¶</a>步骤 3 : 效果</h3>
<p>如图所示，点击编辑按钮之后，出现分类编辑页面</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5008.png" alt></p>
<h3 id="步骤-4-CategoryService"><a class="header-anchor" href="#步骤-4-CategoryService">¶</a>步骤 4 : CategoryService</h3>
<p>为接口CategoryService提供get方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-CategoryServiceImpl"><a class="header-anchor" href="#步骤-5-CategoryServiceImpl">¶</a>步骤 5 : CategoryServiceImpl</h3>
<p>实现get(Class clazz, int id)方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.delete(category);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Category) dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryAction"><a class="header-anchor" href="#步骤-6-CategoryAction">¶</a>步骤 6 : CategoryAction</h3>
<p>CategoryAction做了如下改动</p>
<ol>
<li>新增加Result：editCategory</li>
<li>提供方法edit()以映射路径：admin_category_edit<br>
2.1 首先获取id<br>
2.2 根据id获取Category对象。 为什么要这么做呢？因为浏览器提交数据的时候，只提交了id,而编辑页面需要显示的是这个分类的名称，所以需要根据id到数据库中把相应的信息查询出来。<br>
2.3 服务端跳转到editCategory.jsp页面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">     </span><br><span class="line">    Category category;</span><br><span class="line">     </span><br><span class="line">    File img;</span><br><span class="line"> </span><br><span class="line">    Page page;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = category.getId();</span><br><span class="line">        category = categoryService.get(Category<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-editCategory-jsp"><a class="header-anchor" href="#步骤-7-editCategory-jsp">¶</a>步骤 7 : editCategory.jsp</h3>
<p>在editCategory.jsp页面里，获取由CategoryAction.edit() 通过request传递过来的Category对象，获取name和id，分别放在</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input  id=<span class="string">"name"</span> name=<span class="string">"name"</span> value=<span class="string">"$&#123;c.name&#125;"</span> type=<span class="string">"text"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control"</span>&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"id"</span> value=<span class="string">"$&#123;c.id&#125;"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>但是不能放在浏览图片这个input上。 因为浏览器不支持</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">"categoryPic"</span> accept=<span class="string">"image/*"</span> type=<span class="string">"file"</span> name=<span class="string">"filepath"</span> /&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;编辑分类&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;编辑分类&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning editDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;编辑分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_category_update"</span>  enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"editTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="category.name" value="$&#123;category.name&#125;" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;                </span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;   </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="11、修改"><a class="header-anchor" href="#11、修改">¶</a>11、修改</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v6"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v6">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v6"><a class="header-anchor" href="#步骤-2-模仿和排错-v6">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果-v4"><a class="header-anchor" href="#步骤-3-效果-v4">¶</a>步骤 3 : 效果</h3>
<p>如图所示，“测试分类A” 的名称被修改为了 “测试分类B”</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5190.png" alt></p>
<h3 id="步骤-4-编辑页面提交数据"><a class="header-anchor" href="#步骤-4-编辑页面提交数据">¶</a>步骤 4 : 编辑页面提交数据</h3>
<p>编辑页面提交数据到admin_category_update</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_category_update"</span>  </span><br><span class="line">enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>method=“post” 用于提交中文</li>
<li>enctype=“multipart/form-data” 用于提交二进制文件</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5012.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;编辑分类&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;编辑分类&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning editDiv"</span>&gt;</span><br><span class="line">      &lt;div class="panel-heading"&gt;编辑分类&lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_category_update"</span>  enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"editTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input  id="name" name="category.name" value="$&#123;category.name&#125;" type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;分类圖片&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"categoryPic"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;                </span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;   </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-CategoryService-v2"><a class="header-anchor" href="#步骤-5-CategoryService-v2">¶</a>步骤 5 : CategoryService</h3>
<p>新增update方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryServiceImpl-v2"><a class="header-anchor" href="#步骤-6-CategoryServiceImpl-v2">¶</a>步骤 6 : CategoryServiceImpl</h3>
<p>实现update方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.delete(category);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Category) dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.update(category);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-CategoryAction-v2"><a class="header-anchor" href="#步骤-7-CategoryAction-v2">¶</a>步骤 7 : CategoryAction</h3>
<p>CategoryAction.update() 方法和[CategoryAction.add()] 方法的处理很类似，有所不同之处在于增加操作一定会提交图片，而修改不一定提交图片。</p>
<p>在update()方法中做了如下操作：</p>
<ol>
<li>
<p>更新category对象</p>
</li>
<li>
<p>当发现上传的文件的时候，进行文件更新操作<br>
2.1 根据category对象的id， 计算其对应的图片文件的名称: id.jpg<br>
2.2 然后把 Struts 接受到的浏览器上传的临时文件，复制到 id.jpg。<br>
2.3 借助[ImageUtil]把这个文件的格式转换为真正的JPG格式。<br>
2.4 通过listCategoryPage，客户端跳转到admin_category_list 路径</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">     </span><br><span class="line">    Category category;</span><br><span class="line">     </span><br><span class="line">    File img;</span><br><span class="line"> </span><br><span class="line">    Page page;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = category.getId();</span><br><span class="line">        category = categoryService.get(Category<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                 </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12、做一遍"><a class="header-anchor" href="#12、做一遍">¶</a>12、做一遍</h2>
<p>关于分类管理这一块的学习，推荐如下思路：</p>
<ol>
<li>
<p>先下载[可运行的项目] ，配置好了跑一边</p>
</li>
<li>
<p>根据接着的讲解，把里面的每一块代码的逻辑，思路，设计思想搞明白，不明不白的在对应页面下提问</p>
</li>
<li>
<p>都理清楚之后，把[可运行的项目] 删掉，按照：查询，增加，删除，编辑，修改的顺序自己从头到尾做一遍</p>
</li>
</ol>
<p>只有，能够独立的做出来，才叫做把这些知识点的内容转化为自己的技能</p>
<h1 id="八、项目重构"><a class="header-anchor" href="#八、项目重构">¶</a>八、项目重构</h1>
<h2 id="1、存在的问题"><a class="header-anchor" href="#1、存在的问题">¶</a>1、存在的问题</h2>
<p>项目重构这一块大家可以学习到不少JAVA里的中高级处理手法，使得框架更加紧凑，后续开发更加便利和高效率。<br>
这也是作为架构师的常用利器，掌握这一手段对JAVA从业者是非常有价值的</p>
<h3 id="步骤-1-分类管理完成"><a class="header-anchor" href="#步骤-1-分类管理完成">¶</a>步骤 1 : 分类管理完成</h3>
<p>截止到现在， 分类管理的功能就已经做好了。 虽然分类管理做好了，但是代码层面的问题开始逐渐浮现出来了。<br>
问题主要表现在Service层，和Action层。</p>
<h3 id="步骤-2-Service层的问题"><a class="header-anchor" href="#步骤-2-Service层的问题">¶</a>步骤 2 : Service层的问题</h3>
<p>在开发分类管理的过程中，Service层用到了一个接口和一个实现类，分别是CategoryService和CategoryServiceImpl。<br>
这个层有什么问题呢？<br>
首先看接口：CategoryService。 其声明的方法基本上就是CURD和分页。<br>
可以预见的是，在后续做产品管理，用户管理，订单管理等等，也会有这么一个非常近似的CURD的接口，换句话说，这里是有做抽象和代码重构(Refactory)的机会和价值的。</p>
<p>然后看实现类：CategoryServiceImpl。 CategoryServiceImpl本身其实就是个架子，真正起作用的是为其注入的DAO对象，所以这个地方也是可以引入<strong>委派模式</strong>，使得代码调用更加顺畅。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.delete(category);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Category) dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.update(category);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-Action的问题"><a class="header-anchor" href="#步骤-3-Action的问题">¶</a>步骤 3 : Action的问题</h3>
<p>这里放上了CategoryAction的代码，这样的CategoryAction代码完成功能是没有问题的，但是问题恰恰在于，这样一个本来是用于充当控制层(Controller)的类，需要集中应付太多的需求：</p>
<ol>
<li>返回页面的定义</li>
<li>单个对象的getter setter</li>
<li>集合对象的getter setter</li>
<li>分页对象的getter setter</li>
<li>上传文件对象的getter setter</li>
<li>Service层对象的注入</li>
<li>作为控制层进行的访问路径映射</li>
</ol>
<p>把所有的这些代码，都放在一个类里面，这个类就会显得繁杂，不易阅读，不易维护。 所以这个地方也是很有代码重构价值的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">  </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">      </span><br><span class="line">    Category category;</span><br><span class="line">      </span><br><span class="line">    File img;</span><br><span class="line">  </span><br><span class="line">    Page page;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = category.getId();</span><br><span class="line">        category = categoryService.get(Category<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                  </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-解决办法"><a class="header-anchor" href="#步骤-4-解决办法">¶</a>步骤 4 : 解决办法</h3>
<p>以上列出了Service层和Action层存在的问题，分析了其重构的价值，接下来就分别对Service层和Action层进行重构：<br>
[Service重构-抽象]，[Action重构]</p>
<h2 id="2、SERVICE重构-抽象"><a class="header-anchor" href="#2、SERVICE重构-抽象">¶</a>2、SERVICE重构-抽象</h2>
<h3 id="步骤-1-重构完成之后的效果"><a class="header-anchor" href="#步骤-1-重构完成之后的效果">¶</a>步骤 1 : 重构完成之后的效果</h3>
<p>如图所示，Service层完成重构之后，CategoryService只需要继承BaseService,而CategoryServiceImpl也是只需要继承 BaseServiceImpl并实现CategoryService接口。<br>
无需自己再写额外的代码，后续其他实体类的开发也能享受到这个好处，这样就大大地加快了开发的效率，减少了出错与维护成本。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5204.png" alt></p>
<h3 id="步骤-2-重申Service层存在的重构需求"><a class="header-anchor" href="#步骤-2-重申Service层存在的重构需求">¶</a>步骤 2 : 重申Service层存在的重构需求</h3>
<p>在开发分类管理的过程中，Service层用到了一个接口和一个实现类，分别是CategoryService和CategoryServiceImpl。<br>
这个层有什么问题呢？<br>
首先看接口：CategoryService。 其声明的方法基本上就是CURD和分页。<br>
可以预见的是，在后续做产品管理，用户管理，订单管理等等，也会有这么一个非常近似的CURD的接口，换句话说，这里是有做抽象和代码重构(Refactory)的机会和价值的。</p>
<p>然后看实现类：CategoryServiceImpl。 CategoryServiceImpl本身其实就是个架子，真正起作用的是为其注入的DAO对象，所以这个地方也是可以引入<strong>委派模式</strong>，使得代码调用更加顺畅。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span></span>;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span>  <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from Category "</span>;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(Category<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.save(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.delete(category);</span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Category) dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        dao.update(category);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-Service层-的重构行为"><a class="header-anchor" href="#步骤-3-Service层-的重构行为">¶</a>步骤 3 : Service层 的重构行为</h3>
<p>所以Service层 的重构行为主要包括两种角度</p>
<ol>
<li>
<p>对CURD进行抽象</p>
</li>
<li>
<p>委派模式的重构<br>
因为重构比较复杂，所以分为两个知识点进行讲解，本知识点讲[CURD-抽象]，在下一个知识点讲解[委派模式]。</p>
</li>
</ol>
<h3 id="步骤-4-父接口-BaseService"><a class="header-anchor" href="#步骤-4-父接口-BaseService">¶</a>步骤 4 : 父接口 BaseService</h3>
<p>由于可以预见的在后续做产品管理，用户管理，订单管理等等，也会有这么一个非常近似的CURD的接口，那么我们就做一个BaseService，里面就提供这些CRUD和分页查询的方法</p>
<p>**注：**save方法为什么不是返回void,而是要返回一个Integer。 这个问题在后续步骤有一个专门讲解:[关于save方法的返回类型]<br>
**注：**提供了一个新的get(int id)方法，不需要指定clazz也行，只需要提供id即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz,<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-父接口实现类-BaseServiceImpl"><a class="header-anchor" href="#步骤-5-父接口实现类-BaseServiceImpl">¶</a>步骤 5 : 父接口实现类 BaseServiceImpl</h3>
<p>接着，提供了一个BaseServiceImpl类来实现BaseService这个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">protected</span> Class clazz =Category<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) dao.save(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.delete(object);</span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.update(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-CategoryService接口继承BaseService"><a class="header-anchor" href="#步骤-6-CategoryService接口继承BaseService">¶</a>步骤 6 : CategoryService接口继承BaseService</h3>
<p>这样CategoryService就不需要自己声明方法了，只需要继承接口BaseService即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-CategoryServiceImpl继承BaseServiceImpl"><a class="header-anchor" href="#步骤-7-CategoryServiceImpl继承BaseServiceImpl">¶</a>步骤 7 : CategoryServiceImpl继承BaseServiceImpl</h3>
<p>CategoryServiceImpl也不需要自己提供实现了，继承BaseServiceImpl 并实现接口CategoryService 即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Clazz对象的处理"><a class="header-anchor" href="#步骤-8-Clazz对象的处理">¶</a>步骤 8 : Clazz对象的处理</h3>
<p>可是现在有一个问题，BaseServiceImpl类里面有一行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class clazz =Category<span class="class">.<span class="keyword">class</span></span>;</span><br></pre></td></tr></table></figure>
<p>表示这个BaseServiceImpl是专门用于进行Category类的CURD的，如果是后续要做的产品功能对应的ProductService继承BaseServiceImpl 这个类，不就有问题了吗？</p>
<p>这个问题怎么解决呢？ 这个。。。这个。。。。处理起来比较复杂，分以下几个步骤进行</p>
<ol>
<li>声明clazz的时候，不再指向Category.class 对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class clazz;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在构造方法中，借助异常处理和反射得到Category.class或者Product.class。 即要做到哪个类继承了BaseServiceImpl，clazz 就对应哪个类对象。<br>
比如是 CategoryServiceImpl继承了BaseServiceImpl,那么这个clazz的值就是Category.class<br>
比如是 ProductServiceImpl继承了BaseServiceImpl,那么这个clazz的值就是Product.class</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> Exception();	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">	    String serviceImpleClassName=	stes[<span class="number">1</span>].getClassName();</span><br><span class="line">	    <span class="keyword">try</span> &#123;</span><br><span class="line">			Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">			String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">			String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">			String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">			String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">			clazz=Class.forName(pojoFullName);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">			e1.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		2.1 首先要获取是哪个类继承了BaseServiceImpl，这里用到了面向对象知识里的：实例化子类，父类的构造方法一定会被调用 这么一个知识点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> Exception();	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">		    String serviceImpleClassName=	stes[<span class="number">1</span>].getClassName();</span><br></pre></td></tr></table></figure>
<p>所以在父类BaseServiceImpl里故意抛出一个异常，然后手动捕捉住它，在其对应的StackTrace里的第二个(下标是1) 栈跟踪元素StackTraceElement ，即对应子类。 这样我们就拿到了子类名称 CategoryServiceImpl或者ProductServiceImpl</p>
<p>​		2.2 拿到了CategoryServiceImpl或者ProductServiceImpl，通过字符串替换，拼接和反射，就得到了对应的实体类的类对象Category.class或者Product.class对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">clazz=Class.forName(pojoFullName);</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是，这样的做法是建立在服务实现类是放在xxx.service.impl包下的，而实体类是放在xxx.pojo包下的。</p>
<ol start="3">
<li>同时提供了一个测试方法，运行一下，看看这个clazz引用是否指向了期望的类对象。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">new</span> CategoryServiceImpl().showClass();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考知识： [反射]，[异常处理]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> CategoryServiceImpl().showClass();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception();  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) dao.save(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.delete(object);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.update(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-CategoryAction的调整"><a class="header-anchor" href="#步骤-9-CategoryAction的调整">¶</a>步骤 9 : CategoryAction的调整</h3>
<p>因为BaseService接口中方法声明的改变，所以CategoryAction在调用的时候，需要做相应的调整。<br>
这里主要是categoryService.get方法，由原本需要制定class对象，变为只需要给出id即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//category = categoryService.get(Category.class,id);</span></span><br><span class="line">category = (Category) categoryService.get(id);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">   </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">       </span><br><span class="line">    Category category;</span><br><span class="line">       </span><br><span class="line">    File img;</span><br><span class="line">   </span><br><span class="line">    Page page;</span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = category.getId();</span><br><span class="line"><span class="comment">//        category = categoryService.get(Category.class,id);</span></span><br><span class="line">        category = (Category) categoryService.get(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                   </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-Service重构-抽象带来的好处"><a class="header-anchor" href="#步骤-10-Service重构-抽象带来的好处">¶</a>步骤 10 : Service重构-抽象带来的好处</h3>
<p>这么做的好处主要在于：后续新功能开发的过程中，当需要新增加新的Service类的话，比如PropertyService，无需从头开发，只需要继承BaseServiceImpl 并实现PropertyService，那么其所需要CRUD一套方法都有了。</p>
<ol>
<li>开发成本显著降低</li>
<li>更加不容易出错(因为方法都被抽象在父类中了，并且被前面的业务验证过了，要出错早就被纠正过了)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">PropertyService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-可运行项目"><a class="header-anchor" href="#步骤-11-可运行项目">¶</a>步骤 11 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以实现分类的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h2 id="3、SERVICE重构-委派"><a class="header-anchor" href="#3、SERVICE重构-委派">¶</a>3、SERVICE重构-委派</h2>
<h3 id="步骤-1-先看委派重构实现之后的好处"><a class="header-anchor" href="#步骤-1-先看委派重构实现之后的好处">¶</a>步骤 1 : 先看委派重构实现之后的好处</h3>
<p>在此之前，<a href="http://xn--dao-mw2fi8sdkdx05gd0dr9kyxau9evtx5ld.XXX" target="_blank" rel="noopener">访问数据库都需要通过dao.XXX</a>()来进行。 而委派重构之后，数据库相关方法，不再需要通过dao，直接调用即可，代码看上去更简洁。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5366.png" alt></p>
<h3 id="步骤-2-ServiceDelegateDAO"><a class="header-anchor" href="#步骤-2-ServiceDelegateDAO">¶</a>步骤 2 : ServiceDelegateDAO</h3>
<p>接着我们继续分析 BaseServiceImpl类，可以看到其CURD关键方法都是调用的被注入的dao完成的，这样就十分适合使用委派模式来重构这块代码。</p>
<p>首先设计一个新的类，叫做ServiceDelegateDAO，在其中注入dao，然后让对dao的每一个方法进行委派。</p>
<p>那么到底什么是委派呢？ 如ServiceDelegateDAO类所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">	dao.delete(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当调用ServiceDelegateDAO对象的delete(Object entity) 的时候，其实就是<strong>委派给</strong>的dao的delete(Object entity) 方法。<br>
但是从调用者的角度来看，调用者只知道ServiceDelegateDAO这个类的delete(Object entity)方法，而意识不到dao的存在。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> CategoryServiceImpl().showClass();</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= dao.find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) dao.save(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.delete(object);</span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        dao.update(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dao.get(clazz, id);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.Filter;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.HibernateException;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.LockMode;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.ReplicationMode;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.SQLExceptionTranslator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate3.HibernateCallback;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceDelegateDAO</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> DAOImpl dao;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.delete(entity);</span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Serializable <span class="title">save</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.save(entity);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dao.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bulkUpdate</span><span class="params">(String queryString, Object... values)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.bulkUpdate(queryString, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bulkUpdate</span><span class="params">(String queryString, Object value)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.bulkUpdate(queryString, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bulkUpdate</span><span class="params">(String queryString)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.bulkUpdate(queryString);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.clear();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeIterator</span><span class="params">(Iterator arg0)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.closeIterator(arg0);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.contains(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataAccessException <span class="title">convertHibernateAccessException</span><span class="params">(HibernateException ex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.convertHibernateAccessException(ex);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.delete(entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String entityName, Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.delete(entityName, entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String entityName, Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.delete(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">(Collection entities)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.deleteAll(entities);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Filter <span class="title">enableFilter</span><span class="params">(String filterName)</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.enableFilter(filterName);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.equals(obj);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evict</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.evict(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(HibernateCallback&lt;T&gt; action)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.execute(action);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">executeFind</span><span class="params">(HibernateCallback&lt;?&gt; action)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.executeFind(action);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">executeWithNativeSession</span><span class="params">(HibernateCallback&lt;T&gt; action)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.executeWithNativeSession(action);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">executeWithNewSession</span><span class="params">(HibernateCallback&lt;T&gt; action)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.executeWithNewSession(action);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">find</span><span class="params">(String queryString, Object... values)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.find(queryString, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">find</span><span class="params">(String queryString, Object value)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.find(queryString, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">find</span><span class="params">(String queryString)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.find(queryString);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByCriteria</span><span class="params">(DetachedCriteria criteria, <span class="keyword">int</span> firstResult, <span class="keyword">int</span> maxResults)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(criteria, firstResult, maxResults);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByCriteria</span><span class="params">(DetachedCriteria criteria)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByCriteria(criteria);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByExample</span><span class="params">(Object exampleEntity, <span class="keyword">int</span> firstResult, <span class="keyword">int</span> maxResults)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByExample(exampleEntity, firstResult, maxResults);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByExample</span><span class="params">(Object exampleEntity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByExample(exampleEntity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByExample</span><span class="params">(String entityName, Object exampleEntity, <span class="keyword">int</span> firstResult, <span class="keyword">int</span> maxResults)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByExample(entityName, exampleEntity, firstResult, maxResults);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByExample</span><span class="params">(String entityName, Object exampleEntity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByExample(entityName, exampleEntity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedParam</span><span class="params">(String queryString, String paramName, Object value)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedParam(queryString, paramName, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedParam</span><span class="params">(String queryString, String[] paramNames, Object[] values)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedParam(queryString, paramNames, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQuery</span><span class="params">(String queryName, Object... values)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQuery(queryName, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQuery</span><span class="params">(String queryName, Object value)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQuery(queryName, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQuery</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQuery(queryName);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQueryAndNamedParam</span><span class="params">(String queryName, String paramName, Object value)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQueryAndNamedParam(queryName, paramName, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQueryAndNamedParam</span><span class="params">(String queryName, String[] paramNames, Object[] values)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQueryAndNamedParam(queryName, paramNames, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByNamedQueryAndValueBean</span><span class="params">(String queryName, Object valueBean)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByNamedQueryAndValueBean(queryName, valueBean);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">findByValueBean</span><span class="params">(String queryString, Object valueBean)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findByValueBean(queryString, valueBean);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.flush();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Class&lt;T&gt; entityClass, Serializable id, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(entityClass, id, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Class&lt;T&gt; entityClass, Serializable id)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(entityClass, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String entityName, Serializable id, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(entityName, id, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String entityName, Serializable id)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.get(entityName, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Interceptor <span class="title">getEntityInterceptor</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException, BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getEntityInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFetchSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getFetchSize();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String[] getFilterNames() &#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getFilterNames();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFlushMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getFlushMode();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLExceptionTranslator <span class="title">getJdbcExceptionTranslator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getJdbcExceptionTranslator();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaxResults</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getMaxResults();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQueryCacheRegion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getQueryCacheRegion();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionFactory <span class="title">getSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.getSessionFactory();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Object arg0)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.initialize(arg0);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAllowCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.isAllowCreate();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAlwaysUseNewSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.isAlwaysUseNewSession();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCacheQueries</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.isCacheQueries();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCheckWriteOperations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.isCheckWriteOperations();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExposeNativeSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.isExposeNativeSession();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">iterate</span><span class="params">(String queryString, Object... values)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.iterate(queryString, values);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">iterate</span><span class="params">(String queryString, Object value)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.iterate(queryString, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">iterate</span><span class="params">(String queryString)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.iterate(queryString);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">load</span><span class="params">(Class&lt;T&gt; entityClass, Serializable id, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.load(entityClass, id, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">load</span><span class="params">(Class&lt;T&gt; entityClass, Serializable id)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.load(entityClass, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(Object entity, Serializable id)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.load(entity, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">load</span><span class="params">(String entityName, Serializable id, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.load(entityName, id, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">load</span><span class="params">(String entityName, Serializable id)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.load(entityName, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">loadAll</span><span class="params">(Class&lt;T&gt; entityClass)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.loadAll(entityClass);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.lock(entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(String entityName, Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.lock(entityName, entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">merge</span><span class="params">(String entityName, T entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.merge(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">merge</span><span class="params">(T entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.merge(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">persist</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.persist(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">persist</span><span class="params">(String entityName, Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.persist(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">(Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.refresh(entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.refresh(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replicate</span><span class="params">(Object entity, ReplicationMode replicationMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.replicate(entity, replicationMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replicate</span><span class="params">(String entityName, Object entity, ReplicationMode replicationMode)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.replicate(entityName, entity, replicationMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Serializable <span class="title">save</span><span class="params">(String entityName, Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.save(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.saveOrUpdate(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">(String entityName, Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.saveOrUpdate(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateAll</span><span class="params">(Collection entities)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.saveOrUpdateAll(entities);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAllowCreate</span><span class="params">(<span class="keyword">boolean</span> allowCreate)</span> </span>&#123;</span><br><span class="line">        dao.setAllowCreate(allowCreate);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlwaysUseNewSession</span><span class="params">(<span class="keyword">boolean</span> alwaysUseNewSession)</span> </span>&#123;</span><br><span class="line">        dao.setAlwaysUseNewSession(alwaysUseNewSession);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">        dao.setBeanFactory(beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCacheQueries</span><span class="params">(<span class="keyword">boolean</span> cacheQueries)</span> </span>&#123;</span><br><span class="line">        dao.setCacheQueries(cacheQueries);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCheckWriteOperations</span><span class="params">(<span class="keyword">boolean</span> checkWriteOperations)</span> </span>&#123;</span><br><span class="line">        dao.setCheckWriteOperations(checkWriteOperations);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEntityInterceptor</span><span class="params">(Interceptor entityInterceptor)</span> </span>&#123;</span><br><span class="line">        dao.setEntityInterceptor(entityInterceptor);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEntityInterceptorBeanName</span><span class="params">(String entityInterceptorBeanName)</span> </span>&#123;</span><br><span class="line">        dao.setEntityInterceptorBeanName(entityInterceptorBeanName);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExposeNativeSession</span><span class="params">(<span class="keyword">boolean</span> exposeNativeSession)</span> </span>&#123;</span><br><span class="line">        dao.setExposeNativeSession(exposeNativeSession);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFetchSize</span><span class="params">(<span class="keyword">int</span> fetchSize)</span> </span>&#123;</span><br><span class="line">        dao.setFetchSize(fetchSize);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilterName</span><span class="params">(String filter)</span> </span>&#123;</span><br><span class="line">        dao.setFilterName(filter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilterNames</span><span class="params">(String[] filterNames)</span> </span>&#123;</span><br><span class="line">        dao.setFilterNames(filterNames);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlushMode</span><span class="params">(<span class="keyword">int</span> flushMode)</span> </span>&#123;</span><br><span class="line">        dao.setFlushMode(flushMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlushModeName</span><span class="params">(String constantName)</span> </span>&#123;</span><br><span class="line">        dao.setFlushModeName(constantName);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcExceptionTranslator</span><span class="params">(SQLExceptionTranslator jdbcExceptionTranslator)</span> </span>&#123;</span><br><span class="line">        dao.setJdbcExceptionTranslator(jdbcExceptionTranslator);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxResults</span><span class="params">(<span class="keyword">int</span> maxResults)</span> </span>&#123;</span><br><span class="line">        dao.setMaxResults(maxResults);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQueryCacheRegion</span><span class="params">(String queryCacheRegion)</span> </span>&#123;</span><br><span class="line">        dao.setQueryCacheRegion(queryCacheRegion);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span> </span>&#123;</span><br><span class="line">        dao.setSessionFactory(sessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.update(entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.update(entity);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String entityName, Object entity, LockMode lockMode)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.update(entityName, entity, lockMode);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String entityName, Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">        dao.update(entityName, entity);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-ServiceDelegateDAO的快速生成技巧"><a class="header-anchor" href="#步骤-3-ServiceDelegateDAO的快速生成技巧">¶</a>步骤 3 : ServiceDelegateDAO的快速生成技巧</h3>
<p>如上个步骤的代码中，ServiceDelegateDAO 类对其注入的dao进行委派，而dao一共有104个方法，那么ServiceDelegateDAO自己就需要设计104个方法，假如都手动写会非常耗时，而且容易出错。有什么办法可以又快又准地生成委派代码呢？<br>
答案是有的，我们可以借助eclipse的快速生成委派模式来解决这个问题。</p>
<ol>
<li>
<p>首先回到ServiceDelegateDAO 只有dao属性的状态，并且选中dao属性，<strong>一定要选中哦</strong></p>
</li>
<li>
<p>然后点击菜单-&gt;Source-&gt;Generate Delegate Methods -&gt; Select All -&gt; OK<br>
这样就快速而不出错地对dao的104个方法自动生成了委派方法。</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5205.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.dao.impl.DAOImpl;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceDelegateDAO</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DAOImpl dao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-BaseServiceImpl继承ServiceDelegateDAO"><a class="header-anchor" href="#步骤-4-BaseServiceImpl继承ServiceDelegateDAO">¶</a>步骤 4 : BaseServiceImpl继承ServiceDelegateDAO</h3>
<p>这个时候，BaseServiceImpl 就可以继承ServiceDelegateDAO，并且在原来需要通过dao.methodxxx()的地方，直接调用methodxxx()即可达到一样的效果，从而使得代码看上去更加简约。</p>
<p>比如list方法，在使用委派模式之前，需要通过**dao.**findByCriteria(dc)进行调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">    dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">    <span class="keyword">return</span> dao.findByCriteria(dc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而使用委派模式之后，就直接调用findByCriteria(dc)即可，根本意识不到dao对象的存在。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">    dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">    <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不仅如此，因为继承了ServiceDelegateDAO，所以update和delete方法也无需额外提供了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 	  因为继承了ServiceDelegateDAO，所以就继承了update和delete方法</span></span><br><span class="line"><span class="comment">//    public void update(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        update(object);</span></span><br><span class="line"><span class="comment">//    &#125;   </span></span><br><span class="line"><span class="comment">//    public void delete(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        delete(object);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">extends</span> <span class="title">ServiceDelegateDAO</span> <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) <span class="keyword">super</span>.save(object);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"><span class="comment">//    因为继承了ServiceDelegateDAO，所以就继承了update和delete方法</span></span><br><span class="line"><span class="comment">//    public void update(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        update(object);</span></span><br><span class="line"><span class="comment">//    &#125;  </span></span><br><span class="line"><span class="comment">//    public void delete(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        delete(object);</span></span><br><span class="line"><span class="comment">//    &#125;   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-关于save方法的返回类型"><a class="header-anchor" href="#步骤-5-关于save方法的返回类型">¶</a>步骤 5 : 关于save方法的返回类型</h3>
<p>这里需要解释一下save方法。<br>
作为委派模式，ServiceDelegateDAO提供的save方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Serializable <span class="title">save</span><span class="params">(Object entity)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dao.save(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其返回类型是Serializable(自增长id) ，所以按照方法重写原则，作为其子类BaseServiceImpl重写的save方法，其返回类型只能是Serializable 或者Serializable 的子类，所以这里选择的是Integer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (Integer) <span class="keyword">super</span>.save(object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与此同时，BaseServiceImpl又实现了BaseService接口，而BaseService接口中声明了一个save方法。倘若BaseService接口中的save方法返回的是void，那么就矛盾了。<br>
所以在BaseService中声明的save方法，返回的是Integer，用于和委派模式进行兼容。</p>
<h3 id="步骤-6-委派模式的好处"><a class="header-anchor" href="#步骤-6-委派模式的好处">¶</a>步骤 6 : 委派模式的好处</h3>
<ol>
<li>通过委派模式把dao隐藏起来，调用的时候意识不到dao的存在，代码看起来更加简洁</li>
<li>通过继承委派模式的ServiceDelegateDAO，继承了update和delete，直接使用即可，BaseServiceImpl 类无须再额外提供这两个方法</li>
</ol>
<h3 id="步骤-7-可运行项目"><a class="header-anchor" href="#步骤-7-可运行项目">¶</a>步骤 7 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以实现分类的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h2 id="4、SERVICE重构-总结"><a class="header-anchor" href="#4、SERVICE重构-总结">¶</a>4、SERVICE重构-总结</h2>
<h3 id="步骤-1-好处"><a class="header-anchor" href="#步骤-1-好处">¶</a>步骤 1 : 好处</h3>
<ol>
<li>CategoryService 接口只需要继承BaseService就声明了一套CRUD方法</li>
<li>CategoryServiceImpl 实现类只需要继承BaseServiceImpl 就继承了一套CRUD方法</li>
<li>在实现类BaseServiceImpl 不用做dao.methodXXX这样脱裤子放屁的事情，感受不到dao的存在。</li>
</ol>
<p>可以预见在后续开发过程中，其他的Service接口与实现了也能够享受这样的好处，提升开发速度，加快开发效率，降低犯错几率。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">extends</span> <span class="title">ServiceDelegateDAO</span> <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) <span class="keyword">super</span>.save(object);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span> </span>&#123;</span><br><span class="line">        String parentName= parent.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Object... pairParms)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"><span class="comment">//    因为继承了ServiceDelegateDAO，所以就继承了update和delete方法</span></span><br><span class="line"><span class="comment">//    public void update(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        update(object);</span></span><br><span class="line"><span class="comment">//    &#125;  </span></span><br><span class="line"><span class="comment">//    public void delete(Object object) &#123;</span></span><br><span class="line"><span class="comment">//        delete(object);</span></span><br><span class="line"><span class="comment">//    &#125;   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-Service层类关系图"><a class="header-anchor" href="#步骤-2-Service层类关系图">¶</a>步骤 2 : Service层类关系图</h3>
<p>为了更加清楚地理解Service层的几个类之间的关系，整理了这么一个类图</p>
<ol>
<li>
<p>BaseService是接口</p>
</li>
<li>
<p>CategoryService 是接口</p>
</li>
<li>
<p>CategoryService 接口 继承了 BaseService接口 (接口是可以继承接口的)</p>
</li>
<li>
<p>BaseServiceImpl 实现了BaseService接口</p>
</li>
<li>
<p>CategoryServiceImpl 实现了CategoryService接口</p>
</li>
<li>
<p>CategoryServiceImpl 继承了BaseServiceImpl</p>
</li>
<li>
<p>BaseServiceImpl 继承了ServiceDelegateDAO类</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5221.png" alt></p>
<h2 id="5、ACTION重构"><a class="header-anchor" href="#5、ACTION重构">¶</a>5、ACTION重构</h2>
<h3 id="步骤-1-重申Action层存在的问题"><a class="header-anchor" href="#步骤-1-重申Action层存在的问题">¶</a>步骤 1 : 重申Action层存在的问题</h3>
<p>这里放上了CategoryAction的代码，这样的CategoryAction代码完成功能是没有问题的，但是问题恰恰在于，这样一个本来是用于充当控制层(Controller)的类，需要集中应付太多的需求：</p>
<ol>
<li>返回页面的定义</li>
<li>单个对象的getter setter</li>
<li>集合对象的getter setter</li>
<li>分页对象的getter setter</li>
<li>上传文件对象的getter setter</li>
<li>Service层对象的注入</li>
<li>作为控制层进行的访问路径映射</li>
</ol>
<p>把所有的这些代码，都放在一个类里面，这个类就会显得繁杂，不易阅读，不易维护。 所以这个地方也是很有代码重构价值的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">  </span><br><span class="line">    List&lt;Category&gt; categorys;</span><br><span class="line">      </span><br><span class="line">    Category category;</span><br><span class="line">      </span><br><span class="line">    File img;</span><br><span class="line">  </span><br><span class="line">    Page page;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = category.getId();</span><br><span class="line">        category = categoryService.get(Category<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                  </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-重构后的效果"><a class="header-anchor" href="#步骤-2-重构后的效果">¶</a>步骤 2 : 重构后的效果</h3>
<p>CategoryAction 通过继承功能性的父类，将非控制器功能规划到了父类里，<br>
CategoryAction 本身只需要专注于扮演控制器(Controller)本身就行了，不会再出现其他看上去纷繁复杂的其他<strong>手段代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span></span>&#123;</span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                   </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-重构思路"><a class="header-anchor" href="#步骤-3-重构思路">¶</a>步骤 3 : 重构思路</h3>
<p>目前CategoryAction存在的问题是一个类需要做太多的事情，显的繁杂，影响阅读和维护。 那么重构思路就是把不同的事情，放在专门的类进行处理。<br>
接下来就会设计各种专门的类处理专门的问题。</p>
<h3 id="步骤-4-上传专用-Action4Upload"><a class="header-anchor" href="#步骤-4-上传专用-Action4Upload">¶</a>步骤 4 : 上传专用 Action4Upload</h3>
<p>Action4Upload这个类就专门用于处理图片上传，其他的事情一概不管</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Upload</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">protected</span> File img;</span><br><span class="line">     <span class="keyword">protected</span> String imgFileName;</span><br><span class="line">     <span class="keyword">protected</span> String imgContentType;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImg</span><span class="params">(File img)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.img = img;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImgFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgFileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgFileName</span><span class="params">(String imgFileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgFileName = imgFileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImgContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgContentType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgContentType</span><span class="params">(String imgContentType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgContentType = imgContentType;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-分页专用-Action4Pagination"><a class="header-anchor" href="#步骤-5-分页专用-Action4Pagination">¶</a>步骤 5 : 分页专用 Action4Pagination</h3>
<p>Action4Pagination 专门用于处理分页，并且继承[上传专用 Action4Upload]，这样就能又处理分页，又处理上传</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pagination</span> <span class="keyword">extends</span> <span class="title">Action4Upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Page page;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">getPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.page = page;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-对象和集合-Action4Pojo"><a class="header-anchor" href="#步骤-6-对象和集合-Action4Pojo">¶</a>步骤 6 : 对象和集合 Action4Pojo</h3>
<p>Action4Pojo用于提供实体对象以及实体对象集合的setter和getter.<br>
setter用于接收注入<br>
getter用于提供数据到JSP(VIEW)上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-注入服务专用-Action4Service"><a class="header-anchor" href="#步骤-7-注入服务专用-Action4Service">¶</a>步骤 7 : 注入服务专用 Action4Service</h3>
<p>Action4Service提供服务的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Service新加一个方法t2p"><a class="header-anchor" href="#步骤-8-Action4Service新加一个方法t2p">¶</a>步骤 8 : Action4Service新加一个方法t2p()</h3>
<p>我们观察CategoryAction的edit方法，里面有这么一个需求： 需要根据浏览器传递过来的分类id,去获取一个分类对象。<br>
目前的做法是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id = category.getId();</span><br><span class="line">    category = (Category) categoryService.get(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种需求在各个实体类的管理都是存在的，而这样的代码风格略显丑陋，所以在Action4Service新加一个方法t2p()，专门用于重构这个行为。<br>
重构结束之后，调用的方式就变成了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(category);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>t2p()代码解析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * transient to persistent</span></span><br><span class="line"><span class="comment"> * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = o.getClass();</span><br><span class="line">			<span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">			Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line">			String beanName = clazz.getSimpleName();</span><br><span class="line">			Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">			setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>首先获取瞬时对象的类对象</li>
<li>接着通过反射，调用这个瞬时对象的getId方法获取id</li>
<li>然后根据id，获取持久化对象</li>
<li>因为Action4Service继承了Action4Pojo,所以就提供了改持久对象对应的setXXX方法，在这个例子里就是setCategory方法，通过反射，把该持久对象设置在category引用上。</li>
<li>最后结果就导致父类Action4Pojo中声明的category本身是指向瞬时对象的，现在指向了持久对象。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id = category.getId();</span><br><span class="line">    category = (Category) categoryService.get(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(category);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-定义返回页面的-Action4Result"><a class="header-anchor" href="#步骤-9-定义返回页面的-Action4Result">¶</a>步骤 9 : 定义返回页面的 Action4Result</h3>
<p>Action4Result 专门进行返回页面的定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Result</span> <span class="keyword">extends</span> <span class="title">Action4Service</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-完整版的Action4Result"><a class="header-anchor" href="#步骤-10-完整版的Action4Result">¶</a>步骤 10 : 完整版的Action4Result</h3>
<p>观察[定义返回页面 Action4Result]可以发现，其作用无非就是映射某个字符串对应某个jsp页面。<br>
为了后续的学习更加顺畅，我这里把完整的Action4Result给出来，即里面包含了所有的返回页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*全局的*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"success.jsp"</span>, location=<span class="string">"/success.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"fail.jsp"</span>, location=<span class="string">"/fail.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">         </span><br><span class="line">            <span class="comment">/*属性管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProperty"</span>, location=<span class="string">"/admin/listProperty.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editProperty"</span>, location=<span class="string">"/admin/editProperty.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listPropertyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_property_list?category.id=$&#123;property.category.id&#125;"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*产品管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProduct"</span>, location=<span class="string">"/admin/listProduct.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editProduct"</span>, location=<span class="string">"/admin/editProduct.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_product_list?category.id=$&#123;product.category.id&#125;"</span>),</span><br><span class="line"> </span><br><span class="line">            <span class="comment">/*产品图片管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductImage"</span>, location=<span class="string">"/admin/listProductImage.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductImagePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_productImage_list?product.id=$&#123;productImage.product.id&#125;"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*属性值管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editPropertyValue"</span>, location=<span class="string">"/admin/editProductValue.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*用户管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listUser"</span>, location=<span class="string">"/admin/listUser.jsp"</span>),</span><br><span class="line"> </span><br><span class="line">            <span class="comment">/*订单管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listOrder"</span>, location=<span class="string">"/admin/listOrder.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listOrderPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_order_list"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*前台 服务端跳转*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"home.jsp"</span>, location=<span class="string">"/home.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"register.jsp"</span>, location=<span class="string">"/register.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"login.jsp"</span>, location=<span class="string">"/login.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"product.jsp"</span>, location=<span class="string">"/product.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"category.jsp"</span>, location=<span class="string">"/category.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"searchResult.jsp"</span>, location=<span class="string">"/searchResult.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"buy.jsp"</span>, location=<span class="string">"/buy.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"cart.jsp"</span>, location=<span class="string">"/cart.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"alipay.jsp"</span>, location=<span class="string">"/alipay.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"payed.jsp"</span>, location=<span class="string">"/payed.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"bought.jsp"</span>, location=<span class="string">"/bought.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"confirmPay.jsp"</span>, location=<span class="string">"/confirmPay.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"orderConfirmed.jsp"</span>, location=<span class="string">"/orderConfirmed.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"review.jsp"</span>, location=<span class="string">"/review.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*前台 客户端跳转*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"registerSuccessPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/registerSuccess.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"homePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forehome"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"buyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forebuy?oiids=$&#123;oiid&#125;"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"alipayPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forealipay?order.id=$&#123;order.id&#125;&amp;total=$&#123;total&#125;"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"reviewPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forereview?order.id=$&#123;order.id&#125;&amp;showonly=$&#123;showonly&#125;"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Result</span> <span class="keyword">extends</span> <span class="title">Action4Service</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-CategoryAction"><a class="header-anchor" href="#步骤-11-CategoryAction">¶</a>步骤 11 : CategoryAction</h3>
<p>CategoryAction 继承Action4Result, 于是就间接地继承了Action4Service，Action4Pojo，Action4Pagination，Action4Upload，于是就通过继承提供了各种相关的功能。<br>
CategoryAction 本身只需要专注于扮演控制器(Controller)本身就行了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = categoryService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        categorys = categoryService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategory"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.delete(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editCategory"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_category_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categoryService.update(category);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=img)&#123;</span><br><span class="line">            File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(<span class="string">"img/category"</span>));</span><br><span class="line">            File file = <span class="keyword">new</span> File(imageFolder,category.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyFile(img, file);</span><br><span class="line">                BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">                ImageIO.write(img, <span class="string">"jpg"</span>, file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                  </span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listCategoryPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-可运行项目"><a class="header-anchor" href="#步骤-12-可运行项目">¶</a>步骤 12 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以实现分类的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h2 id="6、项目重构总结"><a class="header-anchor" href="#6、项目重构总结">¶</a>6、项目重构总结</h2>
<h3 id="步骤-1-短期看复杂-长期看收益高"><a class="header-anchor" href="#步骤-1-短期看复杂-长期看收益高">¶</a>步骤 1 : 短期看复杂-长期看收益高</h3>
<p>重构的过程需要用到一些复杂的反射技术，抽象多层的父类，使得重构之后的代码，看上去比没有重构之前更加复杂了。</p>
<p>假如整个模仿天猫项目只有这么一个分类管理功能，那么重构行为是会显得画蛇添足，杀鸡用牛刀的。</p>
<p>但是本项目后续还有大量的后台管理以及前台功能开发，从长期来看，这些重构行为都会导致后续的开发更加快速，效率提高，并且更不容易犯错。</p>
<p>所以重构行为短期看复杂，长期看是一个收益很高的行为，在接下来的众多功能开发过程里，大家会越来越明显地感觉到这一点，请拭目以待。</p>
<h3 id="步骤-2-重构没有结束"><a class="header-anchor" href="#步骤-2-重构没有结束">¶</a>步骤 2 : 重构没有结束</h3>
<p>目前的重构是基于分类管理这么一个较为简单的功能上进行的。 还有更为精妙的重构行为需要建立在更为复杂的业务上，才可以清晰的阐明其原理和作用，比如[Service重构-关系]、[Service重构-多条件查询]和[Action重构-参数]。 所以本项目会进行持续的重构，在后续相关章节的学习就会展开相关的重构行为。</p>
<h1 id="九、后台-其他管理"><a class="header-anchor" href="#九、后台-其他管理">¶</a>九、后台-其他管理</h1>
<h2 id="1、后台其他页面"><a class="header-anchor" href="#1、后台其他页面">¶</a>1、后台其他页面</h2>
<p>在[后台-分类管理]里把设计思路，用到的设计模式，静态资源，JSP包含关系, 分页，增删改查典型操作等每个详细的操作都掰的很细了。同时对项目也进行了第一次的[重构] ， 后台的其他管理页面，比如产品管理，订单管理等大家就可以看到重构带来的效果，不仅如此，也会持续地进行重构，比如[Service重构-关系]和[Service重构-多条件查询]，这样对项目进行改进。<br>
因为有了一定基础了，所以每个管理模块放在一个知识点里讲解，这样大家学习起来更加紧凑。</p>
<h2 id="2、SERVICE重构-关系"><a class="header-anchor" href="#2、SERVICE重构-关系">¶</a>2、SERVICE重构-关系</h2>
<h3 id="步骤-1-PropertyService"><a class="header-anchor" href="#步骤-1-PropertyService">¶</a>步骤 1 : PropertyService</h3>
<p>观察PropertyService可以发现，其新增了关于基于父类关系的查询，比如根据分类查询属性集合。</p>
<p>可以预见这样类似的操作，在后续的功能开发里也很多，比如：<br>
根据分类查询产品集合<br>
根据产品查询评价集合<br>
根据用户查询订单集合<br>
总结起来，就是根据父类对象，查询子类对象的集合。</p>
<p>他们的操作都是很近似的，所以也有很大的空间进行重构，并且享受重构带来的价值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByCategory</span><span class="params">(Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page,Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span> <span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-BaseService"><a class="header-anchor" href="#步骤-2-BaseService">¶</a>步骤 2 : BaseService</h3>
<p>为BaseService新增加如下三种方法：<br>
根据父类查询所有子类对象(比如：查询某个分类下所有属性)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span></span>;</span><br></pre></td></tr></table></figure>
<p>根据父类分页查询子类对象(比如：查询某个分类下前5个属性)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List <span class="title">list</span><span class="params">(Page page, Object parent)</span></span>;</span><br></pre></td></tr></table></figure>
<p>根据父类查询子类对象数量(比如：查询分类下属性数量)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz,<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span></span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-BaseServiceImpl"><a class="header-anchor" href="#步骤-3-BaseServiceImpl">¶</a>步骤 3 : BaseServiceImpl</h3>
<p>因为BaseService中声明了新的方法，所以BaseServiceImpl都要提供对应的实现。<br>
每个新方法的实现都比较复杂，这里只是一览，接下来会对每个新方法做详细的讲解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">extends</span> <span class="title">ServiceDelegateDAO</span> <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) <span class="keyword">super</span>.save(object);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span> </span>&#123;</span><br><span class="line">        String parentName= parent.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span> </span>&#123;</span><br><span class="line">        String parentName= parent.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span> </span>&#123;</span><br><span class="line">        String parentName= parentObject.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">         </span><br><span class="line">        String sqlFormat = <span class="string">"select count(*) from %s bean where bean.%s = ?"</span>;</span><br><span class="line">        String hql = String.format(sqlFormat, clazz.getName(), parentNameWithFirstLetterLower);</span><br><span class="line">         </span><br><span class="line">        List&lt;Long&gt; l= <span class="keyword">this</span>.find(hql,parentObject);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-List-listByParent-Object-parent"><a class="header-anchor" href="#步骤-4-List-listByParent-Object-parent">¶</a>步骤 4 : List listByParent(Object parent);</h3>
<p>查询父类下的所有子类对象，以为分类和属性为例，就是查询某个分类下的所有属性。<br>
借助反射获取父类的类型名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String parentName= parent.getClass().getSimpleName();</span><br></pre></td></tr></table></figure>
<p>把第一个字母变成小写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br></pre></td></tr></table></figure>
<p>通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span> </span>&#123;</span><br><span class="line">    String parentName= parent.getClass().getSimpleName();</span><br><span class="line">    String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">    DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">    dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">    dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">    <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-list-Page-page-Object-parent"><a class="header-anchor" href="#步骤-5-list-Page-page-Object-parent">¶</a>步骤 5 : list(Page page, Object parent);</h3>
<p>以分页的方式查询父类下的子类对象集合，以为分类和属性为例，就是查询某个分类下前5个属性，或者第5个到第10个属性。<br>
借助反射获取父类的类型名称<br>
前面的代码和[List listByParent(Object parent);]是一样的，唯一在最后一句查询的时候，用上了Page对象的start和count属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span> </span>&#123;</span><br><span class="line">    String parentName= parent.getClass().getSimpleName();</span><br><span class="line">    String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">    DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">    dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">    dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">    <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-int-total-Object-parentObject"><a class="header-anchor" href="#步骤-6-int-total-Object-parentObject">¶</a>步骤 6 : int total(Object parentObject);</h3>
<p>基于父类对象查看其子类集合总数，这个在分页的时候需要用到。<br>
代码和BaseServiceImpl中的total()方法一样，只是利用反射，加上了父类限制条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String parentName= parentObject.getClass().getSimpleName();</span><br><span class="line">String parentNameWithFirstLetterLower = tringUtils.uncapitalize(parentName);</span><br><span class="line">String sqlFormat = <span class="string">"select count(*) from %s bean where bean.%s = ?"</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span> </span>&#123;</span><br><span class="line">    String parentName= parentObject.getClass().getSimpleName();</span><br><span class="line">    String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">     </span><br><span class="line">    String sqlFormat = <span class="string">"select count(*) from %s bean where bean.%s = ?"</span>;</span><br><span class="line">    String hql = String.format(sqlFormat, clazz.getName(), parentNameWithFirstLetterLower);</span><br><span class="line">     </span><br><span class="line">    List&lt;Long&gt; l= <span class="keyword">this</span>.find(hql,parentObject);</span><br><span class="line">    <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Long result= l.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> result.intValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-PropertyService"><a class="header-anchor" href="#步骤-7-PropertyService">¶</a>步骤 7 : PropertyService</h3>
<p>在[BaseService]新增了三个方法之后，PropertyService 仅仅需要继承BaseService即可，无需再做任何改动	package com.how2java.tmall.service;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-PropertyServiceImpl"><a class="header-anchor" href="#步骤-8-PropertyServiceImpl">¶</a>步骤 8 : PropertyServiceImpl</h3>
<p>在[BaseServiceImpl]类提供了相应的实现之后，PropertyServiceImpl 也是不需要做任何改动，仅仅继承BaseServiceImpl 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">PropertyService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-PropertyAction"><a class="header-anchor" href="#步骤-9-PropertyAction">¶</a>步骤 9 : PropertyAction</h3>
<p>PropertyAction无需做任何变化</p>
<h3 id="步骤-10-可运行项目"><a class="header-anchor" href="#步骤-10-可运行项目">¶</a>步骤 10 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以属性的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h2 id="3、属性管理-v3"><a class="header-anchor" href="#3、属性管理-v3">¶</a>3、属性管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v7"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v7">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v7"><a class="header-anchor" href="#步骤-2-模仿和排错-v7">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面截图"><a class="header-anchor" href="#步骤-3-页面截图">¶</a>步骤 3 : 页面截图</h3>
<p>重启tomcat,通过访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/tmall_ssh/admin_property_list?category.id=35</span><br></pre></td></tr></table></figure>
<p>可以看到属性管理的界面</p>
<p>注： 这category.id=35是分类的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4852.png" alt></p>
<h3 id="步骤-4-Property"><a class="header-anchor" href="#步骤-4-Property">¶</a>步骤 4 : Property</h3>
<p>准备Property 实体类，并用Hibernate注解标示其对应的表，字段等信息。值得留意的是，其中配置了和[Category类]的多对一关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"property"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Property</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Category category;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-PropertyService"><a class="header-anchor" href="#步骤-5-PropertyService">¶</a>步骤 5 : PropertyService</h3>
<p>接着是PropertyService接口，PropertyServic通过继承BaseService，提供了基本的CRUD，但是不足以对业务进行支撑。 因为业务上并不是查询所有的属性集合，而是查询某个分类对象下的属性集合，所以还要额外提供一下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">listByCategory</span><span class="params">(Category category)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page,Category category)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span> <span class="params">(Category category)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByCategory</span><span class="params">(Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page,Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span> <span class="params">(Category category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-PropertyServiceImpl"><a class="header-anchor" href="#步骤-6-PropertyServiceImpl">¶</a>步骤 6 : PropertyServiceImpl</h3>
<p>PropertyServiceImpl 继承了BaseServiceImpl ，同时实现了PropertyService 。 所以对[PropertyService]中额外声明的几种方法进行了实现。</p>
<p>如果对前面[项目重构]消化理解比较到位的同学，会隐隐约约地意识到，这个地方其实也有重构价值的。事实正是如此，对这部分重构，将放在[Service重构-关系]中进行专门讲解，本知识点就不展开了，而是集中精力放在如何完成属性管理模块本身。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">PropertyService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(<span class="string">"category"</span>, category));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);     </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Category category)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(<span class="string">"category"</span>, category));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        String sqlFormat = <span class="string">"select count(*) from %s bean where bean.category = ?"</span>;</span><br><span class="line">        String hql = String.format(sqlFormat, clazz.getName());</span><br><span class="line">         </span><br><span class="line">        List&lt;Long&gt; l= <span class="keyword">this</span>.find(hql,category);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-Action4Pojo"><a class="header-anchor" href="#步骤-7-Action4Pojo">¶</a>步骤 7 : Action4Pojo</h3>
<p>为Action4Pojo追加Property相关属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Service"><a class="header-anchor" href="#步骤-8-Action4Service">¶</a>步骤 8 : Action4Service</h3>
<p>为Action4Service追加对于PropertyService 的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-PropertyAction-v2"><a class="header-anchor" href="#步骤-9-PropertyAction-v2">¶</a>步骤 9 : PropertyAction</h3>
<p>PropertyAction提供对各个路径的映射。 每个方法的详细讲解将在接下来的步骤，一一展开。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_property_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = propertyService.total(category);</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br><span class="line">        propertys = propertyService.list(page,category);</span><br><span class="line">        t2p(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProperty"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_property_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        propertyService.save(property);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_property_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(property);</span><br><span class="line">        propertyService.delete(property);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_property_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(property);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editProperty"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_property_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        propertyService.update(property);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-listProperty-jsp-editProperty-jsp"><a class="header-anchor" href="#步骤-10-listProperty-jsp-editProperty-jsp">¶</a>步骤 10 : listProperty.jsp+editProperty.jsp</h3>
<p>然后是查询和编辑的jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function() &#123;</span><br><span class="line"> </span><br><span class="line">        $(<span class="string">"#addForm"</span>).submit(function() &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkEmpty(<span class="string">"name"</span>, <span class="string">"属性名称"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;属性管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_property_list?category.id=$&#123;category.id&#125;"&gt;$&#123;category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;属性管理&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table</span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;属性名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;propertys&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line"> </span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_property_edit?property.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">                            href=<span class="string">"admin_property_delete?property.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span>%&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">        &lt;div class="panel-heading"&gt;新增属性&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_property_add"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;属性名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"property.name"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;编辑属性&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_property_list?category.id=$&#123;property.category.id&#125;"&gt;$&#123;property.category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;编辑属性&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning editDiv"</span>&gt;</span><br><span class="line">        &lt;div class="panel-heading"&gt;编辑属性&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_property_update"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"editTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;属性名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"property.name"</span> value=<span class="string">"$&#123;property.name&#125;"</span></span><br><span class="line">                            type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                        &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.id"</span> value=<span class="string">"$&#123;property.id&#125;"</span>&gt;</span><br><span class="line">                        &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.category.id"</span> value=<span class="string">"$&#123;property.category.id&#125;"</span>&gt;</span><br><span class="line">                        &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-查询功能讲解"><a class="header-anchor" href="#步骤-11-查询功能讲解">¶</a>步骤 11 : 查询功能讲解</h3>
<p>查询访问的是_PropertyAction的list()方法</p>
<ol>
<li>
<p>判断是否有分页对象，如果没有创建一个新的Page对象。新的Page对象即代表第一个，本页有5条数据。</p>
</li>
<li>
<p>判断当前分类下一共有多少条数据</p>
</li>
<li>
<p>为分页对象设置总数</p>
</li>
<li>
<p>为分页对象设置参数，这个参数的用处在后面步骤会结合分页JSP讲解：[其他-分页]</p>
</li>
<li>
<p>根据分页对象和分类对象获取属性集合</p>
</li>
<li>
<p>让category引用从指向瞬时对象，变为指向持久对象。因为在后面步骤的[其他-面包屑导航]需要显示分类的名称。</p>
</li>
<li>
<p>在listProperty.jsp页面上使用c:forEach 遍历propertys集合，并显示</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4857.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"admin_property_list"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">        page = <span class="keyword">new</span> Page();</span><br><span class="line">    <span class="keyword">int</span> total = propertyService.total(category);</span><br><span class="line">    page.setTotal(total);</span><br><span class="line">    page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br><span class="line">    propertys = propertyService.list(page,category);</span><br><span class="line">    t2p(category);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProperty"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;propertys&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">"admin_property_edit?property.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">            href=<span class="string">"admin_property_delete?property.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-增加功能讲解"><a class="header-anchor" href="#步骤-12-增加功能讲解">¶</a>步骤 12 : 增加功能讲解</h3>
<ol>
<li>
<p>在listProperty.jsp页面提交数据的时候，除了提交属性名称，<a href="http://xn--property-570m61bm13mwo0g.category.id" target="_blank" rel="noopener">还会提交property.category.id</a></p>
</li>
<li>
<p>通过propertyService将Property对象插入到数据库</p>
</li>
<li>
<p>返回listPropertyPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_property_list,并带上分类的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listPropertyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_property_list?category.id=$&#123;property.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4858.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_property_add"</span>&gt;</span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;属性名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"property.name"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"admin_property_add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    propertyService.save(property);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-编辑功能讲解"><a class="header-anchor" href="#步骤-13-编辑功能讲解">¶</a>步骤 13 : 编辑功能讲解</h3>
<ol>
<li>在PropertyAction的edit方法中，通过t2p()方法，让property引用从指向瞬时对象，改为指向持久化对象。瞬时对象是Struts注入进来的，只有id，没有name,持久化对象就和数据库中的同步了，不仅有id,也有name.</li>
<li>服务端跳转到editProperty.jsp</li>
<li>在editProperty.jsp中显示属性名称</li>
<li><a href="http://xn--editProperty-1o9u.xn--jspproperty-218qw2mns2eu5ofs5q.xn--idproperty-ih7q.category.id" target="_blank" rel="noopener">在editProperty.jsp中隐式提供property.id和property.category.id</a></li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.id"</span> value=<span class="string">"$&#123;property.id&#125;"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.category.id"</span> value=<span class="string">"$&#123;property.category.id&#125;"</span>&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4859.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(property);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editProperty"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_property_update"</span>&gt;</span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"editTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;属性名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"property.name"</span> value=<span class="string">"$&#123;property.name&#125;"</span></span><br><span class="line">                type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.id"</span> value=<span class="string">"$&#123;property.id&#125;"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"property.category.id"</span> value=<span class="string">"$&#123;property.category.id&#125;"</span>&gt;</span><br><span class="line">            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-修改功能讲解"><a class="header-anchor" href="#步骤-14-修改功能讲解">¶</a>步骤 14 : 修改功能讲解</h3>
<ol>
<li>
<p>在PropertyAction的update方法中通过propertyService更新property对象</p>
</li>
<li>
<p>返回listPropertyPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_property_list,并带上分类的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listPropertyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_property_list?category.id=$&#123;property.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4860.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    propertyService.update(property);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-删除功能讲解"><a class="header-anchor" href="#步骤-15-删除功能讲解">¶</a>步骤 15 : 删除功能讲解</h3>
<ol>
<li>
<p>在PropertyAction的delete方法中通过t2p把property转换为持久化对象，为什么要做这个行为呢？ 因为在[查询功能讲解]里的删除按钮，只传递了property.id过来，但是删除结束之后，要跳转到property对应的分类下的属性查询界面，所以需要通过t2p()方法把其对应的分类信息查询出来。</p>
</li>
<li>
<p>借助propertyService删除这个对象</p>
</li>
<li>
<p>返回listPropertyPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_property_list,并带上分类的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listPropertyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_property_list?category.id=$&#123;property.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4861.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(property);</span><br><span class="line">    propertyService.delete(property);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listPropertyPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-其他-面包屑导航"><a class="header-anchor" href="#步骤-16-其他-面包屑导航">¶</a>步骤 16 : 其他-面包屑导航</h3>
<p>在属性管理页面的页头，有一个面包屑导航<br>
第一个连接跳转到admin_category_list<br>
第二个连接跳转到admin_property_list?category.id=</p>
<p>样式用的是[Bootstrap面包屑导航]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4862.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href="admin_property_list?category.id=$&#123;category.id&#125;"&gt;$&#123;category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li class="active"&gt;属性管理&lt;/li&gt;</span><br><span class="line">&lt;/ol&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-其他-分页"><a class="header-anchor" href="#步骤-17-其他-分页">¶</a>步骤 17 : 其他-分页</h3>
<p>这里的分页比起[分类管理中的分页]<a href="http://xn--category-z09lrnu7ar37b9lqlx4b.id" target="_blank" rel="noopener">多了一个参数category.id</a></p>
<ol>
<li>在PropertyAction.list() 方法中有一段代码：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br></pre></td></tr></table></figure>
<p>就是用在这里的</p>
<ol start="2">
<li>在adminPage.jsp页面中通过${page.param}取出这个参数</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4863.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"ul.pagination li.disabled a"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"pagination"</span>&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=0$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;«&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasPreviouse&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a  href=<span class="string">"?page.start=$&#123;page.start-page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Previous"</span> &gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;‹&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;   </span><br><span class="line"> </span><br><span class="line">    &lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"$&#123;page.totalPage-1&#125;"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">     </span><br><span class="line">            &lt;li &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">                &lt;a </span><br><span class="line">                href=<span class="string">"?page.start=$&#123;status.index*page.count&#125;$&#123;page.param&#125;"</span></span><br><span class="line">                &lt;c:if test="$&#123;status.index*page.count==page.start&#125;"&gt;class="current"&lt;/c:if&gt;</span><br><span class="line">                &gt;$&#123;status.count&#125;&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.start+page.count&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;›&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li &lt;c:if test="$&#123;!page.hasNext&#125;"&gt;class="disabled"&lt;/c:if&gt;&gt;</span><br><span class="line">      &lt;a href=<span class="string">"?page.start=$&#123;page.last&#125;$&#123;page.param&#125;"</span> aria-label=<span class="string">"Next"</span>&gt;</span><br><span class="line">        &lt;span aria-hidden="true"&gt;»&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h2 id="4、产品管理-v3"><a class="header-anchor" href="#4、产品管理-v3">¶</a>4、产品管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v8"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v8">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-页面截图"><a class="header-anchor" href="#步骤-2-页面截图">¶</a>步骤 2 : 页面截图</h3>
<p>重启tomcat,通过访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/admin_product_list?category.id=35</span><br></pre></td></tr></table></figure>
<p>可以看到产品管理的界面<br>
<strong>注：</strong> 这category.id=35是分类的id，根据你的实际运行情况，采取不同的id值<br>
<strong>注：</strong> 看不到产品缩略图很正常，产品图片在后续[产品图片管理]开发之后才可以看到</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4866.png" alt></p>
<h3 id="步骤-3-模仿和排错"><a class="header-anchor" href="#步骤-3-模仿和排错">¶</a>步骤 3 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-4-Product"><a class="header-anchor" href="#步骤-4-Product">¶</a>步骤 4 : Product</h3>
<p>准备Product 实体类，并用Hibernate注解标示其对应的表，字段等信息。值得留意的是，其中配置了和[Category类]的多对一关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"product"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Category category;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> originalPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> promotePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stock;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSubTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubTitle</span><span class="params">(String subTitle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subTitle = subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getOriginalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOriginalPrice</span><span class="params">(<span class="keyword">float</span> originalPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.originalPrice = originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPromotePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPromotePrice</span><span class="params">(<span class="keyword">float</span> promotePrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.promotePrice = promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStock</span><span class="params">(<span class="keyword">int</span> stock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stock = stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ProductService"><a class="header-anchor" href="#步骤-5-ProductService">¶</a>步骤 5 : ProductService</h3>
<p>ProductService, 到这里，前面辛辛苦苦重构行为的<strong>威力</strong>就开始显现出来了。 新开发产品管理所需要的ProductService 接口，仅仅需要继承 BaseService 就行了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-ProductServiceImpl"><a class="header-anchor" href="#步骤-6-ProductServiceImpl">¶</a>步骤 6 : ProductServiceImpl</h3>
<p>ProductServiceImpl, 到这里，前面辛辛苦苦重构行为的<strong>威力</strong>就开始显现出来了。 新开发产品管理所需要的ProductService 接口，仅仅需要继承 BaseServiceImpl 并实现ProductService 接口就行了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-Action4Pojo-v2"><a class="header-anchor" href="#步骤-7-Action4Pojo-v2">¶</a>步骤 7 : Action4Pojo</h3>
<p>增加Product的实体类和集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Service-v2"><a class="header-anchor" href="#步骤-8-Action4Service-v2">¶</a>步骤 8 : Action4Service</h3>
<p>增加productService的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-ProductAction"><a class="header-anchor" href="#步骤-9-ProductAction">¶</a>步骤 9 : ProductAction</h3>
<p>ProductAction类提供对各个路径的映射。 每个方法的详细讲解将在接下来的步骤，一一展开。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = productService.total(category);</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br><span class="line">        products = productService.list(page,category);</span><br><span class="line">        t2p(category);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        productService.save(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">        productService.delete(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Product productFromDB= (Product)productService.get(product.getId());</span><br><span class="line">        product.setCreateDate(productFromDB.getCreateDate());</span><br><span class="line">         </span><br><span class="line">        productService.update(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-listProduct-jsp-editProduct-jsp"><a class="header-anchor" href="#步骤-10-listProduct-jsp-editProduct-jsp">¶</a>步骤 10 : listProduct.jsp+editProduct.jsp</h3>
<p>然后是查询和编辑的jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function() &#123;</span><br><span class="line">        $(<span class="string">"#addForm"</span>).submit(function() &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkEmpty(<span class="string">"name"</span>, <span class="string">"产品名称"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkEmpty(<span class="string">"subTitle"</span>, <span class="string">"小标题"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkNumber(<span class="string">"originalPrice"</span>, <span class="string">"原价格"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkNumber(<span class="string">"promotePrice"</span>, <span class="string">"优惠价格"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkInt(<span class="string">"stock"</span>, <span class="string">"库存"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;产品管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_product_list?category.id=$&#123;category.id&#125;"&gt;$&#123;category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;产品管理&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table</span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品小标题&lt;/th&gt;</span><br><span class="line">                    &lt;th width="53px"&gt;原价格&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;优惠价格&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;库存数量&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;图片管理&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;设置属性&lt;/th&gt;</span><br><span class="line">                    &lt;th width="42px"&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th width="42px"&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;%--</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty p.firstProductImage&#125;"</span>&gt;</span><br><span class="line">                            &lt;img width=<span class="string">"40px"</span> src=<span class="string">"img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                         --%&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.subTitle&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.originalPrice&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.promotePrice&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.stock&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_productImage_list?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-picture"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_propertyValue_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_product_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">                            href=<span class="string">"admin_product_delete?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span>%&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">        &lt;div class="panel-heading"&gt;新增产品&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_product_add"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"product.name"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品小标题&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"subTitle"</span> name=<span class="string">"product.subTitle"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;原价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"originalPrice"</span> value=<span class="string">"99.98"</span> name=<span class="string">"product.originalPrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;优惠价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"promotePrice"</span>  value=<span class="string">"19.98"</span> name=<span class="string">"product.promotePrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;库存&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"stock"</span>  value=<span class="string">"99"</span> name=<span class="string">"product.stock"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;编辑产品&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function() &#123;</span><br><span class="line">    $(<span class="string">"#editForm"</span>).submit(function() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!checkEmpty(<span class="string">"name"</span>, <span class="string">"产品名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkEmpty(<span class="string">"subTitle"</span>, <span class="string">"小标题"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!checkNumber(<span class="string">"originalPrice"</span>, <span class="string">"原价格"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!checkNumber(<span class="string">"promotePrice"</span>, <span class="string">"优惠价格"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!checkInt(<span class="string">"stock"</span>, <span class="string">"库存"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_product_list?category.id=$&#123;product.category.id&#125;"&gt;$&#123;product.category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;$&#123;product.name&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;编辑产品&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning editDiv"</span>&gt;</span><br><span class="line">        &lt;div class="panel-heading"&gt;编辑产品&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"editForm"</span> action=<span class="string">"admin_product_update"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"editTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"product.name"</span> value=<span class="string">"$&#123;product.name&#125;"</span></span><br><span class="line">                            type="text" class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品小标题&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"subTitle"</span> name=<span class="string">"product.subTitle"</span> type=<span class="string">"text"</span></span><br><span class="line">                        value=<span class="string">"$&#123;product.subTitle&#125;"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;原价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"originalPrice"</span> value=<span class="string">"$&#123;product.originalPrice&#125;"</span> name=<span class="string">"product.originalPrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;优惠价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"promotePrice"</span>  value=<span class="string">"$&#123;product.promotePrice&#125;"</span> name=<span class="string">"product.promotePrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;库存&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"stock"</span>  value=<span class="string">"$&#123;product.stock&#125;"</span> name=<span class="string">"product.stock"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                                         </span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                        &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">                        &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;product.category.id&#125;"</span>&gt;</span><br><span class="line">                        &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-查询功能讲解-v2"><a class="header-anchor" href="#步骤-11-查询功能讲解-v2">¶</a>步骤 11 : 查询功能讲解</h3>
<p>查询访问ProductAction的list()方法</p>
<ol>
<li>判断是否有分页对象，如果没有创建一个新的Page对象。新的Page对象即代表第一个，本页有5条数据。</li>
<li>判断当前分类下一共有多少条数据</li>
<li>为分页对象设置总数</li>
<li>为分页对象设置参数</li>
<li>根据分页对象和分类对象获取产品集合</li>
<li>让category引用从指向瞬时对象，变为指向持久对象。因为在面包屑导航需要显示分类的名称。</li>
<li>在listProduct.jsp页面上使用c:forEach 遍历products集合，并显示</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4871.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">        page = <span class="keyword">new</span> Page();</span><br><span class="line">    <span class="keyword">int</span> total = productService.total(category);</span><br><span class="line">    page.setTotal(total);</span><br><span class="line">    page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br><span class="line">    products = productService.list(page,category);</span><br><span class="line">    t2p(category);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProduct"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.subTitle&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.originalPrice&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.promotePrice&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;p.stock&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">"admin_productImage_list?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="glyphicon glyphicon-picture"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">"admin_propertyValue_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">"admin_product_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">            href=<span class="string">"admin_product_delete?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-增加功能讲解-v2"><a class="header-anchor" href="#步骤-12-增加功能讲解-v2">¶</a>步骤 12 : 增加功能讲解</h3>
<ol>
<li>
<p>在listProduct.jsp页面提交数据的时候，除了提交产品名称，小标题，原价格，优惠价格，<a href="http://xn--product-mw4kh8a482muhxg.category.id" target="_blank" rel="noopener">还会提交product.category.id</a></p>
</li>
<li>
<p>为产品设置创建时间</p>
</li>
<li>
<p>通过productService将Product对象插入到数据库</p>
</li>
<li>
<p>返回listProductPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_product_list,并带上分类的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listProductPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_product_list?category.id=$&#123;product.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4872.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_product_add"</span>&gt;</span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;产品名称&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"product.name"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;产品小标题&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"subTitle"</span> name=<span class="string">"product.subTitle"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;原价格&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"originalPrice"</span> value=<span class="string">"99.98"</span> name=<span class="string">"product.originalPrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;优惠价格&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"promotePrice"</span>  value=<span class="string">"19.98"</span> name=<span class="string">"product.promotePrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;库存&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input id=<span class="string">"stock"</span>  value=<span class="string">"99"</span> name=<span class="string">"product.stock"</span> type=<span class="string">"text"</span></span><br><span class="line">                class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    product.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">    productService.save(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-编辑功能讲解-v2"><a class="header-anchor" href="#步骤-13-编辑功能讲解-v2">¶</a>步骤 13 : 编辑功能讲解</h3>
<ol>
<li>在ProductAction的edit方法中，通过t2p()方法，让Product引用从指向瞬时对象，改为指向持久化对象。瞬时对象是Struts注入进来的，只有id，没有其他字段,持久化对象就和数据库中的同步了，不仅有id,也有name和其他字段.</li>
<li>服务端跳转到editProduct.jsp</li>
<li>在editProduct.jsp中显示产品名称等信息</li>
<li><a href="http://xn--editProduct-7k1t.xn--jspproduct-xt2pi1lmr0e25n7s3p.xn--idproduct-rw9o.category.id" target="_blank" rel="noopener">在editProduct.jsp中隐式提供product.id和product.category.id</a></li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;product.category.id&#125;"</span>&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4873.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editProduct"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;product.category.id&#125;"</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-修改功能讲解-v2"><a class="header-anchor" href="#步骤-14-修改功能讲解-v2">¶</a>步骤 14 : 修改功能讲解</h3>
<ol>
<li>首先根据浏览器传递过来的id，到数据库中把对象查询出来。 查询出来的目的是获取创建时间，因为这个创建时间并没有从页面上提交过来，如果不处理，那么日期信息就丢失了。</li>
<li>将日期信息设置在product对象上</li>
<li>通过ProductService更新product对象</li>
<li>返回listProductPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_product_list,并带上分类的id。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listProductPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_product_list?category.id=$&#123;product.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4874.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Product productFromDB= (Product)productService.get(product.getId());</span><br><span class="line">    product.setCreateDate(productFromDB.getCreateDate());</span><br><span class="line">     </span><br><span class="line">    productService.update(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-删除功能讲解-v2"><a class="header-anchor" href="#步骤-15-删除功能讲解-v2">¶</a>步骤 15 : 删除功能讲解</h3>
<ol>
<li>
<p>在ProductAction的delete方法中通过t2p把product转换为持久化对象，为什么要做这个行为呢？ 因为在[查询功能讲解]里的删除按钮，只传递了product.id过来，但是删除结束之后，要跳转到Product对应的分类下的产品查询界面，所以需要通过t2p()方法把其对应的分类信息查询出来。</p>
</li>
<li>
<p>借助ProductService删除这个对象</p>
</li>
<li>
<p>返回listProductPage，在[完整版的Action4Result]中，会导致客户端跳转到admin_product_list,并带上分类的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listProductPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_product_list?category.id=$&#123;product.category.id&#125;"</span>),</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4875.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(product);</span><br><span class="line">    productService.delete(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5、产品图片管理-v3"><a class="header-anchor" href="#5、产品图片管理-v3">¶</a>5、产品图片管理</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v9"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v9">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-效果截图"><a class="header-anchor" href="#步骤-2-效果截图">¶</a>步骤 2 : 效果截图</h3>
<p>重启tomcat,通过访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/admin_productImage_list?product.id=2</span><br></pre></td></tr></table></figure>
<p>可以看到产品图片管理的界面<br>
<strong>注：</strong> 这product.id=2是产品的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4878.png" alt></p>
<h3 id="步骤-3-模仿和排错-v2"><a class="header-anchor" href="#步骤-3-模仿和排错-v2">¶</a>步骤 3 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-4-ProductImage"><a class="header-anchor" href="#步骤-4-ProductImage">¶</a>步骤 4 : ProductImage</h3>
<p>准备ProductImage实体类，并用Hibernate注解标示其对应的表，字段等信息。值得留意的是，其中配置了和 [Product] 的多对一关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"productImage"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImage</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"pid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-Product"><a class="header-anchor" href="#步骤-5-Product">¶</a>步骤 5 : Product</h3>
<p>现在有了[ProductImage]，就可以解决产品查询界面看不到缩略图的问题了。<br>
为Product新增一个firstProductImage属性。<br>
这个属性被注解为@Transient，即表示这个字段并不会被保存到数据库中，是一个瞬时字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"product"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Category category;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> originalPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> promotePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stock;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> ProductImage firstProductImage;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSubTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubTitle</span><span class="params">(String subTitle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subTitle = subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getOriginalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOriginalPrice</span><span class="params">(<span class="keyword">float</span> originalPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.originalPrice = originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPromotePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPromotePrice</span><span class="params">(<span class="keyword">float</span> promotePrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.promotePrice = promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStock</span><span class="params">(<span class="keyword">int</span> stock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stock = stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getFirstProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> firstProductImage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProductImage</span><span class="params">(ProductImage firstProductImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstProductImage = firstProductImage;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-ProductImageService"><a class="header-anchor" href="#步骤-6-ProductImageService">¶</a>步骤 6 : ProductImageService</h3>
<p>ProductImageService继承BaseService ，除此之外还提供了两个常量，用于表示图片类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_single = <span class="string">"type_single"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_detail = <span class="string">"type_detail"</span>;</span><br></pre></td></tr></table></figure>
<p>还有两个方法，这两个方法接下来的[ProductImageServiceImpl]中会详细讲解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>;	</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductImageService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_single = <span class="string">"type_single"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_detail = <span class="string">"type_detail"</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-ProductImageServiceImpl"><a class="header-anchor" href="#步骤-7-ProductImageServiceImpl">¶</a>步骤 7 : ProductImageServiceImpl</h3>
<p>ProductImageServiceImpl 继承了BaseServiceImpl 并实现了ProductImageService 接口。</p>
<p>通过继承BaseServiceImpl 得到了一系列的CRUD方法。<br>
在实现ProductImageService 接口后，还需要提供两个方法setFirstProdutImage(Product product)和list(String key_product, Product product, String key_type, String type)。</p>
<p>list(String key_product, Product product, String key_type, String type)的作用是：<br>
查询某个产品下的，某种类型的图片。</p>
<p>setFirstProdutImage方法的作用是：</p>
<ol>
<li>
<p>查询出某个产品下的类型是type_single的图片集合</p>
</li>
<li>
<p>如果这个集合不为空，那么取出其中的第一个图片，作为这个产品的图片：firstProdutImage.</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImageServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductImageService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=product.getFirstProductImage())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        List&lt;ProductImage&gt; pis= list(<span class="string">"product"</span>, product, <span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        <span class="keyword">if</span>(!pis.isEmpty())</span><br><span class="line">            product.setFirstProductImage(pis.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(key_product, product));</span><br><span class="line">        dc.add(Restrictions.eq(key_type, type));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Pojo"><a class="header-anchor" href="#步骤-8-Action4Pojo">¶</a>步骤 8 : Action4Pojo</h3>
<p>与以往在Action4Pojo中添加一个实体类集合不一样，这里添加了两个集合，分别是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line"><span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br></pre></td></tr></table></figure>
<p>因为在页面上显示的时候，左边和右边分别显示的是不同的产品图片集合。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5260.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">    <span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-Action4Service"><a class="header-anchor" href="#步骤-9-Action4Service">¶</a>步骤 9 : Action4Service</h3>
<p>为Action4Service添加productImageService的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-ProductImageAction"><a class="header-anchor" href="#步骤-10-ProductImageAction">¶</a>步骤 10 : ProductImageAction</h3>
<p>ProductImageAction类提供对各个路径的映射。 每个方法的详细讲解将在接下来的步骤，一一展开。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.ImageUtil;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImageAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_productImage_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        t2p(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductImage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_productImage_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        productImageService.save(productImage);</span><br><span class="line">         </span><br><span class="line">        String folder = <span class="string">"img/"</span>;</span><br><span class="line">        <span class="keyword">if</span>(ProductImageService.type_single.equals(productImage.getType()))&#123;</span><br><span class="line">            folder +=<span class="string">"productSingle"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            folder +=<span class="string">"productDetail"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">             </span><br><span class="line">        File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(folder));</span><br><span class="line">        File file = <span class="keyword">new</span> File(imageFolder,productImage.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">        String fileName = file.getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(img, file);</span><br><span class="line">            BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">            ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">             </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(ProductImageService.type_single.equals(productImage.getType()))&#123;</span><br><span class="line">            String imageFolder_small= ServletActionContext.getServletContext().getRealPath(<span class="string">"img/productSingle_small"</span>);</span><br><span class="line">            String imageFolder_middle= ServletActionContext.getServletContext().getRealPath(<span class="string">"img/productSingle_middle"</span>);       </span><br><span class="line">             </span><br><span class="line">            File f_small = <span class="keyword">new</span> File(imageFolder_small, fileName);</span><br><span class="line">            File f_middle = <span class="keyword">new</span> File(imageFolder_middle, fileName);</span><br><span class="line"> </span><br><span class="line">            f_small.getParentFile().mkdirs();</span><br><span class="line">            f_middle.getParentFile().mkdirs();</span><br><span class="line">             </span><br><span class="line">            ImageUtil.resizeImage(file, <span class="number">56</span>, <span class="number">56</span>, f_small);</span><br><span class="line">            ImageUtil.resizeImage(file, <span class="number">217</span>, <span class="number">190</span>, f_middle);</span><br><span class="line">        &#125;      </span><br><span class="line">                 </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductImagePage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_productImage_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(productImage);</span><br><span class="line">        productService.delete(productImage);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductImagePage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-listProductImage-jsp"><a class="header-anchor" href="#步骤-11-listProductImage-jsp">¶</a>步骤 11 : listProductImage.jsp</h3>
<p>增加listProductImage.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">".addFormSingle"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(checkEmpty(<span class="string">"filepathSingle"</span>,<span class="string">"图片文件"</span>))&#123;</span><br><span class="line">            $(<span class="string">"#filepathSingle"</span>).value(<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".addFormDetail"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(checkEmpty(<span class="string">"filepathDetail"</span>,<span class="string">"图片文件"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;产品图片管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">        &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href="admin_product_list?category.id=$&#123;product.category.id&#125;"&gt;$&#123;product.category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li class="active"&gt;$&#123;product.name&#125;&lt;/li&gt;</span><br><span class="line">          &lt;li class="active"&gt;产品图片管理&lt;/li&gt;</span><br><span class="line">        &lt;/ol&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addPictureTable"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"addPictureTableTD"</span>&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addPictureDiv"</span>&gt;</span><br><span class="line">                    &lt;div class="panel-heading"&gt;新增产品&lt;b class="text-primary"&gt; 单个 &lt;/b&gt;图片&lt;/div&gt;</span><br><span class="line">                      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">                            &lt;form method=<span class="string">"post"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"addFormSingle"</span> action=<span class="string">"admin_productImage_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                                    &lt;tr&gt;</span><br><span class="line">                                        &lt;td&gt;请选择本地图片 尺寸400X400 为佳&lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                    &lt;tr&gt;</span><br><span class="line">                                        &lt;td&gt;</span><br><span class="line">                                            &lt;input id=<span class="string">"filepathSingle"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                                        &lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                                        &lt;td align=<span class="string">"center"</span>&gt;</span><br><span class="line">                                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.type"</span> value=<span class="string">"type_single"</span> /&gt;</span><br><span class="line">                                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span> /&gt;</span><br><span class="line">                                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                                        &lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                &lt;/table&gt;</span><br><span class="line">                            &lt;/form&gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;           </span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">                    &lt;thead&gt;</span><br><span class="line">                        &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                            &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                            &lt;th&gt;产品单个图片缩略图&lt;/th&gt;</span><br><span class="line">                            &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    &lt;/thead&gt;</span><br><span class="line">                    &lt;tbody&gt;</span><br><span class="line">                        &lt;c:forEach items=<span class="string">"$&#123;productSingleImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">                            &lt;tr&gt;</span><br><span class="line">                                &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt;</span><br><span class="line">                                &lt;td&gt;</span><br><span class="line">                                &lt;a title="点击查看原图" href="img/productSingle/$&#123;pi.id&#125;.jpg"&gt;&lt;img height="50px" src="img/productSingle/$&#123;pi.id&#125;.jpg"&gt;&lt;/a&gt; </span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                                &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">                                    href=<span class="string">"admin_productImage_delete?productImage.id=$&#123;pi.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                        class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">         </span><br><span class="line">                            &lt;/tr&gt;</span><br><span class="line">                        &lt;/c:forEach&gt;</span><br><span class="line">                    &lt;/tbody&gt;   </span><br><span class="line">                &lt;/table&gt; </span><br><span class="line">                         </span><br><span class="line">              &lt;/div&gt;         </span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"addPictureTableTD"</span>&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addPictureDiv"</span>&gt;</span><br><span class="line">                    &lt;div class="panel-heading"&gt;新增产品&lt;b class="text-primary"&gt; 详情 &lt;/b&gt;图片&lt;/div&gt;</span><br><span class="line">                      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">                            &lt;form method=<span class="string">"post"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"addFormDetail"</span> action=<span class="string">"admin_productImage_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                                    &lt;tr&gt;</span><br><span class="line">                                        &lt;td&gt;请选择本地图片 宽度790  为佳&lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                    &lt;tr&gt;</span><br><span class="line">                                        &lt;td&gt;</span><br><span class="line">                                            &lt;input id=<span class="string">"filepathDetail"</span>  type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">                                        &lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                                        &lt;td align=<span class="string">"center"</span>&gt;</span><br><span class="line">                                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.type"</span> value=<span class="string">"type_detail"</span> /&gt;</span><br><span class="line">                                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span> /&gt;                                         </span><br><span class="line">                                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                                        &lt;/td&gt;</span><br><span class="line">                                    &lt;/tr&gt;</span><br><span class="line">                                &lt;/table&gt;</span><br><span class="line">                            &lt;/form&gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">                        &lt;thead&gt;</span><br><span class="line">                            &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                                &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                                &lt;th&gt;产品详情图片缩略图&lt;/th&gt;</span><br><span class="line">                                &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">                            &lt;/tr&gt;</span><br><span class="line">                        &lt;/thead&gt;</span><br><span class="line">                        &lt;tbody&gt;</span><br><span class="line">                            &lt;c:forEach items=<span class="string">"$&#123;productDetailImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">                                &lt;tr&gt;</span><br><span class="line">                                    &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt;</span><br><span class="line">                                    &lt;td&gt;</span><br><span class="line">                                        &lt;a title="点击查看原图" href="img/productDetail/$&#123;pi.id&#125;.jpg"&gt;&lt;img height="50px" src="img/productDetail/$&#123;pi.id&#125;.jpg"&gt;&lt;/a&gt;</span><br><span class="line">                                    &lt;/td&gt;</span><br><span class="line">                                    &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">                                        href=<span class="string">"admin_productImage_delete?productImage.id=$&#123;pi.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                            class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">             </span><br><span class="line">                                &lt;/tr&gt;</span><br><span class="line">                            &lt;/c:forEach&gt;</span><br><span class="line">                        &lt;/tbody&gt;   </span><br><span class="line">                    &lt;/table&gt;                         </span><br><span class="line">              &lt;/div&gt;         </span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-查询功能讲解"><a class="header-anchor" href="#步骤-12-查询功能讲解">¶</a>步骤 12 : 查询功能讲解</h3>
<p>通过产品页面的图片管理访问ProductImageAction的list()方法</p>
<ol>
<li>根据product和类型type_single获取productSingleImages集合</li>
<li>根据product和类型type_detail 获取productDetailImages集合</li>
<li>持久化product，以便于在面包屑导航上显示产品信息和分类连接</li>
<li>服务端跳转到listProductImage.jsp页面</li>
<li>在listProductImage.jsp，使用c:forEach 遍历pisSingle</li>
<li>在listProductImage.jsp，使用c:forEach 遍历pisDetail</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4882.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">    productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">    t2p(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductImage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;productSingleImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">        &lt;a title="点击查看原图" href="img/productSingle/$&#123;pi.id&#125;.jpg"&gt;&lt;img height="50px" src="img/productSingle/$&#123;pi.id&#125;.jpg"&gt;&lt;/a&gt; </span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">            href=<span class="string">"admin_productImage_delete?productImage.id=$&#123;pi.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;productDetailImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &lt;a title="点击查看原图" href="img/productDetail/$&#123;pi.id&#125;.jpg"&gt;&lt;img height="50px" src="img/productDetail/$&#123;pi.id&#125;.jpg"&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">            href=<span class="string">"admin_productImage_delete?productImage.id=$&#123;pi.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-增加功能讲解"><a class="header-anchor" href="#步骤-13-增加功能讲解">¶</a>步骤 13 : 增加功能讲解</h3>
<p>增加产品图片分单个和详情两种，其区别在于增加时提交的type类型不一样。<br>
这里就对单个的进行讲解，详情图片的处理同理。<br>
首先， 在listProductImage.jsp准备一个form，提交到admin_productImage_add</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"addFormSingle"</span> action=<span class="string">"admin_productImage_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>接着在ProductImageAction的add()方法中进行处理</p>
<ol>
<li>把productImage对象插入到数据库</li>
<li>根据productImage的type字段值，确定文件存放的目录名称</li>
<li>根据ServletActionContext.getServletContext().getRealPath(folder) 定位硬盘上的真正位置</li>
<li>根据插入到数据库之后，productImage的id，确定文件名称，并结合第2条的目录位置，确定文件的绝对路径</li>
<li>因为ProductAction间接地继承了[上传专用 Action4Upload]类，所以提供了一个img对象以接受上传的文件，不过这个img是一个临时文件，通过FileUtils.copyFile把这个临时文件复制到第4条描述的文件绝对路径。</li>
<li>通过[ImageUtil]确保图片的真正格式是jpg.</li>
<li>如果图片的类型是type_single,借助[ImageUtil.resizeImage]把正常大小的图片，改变大小之后，分别复制到productSingle_middle和productSingle_small目录下。</li>
<li>最后，返回listProductImagePage，在[完整版的Action4Result]中，会导致客户端跳转到admin_productImage_list,并带上产品的id。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listProductImagePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_productImage_list?product.id=$&#123;productImage.product.id&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>详情图片做的是一样的事情，区别在于复制到目录productDetail下，并且不需要改变大小。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4883.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"addFormSingle"</span> action=<span class="string">"admin_productImage_add"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;请选择本地图片 尺寸400X400 为佳&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;input id=<span class="string">"filepathSingle"</span> type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">            &lt;td align=<span class="string">"center"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.type"</span> value=<span class="string">"type_single"</span> /&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"productImage.product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span> /&gt;</span><br><span class="line">                &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    productImageService.save(productImage);</span><br><span class="line">    String folder = <span class="string">"img/"</span>;</span><br><span class="line">    <span class="keyword">if</span>(ProductImageService.type_single.equals(productImage.getType()))&#123;</span><br><span class="line">        folder +=<span class="string">"productSingle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        folder +=<span class="string">"productDetail"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    File  imageFolder= <span class="keyword">new</span> File(ServletActionContext.getServletContext().getRealPath(folder));</span><br><span class="line">    File file = <span class="keyword">new</span> File(imageFolder,productImage.getId()+<span class="string">".jpg"</span>);</span><br><span class="line">    String fileName = file.getName();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        FileUtils.copyFile(img, file);</span><br><span class="line">        BufferedImage img = ImageUtil.change2jpg(file);</span><br><span class="line">        ImageIO.write(img, <span class="string">"jpg"</span>, file);           </span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(ProductImageService.type_single.equals(productImage.getType()))&#123;</span><br><span class="line">        String imageFolder_small= ServletActionContext.getServletContext().getRealPath(<span class="string">"img/productSingle_small"</span>);</span><br><span class="line">        String imageFolder_middle= ServletActionContext.getServletContext().getRealPath(<span class="string">"img/productSingle_middle"</span>);       </span><br><span class="line">        File f_small = <span class="keyword">new</span> File(imageFolder_small, fileName);</span><br><span class="line">        File f_middle = <span class="keyword">new</span> File(imageFolder_middle, fileName);</span><br><span class="line">        f_small.getParentFile().mkdirs();</span><br><span class="line">        f_middle.getParentFile().mkdirs();</span><br><span class="line">        ImageUtil.resizeImage(file, <span class="number">56</span>, <span class="number">56</span>, f_small);</span><br><span class="line">        ImageUtil.resizeImage(file, <span class="number">217</span>, <span class="number">190</span>, f_middle);</span><br><span class="line">    &#125;      </span><br><span class="line">             </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductImagePage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-删除功能讲解"><a class="header-anchor" href="#步骤-14-删除功能讲解">¶</a>步骤 14 : 删除功能讲解</h3>
<p>点击删除超链，进入ProductImageAction的delete方法</p>
<ol>
<li>
<p>通过t2p把productImage转换为持久化对象，为什么要做这个行为呢？ 因为删除按钮，只传递了productImage.id过来，但是删除结束之后，要跳转到productImage对应的产品下的图片查询界面，所以需要通过t2p()方法把其对应的产品信息查询出来。</p>
</li>
<li>
<p>返回listProductImagePage，在[完整版的Action4Result]中，会导致客户端跳转到admin_productImage_list,并带上产品的id。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result</span>(name=<span class="string">"listProductImagePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_productImage_list?product.id=$&#123;productImage.product.id&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4884.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(productImage);</span><br><span class="line">    productService.delete(productImage);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listProductImagePage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-编辑和修改"><a class="header-anchor" href="#步骤-15-编辑和修改">¶</a>步骤 15 : 编辑和修改</h3>
<p>因为只有图片，就不提供编辑和修改功能。 要做修改，先删除，再增加即可</p>
<h3 id="步骤-16-ProductAction"><a class="header-anchor" href="#步骤-16-ProductAction">¶</a>步骤 16 : ProductAction</h3>
<p>有了ProductImage这一套的支持，产品查询界面也可以显示缩略图了。<br>
在ProductAction的list方法的第22-24行，新增一段代码，用以为每个产品设置firstProdutImage</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">	productImageService.setFirstProdutImage(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = productService.total(category);</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        page.setParam(<span class="string">"&amp;category.id="</span>+category.getId());</span><br><span class="line">        products = productService.list(page,category);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            productImageService.setFirstProdutImage(product);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        t2p(category);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        productService.save(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">        productService.delete(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editProduct"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_product_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Product productFromDB= (Product)productService.get(product.getId());</span><br><span class="line">        product.setCreateDate(productFromDB.getCreateDate());</span><br><span class="line">         </span><br><span class="line">        productService.update(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listProductPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-listProduct-jsp"><a class="header-anchor" href="#步骤-17-listProduct-jsp">¶</a>步骤 17 : listProduct.jsp</h3>
<p>listProduct.jsp的第66-68行本来是注释掉的，现在也可以放出来了</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function() &#123;</span><br><span class="line">        $(<span class="string">"#addForm"</span>).submit(function() &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkEmpty(<span class="string">"name"</span>, <span class="string">"产品名称"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkEmpty(<span class="string">"subTitle"</span>, <span class="string">"小标题"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkNumber(<span class="string">"originalPrice"</span>, <span class="string">"原价格"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkNumber(<span class="string">"promotePrice"</span>, <span class="string">"优惠价格"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!checkInt(<span class="string">"stock"</span>, <span class="string">"库存"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;产品管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_product_list?category.id=$&#123;category.id&#125;"&gt;$&#123;category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;产品管理&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table</span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;产品小标题&lt;/th&gt;</span><br><span class="line">                    &lt;th width="53px"&gt;原价格&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;优惠价格&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;库存数量&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;图片管理&lt;/th&gt;</span><br><span class="line">                    &lt;th width="80px"&gt;设置属性&lt;/th&gt;</span><br><span class="line">                    &lt;th width="42px"&gt;编辑&lt;/th&gt;</span><br><span class="line">                    &lt;th width="42px"&gt;删除&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty p.firstProductImage&#125;"</span>&gt;</span><br><span class="line">                            &lt;img width=<span class="string">"40px"</span> src=<span class="string">"img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                          </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.subTitle&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.originalPrice&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.promotePrice&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;p.stock&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_productImage_list?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-picture"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_propertyValue_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;td&gt;&lt;a href=<span class="string">"admin_product_edit?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="glyphicon glyphicon-edit"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;a deleteLink=<span class="string">"true"</span></span><br><span class="line">                            href=<span class="string">"admin_product_delete?product.id=$&#123;p.id&#125;"</span>&gt;&lt;span</span><br><span class="line">                                class="     glyphicon glyphicon-trash"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span>%&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel panel-warning addDiv"</span>&gt;</span><br><span class="line">        &lt;div class="panel-heading"&gt;新增产品&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"post"</span> id=<span class="string">"addForm"</span> action=<span class="string">"admin_product_add"</span>&gt;</span><br><span class="line">                &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addTable"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品名称&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"name"</span> name=<span class="string">"product.name"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;产品小标题&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"subTitle"</span> name=<span class="string">"product.subTitle"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;原价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"originalPrice"</span> value=<span class="string">"99.98"</span> name=<span class="string">"product.originalPrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;优惠价格&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"promotePrice"</span>  value=<span class="string">"19.98"</span> name=<span class="string">"product.promotePrice"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;库存&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;input id=<span class="string">"stock"</span>  value=<span class="string">"99"</span> name=<span class="string">"product.stock"</span> type=<span class="string">"text"</span></span><br><span class="line">                            class="form-control"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitTR"</span>&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"2"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.category.id"</span> value=<span class="string">"$&#123;category.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;button type="submit" class="btn btn-success"&gt;提 交&lt;/button&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-18-产品缩略图效果"><a class="header-anchor" href="#步骤-18-产品缩略图效果">¶</a>步骤 18 : 产品缩略图效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5267.png" alt></p>
<h2 id="6、SERVICE重构-多条件查询"><a class="header-anchor" href="#6、SERVICE重构-多条件查询">¶</a>6、SERVICE重构-多条件查询</h2>
<h3 id="步骤-1-ProductImageService"><a class="header-anchor" href="#步骤-1-ProductImageService">¶</a>步骤 1 : ProductImageService</h3>
<p>我们来观察ProductImageService以及其实现类ProductImageServiceImpl里的多条件查询方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>;</span><br></pre></td></tr></table></figure>
<p>这个方法之所以要单独声明出来，是因为BaseService里的listByParent(Object parentObject)这个只有一个条件的查询无法满足需要。<br>
然后，可以预见的是，这样的多条件查询的需求，在后续开发中也会碰到，比如：<br>
通过账号和密码查询用户是否存在<br>
查看某个用户下的，还没有指定订单的订单项(购物车数据)<br>
等等<br>
所以这样的方法也是具备重构价值的。</p>
<p>而setFirstProdutImage这个方法，只有这里有业务需求，其他地方用不了，所以不会被用来进行重构。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductImageService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_single = <span class="string">"type_single"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String type_detail = <span class="string">"type_detail"</span>;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span></span>;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImageServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductImageService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=product.getFirstProductImage())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        List&lt;ProductImage&gt; pis= list(<span class="string">"product"</span>, product, <span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        <span class="keyword">if</span>(!pis.isEmpty())</span><br><span class="line">            product.setFirstProductImage(pis.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">list</span><span class="params">(String key_product, Product product, String key_type, String type)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(key_product, product));</span><br><span class="line">        dc.add(Restrictions.eq(key_type, type));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-BaseService-v2"><a class="header-anchor" href="#步骤-2-BaseService-v2">¶</a>步骤 2 : BaseService</h3>
<p>于是，<strong>又</strong>就开始了我们的重构之旅. 为BaseService新增加一个方法：<br>
public List list(Object …pairParms);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object object)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz,<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByPage</span><span class="params">(Page page)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span></span>;   </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Object ...pairParms)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-BaseServiceImpl-v2"><a class="header-anchor" href="#步骤-3-BaseServiceImpl-v2">¶</a>步骤 3 : BaseServiceImpl</h3>
<p>这里使用了[可变数量的参数]的形式，因为有可能是两对参数，也有可能是三对参数，考虑到兼容性，使用了可变数量的参数。<br>
需要注意的是，调用这个方法的时候，应该提供偶数个参数，否则会出错。</p>
<ol>
<li>把这个可变数量的参数，按照key,value,key,value,key,value的预判，取出来，并放进Map里</li>
<li>遍历这个Map,借助DetachedCriteria，按照 key,value的方式设置查询条件<br>
2.1 当value是null的时候，需要使用dc.add(Restrictions.isNull(key)); 这样风格的代码进行查询。</li>
<li>按照id倒排序</li>
<li>返回查询结果</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>  <span class="keyword">extends</span> <span class="title">ServiceDelegateDAO</span> <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> Class clazz;</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            StackTraceElement stes[]= e.getStackTrace();</span><br><span class="line">            String serviceImpleClassName=   stes[<span class="number">1</span>].getClassName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class  serviceImplClazz= Class.forName(serviceImpleClassName);</span><br><span class="line">                String serviceImpleClassSimpleName = serviceImplClazz.getSimpleName();</span><br><span class="line">                String pojoSimpleName = serviceImpleClassSimpleName.replaceAll(<span class="string">"ServiceImpl"</span>, <span class="string">""</span>);</span><br><span class="line">                String pojoPackageName = serviceImplClazz.getPackage().getName().replaceAll(<span class="string">".service.impl"</span>, <span class="string">".pojo"</span>);</span><br><span class="line">                String pojoFullName = pojoPackageName +<span class="string">"."</span>+ pojoSimpleName;</span><br><span class="line">                clazz=Class.forName(pojoFullName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"select count(*) from "</span> + clazz.getName() ;</span><br><span class="line">        List&lt;Long&gt; l= find(hql);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">listByPage</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">save</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Integer) <span class="keyword">super</span>.save(object);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Class clazz, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(clazz, id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">listByParent</span><span class="params">(Object parent)</span> </span>&#123;</span><br><span class="line">        String parentName= parent.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Page page, Object parent)</span> </span>&#123;</span><br><span class="line">        String parentName= parent.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(parentNameWithFirstLetterLower, parent));</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,page.getStart(),page.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">total</span><span class="params">(Object parentObject)</span> </span>&#123;</span><br><span class="line">        String parentName= parentObject.getClass().getSimpleName();</span><br><span class="line">        String parentNameWithFirstLetterLower = StringUtils.uncapitalize(parentName);</span><br><span class="line">         </span><br><span class="line">        String sqlFormat = <span class="string">"select count(*) from %s bean where bean.%s = ?"</span>;</span><br><span class="line">        String hql = String.format(sqlFormat, clazz.getName(), parentNameWithFirstLetterLower);</span><br><span class="line">         </span><br><span class="line">        List&lt;Long&gt; l= <span class="keyword">this</span>.find(hql,parentObject);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Long result= l.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(Object... pairParms)</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String,Object&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pairParms.length; i=i+<span class="number">2</span>)</span><br><span class="line">            m.put(pairParms[i].toString(), pairParms[i+<span class="number">1</span>]);</span><br><span class="line"> </span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line"> </span><br><span class="line">        Set&lt;String&gt; ks = m.keySet();</span><br><span class="line">        <span class="keyword">for</span> (String key : ks) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>==m.get(key))</span><br><span class="line">                dc.add(Restrictions.isNull(key));</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dc.add(Restrictions.eq(key, m.get(key)));</span><br><span class="line">        &#125;</span><br><span class="line">        dc.addOrder(Order.desc(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.findByCriteria(dc);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-ProductImageServiceImpl"><a class="header-anchor" href="#步骤-4-ProductImageServiceImpl">¶</a>步骤 4 : ProductImageServiceImpl</h3>
<p>这个时候ProductImageServiceImpl就可以去掉原本的多条件查询方法，转而继承BaseServiceImpl中的list(Object… pairParms)方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImageServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductImageService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProdutImage</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=product.getFirstProductImage())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        List&lt;ProductImage&gt; pis= list(<span class="string">"product"</span>, product, <span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        <span class="keyword">if</span>(!pis.isEmpty())</span><br><span class="line">            product.setFirstProductImage(pis.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-可运行项目"><a class="header-anchor" href="#步骤-5-可运行项目">¶</a>步骤 5 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以实现产品图片的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一下。</p>
<h2 id="7、产品属性值设置"><a class="header-anchor" href="#7、产品属性值设置">¶</a>7、产品属性值设置</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v10"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v10">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-2-模仿和排错-v8"><a class="header-anchor" href="#步骤-2-模仿和排错-v8">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v2"><a class="header-anchor" href="#步骤-3-效果截图-v2">¶</a>步骤 3 : 效果截图</h3>
<p>重启tomcat后访问地址：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/admin_propertyValue_edit?product.id=2</span><br></pre></td></tr></table></figure>
<p>可以看到产品属性设置的界面<br>
<strong>注：</strong> 这product.id=2是产品的id，根据你的实际运行情况，采取不同的id值</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4887.png" alt></p>
<h3 id="步骤-4-PropertyValue"><a class="header-anchor" href="#步骤-4-PropertyValue">¶</a>步骤 4 : PropertyValue</h3>
<p>准备PropertyValue实体类，并用Hibernate注解标示其对应的表，字段等信息。值得留意的是，其中配置了和 [Product] 跟[Category类] 的多对一关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"propertyvalue"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyValue</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"pid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"ptid"</span>)   </span><br><span class="line">    <span class="keyword">private</span> Property property;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-PropertyValueService"><a class="header-anchor" href="#步骤-5-PropertyValueService">¶</a>步骤 5 : PropertyValueService</h3>
<p>PropertyValueService继承了BaseService ，并额外声明了一个用于初始化的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Product product)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyValueService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Product product)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-PropertyValueServiceImpl"><a class="header-anchor" href="#步骤-6-PropertyValueServiceImpl">¶</a>步骤 6 : PropertyValueServiceImpl</h3>
<p>PropertyValueServiceImpl继承了BaseServiceImpl 并实现了PropertyValueService ，所以提供了public void init(Product product) 方法的实现：</p>
<ol>
<li>这个方法的作用是初始化PropertyValue。 为什么要初始化呢？ 因为对于PropertyValue的管理，没有增加，只有修改。 所以需要通过初始化来进行自动地增加，以便于后面的修改。</li>
<li>首先根据产品获取分类，然后获取这个分类下的所有属性集合</li>
<li>然后用属性和产品去查询，看看这个属性和这个产品，是否已经存在属性值了。</li>
<li>如果不存在，那么就创建一个属性值，并设置其属性和产品，接着插入到数据库中。<br>
这样就完成了属性值的初始化。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyValueService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyValueServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">PropertyValueService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        List&lt;Property&gt; propertys= propertyService.listByParent(product.getCategory());</span><br><span class="line">        <span class="keyword">for</span> (Property property: propertys) &#123;</span><br><span class="line">            PropertyValue propertyValue = get(property,product);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>==propertyValue)&#123;</span><br><span class="line">                propertyValue = <span class="keyword">new</span> PropertyValue();</span><br><span class="line">                propertyValue.setProduct(product);</span><br><span class="line">                propertyValue.setProperty(property);</span><br><span class="line">                save(propertyValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> PropertyValue <span class="title">get</span><span class="params">(Property property, Product product)</span> </span>&#123;</span><br><span class="line">        List&lt;PropertyValue&gt; result= <span class="keyword">this</span>.list(<span class="string">"property"</span>,property, <span class="string">"product"</span>,product);</span><br><span class="line">        <span class="keyword">if</span>(result.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> result.get(<span class="number">0</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-Action4Pojo-v3"><a class="header-anchor" href="#步骤-7-Action4Pojo-v3">¶</a>步骤 7 : Action4Pojo</h3>
<p>在Action4Pojo增加PropertyValue 实体对象和集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">    <span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">    <span class="keyword">protected</span> PropertyValue propertyValue;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;PropertyValue&gt; propertyValues;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValue <span class="title">getPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(PropertyValue propertyValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PropertyValue&gt; <span class="title">getPropertyValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValues</span><span class="params">(List&lt;PropertyValue&gt; propertyValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValues = propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Service-v3"><a class="header-anchor" href="#步骤-8-Action4Service-v3">¶</a>步骤 8 : Action4Service</h3>
<p>在Action4Service中增加PropertyValueService 的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyValueService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyValueService propertyValueService; </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-PropertyValueAction"><a class="header-anchor" href="#步骤-9-PropertyValueAction">¶</a>步骤 9 : PropertyValueAction</h3>
<p>PropertyValueAction提供两个方法edit和update,将在后续详细讲解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyValueAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_propertyValue_edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        t2p(product);</span><br><span class="line">        propertyValueService.init(product);</span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"editPropertyValue"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_propertyValue_update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String value = propertyValue.getValue();</span><br><span class="line">        t2p(propertyValue);</span><br><span class="line">        propertyValue.setValue(value);</span><br><span class="line">        propertyValueService.update(propertyValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-editProductValue-jsp"><a class="header-anchor" href="#步骤-10-editProductValue-jsp">¶</a>步骤 10 : editProductValue.jsp</h3>
<p>editProductValue.jsp用于编辑PropertyValue的页面。<br>
<strong>注</strong> 本来应该叫做editPropertyValue.jsp的，写错了。。。。将错就错了吧。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;编辑产品属性值&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function() &#123;</span><br><span class="line">    $(<span class="string">"input.pvValue"</span>).keyup(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> value = $(<span class="keyword">this</span>).val();</span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"admin_propertyValue_update"</span>;</span><br><span class="line">        <span class="keyword">var</span> pvid = $(<span class="keyword">this</span>).attr(<span class="string">"pvid"</span>);</span><br><span class="line">        <span class="keyword">var</span> parentSpan = $(<span class="keyword">this</span>).parent(<span class="string">"span"</span>);</span><br><span class="line">        parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid yellow"</span>);</span><br><span class="line">        $.post(</span><br><span class="line">                page,</span><br><span class="line">                &#123;<span class="string">"propertyValue.value"</span>:value,<span class="string">"propertyValue.id"</span>:pvid&#125;,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)</span><br><span class="line">                        parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid green"</span>);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid red"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            );     </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"breadcrumb"</span>&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_category_list"&gt;所有分类&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href="admin_product_list?category.id=$&#123;product.category.id&#125;"&gt;$&#123;product.category.name&#125;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;$&#123;product.name&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li class="active"&gt;编辑产品属性&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"editPVDiv"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;propertyValues&#125;"</span> <span class="keyword">var</span>=<span class="string">"propertyValue"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"eachPV"</span>&gt;</span><br><span class="line">                &lt;span class="pvName" &gt;$&#123;propertyValue.property.name&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span class="pvValue"&gt;&lt;input class="pvValue" pvid="$&#123;propertyValue.id&#125;" type="text" value="$&#123;propertyValue.value&#125;"&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt; </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-success-jsp"><a class="header-anchor" href="#步骤-11-success-jsp">¶</a>步骤 11 : success.jsp</h3>
<p>在WebContent目录下新建一个success.jsp文件。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5280.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-编辑功能讲解"><a class="header-anchor" href="#步骤-12-编辑功能讲解">¶</a>步骤 12 : 编辑功能讲解</h3>
<p>通过产品管理界面的设置属性，跳到编辑页面<br>
调用ProductAction的edit方法：</p>
<ol>
<li>通过t2p()方法持久化product，因为面包屑导航里需要显示产品的名称和分类的连接。</li>
<li>初始化属性值： propertyValueDAO.init§。 因为在第一次访问的时候，这些属性值是不存在的，需要进行初始化。</li>
<li>根据产品，获取其对应的属性值集合。</li>
<li>服务端跳转到editProductValue.jsp 上</li>
<li>在editProductValue.jsp上，用c:forEach遍历出这些属性值</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4891.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    t2p(product);</span><br><span class="line">    propertyValueService.init(product);</span><br><span class="line">    propertyValues = propertyValueService.listByParent(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"editPropertyValue"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;propertyValues&#125;"</span> <span class="keyword">var</span>=<span class="string">"propertyValue"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"eachPV"</span>&gt;</span><br><span class="line">        &lt;span class="pvName" &gt;$&#123;propertyValue.property.name&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span class="pvValue"&gt;&lt;input class="pvValue" pvid="$&#123;propertyValue.id&#125;" type="text" value="$&#123;propertyValue.value&#125;"&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-修改功能讲解"><a class="header-anchor" href="#步骤-13-修改功能讲解">¶</a>步骤 13 : 修改功能讲解</h3>
<p>修改功能采用的是[使用post方式提交ajax]的异步调用方式</p>
<ol>
<li>监听输入框上的keyup事件</li>
<li>获取输入框里的值</li>
<li>获取输入框上的自定义属性pvid，这就是当前PropertyValue对应的id</li>
<li>把边框的颜色修改为黄色，表示正在修改的意思</li>
<li>借助JQuery的ajax函数 $.post，把id和值，提交到admin_propertyValue_update</li>
<li>admin_propertyValue_update导致PropertyValueAction的update方法被调用<br>
6.1 通过 String value = propertyValue.getValue();获取页面传递过来的属性值<br>
6.2 通过 t2p(propertyValue); 转换为持久对象<br>
6.3 通过 propertyValue.setValue(value) 修改此值<br>
6.4 通过 propertyValueService.update(propertyValue) 提交到数据库<br>
6.5 服务端跳转到success.jsp，而[success.jsp]中，只有一个字符串 <strong>success</strong><br>
6.6 为什么这么繁琐，而不是直接调用propertyValueService.update(propertyValue)呢？ 因为页面提交数据的时候，只提交了id和value,<a href="http://xn--product-1t0n035dezm.xn--idproperty-ih7q.id" target="_blank" rel="noopener">没有带product.id和property.id</a>，假如直接propertyValueService.update(propertyValue)的话，这两个信息就丢失了。</li>
<li>浏览器判断如果返回值是&quot;success&quot;,那么就把边框设置为绿色，表示修改成功，否则设置为红色，表示修改失败</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4892.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"input.pvValue"</span>).keyup(function()&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="keyword">this</span>).val();</span><br><span class="line">    <span class="keyword">var</span> page = <span class="string">"admin_propertyValue_update"</span>;</span><br><span class="line">    <span class="keyword">var</span> pvid = $(<span class="keyword">this</span>).attr(<span class="string">"pvid"</span>);</span><br><span class="line">    <span class="keyword">var</span> parentSpan = $(<span class="keyword">this</span>).parent(<span class="string">"span"</span>);</span><br><span class="line">    parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid yellow"</span>);</span><br><span class="line">    $.post(</span><br><span class="line">            page,</span><br><span class="line">            &#123;<span class="string">"propertyValue.value"</span>:value,<span class="string">"propertyValue.id"</span>:pvid&#125;,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"success"</span>==result)</span><br><span class="line">                    parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid green"</span>);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    parentSpan.css(<span class="string">"border"</span>,<span class="string">"1px solid red"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        );     </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String value = propertyValue.getValue();</span><br><span class="line">    t2p(propertyValue);</span><br><span class="line">    propertyValue.setValue(value);</span><br><span class="line">    propertyValueService.update(propertyValue);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-删除，增加功能不需要"><a class="header-anchor" href="#步骤-14-删除，增加功能不需要">¶</a>步骤 14 : 删除，增加功能不需要</h3>
<p>属性的维护是在分类中进行，这里仅仅做值的设置。 不提供删除和增加功能</p>
<h3 id="步骤-15-欠缺"><a class="header-anchor" href="#步骤-15-欠缺">¶</a>步骤 15 : 欠缺</h3>
<p>这里有一定的欠缺：当属性被删除的时候，对应的属性值，应该怎么处理？ 这个留给同学们思考</p>
<h2 id="8、用户管理"><a class="header-anchor" href="#8、用户管理">¶</a>8、用户管理</h2>
<h3 id="步骤-1-准备数据"><a class="header-anchor" href="#步骤-1-准备数据">¶</a>步骤 1 : 准备数据</h3>
<p>因为用户信息是前台注册的时候增加的，截至目前为止，还没有讲到前台的功能。所以需要手动在数据库中增加数据，以便于观察运行的效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into user values(null,&#39;测试用户1&#39;,&#39;password1&#39;);</span><br><span class="line">insert into user values(null,&#39;测试用户2&#39;,&#39;password2&#39;);</span><br><span class="line">insert into user values(null,&#39;测试用户3&#39;,&#39;password3&#39;);</span><br><span class="line">insert into user values(null,&#39;测试用户4&#39;,&#39;password4&#39;);</span><br><span class="line">insert into user values(null,&#39;测试用户5&#39;,&#39;password5&#39;);</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-2-先运行，看到效果，再学习">¶</a>步骤 2 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-3-效果截图-v3"><a class="header-anchor" href="#步骤-3-效果截图-v3">¶</a>步骤 3 : 效果截图</h3>
<p>用户这部分做的比较简单，只有查询，为什么呢？</p>
<ol>
<li>用户的增加，是交由前台注册行为产生的，后台不需要自己进行增加</li>
<li>用户信息不能删除。 用户信息是最重要的业务信息，不可以删除</li>
<li>用户资料的修改，也应该由前台用户自己进行，而不是后台操作。比如修改密码</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4896.png" alt></p>
<h3 id="步骤-4-模仿和排错"><a class="header-anchor" href="#步骤-4-模仿和排错">¶</a>步骤 4 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-5-User"><a class="header-anchor" href="#步骤-5-User">¶</a>步骤 5 : User</h3>
<p>准备User实体类，并用Hibernate注解标示其对应的表，字段等信息。<br>
其中getAnonymousName表示获取本用户的匿名名称，在评价的时候显示用户名使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)       </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;   </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAnonymousName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==name)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(name.length()&lt;=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"*"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(name.length()==<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> name.substring(<span class="number">0</span>,<span class="number">1</span>) +<span class="string">"*"</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">char</span>[] cs =name.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; cs.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">            cs[i]=<span class="string">'*'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(cs);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-UserService"><a class="header-anchor" href="#步骤-6-UserService">¶</a>步骤 6 : UserService</h3>
<p>UserService继承了BaseService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-UserServiceImpl"><a class="header-anchor" href="#步骤-7-UserServiceImpl">¶</a>步骤 7 : UserServiceImpl</h3>
<p>UserServiceImpl继承了BaseServiceImpl ，实现了UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Pojo-v2"><a class="header-anchor" href="#步骤-8-Action4Pojo-v2">¶</a>步骤 8 : Action4Pojo</h3>
<p>Action4Pojo增加了User实体类和集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">    <span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">    <span class="keyword">protected</span> PropertyValue propertyValue;</span><br><span class="line">    <span class="keyword">protected</span> User user;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;PropertyValue&gt; propertyValues;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;User&gt; users;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValue <span class="title">getPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(PropertyValue propertyValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PropertyValue&gt; <span class="title">getPropertyValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValues</span><span class="params">(List&lt;PropertyValue&gt; propertyValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValues = propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-Action4Service-v2"><a class="header-anchor" href="#步骤-9-Action4Service-v2">¶</a>步骤 9 : Action4Service</h3>
<p>Action4Service增加了对于UserService的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyValueService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyValueService propertyValueService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-UserAction"><a class="header-anchor" href="#步骤-10-UserAction">¶</a>步骤 10 : UserAction</h3>
<p>UserAction提供对于路径的映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_user_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = userService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        users = userService.listByPage(page);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-listUser-jsp"><a class="header-anchor" href="#步骤-11-listUser-jsp">¶</a>步骤 11 : listUser.jsp</h3>
<p>listUser.jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(checkEmpty(<span class="string">"name"</span>,<span class="string">"用户名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;用户管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;用户管理&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;用户名称&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;users&#125;"</span> <span class="keyword">var</span>=<span class="string">"u"</span>&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;u.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;u.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span> %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-查询功能讲解-v2"><a class="header-anchor" href="#步骤-12-查询功能讲解-v2">¶</a>步骤 12 : 查询功能讲解</h3>
<p>点击后台管理上方导航中的 用户管理，进入用户查询界面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin_user_list</span></span><br></pre></td></tr></table></figure>
<p>UserAction的list方法被调用，和其他实体类的查询没什么区别，就不赘述了。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4900.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(page==<span class="keyword">null</span>)</span><br><span class="line">        page = <span class="keyword">new</span> Page();</span><br><span class="line">    <span class="keyword">int</span> total = userService.total();</span><br><span class="line">    page.setTotal(total);</span><br><span class="line">    users = userService.listByPage(page);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listUser"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;users&#125;"</span> <span class="keyword">var</span>=<span class="string">"u"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;$&#123;u.id&#125;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;$&#123;u.name&#125;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-增加，删除，修改功能"><a class="header-anchor" href="#步骤-13-增加，删除，修改功能">¶</a>步骤 13 : 增加，删除，修改功能</h3>
<p>增加交由前台用户注册功能<br>
删除不提供（用户信息是最重要的资料）<br>
修改不提供，应该由前台用户自己完成</p>
<h2 id="9、订单管理"><a class="header-anchor" href="#9、订单管理">¶</a>9、订单管理</h2>
<h3 id="步骤-1-准备数据SQL"><a class="header-anchor" href="#步骤-1-准备数据SQL">¶</a>步骤 1 : 准备数据SQL</h3>
<p>订单数据，以及其对应的订单项数据，都是由前台功能增加的。<br>
为了在后台演示效果，需要自己在数据库中插入数据</p>
<ol>
<li>订单：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert INTO order_ VALUES (1,&#39;201608241638122609867&#39;,&#39;某某市，某某区，某某街道，某某号 &#39;,&#39;610000&#39;,&#39;某某某&#39;,&#39;15111111111&#39;,NULL,&#39;2016-12-30&#39;,NULL,NULL,NULL,14,&#39;waitDelivery&#39;);</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 倒数第二个参数<strong>14</strong>是对应的用户id，需要在数据库中存在，请根据自己的数据信息自行修改。</p>
<ol start="2">
<li>订单项</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert INTO orderitem VALUES (1,2,1,14,2);</span><br><span class="line">insert INTO orderitem VALUES (2,3,1,14,2);</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> 第二个参数<strong>2</strong>、<strong>3</strong>分别对应的产品id，需要在数据库中存在，请根据自己的数据信息自行修改。</p>
<h3 id="步骤-2-效果截图-v2"><a class="header-anchor" href="#步骤-2-效果截图-v2">¶</a>步骤 2 : 效果截图</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4904.png" alt></p>
<h3 id="步骤-3-先运行，看到效果，再学习"><a class="header-anchor" href="#步骤-3-先运行，看到效果，再学习">¶</a>步骤 3 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<h3 id="步骤-4-模仿和排错-v2"><a class="header-anchor" href="#步骤-4-模仿和排错-v2">¶</a>步骤 4 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-5-Order"><a class="header-anchor" href="#步骤-5-Order">¶</a>步骤 5 : Order</h3>
<p>准备Order实体类，并用Hibernate注解标示其对应的表，字段等信息。<br>
需要注意的是，Order有三个瞬时字段，他们都是不参与持久化的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> List&lt;OrderItem&gt; orderItems;</span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> total;</span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> totalNumber;</span><br></pre></td></tr></table></figure>
<p>有一个getStatusDesc方法，用于返回订单状态对应的中文解释。 这些订单状态字符串是定义在接下来要讲的 [OrderService] 中的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStatusDesc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	String desc =<span class="string">"未知"</span>;</span><br><span class="line">	<span class="keyword">switch</span>(status)&#123;</span><br><span class="line">		<span class="keyword">case</span> OrderService.waitPay:</span><br><span class="line">			desc=<span class="string">"待付"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OrderService.waitDelivery:</span><br><span class="line">			desc=<span class="string">"待发"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OrderService.waitConfirm:</span><br><span class="line">			desc=<span class="string">"待收"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OrderService.waitReview:</span><br><span class="line">			desc=<span class="string">"等评"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OrderService.finish:</span><br><span class="line">			desc=<span class="string">"完成"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OrderService.delete:</span><br><span class="line">			desc=<span class="string">"刪除"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			desc=<span class="string">"未知"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> desc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"order_"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"uid"</span>)</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String orderCode;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String post;</span><br><span class="line">    <span class="keyword">private</span> String receiver;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String userMessage;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">    <span class="keyword">private</span> Date payDate;</span><br><span class="line">    <span class="keyword">private</span> Date deliveryDate;</span><br><span class="line">    <span class="keyword">private</span> Date confirmDate;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; orderItems;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> total;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalNumber;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatusDesc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String desc =<span class="string">"未知"</span>;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> OrderService.waitPay:</span><br><span class="line">                desc=<span class="string">"待付"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OrderService.waitDelivery:</span><br><span class="line">                desc=<span class="string">"待发"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OrderService.waitConfirm:</span><br><span class="line">                desc=<span class="string">"待收"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OrderService.waitReview:</span><br><span class="line">                desc=<span class="string">"等评"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OrderService.finish:</span><br><span class="line">                desc=<span class="string">"完成"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OrderService.delete:</span><br><span class="line">                desc=<span class="string">"刪除"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                desc=<span class="string">"未知"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> post;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPost</span><span class="params">(String post)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.post = post;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mobile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMobile</span><span class="params">(String mobile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mobile = mobile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserMessage</span><span class="params">(String userMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMessage = userMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getPayDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> payDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPayDate</span><span class="params">(Date payDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.payDate = payDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getDeliveryDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deliveryDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeliveryDate</span><span class="params">(Date deliveryDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deliveryDate = deliveryDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getConfirmDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> confirmDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfirmDate</span><span class="params">(Date confirmDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.confirmDate = confirmDate;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getReceiver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiver;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReceiver</span><span class="params">(String receiver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderCode;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderCode</span><span class="params">(String orderCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderCode = orderCode;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title">getOrderItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderItems;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderItems</span><span class="params">(List&lt;OrderItem&gt; orderItems)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderItems = orderItems;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(<span class="keyword">float</span> total)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalNumber;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalNumber</span><span class="params">(<span class="keyword">int</span> totalNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalNumber = totalNumber;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-OrderItem"><a class="header-anchor" href="#步骤-6-OrderItem">¶</a>步骤 6 : OrderItem</h3>
<p>准备OrderItem实体类，并用Hibernate注解标示其对应的表，字段等信息。<br>
OrderItem有三个多对一关系：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@ManyToOne</span></span><br><span class="line">   <span class="meta">@JoinColumn</span>(name=<span class="string">"pid"</span>)	</span><br><span class="line"><span class="keyword">private</span> Product product;</span><br><span class="line">   <span class="meta">@ManyToOne</span></span><br><span class="line">   <span class="meta">@JoinColumn</span>(name=<span class="string">"oid"</span>)    </span><br><span class="line"><span class="keyword">private</span> Order order;</span><br><span class="line">   <span class="meta">@ManyToOne</span></span><br><span class="line">   <span class="meta">@JoinColumn</span>(name=<span class="string">"uid"</span>)    </span><br><span class="line"><span class="keyword">private</span> User user;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"orderItem"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"pid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"oid"</span>)   </span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"uid"</span>)   </span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-OrderService"><a class="header-anchor" href="#步骤-7-OrderService">¶</a>步骤 7 : OrderService</h3>
<p>OrderService继承了BaseService ，接着定义了6个状态常量字符串。<br>
以及</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitPay = <span class="string">"waitPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitDelivery = <span class="string">"waitDelivery"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitConfirm = <span class="string">"waitConfirm"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitReview = <span class="string">"waitReview"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String finish = <span class="string">"finish"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String delete = <span class="string">"delete"</span>;  </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-OrderServiceImpl"><a class="header-anchor" href="#步骤-8-OrderServiceImpl">¶</a>步骤 8 : OrderServiceImpl</h3>
<p>OrderServiceImpl继承了BaseServiceImpl 并实现了OrderService 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-OrderItemService"><a class="header-anchor" href="#步骤-9-OrderItemService">¶</a>步骤 9 : OrderItemService</h3>
<p>OrderItemService继承了BaseService，并声明了2个新方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Order&gt; orders)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Order order)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderItemService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Order&gt; orders)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Order order)</span></span>;</span><br><span class="line">         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-OrderItemServiceImpl"><a class="header-anchor" href="#步骤-10-OrderItemServiceImpl">¶</a>步骤 10 : OrderItemServiceImpl</h3>
<p>OrderItemServiceImpl 继承了BaseServiceImpl 并实现OrderItemService接口。</p>
<ol>
<li>为订单对象填充其orderItems字段，并且计算出订单总金额，订单总购买数量</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Order order)</span></span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>为多个订单计算</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Order&gt; orders)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderItemService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Order order : orders)</span><br><span class="line">            fill(order);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">            List&lt;OrderItem&gt; orderItems= <span class="keyword">this</span>.listByParent(order);</span><br><span class="line">            order.setOrderItems(orderItems);</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">float</span> total = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> totalNumber = <span class="number">0</span>;           </span><br><span class="line">            <span class="keyword">for</span> (OrderItem oi :orderItems) &#123;</span><br><span class="line">                total+=oi.getNumber()*oi.getProduct().getPromotePrice();</span><br><span class="line">                totalNumber+=oi.getNumber();</span><br><span class="line">                 </span><br><span class="line">                productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">            &#125;</span><br><span class="line">            order.setTotal(total);</span><br><span class="line">            order.setOrderItems(orderItems);</span><br><span class="line">            order.setTotalNumber(totalNumber);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-Action4Pojo"><a class="header-anchor" href="#步骤-11-Action4Pojo">¶</a>步骤 11 : Action4Pojo</h3>
<p>Action4Pojo中新增Order和OrderItem的 实体与集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">    <span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">    <span class="keyword">protected</span> PropertyValue propertyValue;</span><br><span class="line">    <span class="keyword">protected</span> User user;</span><br><span class="line">    <span class="keyword">protected</span> Order order;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;PropertyValue&gt; propertyValues;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;User&gt; users;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Order&gt; orders;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValue <span class="title">getPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(PropertyValue propertyValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PropertyValue&gt; <span class="title">getPropertyValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValues</span><span class="params">(List&lt;PropertyValue&gt; propertyValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValues = propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-Action4Service"><a class="header-anchor" href="#步骤-12-Action4Service">¶</a>步骤 12 : Action4Service</h3>
<p>追加OrderService和OrderItemService的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyValueService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyValueService propertyValueService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderService orderService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService; </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-OrderAction"><a class="header-anchor" href="#步骤-13-OrderAction">¶</a>步骤 13 : OrderAction</h3>
<p>OrderAction用于映射不同路径的访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.util.Page;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_order_list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (page == <span class="keyword">null</span>)</span><br><span class="line">            page = <span class="keyword">new</span> Page();</span><br><span class="line">        <span class="keyword">int</span> total = orderService.total();</span><br><span class="line">        page.setTotal(total);</span><br><span class="line">        orders = orderService.listByPage(page);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listOrder"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"admin_order_delivery"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delivery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setDeliveryDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setStatus(OrderService.waitConfirm);</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listOrderPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-14-listOrder-jsp"><a class="header-anchor" href="#步骤-14-listOrder-jsp">¶</a>步骤 14 : listOrder.jsp</h3>
<p>增加listOrder.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">  </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminHeader.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminNavigator.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"#addForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(checkEmpty(<span class="string">"name"</span>,<span class="string">"订单名称"</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"button.orderPageCheckOrderItems"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> oid = $(<span class="keyword">this</span>).attr(<span class="string">"oid"</span>);</span><br><span class="line">        $(<span class="string">"tr.orderPageOrderItemTR[oid="</span>+oid+<span class="string">"]"</span>).toggle();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;订单管理&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"workingArea"</span>&gt;</span><br><span class="line">    &lt;h1 class="label label-info" &gt;订单管理&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"listDataTableDiv"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-striped table-bordered table-hover1  table-condensed"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"success"</span>&gt;</span><br><span class="line">                    &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;金额&lt;/th&gt;</span><br><span class="line">                    &lt;th width="100px"&gt;商品数量&lt;/th&gt;</span><br><span class="line">                    &lt;th width="100px"&gt;买家名称&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;创建时间&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;支付时间&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;发货时间&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;确认收货时间&lt;/th&gt;</span><br><span class="line">                    &lt;th width="120px"&gt;操作&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;orders&#125;"</span> <span class="keyword">var</span>=<span class="string">"o"</span>&gt;</span><br><span class="line">                    &lt;tr&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;o.id&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;o.statusDesc&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;o.total&#125;" minFractionDigits="2"/&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td align="center"&gt;$&#123;o.totalNumber&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td align="center"&gt;$&#123;o.user.name&#125;&lt;/td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.createDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.payDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.deliveryDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.confirmDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;button oid=$&#123;o.id&#125; class="orderPageCheckOrderItems btn btn-primary btn-xs"&gt;查看详情&lt;/button&gt;</span><br><span class="line">                             </span><br><span class="line">                            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitDelivery'&#125;"</span>&gt;</span><br><span class="line">                                &lt;a href=<span class="string">"admin_order_delivery?order.id=$&#123;o.id&#125;"</span>&gt;</span><br><span class="line">                                    &lt;button class="btn btn-primary btn-xs"&gt;发货&lt;/button&gt;</span><br><span class="line">                                &lt;/a&gt;                         </span><br><span class="line">                            &lt;/c:if&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItemTR"</span>  oid=$&#123;o.id&#125;&gt;</span><br><span class="line">                        &lt;td colspan=<span class="string">"10"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">                             </span><br><span class="line">                            &lt;div  <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItem"</span>&gt;</span><br><span class="line">                                &lt;table width=<span class="string">"800px"</span> align=<span class="string">"center"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItemTable"</span>&gt;</span><br><span class="line">                                    &lt;c:forEach items=<span class="string">"$&#123;o.orderItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span>&gt;</span><br><span class="line">                                        &lt;tr&gt;</span><br><span class="line">                                            &lt;td align=<span class="string">"left"</span>&gt;</span><br><span class="line">                                                &lt;img width=<span class="string">"40px"</span> height=<span class="string">"40px"</span> src=<span class="string">"img/productSingle/$&#123;oi.product.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                                            &lt;/td&gt;</span><br><span class="line">                                             </span><br><span class="line">                                            &lt;td&gt;</span><br><span class="line">                                                &lt;a href=<span class="string">"foreproduct?product.id=$&#123;oi.product.id&#125;"</span>&gt;</span><br><span class="line">                                                    &lt;span&gt;$&#123;oi.product.name&#125;&lt;/span&gt;</span><br><span class="line">                                                &lt;/a&gt;                                         </span><br><span class="line">                                            &lt;/td&gt;</span><br><span class="line">                                            &lt;td align=<span class="string">"right"</span>&gt;</span><br><span class="line">                                             </span><br><span class="line">                                                &lt;span class="text-muted"&gt;$&#123;oi.number&#125;个&lt;/span&gt;                                              </span><br><span class="line">                                            &lt;/td&gt;</span><br><span class="line">                                            &lt;td align=<span class="string">"right"</span>&gt;</span><br><span class="line">                                             </span><br><span class="line">                                                &lt;span class="text-muted"&gt;单价：￥$&#123;oi.product.promotePrice&#125;&lt;/span&gt;                                             </span><br><span class="line">                                            &lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                                        &lt;/tr&gt;</span><br><span class="line">                                    &lt;/c:forEach&gt;</span><br><span class="line">                                 </span><br><span class="line">                                &lt;/table&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pageDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminPage.jsp"</span> %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"../include/admin/adminFooter.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-查询功能讲解"><a class="header-anchor" href="#步骤-15-查询功能讲解">¶</a>步骤 15 : 查询功能讲解</h3>
<p>访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin_order_list</span></span><br></pre></td></tr></table></figure>
<p>即可看到订单查询界面。<br>
admin_order_list 导致OrderAction.list()方法被调用</p>
<ol>
<li>分页查询订单信息</li>
<li>借助orderItemService.fill()方法为这些订单填充上orderItems信息</li>
<li>服务端跳转到admin/listOrder.jsp页面</li>
<li>在listOrder.jsp借助c:forEach把订单集合遍历出来</li>
<li>遍历订单的时候，再把当前订单的orderItem订单项集合遍历出来</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4909.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (page == <span class="keyword">null</span>)</span><br><span class="line">        page = <span class="keyword">new</span> Page();</span><br><span class="line">    <span class="keyword">int</span> total = orderService.total();</span><br><span class="line">    page.setTotal(total);</span><br><span class="line">    orders = orderService.listByPage(page);</span><br><span class="line">    orderItemService.fill(orders);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listOrder"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;orders&#125;"</span> <span class="keyword">var</span>=<span class="string">"o"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;o.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;o.statusDesc&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;o.total&#125;" minFractionDigits="2"/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td align="center"&gt;$&#123;o.totalNumber&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td align="center"&gt;$&#123;o.user.name&#125;&lt;/td&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.createDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.payDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.deliveryDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;fmt:formatDate value="$&#123;o.confirmDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &lt;button oid=$&#123;o.id&#125; class="orderPageCheckOrderItems btn btn-primary btn-xs"&gt;查看详情&lt;/button&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitDelivery'&#125;"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"admin_order_delivery?order.id=$&#123;o.id&#125;"</span>&gt;</span><br><span class="line">                    &lt;button class="btn btn-primary btn-xs"&gt;发货&lt;/button&gt;</span><br><span class="line">                &lt;/a&gt;                         </span><br><span class="line">            &lt;/c:if&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItemTR"</span>  oid=$&#123;o.id&#125;&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"10"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;div  <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItem"</span>&gt;</span><br><span class="line">                &lt;table width=<span class="string">"800px"</span> align=<span class="string">"center"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderPageOrderItemTable"</span>&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">"$&#123;o.orderItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span>&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td align=<span class="string">"left"</span>&gt;</span><br><span class="line">                                &lt;img width=<span class="string">"40px"</span> height=<span class="string">"40px"</span> src=<span class="string">"img/productSingle/$&#123;oi.product.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                             </span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;a href=<span class="string">"foreproduct?product.id=$&#123;oi.product.id&#125;"</span>&gt;</span><br><span class="line">                                    &lt;span&gt;$&#123;oi.product.name&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;/a&gt;                                         </span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td align=<span class="string">"right"</span>&gt;</span><br><span class="line">                             </span><br><span class="line">                                &lt;span class="text-muted"&gt;$&#123;oi.number&#125;个&lt;/span&gt;                                              </span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td align=<span class="string">"right"</span>&gt;</span><br><span class="line">                             </span><br><span class="line">                                &lt;span class="text-muted"&gt;单价：￥$&#123;oi.product.promotePrice&#125;&lt;/span&gt;                                             </span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line"> </span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-发货功能讲解"><a class="header-anchor" href="#步骤-16-发货功能讲解">¶</a>步骤 16 : 发货功能讲解</h3>
<p>当订单状态是waitDelivery的时候，就会出现发货按钮</p>
<ol>
<li>发货按钮链接跳转到admin_order_delivery</li>
<li>OrderAction.delivery()方法被调用<br>
2.1 通过t2p把order对象转换为持久化对象<br>
2.2 修改发货时间，设置发货状态<br>
2.3 更新到数据库<br>
2.4 客户端跳转到admin_order_list页面</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4910.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delivery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    order.setDeliveryDate(<span class="keyword">new</span> Date());</span><br><span class="line">    order.setStatus(OrderService.waitConfirm);</span><br><span class="line">    orderService.update(order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"listOrderPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-增加，修改，删除功能"><a class="header-anchor" href="#步骤-17-增加，修改，删除功能">¶</a>步骤 17 : 增加，修改，删除功能</h3>
<p>订单的增加和删除功能交由前台完成，后台不提供</p>
<h1 id="十、原型-前端"><a class="header-anchor" href="#十、原型-前端">¶</a>十、原型-前端</h1>
<h2 id="1、概述-v7"><a class="header-anchor" href="#1、概述-v7">¶</a>1、概述</h2>
<h3 id="步骤-1-真正开发的时候会直接使用这些前端页面吗？"><a class="header-anchor" href="#步骤-1-真正开发的时候会直接使用这些前端页面吗？">¶</a>步骤 1 : 真正开发的时候会直接使用这些前端页面吗？</h3>
<p>事实上，这些前端页面都是相当复杂的，真正开发的时候，也不会完全在这些页面上进行，而是把一个复杂的前端页面拆成了多个便于维护与理解的小的jsp文件。<br>
比如首页[home.jsp]就是由多个[home.jsp 公共文件]和一个[homePage.jsp]组成。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4758.png" alt></p>
<h3 id="步骤-2-homePage-jsp-又由多个子jsp文件组成"><a class="header-anchor" href="#步骤-2-homePage-jsp-又由多个子jsp文件组成">¶</a>步骤 2 : homePage.jsp 又由多个子jsp文件组成</h3>
<p>[homePage.jsp ]又由多个子jsp文件组成，这样每个文件就相对于整篇的前端页面来讲，简单了不少，更加利于理解与消化</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4759.png" alt></p>
<h3 id="步骤-3-这些前端原型的作用"><a class="header-anchor" href="#步骤-3-这些前端原型的作用">¶</a>步骤 3 : 这些前端原型的作用</h3>
<p>这些前端原型的作用，主要还是用于和客户沟通，让大家对工作的真正状态有一定的模拟。 如果对前端页面本身的布局，样式十分感兴趣，请跳转到[模仿天猫前端教程]</p>
<h2 id="2、首页-v2"><a class="header-anchor" href="#2、首页-v2">¶</a>2、首页</h2>
<p><strong>说明</strong> 这些是前端页面原型的整合代码，在实际开发中是不会像这样把那么多的标签，元素，样式，js放在一个页面里的。 在本教程中会把大的页面拆分成为容易理解，维护的小文件，在后续的章节会讲解到。</p>
<h3 id="步骤-1-效果-v8"><a class="header-anchor" href="#步骤-1-效果-v8">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="3、分类页"><a class="header-anchor" href="#3、分类页">¶</a>3、分类页</h2>
<h3 id="步骤-1-效果-v9"><a class="header-anchor" href="#步骤-1-效果-v9">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="4、产品页面"><a class="header-anchor" href="#4、产品页面">¶</a>4、产品页面</h2>
<h3 id="步骤-1-效果-v10"><a class="header-anchor" href="#步骤-1-效果-v10">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="5、购物车页面"><a class="header-anchor" href="#5、购物车页面">¶</a>5、购物车页面</h2>
<h3 id="步骤-1-效果-v11"><a class="header-anchor" href="#步骤-1-效果-v11">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="6、我的订单页面"><a class="header-anchor" href="#6、我的订单页面">¶</a>6、我的订单页面</h2>
<h3 id="步骤-1-效果-v12"><a class="header-anchor" href="#步骤-1-效果-v12">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="7、结算页面"><a class="header-anchor" href="#7、结算页面">¶</a>7、结算页面</h2>
<h3 id="步骤-1-效果-v13"><a class="header-anchor" href="#步骤-1-效果-v13">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="8、查询结果页"><a class="header-anchor" href="#8、查询结果页">¶</a>8、查询结果页</h2>
<h3 id="步骤-1-效果-v14"><a class="header-anchor" href="#步骤-1-效果-v14">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="9、支付页面"><a class="header-anchor" href="#9、支付页面">¶</a>9、支付页面</h2>
<h3 id="步骤-1-效果-v15"><a class="header-anchor" href="#步骤-1-效果-v15">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="10、支付成功页面"><a class="header-anchor" href="#10、支付成功页面">¶</a>10、支付成功页面</h2>
<h3 id="步骤-1-效果-v16"><a class="header-anchor" href="#步骤-1-效果-v16">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="11、确认收货页面"><a class="header-anchor" href="#11、确认收货页面">¶</a>11、确认收货页面</h2>
<h3 id="步骤-1-效果-v17"><a class="header-anchor" href="#步骤-1-效果-v17">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="12、收货成功页面"><a class="header-anchor" href="#12、收货成功页面">¶</a>12、收货成功页面</h2>
<h3 id="步骤-1-效果-v18"><a class="header-anchor" href="#步骤-1-效果-v18">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="13、评价页面"><a class="header-anchor" href="#13、评价页面">¶</a>13、评价页面</h2>
<h3 id="步骤-1-效果-v19"><a class="header-anchor" href="#步骤-1-效果-v19">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h2 id="14、登录页面"><a class="header-anchor" href="#14、登录页面">¶</a>14、登录页面</h2>
<h3 id="步骤-1-效果-v20"><a class="header-anchor" href="#步骤-1-效果-v20">¶</a>步骤 1 : 效果</h3>
<p>**注：**这里的原型是展示效果，让大家有个感性的认识，编码不在这里进行，项目开发过程会在后面的章节从零开始。</p>
<h1 id="十一、前台-首页"><a class="header-anchor" href="#十一、前台-首页">¶</a>十一、前台-首页</h1>
<h2 id="1、概述-v8"><a class="header-anchor" href="#1、概述-v8">¶</a>1、概述</h2>
<p>前台也包括许多功能， 与[后台-分类管理]类似的，首先把[前台-首页]这个功能单独拿出来，进行精讲。[前台-首页]消化吸收好之后，再进行其他前台功能的开发。</p>
<ol>
<li>
<p>前台无需登录<br>
从前台模块之间的依赖性，以及开发顺序的合理性来考虑，把前台功能分为了 [无需登录] 即可使用的功能，和[需要登录] 才能访问的功能。 建立在前一步[前台-首页]的基础之上，开始进行一系列的[无需登录]功能开发。</p>
</li>
<li>
<p>前台需要登录<br>
接着是[需要登录的前台功能]。 这部分功能基本上都是和购物相关的。 因此，一开始先把[购物流程]单独拿出来捋清楚，其中还特别注明了 [购物流程环节与表关系]，这样能够更好的建立对前端购物功能的理解。随着这部分功能的开发，就会进入订单生成部分，在此之前，先准备了一个 [订单状态图]，在理解了这个图之后，可以更好的进行订单相关功能的开发。</p>
</li>
</ol>
<h2 id="2、可运行项目"><a class="header-anchor" href="#2、可运行项目">¶</a>2、可运行项目</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v11"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v11">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<p><strong>注：</strong> 这个比前面的tmall_ssh.rar 都要大，因为里面包含了1777张图片。</p>
<h3 id="步骤-2-模仿和排错-v9"><a class="header-anchor" href="#步骤-2-模仿和排错-v9">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v4"><a class="header-anchor" href="#步骤-3-效果截图-v4">¶</a>步骤 3 : 效果截图</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4912.png" alt></p>
<h3 id="步骤-4-可运行项目"><a class="header-anchor" href="#步骤-4-可运行项目">¶</a>步骤 4 : 可运行项目</h3>
<ol>
<li>首先下载右边的tmall_ssh.rar</li>
<li>解压到e:/project/tmall_ssh</li>
<li>使用下个步骤的[导入SQL语句]</li>
<li>然后重启tomcat</li>
<li>访问页面</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/</span></span><br></pre></td></tr></table></figure>
<p>**注：**<a href="http://127.0.0.1:8080/tmall_ssh/" target="_blank" rel="noopener">http://127.0.0.1:8080/tmall_ssh/</a> 服务端跳转到了地址 <a href="http://127.0.0.1:8080/tmall_ssh/forehome" target="_blank" rel="noopener">http://127.0.0.1:8080/tmall_ssh/forehome</a></p>
<h3 id="步骤-5-导入SQL语句"><a class="header-anchor" href="#步骤-5-导入SQL语句">¶</a>步骤 5 : 导入SQL语句</h3>
<p>tmall_ssh.rar只包含了项目必须的代码，但是没有数据，为了看到首页的运行效果，还必须导入数据。</p>
<p>在右侧下载 sql 文件，然后使用如下的 命令行方式导入。如果没有安装mysql,可以参考[安装mysql-server]<br>
<strong>注：</strong> 不要用 navicat,mysql-front 等工具导入，因为数据量大，这些工具处理不了，会报奇奇怪怪的错误。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe"</span> -u root -padmin --<span class="keyword">default</span>-character-set=utf8 tmall_ssh &lt; d:\tmall_ssh.sql</span><br></pre></td></tr></table></figure>
<p><strong>注:</strong> D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe 这个路径是我的mysql.exe的路径，根据实际情况换成自己的mysql运行路径<br>
<strong>注:</strong> tmall_ssh.sql下载后，放在 d:\tmall_ssh.sql 这个位置</p>
<h3 id="步骤-6-限制性"><a class="header-anchor" href="#步骤-6-限制性">¶</a>步骤 6 : 限制性</h3>
<p>为了正常显示这个首页效果，包含了17种分类，每种分类下有5种商品，每个商品下大约又有大小不同，单个和详情总供10张左右图片。这样累计下来图片文件就有1777张。</p>
<p>仅仅每个分类下5种商品，项目文件压缩包tmall_ssh.rar的大小就是200多M了，完整的[模仿天猫]下每个分类下平均有60个产品，总计2个G左右，考虑到学习需要下那么大的文件很不方便，就不提供了。</p>
<p>因为每个分类下只有5种产品，所有在推荐产品列表里看到的数据就有限，只能看到5种，而不是[模仿天猫]上看到的比较丰富的内容。</p>
<p>如果为了看到更多的内容，需要自己在后台手动增加新的产品</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4915.png" alt></p>
<h2 id="3、静态资源-v2"><a class="header-anchor" href="#3、静态资源-v2">¶</a>3、静态资源</h2>
<h3 id="步骤-1-图片资源-site目录"><a class="header-anchor" href="#步骤-1-图片资源-site目录">¶</a>步骤 1 : 图片资源-site目录</h3>
<p>和[分类管理中讲到的图片资源]一样，在img目录下的site目录放着所有要用到的静态图片，如猫耳朵什么的</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4916.png" alt></p>
<h3 id="步骤-2-图片资源-轮播图片"><a class="header-anchor" href="#步骤-2-图片资源-轮播图片">¶</a>步骤 2 : 图片资源-轮播图片</h3>
<p>除了[图片资源-site目录]之外，还有轮播用的图片资源</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4917.png" alt></p>
<h3 id="步骤-3-图片资源-分类图片"><a class="header-anchor" href="#步骤-3-图片资源-分类图片">¶</a>步骤 3 : 图片资源-分类图片</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4918.png" alt></p>
<h3 id="步骤-4-图片资源-产品图片"><a class="header-anchor" href="#步骤-4-图片资源-产品图片">¶</a>步骤 4 : 图片资源-产品图片</h3>
<p>产品对应的图片有4个目录，分别是</p>
<ol>
<li>productSingle<br>
产品正常尺寸图片</li>
<li>productSingle_middle<br>
产品中等尺寸图片</li>
<li>productSingle_small<br>
产品小号尺寸图片</li>
<li>productDetail<br>
产品详情图片</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4919.png" alt></p>
<h3 id="步骤-5-css"><a class="header-anchor" href="#步骤-5-css">¶</a>步骤 5 : css</h3>
<p>在css目录里有3个子目录</p>
<ol>
<li>back<br>
这个目录里有一个style.css,这是后台界面用到的样式</li>
<li>bootstrap<br>
这里存放的是bootstrap的css样式文件</li>
<li>fore<br>
这个目录里<strong>也</strong>有一个style.css,这是前台界面用到的样式</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4920.png" alt></p>
<h3 id="步骤-6-js"><a class="header-anchor" href="#步骤-6-js">¶</a>步骤 6 : js</h3>
<p>js目录下有两个子目录<br>
/bootstrap<br>
bootstrap用到的js文件<br>
/jquery<br>
jquery用到的js文件</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4921.png" alt></p>
<h3 id="步骤-7-img-rar"><a class="header-anchor" href="#步骤-7-img-rar">¶</a>步骤 7 : img.rar</h3>
<p>这1777张产品图片就统一放在右侧的img.rar下载，后续学习要用到的时候，就在这里下载.</p>
<p>因为图片很多，在后续学习的每个知识点里的可运行项目下载里就不再提供图片下载了，否则每个都需要下载200M大小，给学习带来不便。</p>
<h2 id="4、FOREACTION"><a class="header-anchor" href="#4、FOREACTION">¶</a>4、FOREACTION</h2>
<h3 id="步骤-1-后台模块与Action对应关系"><a class="header-anchor" href="#步骤-1-后台模块与Action对应关系">¶</a>步骤 1 : 后台模块与Action对应关系</h3>
<p>回顾后台管理部分, 可以发现每个后台管理模块，都会对应一个Action类，比如：<br>
分类管理对应CategoryAction<br>
产品管理对应ProductAction<br>
。。。</p>
<p>因为分类管理模块，主要用到的还是Category，CategoryService， CategoryServiceImpl等类，这样思路清晰，需要修改也比较容易定位。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5299.png" alt></p>
<h3 id="步骤-2-前台模块与Action对应关系"><a class="header-anchor" href="#步骤-2-前台模块与Action对应关系">¶</a>步骤 2 : 前台模块与Action对应关系</h3>
<p>但是前台就不太一样了，比如首页，既有分类，又有产品，还有用户登录信息，购买数量信息。 那么前台页面与哪个Action对应合适呢？是对应CategoryAction呢？还是对应UserAction呢？ 似乎都不合适。</p>
<p>所以就创建了一个新的Action: ForeAction,专门用来对应前台页面的路径。</p>
<h3 id="步骤-3-ForeAction方法一览"><a class="header-anchor" href="#步骤-3-ForeAction方法一览">¶</a>步骤 3 : ForeAction方法一览</h3>
<p>ForeAction的内容比较多，而且还需要对现存的各种Service类进行改进才可以使用，这里就暂时不列出代码，而是在所有前台功能开发完毕之后，对其所有方法做了一个截图，供大家一览</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5301.png" alt></p>
<h2 id="5、FOREACTION-HOME"><a class="header-anchor" href="#5、FOREACTION-HOME">¶</a>5、FOREACTION.HOME()</h2>
<h3 id="步骤-1-明确需求-首页需要什么数据？"><a class="header-anchor" href="#步骤-1-明确需求-首页需要什么数据？">¶</a>步骤 1 : 明确需求,首页需要什么数据？</h3>
<p>那么首页需要什么数据呢？ 从 [首页展示需求分析]上来看：</p>
<ol>
<li>
<p>在横向导航栏上提供4个分类连接</p>
</li>
<li>
<p>在纵向导航栏上提供全部17个分类连接</p>
</li>
<li>
<p>当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的<strong>推荐产品列表</strong></p>
</li>
<li>
<p>按照每种分类显示5个商品的方式，显示所有17种分类<br>
<strong>注</strong> <strong>推荐产品列表</strong>就是如图所示的一个分类右边的产品列表。</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4937.png" alt></p>
<h3 id="步骤-2-Category"><a class="header-anchor" href="#步骤-2-Category">¶</a>步骤 2 : Category</h3>
<p>Category新增两个瞬时字段products和productsByRow。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Transient</span></span><br><span class="line">List&lt;Product&gt; products;</span><br><span class="line">   <span class="meta">@Transient</span></span><br><span class="line">List&lt;List&lt;Product&gt;&gt; productsByRow;</span><br></pre></td></tr></table></figure>
<p>products比较好理解，代表一个分类下有多个产品。</p>
<p>productsByRow这个属性的类型是List&lt;List<Product>&gt; productsByRow。<br>
即一个分类又对应多个 List<Product>，提供这个属性，是为了在首页竖状导航的分类名称右边显示<strong>推荐产品列表</strong>。</Product></Product></p>
<p>如截图所示，一个分类会对应多行产品，而一行产品里又有多个产品记录。<br>
为了实现界面上的这个功能，为Category类设计了<br>
List&lt;List<Product>&gt; productsByRow<br>
这样一个集合属性</Product></p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5302.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)   </span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    String name;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    List&lt;Product&gt; products;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    List&lt;List&lt;Product&gt;&gt; productsByRow;   </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Category [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Product&gt;&gt; getProductsByRow() &#123;</span><br><span class="line">        <span class="keyword">return</span> productsByRow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductsByRow</span><span class="params">(List&lt;List&lt;Product&gt;&gt; productsByRow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productsByRow = productsByRow;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-ProductService"><a class="header-anchor" href="#步骤-3-ProductService">¶</a>步骤 3 : ProductService</h3>
<p>ProductService新增加3个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-ProductServiceImpl"><a class="header-anchor" href="#步骤-4-ProductServiceImpl">¶</a>步骤 4 : ProductServiceImpl</h3>
<p>ProductServiceImpl为[ProductService]中新增加的三个方法提供实现。</p>
<ol>
<li>为分类填充产品集合</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span></span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>为多个分类填充产品集合</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br></pre></td></tr></table></figure>
<p>3.为多个分类填充推荐产品集合，即把分类下的产品集合，按照8个为一行，拆成多行，以利于后续页面上进行显示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            fill(category);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> productNumberEachRow = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            List&lt;Product&gt; products =  category.getProducts();</span><br><span class="line">            List&lt;List&lt;Product&gt;&gt; productsByRow =  <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; products.size(); i+=productNumberEachRow) &#123;</span><br><span class="line">                <span class="keyword">int</span> size = i+productNumberEachRow;</span><br><span class="line">                size= size&gt;products.size()?products.size():size;</span><br><span class="line">                List&lt;Product&gt; productsOfEachRow =products.subList(i, size);</span><br><span class="line">                productsByRow.add(productsOfEachRow);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            category.setProductsByRow(productsByRow);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products= listByParent(category);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);</span><br><span class="line">         </span><br><span class="line">        category.setProducts(products);</span><br><span class="line">         </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ForeAction-home-方法"><a class="header-anchor" href="#步骤-5-ForeAction-home-方法">¶</a>步骤 5 : ForeAction.home()方法</h3>
<p>home()方法映射首页访问路径 “forehome”.</p>
<ol>
<li>查询所有分类</li>
<li>为这些分类填充产品集合</li>
<li>为这些分类填充推荐产品集合</li>
<li>服务端跳转到home.jsp</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//每个产品集合显示8个产品</span></span><br><span class="line">        <span class="keyword">int</span> productNumberEachRow = <span class="number">8</span>;</span><br><span class="line">        <span class="comment">//对该产品类别集合进行操作</span></span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            <span class="comment">//获得该种类下的产品集合</span></span><br><span class="line">            List&lt;Product&gt; products =  category.getProducts();</span><br><span class="line">            <span class="comment">//新建集合，用于存放多个产品集合</span></span><br><span class="line">            List&lt;List&lt;Product&gt;&gt; productsByRow =  <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">//按照8个为一行</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; products.size(); i+=productNumberEachRow) &#123;</span><br><span class="line">                <span class="comment">//获取每个产品集合(加起来)该显示的产品数量</span></span><br><span class="line">                <span class="keyword">int</span> size = i+productNumberEachRow;</span><br><span class="line">                <span class="comment">//如果size大于某种类下的产品集合的大小，显示数量就采用产品集合内产品的数量，否则采用size</span></span><br><span class="line">                size= size&gt;products.size()?products.size():size;</span><br><span class="line">                <span class="comment">//每个种类下的产品集合的显示数量为8个，通过截取子集合，每显示8个换行，每一行都是一个子集合</span></span><br><span class="line">                List&lt;Product&gt; productsOfEachRow =products.subList(i, size);</span><br><span class="line">                <span class="comment">//将子集合放进一个存放集合的集合中</span></span><br><span class="line">                productsByRow.add(productsOfEachRow);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//种类获取集合集</span></span><br><span class="line">            category.setProductsByRow(productsByRow);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、HOME-JSP"><a class="header-anchor" href="#6、HOME-JSP">¶</a>6、HOME.JSP</h2>
<h3 id="步骤-1-前台页面的特点"><a class="header-anchor" href="#步骤-1-前台页面的特点">¶</a>步骤 1 : 前台页面的特点</h3>
<p>观察[模仿天猫前端]，可以发现前台页面有如下特点：</p>
<ol>
<li>有共同的置顶导航</li>
<li>有共同的搜索栏</li>
<li>有共同的页脚</li>
</ol>
<p>根据这样的特点，在设计前台jsp页面的时候，就制作了很多公共页面，其他前台页面就共享这些公共页面，使得开发和维护成本降低不少</p>
<h3 id="步骤-2-home-jsp-所包含页面"><a class="header-anchor" href="#步骤-2-home-jsp-所包含页面">¶</a>步骤 2 : home.jsp 所包含页面</h3>
<p>根据前台页面的特点，我们把home.jsp设计成如代码所示。</p>
<ol>
<li>header.jsp<br>
引入标准标签库，js,css，自定义javascript函数等</li>
<li>top.jsp<br>
置顶导航</li>
<li>search.jsp<br>
搜索栏</li>
<li>homePage.jsp<br>
首页业务页面</li>
<li>footer.jsp<br>
页脚</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4930.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/search.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/home/homePage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-header-jsp"><a class="header-anchor" href="#步骤-3-header-jsp">¶</a>步骤 3 : header.jsp</h3>
<p>header.jsp 做了如下工作</p>
<ol>
<li>声明为html5格式</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br></pre></td></tr></table></figure>
<p>2.让浏览器以UTF显示中文，本页面的中文文字采用UTF-8编码，启动EL表达式</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>引入标准标签库</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix=<span class="string">'fmt'</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>c通常用于条件判断和遍历<br>
fmt用于格式化日期和货币<br>
fn用于校验长度<br>
更多的关于JSTL的查看[这里]</p>
<ol start="4">
<li>引入bootstrap和jquery</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src="js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">"css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">&lt;script src="js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>自定义前端样式</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href=<span class="string">"css/fore/style.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>除了轮播和图标，前端几乎没用Bootstrap中的样式，所有的自定义样式都在这个文件里。</p>
<ol start="6">
<li>各种自定义函数和事件监听。<br>
这些内容在[模仿天猫前端教程]中详细讲解，本项目专注于服务端的内容，就不一一展开了</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix=<span class="string">'fmt'</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src="js/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/bootstrap/3.3.6/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="js/bootstrap/3.3.6/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"css/fore/style.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">formatMoney</span><span class="params">(num)</span></span>&#123;</span><br><span class="line">    num = num.toString().replace(/\$|\,/g,<span class="string">''</span>); </span><br><span class="line">    <span class="keyword">if</span>(isNaN(num)) </span><br><span class="line">        num = <span class="string">"0"</span>; </span><br><span class="line">    sign = (num == (num = Math.abs(num))); </span><br><span class="line">    num = Math.floor(num*<span class="number">100</span>+<span class="number">0.50000000001</span>); </span><br><span class="line">    cents = num%<span class="number">100</span>; </span><br><span class="line">    num = Math.floor(num/<span class="number">100</span>).toString(); </span><br><span class="line">    <span class="keyword">if</span>(cents&lt;<span class="number">10</span>) </span><br><span class="line">    cents = <span class="string">"0"</span> + cents; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; Math.floor((num.length-(<span class="number">1</span>+i))/<span class="number">3</span>); i++) </span><br><span class="line">    num = num.substring(<span class="number">0</span>,num.length-(<span class="number">4</span>*i+<span class="number">3</span>))+<span class="string">','</span>+ </span><br><span class="line">    num.substring(num.length-(<span class="number">4</span>*i+<span class="number">3</span>)); </span><br><span class="line">    <span class="keyword">return</span> (((sign)?<span class="string">''</span>:<span class="string">'-'</span>) + num + <span class="string">'.'</span> + cents); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">checkEmpty</span><span class="params">(id, name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = $(<span class="string">"#"</span>+id).val();</span><br><span class="line">    <span class="keyword">if</span>(value.length==<span class="number">0</span>)&#123;</span><br><span class="line">         </span><br><span class="line">        $(<span class="string">"#"</span>+id)[<span class="number">0</span>].focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$(function()&#123;</span><br><span class="line"> </span><br><span class="line">    $(<span class="string">"a.productDetailTopReviewLink"</span>).click(function()&#123;</span><br><span class="line">        $(<span class="string">"div.productReviewDiv"</span>).show();</span><br><span class="line">        $(<span class="string">"div.productDetailDiv"</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"a.productReviewTopPartSelectedLink"</span>).click(function()&#123;</span><br><span class="line">        $(<span class="string">"div.productReviewDiv"</span>).hide();</span><br><span class="line">        $(<span class="string">"div.productDetailDiv"</span>).show();      </span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"span.leaveMessageTextareaSpan"</span>).hide();</span><br><span class="line">    $(<span class="string">"img.leaveMessageImg"</span>).click(function()&#123;</span><br><span class="line">         </span><br><span class="line">        $(<span class="keyword">this</span>).hide();</span><br><span class="line">        $(<span class="string">"span.leaveMessageTextareaSpan"</span>).show();</span><br><span class="line">        $(<span class="string">"div.orderItemSumDiv"</span>).css(<span class="string">"height"</span>,<span class="string">"100px"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"div#footer a[href$=#nowhere]"</span>).click(function()&#123;</span><br><span class="line">        alert(<span class="string">"模仿天猫的连接，并没有跳转到实际的页面"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"a.wangwanglink"</span>).click(function()&#123;</span><br><span class="line">        alert(<span class="string">"模仿旺旺的图标，并不会打开旺旺"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"a.notImplementLink"</span>).click(function()&#123;</span><br><span class="line">        alert(<span class="string">"这个功能没做，蛤蛤~"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-top-jsp"><a class="header-anchor" href="#步骤-4-top-jsp">¶</a>步骤 4 : top.jsp</h3>
<p>置顶导航页面<br>
这里会根据用户是否登录，决定是否显示退出按钮，或者登录注册按钮，以及购物车中的商品数量</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4932.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;nav <span class="class"><span class="keyword">class</span></span>=<span class="string">"top "</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"top_middle"</span>&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">            &lt;span style="color:#C40000;margin:0px" class=" glyphicon glyphicon-home redColor"&gt;&lt;/span&gt;</span><br><span class="line">            天猫首页</span><br><span class="line">        &lt;/a&gt; </span><br><span class="line">         </span><br><span class="line">        &lt;span&gt;喵，欢迎来天猫&lt;/span&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty user&#125;"</span>&gt;</span><br><span class="line">            &lt;a href="login.jsp"&gt;$&#123;user.name&#125;&lt;/a&gt;</span><br><span class="line">            &lt;a href="forelogout"&gt;退出&lt;/a&gt;    </span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty user&#125;"</span>&gt;</span><br><span class="line">            &lt;a href="login.jsp"&gt;请登录&lt;/a&gt;</span><br><span class="line">            &lt;a href="register.jsp"&gt;免费注册&lt;/a&gt;    </span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-right"</span>&gt;</span><br><span class="line">            &lt;a href="forebought"&gt;我的订单&lt;/a&gt;</span><br><span class="line">            &lt;a href=<span class="string">"forecart"</span>&gt;</span><br><span class="line">            &lt;span style="color:#C40000;margin:0px" class=" glyphicon glyphicon-shopping-cart redColor"&gt;&lt;/span&gt;</span><br><span class="line">            购物车&lt;strong&gt;$&#123;cartTotalItemNumber&#125;&lt;/strong&gt;件&lt;/a&gt;      </span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-search-jsp"><a class="header-anchor" href="#步骤-5-search-jsp">¶</a>步骤 5 : search.jsp</h3>
<p>这里会从session的属性&quot;cs&quot; 中获取到分类集合，并取第5个到第8个，一共4个来显示。 session的cs又是哪里放进去的呢？ 在后面的拦截器章节会讲到。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchOutDiv"</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"logo"</span> src=<span class="string">"img/site/logo.gif"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"logo"</span>&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">    &lt;form action=<span class="string">"foresearch"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchDiv"</span>&gt;</span><br><span class="line">            &lt;input name=<span class="string">"keyword"</span> type=<span class="string">"text"</span> value=<span class="string">"$&#123;param.keyword&#125;"</span> placeholder=<span class="string">"时尚男鞋  太阳镜 "</span>&gt;</span><br><span class="line">            &lt;button  type="submit" class="searchButton"&gt;搜索&lt;/button&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchBelow"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;cs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&gt;=5 and st.count&lt;=8&#125;"</span>&gt;</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                                $&#123;c.name&#125;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count!=8&#125;"</span>&gt;             </span><br><span class="line">                                &lt;span&gt;|&lt;/span&gt;             </span><br><span class="line">                            &lt;/c:if&gt;</span><br><span class="line">                        &lt;/span&gt;          </span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;     </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;  </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-homePage-jsp"><a class="header-anchor" href="#步骤-6-homePage-jsp">¶</a>步骤 6 : homePage.jsp</h3>
<p>这是首页业务页面，将在[homePage.jsp]中详细讲解，在此就不展开了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;模仿天猫官网&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"homepageDiv"</span>&gt;</span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"categoryAndcarousel.jsp"</span>%&gt;</span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"homepageCategoryProducts.jsp"</span>%&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-footer-jsp"><a class="header-anchor" href="#步骤-7-footer-jsp">¶</a>步骤 7 : footer.jsp</h3>
<p>页脚部分,除了显示页脚的静态信息外，还包含了modal.jsp<br>
这个modal.jsp里提供了两个模态窗口</p>
<ol>
<li>登录模态窗口<br>
当用户在未登录状态，于产品页点击购买的时候会弹出</li>
<li>删除模态窗口<br>
当用户在我的订单页面,和购物车页面进行删除操作的时候，就会弹出模态删除窗口。</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4935.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"modal.jsp"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div id=<span class="string">"footer"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"footer"</span> style=<span class="string">"display: block;"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div id=<span class="string">"footer_ensure"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"footer_ensure"</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">"#nowhere"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/site/ensure.png"</span>&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"horizontal_line"</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;div id=<span class="string">"footer_desc"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"footer_desc"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"descColumn"</span>&gt;</span><br><span class="line">                &lt;span class="descColumnTitle"&gt;购物指南&lt;/span&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;免费注册&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;开通支付宝&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;支付宝充值&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"descColumn"</span>&gt;</span><br><span class="line">                &lt;span class="descColumnTitle"&gt;天猫保障&lt;/span&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;发票保障&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;售后规则&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;缺货赔付&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"descColumn"</span>&gt;</span><br><span class="line">                &lt;span class="descColumnTitle"&gt;支付方式&lt;/span&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;快捷支付&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;信用卡&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;蚂蚁花呗&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;货到付款&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"descColumn"</span>&gt;</span><br><span class="line">                &lt;span class="descColumnTitle"&gt;商家服务&lt;/span&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;商家入驻&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;商家中心&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;天猫智库&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;天猫规则&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;物流服务&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;喵言喵语&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;运营服务&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"descColumn"</span>&gt;</span><br><span class="line">                &lt;span class="descColumnTitle"&gt;手机天猫&lt;/span&gt;</span><br><span class="line">                &lt;a href="#nowhere" &gt;&lt;img src="img/site/ma.png"&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div id=<span class="string">"copyright"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"copyright"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"coptyrightMiddle"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"cateye"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cateye"</span> src=<span class="string">"img/site/cateye.png"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"white_link"</span> &gt;</span><br><span class="line">            &lt;a href="#nowhere" style="padding-left:0px" &gt;关于天猫&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt; 帮助中心&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;开放平台&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  诚聘英才&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;联系我们&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;网站合作&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;法律声明&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;知识产权&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  廉正举报    &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"white_link"</span> &gt;</span><br><span class="line">            &lt;a href="#nowhere"  style="padding-left:0px"&gt; 阿里巴巴集团&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt; 淘宝网&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;天猫 &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  聚划算&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;全球速卖通&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;阿里巴巴国际交易市场&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;1688&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;阿里妈妈&lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  阿里旅行·去啊 &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  阿里云计算   &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  阿里通信    &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  YunOS   &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  阿里旅行·去啊 &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;   万网 &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  高德  &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt; 优视   &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  友盟  &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  虾米  &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  天天动听    &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  来往  &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  钉钉  &lt;/a&gt;&lt;span class="slash"&gt;|&lt;/span&gt;</span><br><span class="line">            &lt;a href="#nowhere" &gt;  支付宝         &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"license"</span>&gt;</span><br><span class="line">            &lt;span&gt;增值电信业务经营许可证： 浙B2-20110446&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;网络文化经营许可证：浙网文[2015]0295-065号&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;互联网医疗保健信息服务 审核同意书 浙卫网审【2014】6号 &lt;/span&gt;</span><br><span class="line">            &lt;span&gt;互联网药品信息服务资质证书编号：浙-（经营性）-2012-0005&lt;/span&gt;</span><br><span class="line">            &lt;div class="copyRightYear"&gt;© 2003-2016 TMALL.COM 版权所有&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/site/copyRight1.jpg"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/site/copyRight2.jpg"</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal "</span> id=<span class="string">"loginModal"</span> tabindex=<span class="string">"-1"</span> role=<span class="string">"dialog"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-dialog loginDivInProductPageModalDiv"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-content"</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginDivInProductPage"</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginErrorMessageDiv"</span>&gt;</span><br><span class="line">                            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"alert alert-danger"</span> &gt;</span><br><span class="line">                              &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;</span><br><span class="line">                                &lt;span class="errorMessage"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                             </span><br><span class="line">                        &lt;div class="login_acount_text"&gt;账户登录&lt;/div&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                                &lt;span class=" glyphicon glyphicon-user"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"name"</span> name=<span class="string">"name"</span> placeholder=<span class="string">"手机/会员名/邮箱"</span> type=<span class="string">"text"</span>&gt;        </span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                                &lt;span class=" glyphicon glyphicon-lock"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"password"</span> name=<span class="string">"password"</span>  type=<span class="string">"password"</span> placeholder=<span class="string">"密码"</span> type=<span class="string">"text"</span>&gt;          </span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                                    &lt;span class="text-danger"&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">                        &lt;div&gt;</span><br><span class="line">                            &lt;a href="#nowhere"&gt;忘记登录密码&lt;/a&gt;</span><br><span class="line">                            &lt;a href="register.jsp" class="pull-right"&gt;免费注册&lt;/a&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div style=<span class="string">"margin-top:20px"</span>&gt;</span><br><span class="line">                            &lt;button class="btn btn-block redButton loginSubmitButton" type="submit"&gt;登录&lt;/button&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;   </span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal"</span> id=<span class="string">"deleteConfirmModal"</span> tabindex=<span class="string">"-1"</span> role=<span class="string">"dialog"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-dialog deleteConfirmModalDiv"</span>&gt;</span><br><span class="line">       &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-content"</span>&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-header"</span>&gt;</span><br><span class="line">            &lt;button data-dismiss="modal" class="close" type="button"&gt;&lt;span aria-hidden="true"&gt;×&lt;/span&gt;&lt;span class="sr-only"&gt;Close&lt;/span&gt;&lt;/button&gt;</span><br><span class="line">            &lt;h4 class="modal-title"&gt;确认删除？&lt;/h4&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-footer"</span>&gt;</span><br><span class="line">            &lt;button data-dismiss="modal" class="btn btn-default" type="button"&gt;关闭&lt;/button&gt;</span><br><span class="line">            &lt;button class="btn btn-primary deleteConfirmButton" id="submit" type="button"&gt;确认&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="7、HOMEPAGE-JSP"><a class="header-anchor" href="#7、HOMEPAGE-JSP">¶</a>7、HOMEPAGE.JSP</h2>
<h3 id="步骤-1-homePage-jsp-的复杂性"><a class="header-anchor" href="#步骤-1-homePage-jsp-的复杂性">¶</a>步骤 1 : homePage.jsp 的复杂性</h3>
<p>在homePage中要显示如下内容<br>
1 天猫超市连接右侧有4个分类数据<br>
2 竖状导航栏显示17个分类数据<br>
3 每个分类又再对应不同的推荐产品集合<br>
4 中部会显示17个分类<br>
5 每个分类又显示前5款产品<br>
6 每款产品又会显示第一张图片，标题，价格等信息</p>
<p>倘若把这些功能都在一个jsp中开发出来看，那么这个jsp就会变得非常的长，并且难以维护和扩展。在这里，就可以借鉴[home.jsp]的思路，把一个大的页面，拆成各个小的jsp，这样维护起来就相对容易了</p>
<h3 id="步骤-2-homePage-jsp-所包含页面关系"><a class="header-anchor" href="#步骤-2-homePage-jsp-所包含页面关系">¶</a>步骤 2 : homePage.jsp 所包含页面关系</h3>
<ol>
<li>categoryAndcarousel.jsp<br>
分类和轮播<br>
1.1 categoryMenu.jsp<br>
竖状分类菜单<br>
1.2 productsAsideCategorys.jsp<br>
竖状分类菜单右侧的推荐产品列表<br>
1.3 carousel.jsp<br>
轮播</li>
<li>homepageCategoryProducts.jsp<br>
主题的17种分类以及每种分类对应的5个产品</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4940.png" alt></p>
<h3 id="步骤-3-categoryAndcarousel-jsp"><a class="header-anchor" href="#步骤-3-categoryAndcarousel-jsp">¶</a>步骤 3 : categoryAndcarousel.jsp</h3>
<p>categoryAndcarousel.jsp 页面利用ForeAction传递过来的数据，天猫国际几个字旁边显示4个分类超链<br>
另外包含了其他3个页面：<br>
categoryMenu.jsp<br>
productsAsideCategorys.jsp<br>
carousel.jsp<br>
这3个页面在接下来的步骤就会讲到</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4941.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">showProductsAsideCategorys</span><span class="params">(cid)</span></span>&#123;</span><br><span class="line">    $(<span class="string">"div.eachCategory[cid="</span>+cid+<span class="string">"]"</span>).css(<span class="string">"background-color"</span>,<span class="string">"white"</span>);</span><br><span class="line">    $(<span class="string">"div.eachCategory[cid="</span>+cid+<span class="string">"] a"</span>).css(<span class="string">"color"</span>,<span class="string">"#87CEFA"</span>);</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys[cid="</span>+cid+<span class="string">"]"</span>).show();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">function <span class="title">hideProductsAsideCategorys</span><span class="params">(cid)</span></span>&#123;</span><br><span class="line">    $(<span class="string">"div.eachCategory[cid="</span>+cid+<span class="string">"]"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#e2e2e3"</span>);</span><br><span class="line">    $(<span class="string">"div.eachCategory[cid="</span>+cid+<span class="string">"] a"</span>).css(<span class="string">"color"</span>,<span class="string">"#000"</span>);</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys[cid="</span>+cid+<span class="string">"]"</span>).hide();</span><br><span class="line">&#125;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"div.eachCategory"</span>).mouseenter(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> cid = $(<span class="keyword">this</span>).attr(<span class="string">"cid"</span>);</span><br><span class="line">        showProductsAsideCategorys(cid);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"div.eachCategory"</span>).mouseleave(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> cid = $(<span class="keyword">this</span>).attr(<span class="string">"cid"</span>);</span><br><span class="line">        hideProductsAsideCategorys(cid);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys"</span>).mouseenter(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> cid = $(<span class="keyword">this</span>).attr(<span class="string">"cid"</span>);</span><br><span class="line">        showProductsAsideCategorys(cid);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys"</span>).mouseleave(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> cid = $(<span class="keyword">this</span>).attr(<span class="string">"cid"</span>);</span><br><span class="line">        hideProductsAsideCategorys(cid);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"div.rightMenu span"</span>).mouseenter(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> left = $(<span class="keyword">this</span>).position().left;</span><br><span class="line">        <span class="keyword">var</span> top = $(<span class="keyword">this</span>).position().top;</span><br><span class="line">        <span class="keyword">var</span> width = $(<span class="keyword">this</span>).css(<span class="string">"width"</span>);</span><br><span class="line">        <span class="keyword">var</span> destLeft = parseInt(left) + parseInt(width)/<span class="number">2</span>;</span><br><span class="line">        $(<span class="string">"img#catear"</span>).css(<span class="string">"left"</span>,destLeft);</span><br><span class="line">        $(<span class="string">"img#catear"</span>).css(<span class="string">"top"</span>,top-<span class="number">20</span>);</span><br><span class="line">        $(<span class="string">"img#catear"</span>).fadeIn(<span class="number">500</span>);</span><br><span class="line">                 </span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"div.rightMenu span"</span>).mouseleave(function()&#123;</span><br><span class="line">        $(<span class="string">"img#catear"</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">var</span> left = $(<span class="string">"div#carousel-of-product"</span>).offset().left;</span><br><span class="line">    $(<span class="string">"div.categoryMenu"</span>).css(<span class="string">"left"</span>,left-<span class="number">20</span>);</span><br><span class="line">    $(<span class="string">"div.categoryWithCarousel div.head"</span>).css(<span class="string">"margin-left"</span>,left);</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys"</span>).css(<span class="string">"left"</span>,left-<span class="number">20</span>);</span><br><span class="line">     </span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;img src=<span class="string">"img/site/catear.png"</span> id=<span class="string">"catear"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"catear"</span>/&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"categoryWithCarousel"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"headbar show1"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"head "</span>&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;span style="margin-left:10px" class="glyphicon glyphicon-th-list"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span style="margin-left:10px" &gt;商品分类&lt;/span&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"rightMenu"</span>&gt;</span><br><span class="line">        &lt;span&gt;&lt;a href=""&gt;&lt;img src="img/site/chaoshi.png"/&gt;&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;&lt;a href=""&gt;&lt;img src="img/site/guoji.png"/&gt;&lt;/a&gt;&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&lt;=4&#125;"</span>&gt;</span><br><span class="line">                &lt;span&gt;</span><br><span class="line">                &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                    $&#123;c.name&#125;</span><br><span class="line">                &lt;/a&gt;&lt;/span&gt;        </span><br><span class="line">            &lt;/c:if&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div style=<span class="string">"position: relative"</span>&gt;</span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"categoryMenu.jsp"</span> %&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div style=<span class="string">"position: relative;left: 0;top: 0;"</span>&gt;</span><br><span class="line">    &lt;%<span class="meta">@include</span> file=<span class="string">"productsAsideCategorys.jsp"</span> %&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"carousel.jsp"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"carouselBackgroundDiv"</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-categoryMenu-jsp"><a class="header-anchor" href="#步骤-4-categoryMenu-jsp">¶</a>步骤 4 : categoryMenu.jsp</h3>
<p>categoryMenu.jsp 显示左侧的竖状分类导航</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4942.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"categoryMenu"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">            &lt;div cid=<span class="string">"$&#123;c.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"eachCategory"</span>&gt;</span><br><span class="line">                &lt;span class="glyphicon glyphicon-link"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                    $&#123;c.name&#125;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-productsAsideCategorys-jsp"><a class="header-anchor" href="#步骤-5-productsAsideCategorys-jsp">¶</a>步骤 5 : productsAsideCategorys.jsp</h3>
<p>productsAsideCategorys.jsp 进行了三层遍历</p>
<ol>
<li>先取出每个分类</li>
<li>然后取出每个分类的productsByRow集合</li>
<li>根据productsByRow集合，取出每个产品，把产品的subTitle信息里的第一个单词取出来显示。</li>
</ol>
<p>JQuery代码解释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">这个是用于随机挑选一个产品作为推荐产品，来进行高亮显示。 严格的说，应该是后台设置那个产品是推荐产品，不过这里偷懒了，直接在前端按照<span class="number">20</span>%的概率，随机挑选了一个产品。</span><br><span class="line">$(<span class="string">"div.productsAsideCategorys div.row a"</span>).each(function()&#123;</span><br><span class="line">	<span class="keyword">var</span> v = Math.round(Math.random() *<span class="number">6</span>);</span><br><span class="line">	<span class="keyword">if</span>(v == <span class="number">1</span>)</span><br><span class="line">		$(<span class="keyword">this</span>).css(<span class="string">"color"</span>,<span class="string">"#87CEFA"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4943.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"div.productsAsideCategorys div.row a"</span>).each(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> v = Math.round(Math.random() *<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">if</span>(v == <span class="number">1</span>)</span><br><span class="line">            $(<span class="keyword">this</span>).css(<span class="string">"color"</span>,<span class="string">"#87CEFA"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span>&gt;</span><br><span class="line">    &lt;div cid=<span class="string">"$&#123;c.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"productsAsideCategorys"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;c.productsByRow&#125;"</span> <span class="keyword">var</span>=<span class="string">"ps"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"row "</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;ps&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty p.subTitle&#125;"</span>&gt;</span><br><span class="line">                        &lt;a href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">                            &lt;c:forEach items=<span class="string">"$&#123;fn:split(p.subTitle, ' ')&#125;"</span> <span class="keyword">var</span>=<span class="string">"title"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.index==0&#125;"</span>&gt;</span><br><span class="line">                                    $&#123;title&#125;</span><br><span class="line">                                &lt;/c:if&gt;</span><br><span class="line">                            &lt;/c:forEach&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">                &lt;div class="seperator"&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;       </span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;           </span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-carousel-jsp"><a class="header-anchor" href="#步骤-6-carousel-jsp">¶</a>步骤 6 : carousel.jsp</h3>
<p>轮播部分，都是静态的页面，没有用到服务端数据</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4944.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div id=<span class="string">"carousel-of-product"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"carousel-of-product carousel slide1"</span> data-ride=<span class="string">"carousel"</span>&gt;</span><br><span class="line">  &lt;!-- Indicators --&gt;</span><br><span class="line">  &lt;ol <span class="class"><span class="keyword">class</span></span>=<span class="string">"carousel-indicators"</span>&gt;</span><br><span class="line">    &lt;li data-target="#carousel-of-product" data-slide-to="0" class="active"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li data-target="#carousel-of-product" data-slide-to="1"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li data-target="#carousel-of-product" data-slide-to="2"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li data-target="#carousel-of-product" data-slide-to="3"&gt;&lt;/li&gt;</span><br><span class="line">  &lt;/ol&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;!-- Wrapper <span class="keyword">for</span> slides --&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"carousel-inner"</span> role=<span class="string">"listbox"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item active"</span>&gt;</span><br><span class="line">      &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"carousel carouselImage"</span> src=<span class="string">"img/lunbo/1.jpg"</span> &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span>&gt;</span><br><span class="line">      &lt;img  <span class="class"><span class="keyword">class</span></span>=<span class="string">"carouselImage"</span> src=<span class="string">"img/lunbo/2.jpg"</span> &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span>&gt;</span><br><span class="line">        &lt;img  <span class="class"><span class="keyword">class</span></span>=<span class="string">"carouselImage"</span> src=<span class="string">"img/lunbo/3.jpg"</span> &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span>&gt;</span><br><span class="line">        &lt;img  <span class="class"><span class="keyword">class</span></span>=<span class="string">"carouselImage"</span> src=<span class="string">"img/lunbo/4.jpg"</span> &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;!-- Controls --&gt;</span><br><span class="line">&lt;!--   &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"left carousel-control"</span> href=<span class="string">"#carousel-of-product"</span> role=<span class="string">"button"</span> data-slide=<span class="string">"prev"</span>&gt; --&gt;</span><br><span class="line">&lt;!--     &lt;span class="glyphicon glyphicon-chevron-left" aria-hidden="true"&gt;&lt;/span&gt; --&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!--   &lt;/a&gt; --&gt;</span><br><span class="line">&lt;!--   &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"right carousel-control"</span> href=<span class="string">"#carousel-of-product"</span> role=<span class="string">"button"</span> data-slide=<span class="string">"next"</span>&gt; --&gt;</span><br><span class="line">&lt;!--     &lt;span class="glyphicon glyphicon-chevron-right" aria-hidden="true"&gt;&lt;/span&gt; --&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!--   &lt;/a&gt; --&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-homepageCategoryProducts-jsp"><a class="header-anchor" href="#步骤-7-homepageCategoryProducts-jsp">¶</a>步骤 7 : homepageCategoryProducts.jsp</h3>
<p>homepageCategoryProducts.jsp 进行了2次遍历</p>
<ol>
<li>遍历所有的分类，取出每个分类对象</li>
<li>遍历分类对象的products集合，取出每个产品，然后显示该产品的标题，图片，价格等信息</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4945.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">    &lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"100"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">    &lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"$&#123;param.categorycount&#125;"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"homepageCategoryProducts"</span>&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;categorys&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"stc"</span>&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;stc.count&lt;=categorycount&#125;"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"eachHomepageCategoryProducts"</span>&gt;</span><br><span class="line">                &lt;div class="left-mark"&gt;&lt;/div&gt;</span><br><span class="line">                &lt;span class="categoryTitle"&gt;$&#123;c.name&#125;&lt;/span&gt;</span><br><span class="line">                &lt;br&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;c.products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&lt;=5&#125;"</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productItem"</span> &gt;</span><br><span class="line">                            &lt;a href="foreproduct?product.id=$&#123;p.id&#125;"&gt;&lt;img width="100px" src="img/productSingle_middle/$&#123;p.firstProductImage.id&#125;.jpg"&gt;&lt;/a&gt;</span><br><span class="line">                            &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"productItemDescLink"</span> href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">                                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"productItemDesc"</span>&gt;[热销]</span><br><span class="line">                                $&#123;fn:substring(p.name, <span class="number">0</span>, <span class="number">20</span>)&#125;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"productPrice"</span>&gt;</span><br><span class="line">                                &lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;p.promotePrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/c:if&gt;              </span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">                &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;img id=<span class="string">"endpng"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"endpng"</span> src=<span class="string">"img/site/end.png"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-总结"><a class="header-anchor" href="#步骤-8-总结">¶</a>步骤 8 : 总结</h3>
<p>虽然首页显示的内容非常多，可以说是前端里最复杂的一个展示页面，但是通过这种拆成小块jsp的思路，每个jsp页面的功能就相对单一了。 可以更好的帮助大家理解。</p>
<h1 id="十二、前台-无需登录"><a class="header-anchor" href="#十二、前台-无需登录">¶</a>十二、前台-无需登录</h1>
<h2 id="1、概述-v9"><a class="header-anchor" href="#1、概述-v9">¶</a>1、概述</h2>
<p>通过[前台-首页]的学习，就把前台的思路都理顺了，包括Action的调用流程，JSP页面的包含关系等。在此基础上，学习其他前台页面就更加容易理解了。<br>
根据模仿天猫的前台功能特点，我们把前台功能分为两部分</p>
<ol>
<li>
<p>无需登录<br>
有一些功能，无需登录也可以使用的，比如登录，注册本身，分类页面，查询，产品页面等</p>
</li>
<li>
<p>需要登录<br>
有一些功能，必须建立在已经登录的基础之上，比如购买，加入购物车，查看购物车，结算页面，订单页面等等。</p>
</li>
</ol>
<p>接下来先讲解无需登录的功能，然后再是需要登录的前台功能。</p>
<h2 id="2、注册"><a class="header-anchor" href="#2、注册">¶</a>2、注册</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v12"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v12">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。</p>
<p>下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小)<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载</p>
<h3 id="步骤-2-模仿和排错-v10"><a class="header-anchor" href="#步骤-2-模仿和排错-v10">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v5"><a class="header-anchor" href="#步骤-3-效果截图-v5">¶</a>步骤 3 : 效果截图</h3>
<p>如图所示，当使用已经存在的名称进行注册的时候，会提示已经被使用。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5028.png" alt></p>
<h3 id="步骤-4-register-jsp"><a class="header-anchor" href="#步骤-4-register-jsp">¶</a>步骤 4 : register.jsp</h3>
<p>与首页的[home.jsp]相仿，register.jsp也包含了[header.jsp],[top.jsp],[footer.jsp]等公共页面。<br>
不同的是，没有使用首页的[search.jsp],而是用的简单一点的 [simpleSearch.jsp]</p>
<p>中间是注册业务页面[registerPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/registerPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-simpleSearch-jsp"><a class="header-anchor" href="#步骤-5-simpleSearch-jsp">¶</a>步骤 5 : simpleSearch.jsp</h3>
<p>与[首页的search.jsp]不太一样的是，这个搜索栏要更简单一些，并且左右分开。</p>
<p><strong>注：</strong> 这里${cs} 中用到的数据，将会在后续的拦截器中讲解。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5031.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleSearchOutDiv"</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"simpleLogo"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleLogo"</span> src=<span class="string">"img/site/simpleLogo.png"</span>&gt;   </span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;form action=<span class="string">"foresearch"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleSearchDiv pull-right"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"平衡车 原汁机"</span>  value=<span class="string">"$&#123;param.keyword&#125;"</span> name=<span class="string">"keyword"</span>&gt;</span><br><span class="line">        &lt;button class="searchButton" type="submit"&gt;搜天猫&lt;/button&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchBelow"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;cs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&gt;=8 and st.count&lt;=11&#125;"</span>&gt;</span><br><span class="line">                    &lt;span&gt;</span><br><span class="line">                        &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                            $&#123;c.name&#125;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count!=11&#125;"</span>&gt;            </span><br><span class="line">                            &lt;span&gt;|&lt;/span&gt;             </span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                    &lt;/span&gt;          </span><br><span class="line">                &lt;/c:if&gt;</span><br><span class="line">            &lt;/c:forEach&gt;         </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-registerPage-jsp"><a class="header-anchor" href="#步骤-6-registerPage-jsp">¶</a>步骤 6 : registerPage.jsp</h3>
<p>注册页面的主体功能，用于提交账号密码。 在提交之前会进行为空验证，以及密码是否一致验证。</p>
<p>这段代码用于当账号提交到服务端，服务端判断当前账号已经存在的情况下，显示返回的错误提示 <strong>&quot;用户名已经被使用,不能使用&quot;</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty msg&#125;"</span>&gt;</span><br><span class="line">$(<span class="string">"span.errorMessage"</span>).html(<span class="string">"$&#123;msg&#125;"</span>);</span><br><span class="line">$(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);		</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty msg&#125;"</span>&gt;</span><br><span class="line">    $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"$&#123;msg&#125;"</span>);</span><br><span class="line">    $(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);      </span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".registerForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==$(<span class="string">"#name"</span>).val().length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入用户名"</span>);</span><br><span class="line">            $(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==$(<span class="string">"#password"</span>).val().length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入密码"</span>);</span><br><span class="line">            $(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==$(<span class="string">"#repeatpassword"</span>).val().length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入重复密码"</span>);</span><br><span class="line">            $(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">if</span>($(<span class="string">"#password"</span>).val() !=$(<span class="string">"#repeatpassword"</span>).val())&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"重复密码不一致"</span>);</span><br><span class="line">            $(<span class="string">"div.registerErrorMessageDiv"</span>).css(<span class="string">"visibility"</span>,<span class="string">"visible"</span>);          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;      </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"foreregister"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerForm"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerErrorMessageDiv"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"alert alert-danger"</span> role=<span class="string">"alert"</span>&gt;</span><br><span class="line">          &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;</span><br><span class="line">            &lt;span class="errorMessage"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;       </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerTable"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td  class="registerTip registerTableLeftTD"&gt;设置会员名&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td class="registerTableLeftTD"&gt;登陆名&lt;/td&gt;</span><br><span class="line">            &lt;td  class="registerTableRightTD"&gt;&lt;input id="name" name="user.name" placeholder="会员名一旦设置成功，无法修改" &gt; &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td  class="registerTip registerTableLeftTD"&gt;设置登陆密码&lt;/td&gt;</span><br><span class="line">            &lt;td  class="registerTableRightTD"&gt;登陆时验证，保护账号信息&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;    </span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td class="registerTableLeftTD"&gt;登陆密码&lt;/td&gt;</span><br><span class="line">            &lt;td class="registerTableRightTD"&gt;&lt;input id="password" name="user.password" type="password"  placeholder="设置你的登陆密码" &gt; &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td class="registerTableLeftTD"&gt;密码确认&lt;/td&gt;</span><br><span class="line">            &lt;td class="registerTableRightTD"&gt;&lt;input id="repeatpassword" type="password"   placeholder="请再次输入你的密码" &gt; &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">                 </span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">"2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerButtonTD"</span>&gt;</span><br><span class="line">                &lt;a href="registerSuccess.jsp"&gt;&lt;button&gt;提   交&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;            </span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-UserService"><a class="header-anchor" href="#步骤-7-UserService">¶</a>步骤 7 : UserService</h3>
<p>UserService增加一个判断用户是否存在的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">(String name)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-UserServiceImpl"><a class="header-anchor" href="#步骤-8-UserServiceImpl">¶</a>步骤 8 : UserServiceImpl</h3>
<p>UserServiceImpl实现isExist方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        List l = list(<span class="string">"name"</span>,name);</span><br><span class="line">        <span class="keyword">if</span>(!l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-ForeAction-register"><a class="header-anchor" href="#步骤-9-ForeAction-register">¶</a>步骤 9 : ForeAction.register()</h3>
<p>[registerPage.jsp] 的form提交数据到路径 foreregister,导致ForeAction.register()方法被调用</p>
<ol>
<li>
<p>通过HtmlUtils.htmlEscape();把账号里的特殊符号进行转义</p>
</li>
<li>
<p>判断用户名是否存在<br>
2.1 如果已经存在，就服务端跳转到reigster.jsp，并且带上错误提示信息<br>
2.2 如果不存在，则加入到数据库中，并客户端跳转到registerSuccess.jsp页面</p>
</li>
</ol>
<p>**注：**为什么要用 HtmlUtils.htmlEscape？ 因为有些同学在恶意注册的时候，会使用诸如 &lt;script&gt;alert(‘papapa’)&lt;/script&gt; 这样的名称，会导致网页打开就弹出一个对话框。 那么在转义之后，就没有这个问题了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">    <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">         msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">     &#125;</span><br><span class="line">     userService.save(user);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    String msg;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-registerSuccess-jsp"><a class="header-anchor" href="#步骤-10-registerSuccess-jsp">¶</a>步骤 10 : registerSuccess.jsp</h3>
<p>也是各种包含，不再赘述。<br>
内容页面在 [registerSuccessPage.jsp]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5034.png" alt></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/registerSuccessPage.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-registerSuccessPage-jsp"><a class="header-anchor" href="#步骤-11-registerSuccessPage-jsp">¶</a>步骤 11 : registerSuccessPage.jsp</h3>
<p>很简单，就不说了~</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5035.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"registerSuccessDiv"</span>&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;img src=<span class="string">"img/site/registerSuccess.png"</span>&gt;</span><br><span class="line">            恭喜注册成功</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3、ACTION重构-参数"><a class="header-anchor" href="#3、ACTION重构-参数">¶</a>3、ACTION重构-参数</h2>
<h3 id="步骤-1-ForeAction中的参数msg"><a class="header-anchor" href="#步骤-1-ForeAction中的参数msg">¶</a>步骤 1 : ForeAction中的参数msg</h3>
<p>回顾注册对应的[ForeAction]，因为需要传递错误信息，所以准备了一个属性msg,并且提供对应的getter,setter.<br>
像这样的参数，现在只有一个，但是随着前端更多功能的开发，参数个数会越来越多，破坏了Action充当控制器的简洁性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">    <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">         msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">     &#125;</span><br><span class="line">     userService.save(user);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    String msg;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">        </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-2-新建Action4Parameter"><a class="header-anchor" href="#步骤-2-新建Action4Parameter">¶</a>步骤 2 : 新建Action4Parameter</h3>
<p>怎么处理呢？ 创建一个类Action4Parameter，这个类专门用于处理各种参数，并且继承了Action4Service 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Parameter</span> <span class="keyword">extends</span> <span class="title">Action4Service</span> </span>&#123;</span><br><span class="line">    <span class="comment">//错误消息</span></span><br><span class="line">    <span class="keyword">protected</span> String msg;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-3-Action4Result继承Action4Parameter"><a class="header-anchor" href="#步骤-3-Action4Result继承Action4Parameter">¶</a>步骤 3 : Action4Result继承Action4Parameter</h3>
<p>Action4Result也由原本的继承Action4Service,改为继承Action4Parameter这个类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Results;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"basicstruts"</span>) </span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*全局的*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"success.jsp"</span>, location=<span class="string">"/success.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"fail.jsp"</span>, location=<span class="string">"/fail.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*分类管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategory"</span>, location=<span class="string">"/admin/listCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editCategory"</span>, location=<span class="string">"/admin/editCategory.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listCategoryPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_category_list"</span>),</span><br><span class="line">         </span><br><span class="line">            <span class="comment">/*属性管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProperty"</span>, location=<span class="string">"/admin/listProperty.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editProperty"</span>, location=<span class="string">"/admin/editProperty.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listPropertyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_property_list?category.id=$&#123;property.category.id&#125;"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*产品管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProduct"</span>, location=<span class="string">"/admin/listProduct.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editProduct"</span>, location=<span class="string">"/admin/editProduct.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_product_list?category.id=$&#123;product.category.id&#125;"</span>),</span><br><span class="line"> </span><br><span class="line">            <span class="comment">/*产品图片管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductImage"</span>, location=<span class="string">"/admin/listProductImage.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listProductImagePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_productImage_list?product.id=$&#123;productImage.product.id&#125;"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*属性值管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"editPropertyValue"</span>, location=<span class="string">"/admin/editProductValue.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*用户管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listUser"</span>, location=<span class="string">"/admin/listUser.jsp"</span>),</span><br><span class="line"> </span><br><span class="line">            <span class="comment">/*订单管理*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listOrder"</span>, location=<span class="string">"/admin/listOrder.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"listOrderPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/admin_order_list"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*前台 服务端跳转*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"home.jsp"</span>, location=<span class="string">"/home.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"register.jsp"</span>, location=<span class="string">"/register.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"login.jsp"</span>, location=<span class="string">"/login.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"product.jsp"</span>, location=<span class="string">"/product.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"category.jsp"</span>, location=<span class="string">"/category.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"searchResult.jsp"</span>, location=<span class="string">"/searchResult.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"buy.jsp"</span>, location=<span class="string">"/buy.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"cart.jsp"</span>, location=<span class="string">"/cart.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"alipay.jsp"</span>, location=<span class="string">"/alipay.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"payed.jsp"</span>, location=<span class="string">"/payed.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"bought.jsp"</span>, location=<span class="string">"/bought.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"confirmPay.jsp"</span>, location=<span class="string">"/confirmPay.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"orderConfirmed.jsp"</span>, location=<span class="string">"/orderConfirmed.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"review.jsp"</span>, location=<span class="string">"/review.jsp"</span>),</span><br><span class="line">             </span><br><span class="line">            <span class="comment">/*前台 客户端跳转*/</span></span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"registerSuccessPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"/registerSuccess.jsp"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"homePage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forehome"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"buyPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forebuy?oiids=$&#123;oiid&#125;"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"alipayPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forealipay?order.id=$&#123;order.id&#125;&amp;total=$&#123;total&#125;"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name=<span class="string">"reviewPage"</span>, type = <span class="string">"redirect"</span>, location=<span class="string">"forereview?order.id=$&#123;order.id&#125;&amp;showonly=$&#123;showonly&#125;"</span>),</span><br><span class="line">        &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Result</span> <span class="keyword">extends</span> <span class="title">Action4Parameter</span>  </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-4-Action继承关系"><a class="header-anchor" href="#步骤-4-Action继承关系">¶</a>步骤 4 : Action继承关系</h3>
<p>通过这个继承关系图，清晰的理解，Action4Parameter就是加在了中间这一层，专门用于提供参数的setter和getter</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5322.png" alt></p>
<h3 id="步骤-5-完整的Action4Parameter"><a class="header-anchor" href="#步骤-5-完整的Action4Parameter">¶</a>步骤 5 : 完整的Action4Parameter</h3>
<p>与[完整版的Action4Result]的类似，为了后续学习更加顺畅，把后续要用到的参数都先准备好了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Parameter</span> <span class="keyword">extends</span> <span class="title">Action4Service</span> </span>&#123;</span><br><span class="line">    <span class="comment">//错误消息</span></span><br><span class="line">    <span class="keyword">protected</span> String msg;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//分类页面的排序变量</span></span><br><span class="line">    <span class="keyword">protected</span> String sort;</span><br><span class="line">    <span class="comment">//当前所处于的web应用名称，如果按照教程来，就是tmall_ssh</span></span><br><span class="line">    <span class="keyword">protected</span> String contextPath;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//搜索关键字</span></span><br><span class="line">    <span class="keyword">protected</span> String keyword;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//购物数量</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> num;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//立即购买生成的订单项id</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> oiid;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//通过购物车选中的多个订单项id</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span>[] oiids;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//结算页面显示的总金额</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">float</span> total;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//在进行评论的页面，是否只显示评论记录，而不提供输入</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> showonly;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Action4Parameter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        contextPath = ServletActionContext.getServletContext().getContextPath();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sort;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSort</span><span class="params">(String sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = sort;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContextPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contextPath;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContextPath</span><span class="params">(String contextPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.contextPath = contextPath;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKeyword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> keyword;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeyword</span><span class="params">(String keyword)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.keyword = keyword;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOiid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> oiid;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOiid</span><span class="params">(<span class="keyword">int</span> oiid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.oiid = oiid;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] getOiids() &#123;</span><br><span class="line">        <span class="keyword">return</span> oiids;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOiids</span><span class="params">(<span class="keyword">int</span>[] oiids)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.oiids = oiids;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(<span class="keyword">float</span> total)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isShowonly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> showonly;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShowonly</span><span class="params">(<span class="keyword">boolean</span> showonly)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.showonly = showonly;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-可运行项目"><a class="header-anchor" href="#步骤-6-可运行项目">¶</a>步骤 6 : 可运行项目</h3>
<p>重构不会影响功能性，所以重构之后的代码一样可以实现分类的管理功能。</p>
<p>鉴于重构经历了较多的步骤，并且略微复杂，任何一步出了问题都会导致目前项目运行失败，在右上角有本知识点对应的可运行项目下载 ,实在自己搞不出来，就下载解压出来比较一</p>
<h2 id="4、登录"><a class="header-anchor" href="#4、登录">¶</a>4、登录</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v13"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v13">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v11"><a class="header-anchor" href="#步骤-2-模仿和排错-v11">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果"><a class="header-anchor" href="#步骤-3-界面效果">¶</a>步骤 3 : 界面效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5023.png" alt></p>
<h3 id="步骤-4-login-jsp"><a class="header-anchor" href="#步骤-4-login-jsp">¶</a>步骤 4 : login.jsp</h3>
<p>与[register.jsp]相仿，login.jsp也包含了[header.jsp],[footer.jsp]等公共页面<br>
中间是登录业务页面[loginPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/loginPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-loginPage-jsp"><a class="header-anchor" href="#步骤-5-loginPage-jsp">¶</a>步骤 5 : loginPage.jsp</h3>
<p>注册业务页面，用于向服务器提交账号和密码</p>
<ol>
<li>与[registerPage.jsp]类似的，用于显示登录密码错误</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty msg&#125;"</span>&gt;</span><br><span class="line">$(<span class="string">"span.errorMessage"</span>).html(<span class="string">"$&#123;msg&#125;"</span>);</span><br><span class="line">$(<span class="string">"div.loginErrorMessageDiv"</span>).show();		</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>其他js函数是用于为空验证</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty msg&#125;"</span>&gt;</span><br><span class="line">    $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"$&#123;msg&#125;"</span>);</span><br><span class="line">    $(<span class="string">"div.loginErrorMessageDiv"</span>).show();      </span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"form.loginForm"</span>).submit(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==$(<span class="string">"#name"</span>).val().length||<span class="number">0</span>==$(<span class="string">"#password"</span>).val().length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入账号密码"</span>);</span><br><span class="line">            $(<span class="string">"div.loginErrorMessageDiv"</span>).show();          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"form.loginForm input"</span>).keyup(function()&#123;</span><br><span class="line">        $(<span class="string">"div.loginErrorMessageDiv"</span>).hide();  </span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">var</span> left = window.innerWidth/<span class="number">2</span>+<span class="number">162</span>;</span><br><span class="line">    $(<span class="string">"div.loginSmallDiv"</span>).css(<span class="string">"left"</span>,left);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div id=<span class="string">"loginDiv"</span> style=<span class="string">"position: relative"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleLogo"</span>&gt;</span><br><span class="line">        &lt;a href="$&#123;contextPath&#125;"&gt;&lt;img src="img/site/simpleLogo.png"&gt;&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;img id=<span class="string">"loginBackgroundImg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginBackgroundImg"</span> src=<span class="string">"img/site/loginBackground.png"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;form <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginForm"</span> action=<span class="string">"forelogin"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        &lt;div id=<span class="string">"loginSmallDiv"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginSmallDiv"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginErrorMessageDiv"</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"alert alert-danger"</span> &gt;</span><br><span class="line">                  &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;</span><br><span class="line">                    &lt;span class="errorMessage"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">                 </span><br><span class="line">            &lt;div class="login_acount_text"&gt;账户登录&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                    &lt;span class=" glyphicon glyphicon-user"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;input id=<span class="string">"name"</span> name=<span class="string">"user.name"</span> placeholder=<span class="string">"手机/会员名/邮箱"</span> type=<span class="string">"text"</span>&gt;           </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                    &lt;span class=" glyphicon glyphicon-lock"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;input id=<span class="string">"password"</span> name=<span class="string">"user.password"</span> type=<span class="string">"password"</span> placeholder=<span class="string">"密码"</span> type=<span class="string">"text"</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;span class="text-danger"&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;a class="notImplementLink" href="#nowhere"&gt;忘记登录密码&lt;/a&gt;</span><br><span class="line">                &lt;a href="register.jsp" class="pull-right"&gt;免费注册&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div style=<span class="string">"margin-top:20px"</span>&gt;</span><br><span class="line">                &lt;button class="btn btn-block redButton" type="submit"&gt;登录&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;   </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-UserService-v2"><a class="header-anchor" href="#步骤-6-UserService-v2">¶</a>步骤 6 : UserService</h3>
<p>新增接口get(String name, String password); 通过账号和密码来获取用户对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">BaseService</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">(String name)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function">User <span class="title">get</span><span class="params">(String name, String password)</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-UserServiceImpl-v2"><a class="header-anchor" href="#步骤-7-UserServiceImpl-v2">¶</a>步骤 7 : UserServiceImpl</h3>
<p>实现get(String name, String password) 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        List l = list(<span class="string">"name"</span>,name);</span><br><span class="line">        <span class="keyword">if</span>(!l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; l  = list(<span class="string">"name"</span>,name, <span class="string">"password"</span>,password);</span><br><span class="line">        <span class="keyword">if</span>(l.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> l.get(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-ForeAction-login"><a class="header-anchor" href="#步骤-8-ForeAction-login">¶</a>步骤 8 : ForeAction.login()</h3>
<p>[login.jsp]的form提交数据到路径 forelogin,导致ForeAction.login()方法被调用</p>
<ol>
<li>
<p>把账号通过HtmlUtils.htmlEscape进行转义</p>
</li>
<li>
<p>根据账号和密码获取User对象<br>
2.1 如果对象为空，则服务端跳转回login.jsp，也带上错误信息，并且使用[login.jsp]中的办法显示错误信息<br>
2.2 如果对象存在，则把对象保存在session中，并客户端跳转到首页&quot;forehome&quot;<br>
<strong>注</strong> 为什么要用 HtmlUtils.htmlEscape？ 因为注册的时候，[ForeAction.register()]，就进行了转义，所以这里也需要转义。有些同学在恶意注册的时候，会使用诸如 &lt;script&gt;alert(‘papapa’)&lt;/script&gt; 这样的名称，会导致网页打开就弹出一个对话框。 那么在转义之后，就没有这个问题了。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">    User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">        msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5、退出"><a class="header-anchor" href="#5、退出">¶</a>5、退出</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v14"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v14">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v12"><a class="header-anchor" href="#步骤-2-模仿和排错-v12">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-关于退出"><a class="header-anchor" href="#步骤-3-关于退出">¶</a>步骤 3 : 关于退出</h3>
<p>关于退出功能，这个功能本来是在登录之后才讲的，但是后面有一个[产品页的模态登录]，需要建立在未登录状态，所以这里先把这个功能讲了。</p>
<h3 id="步骤-4-ForeAction-logout"><a class="header-anchor" href="#步骤-4-ForeAction-logout">¶</a>步骤 4 : ForeAction.logout()</h3>
<p>通过访问退出路径：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_tmall/forelogout</span></span><br></pre></td></tr></table></figure>
<p>导致ForeAction.logout()方法被调用</p>
<ol>
<li>在session中去掉&quot;user&quot;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>客户端跳转到首页: forehome</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、产品页"><a class="header-anchor" href="#6、产品页">¶</a>6、产品页</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v15"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v15">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v13"><a class="header-anchor" href="#步骤-2-模仿和排错-v13">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果-v2"><a class="header-anchor" href="#步骤-3-界面效果-v2">¶</a>步骤 3 : 界面效果</h3>
<p>访问地址：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/foreproduct?product.id=845</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5036.png" alt></p>
<h3 id="步骤-4-Product-v2"><a class="header-anchor" href="#步骤-4-Product-v2">¶</a>步骤 4 : Product</h3>
<p>新加如下瞬时字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> reviewCount;</span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> saleCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"product"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Category category;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> originalPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> promotePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stock;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> ProductImage firstProductImage;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> reviewCount;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> saleCount;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSubTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubTitle</span><span class="params">(String subTitle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subTitle = subTitle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getOriginalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOriginalPrice</span><span class="params">(<span class="keyword">float</span> originalPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.originalPrice = originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPromotePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPromotePrice</span><span class="params">(<span class="keyword">float</span> promotePrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.promotePrice = promotePrice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStock</span><span class="params">(<span class="keyword">int</span> stock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stock = stock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getFirstProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> firstProductImage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstProductImage</span><span class="params">(ProductImage firstProductImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstProductImage = firstProductImage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getReviewCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reviewCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReviewCount</span><span class="params">(<span class="keyword">int</span> reviewCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reviewCount = reviewCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSaleCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> saleCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleCount</span><span class="params">(<span class="keyword">int</span> saleCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.saleCount = saleCount;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-Review"><a class="header-anchor" href="#步骤-5-Review">¶</a>步骤 5 : Review</h3>
<p>创建Review对象，并进行各种字段的映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"review"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Review</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"uid"</span>)</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"pid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-ReviewService"><a class="header-anchor" href="#步骤-6-ReviewService">¶</a>步骤 6 : ReviewService</h3>
<p>新建ReviewService类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ReviewService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-ReviewServiceImpl"><a class="header-anchor" href="#步骤-7-ReviewServiceImpl">¶</a>步骤 7 : ReviewServiceImpl</h3>
<p>新建ReviewServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ReviewService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReviewServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ReviewService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-Action4Pojo-v3"><a class="header-anchor" href="#步骤-8-Action4Pojo-v3">¶</a>步骤 8 : Action4Pojo</h3>
<p>在Action4Pojo中增加Review的实体类和集合的setter,getter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Review;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> Category category;</span><br><span class="line">    <span class="keyword">protected</span> Property property;</span><br><span class="line">    <span class="keyword">protected</span> Product product;</span><br><span class="line">    <span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">    <span class="keyword">protected</span> PropertyValue propertyValue;</span><br><span class="line">    <span class="keyword">protected</span> User user;</span><br><span class="line">    <span class="keyword">protected</span> Order order;</span><br><span class="line">    <span class="keyword">protected</span> Review review;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;PropertyValue&gt; propertyValues;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;User&gt; users;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Order&gt; orders;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Review&gt; reviews;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> products;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.products = products;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productImage;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValue <span class="title">getPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(PropertyValue propertyValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PropertyValue&gt; <span class="title">getPropertyValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValues</span><span class="params">(List&lt;PropertyValue&gt; propertyValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.propertyValues = propertyValues;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Review <span class="title">getReview</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> review;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReview</span><span class="params">(Review review)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.review = review;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Review&gt; <span class="title">getReviews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reviews;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReviews</span><span class="params">(List&lt;Review&gt; reviews)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reviews = reviews;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-Action4Service-v3"><a class="header-anchor" href="#步骤-9-Action4Service-v3">¶</a>步骤 9 : Action4Service</h3>
<p>增加ReviewService的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.PropertyValueService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ReviewService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.UserService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Service</span> <span class="keyword">extends</span> <span class="title">Action4Pojo</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyService propertyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductService productService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PropertyValueService propertyValueService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;   </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderService orderService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ReviewService reviewService;   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * transient to persistent</span></span><br><span class="line"><span class="comment">     * 瞬时对象转换为持久对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t2p</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class clazz = o.getClass();</span><br><span class="line">                <span class="keyword">int</span> id = (Integer) clazz.getMethod(<span class="string">"getId"</span>).invoke(o);</span><br><span class="line">                Object persistentBean = categoryService.get(clazz, id);</span><br><span class="line"> </span><br><span class="line">                String beanName = clazz.getSimpleName();</span><br><span class="line">                Method setMethod = getClass().getMethod(<span class="string">"set"</span> + WordUtils.capitalize(beanName), clazz);</span><br><span class="line">                setMethod.invoke(<span class="keyword">this</span>, persistentBean);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-ProductService"><a class="header-anchor" href="#步骤-10-ProductService">¶</a>步骤 10 : ProductService</h3>
<p>增加如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span></span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-11-ProductServiceImpl"><a class="header-anchor" href="#步骤-11-ProductServiceImpl">¶</a>步骤 11 : ProductServiceImpl</h3>
<p>增加两个方法的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ReviewService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ReviewService reviewService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> saleCount = orderItemService.total(product);</span><br><span class="line">        product.setSaleCount(saleCount);</span><br><span class="line">        <span class="keyword">int</span> reviewCount = reviewService.total(product);</span><br><span class="line">        product.setReviewCount(reviewCount);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            setSaleAndReviewNumber(product);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            fill(category);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> productNumberEachRow = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            List&lt;Product&gt; products =  category.getProducts();</span><br><span class="line">            List&lt;List&lt;Product&gt;&gt; productsByRow =  <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; products.size(); i+=productNumberEachRow) &#123;</span><br><span class="line">                <span class="keyword">int</span> size = i+productNumberEachRow;</span><br><span class="line">                size= size&gt;products.size()?products.size():size;</span><br><span class="line">                List&lt;Product&gt; productsOfEachRow =products.subList(i, size);</span><br><span class="line">                productsByRow.add(productsOfEachRow);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            category.setProductsByRow(productsByRow);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products= listByParent(category);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);</span><br><span class="line">         </span><br><span class="line">        category.setProducts(products);</span><br><span class="line">         </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-12-ForeAction"><a class="header-anchor" href="#步骤-12-ForeAction">¶</a>步骤 12 : ForeAction</h3>
<p>通过访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/foreproduct?pid=844</span><br></pre></td></tr></table></figure>
<p>调用ForeAction中中的product方法</p>
<ol>
<li>把product 指向持久化对象</li>
<li>设置首张图片</li>
<li>设置单个和详情图片集合</li>
<li>获取本产品的属性值集合</li>
<li>获取本产品的评价集合</li>
<li>设置销售数量和评价数量</li>
<li>服务端跳转到 product.jsp</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(product);</span><br><span class="line">      </span><br><span class="line">    productImageService.setFirstProdutImage(product);</span><br><span class="line">    productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">    productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">    product.setProductSingleImages(productSingleImages);</span><br><span class="line">    product.setProductDetailImages(productDetailImages);</span><br><span class="line">      </span><br><span class="line">    propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">  </span><br><span class="line">    reviews = reviewService.listByParent(product);</span><br><span class="line">     </span><br><span class="line">    productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-13-product-jsp"><a class="header-anchor" href="#步骤-13-product-jsp">¶</a>步骤 13 : product.jsp</h3>
<p>与 [register.jsp]相仿，product.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。<br>
中间是产品业务页面 [productPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/product/productPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-15-imgAndInfo-jsp"><a class="header-anchor" href="#步骤-15-imgAndInfo-jsp">¶</a>步骤 15 : imgAndInfo.jsp</h3>
<ol>
<li>左侧显示5张单个图片<br>
1.1 默认显示第一张图片</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"img/productSingle/$&#123;product.firstProductImage.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"bigImg"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>​			1.2 5张小图片</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;p.productSingleImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">	&lt;img src=<span class="string">"img/productSingle_small/$&#123;pi.id&#125;.jpg"</span> bigImageURL=<span class="string">"img/productSingle/$&#123;pi.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"smallImage"</span>&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>右边显示基本信息<br>
2.1 标题和小标题</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productTitle"</span>&gt;</span><br><span class="line">	$&#123;product.name&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productSubTitle"</span>&gt;</span><br><span class="line">	$&#123;product.subTitle&#125; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>​		2.2 原始价格和促销价</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.originalPrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.promotePrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>​		2.3 销量和累计评价</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;销量 &lt;span class="redColor boldWord"&gt; $&#123;product.saleCount &#125;&lt;/span&gt;&lt;/div&gt;	</span><br><span class="line">&lt;div&gt;累计评价 &lt;span class="redColor boldWord"&gt; $&#123;product.reviewCount&#125;&lt;/span&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>​		2.4 库存</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;库存$&#123;product.stock&#125;件&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5041.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line"> </span><br><span class="line">$(function()&#123;</span><br><span class="line">    <span class="keyword">var</span> stock = $&#123;product.stock&#125;;</span><br><span class="line">    $(<span class="string">".productNumberSetting"</span>).keyup(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        num = parseInt(num);</span><br><span class="line">        <span class="keyword">if</span>(isNaN(num))</span><br><span class="line">            num= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".increaseNumber"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        num++;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".decreaseNumber"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        --num;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num=<span class="number">1</span>;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".addCartLink"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        <span class="keyword">var</span> pid = $&#123;product.id&#125;;</span><br><span class="line">                        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">                        <span class="keyword">var</span> addCartpage = <span class="string">"foreaddCart"</span>;</span><br><span class="line">                        $.get(</span><br><span class="line">                                addCartpage,</span><br><span class="line">                                &#123;<span class="string">"product.id"</span>:pid,<span class="string">"num"</span>:num&#125;,</span><br><span class="line">                                function(result)&#123;</span><br><span class="line">                                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).html(<span class="string">"已加入购物车"</span>);</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).attr(<span class="string">"disabled"</span>,<span class="string">"disabled"</span>);</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"background-color"</span>,<span class="string">"lightgray"</span>)</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"border-color"</span>,<span class="string">"lightgray"</span>)</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"color"</span>,<span class="string">"black"</span>)</span><br><span class="line">                                         </span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">else</span>&#123;</span><br><span class="line">                                         </span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                        );                         </span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );     </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".buyLink"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        <span class="keyword">var</span> num = $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">                        location.href= $(<span class="string">".buyLink"</span>).attr(<span class="string">"href"</span>)+<span class="string">"&amp;num="</span>+num;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );     </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"button.loginSubmitButton"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> name = $(<span class="string">"#name"</span>).val();</span><br><span class="line">        <span class="keyword">var</span> password = $(<span class="string">"#password"</span>).val();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==name.length||<span class="number">0</span>==password.length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入账号密码"</span>);</span><br><span class="line">            $(<span class="string">"div.loginErrorMessageDiv"</span>).show();          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"foreloginAjax"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                &#123;<span class="string">"user.name"</span>:name,<span class="string">"user.password"</span>:password&#125;,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        location.reload();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"账号密码错误"</span>);</span><br><span class="line">                        $(<span class="string">"div.loginErrorMessageDiv"</span>).show();                      </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );         </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"img.smallImage"</span>).mouseenter(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> bigImageURL = $(<span class="keyword">this</span>).attr(<span class="string">"bigImageURL"</span>);</span><br><span class="line">        $(<span class="string">"img.bigImg"</span>).attr(<span class="string">"src"</span>,bigImageURL);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"img.bigImg"</span>).load(</span><br><span class="line">        function()&#123;</span><br><span class="line">            $(<span class="string">"img.smallImage"</span>).each(function()&#123;</span><br><span class="line">                <span class="keyword">var</span> bigImageURL = $(<span class="keyword">this</span>).attr(<span class="string">"bigImageURL"</span>);</span><br><span class="line">                img = <span class="keyword">new</span> Image();</span><br><span class="line">                img.src = bigImageURL;</span><br><span class="line">                 </span><br><span class="line">                img.onload = function()&#123;</span><br><span class="line">                    console.log(bigImageURL);  </span><br><span class="line">                    $(<span class="string">"div.img4load"</span>).append($(img));</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);    </span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"imgAndInfo"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"imgInimgAndInfo"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/productSingle/$&#123;product.firstProductImage.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"bigImg"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"smallImageDiv"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;product.productSingleImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/productSingle_small/$&#123;pi.id&#125;.jpg"</span> bigImageURL=<span class="string">"img/productSingle/$&#123;pi.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"smallImage"</span>&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="img4load hidden" &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"infoInimgAndInfo"</span>&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productTitle"</span>&gt;</span><br><span class="line">            $&#123;product.name&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productSubTitle"</span>&gt;</span><br><span class="line">            $&#123;product.subTitle&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productPrice"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"juhuasuan"</span>&gt;</span><br><span class="line">                &lt;span class="juhuasuanBig" &gt;聚划算&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;此商品即将参加聚划算，&lt;span class="juhuasuanTime"&gt;1天19小时&lt;/span&gt;后开始，&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productPriceDiv"</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"gouwujuanDiv"</span>&gt;&lt;img height=<span class="string">"16px"</span> src=<span class="string">"img/site/gouwujuan.png"</span>&gt;</span><br><span class="line">                &lt;span&gt; 全天猫实物商品通用&lt;/span&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"originalDiv"</span>&gt;</span><br><span class="line">                    &lt;span class="originalPriceDesc"&gt;价格&lt;/span&gt;</span><br><span class="line">                    &lt;span class="originalPriceYuan"&gt;¥&lt;/span&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"originalPrice"</span>&gt;</span><br><span class="line">                     </span><br><span class="line">                        &lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.originalPrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;                 </span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"promotionDiv"</span>&gt;</span><br><span class="line">                    &lt;span class="promotionPriceDesc"&gt;促销价 &lt;/span&gt;</span><br><span class="line">                    &lt;span class="promotionPriceYuan"&gt;¥&lt;/span&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"promotionPrice"</span>&gt;</span><br><span class="line">                        &lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.promotePrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">                    &lt;/span&gt;              </span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productSaleAndReviewNumber"</span>&gt;</span><br><span class="line">            &lt;div&gt;销量 &lt;span class="redColor boldWord"&gt; $&#123;product.saleCount &#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;累计评价 &lt;span class="redColor boldWord"&gt; $&#123;product.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumber"</span>&gt;</span><br><span class="line">            &lt;span&gt;数量&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumberSettingSpan"</span>&gt;</span><br><span class="line">                &lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumberSetting"</span> type=<span class="string">"text"</span> value=<span class="string">"1"</span>&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"arrow"</span>&gt;</span><br><span class="line">                    &lt;a href=<span class="string">"#nowhere"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"increaseNumber"</span>&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"updown"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/increase.png"</span>&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                     </span><br><span class="line">                    &lt;span class="updownMiddle"&gt; &lt;/span&gt;</span><br><span class="line">                    &lt;a href=<span class="string">"#nowhere"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"decreaseNumber"</span>&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"updown"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/decrease.png"</span>&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                     </span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                     </span><br><span class="line">            件&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;库存$&#123;product.stock&#125;件&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"serviceCommitment"</span>&gt;</span><br><span class="line">            &lt;span class="serviceCommitmentDesc"&gt;服务承诺&lt;/span&gt;</span><br><span class="line">            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"serviceCommitmentLink"</span>&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;正品保证&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;极速退款&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;赠运费险&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;七天无理由退换&lt;/a&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;   </span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"buyDiv"</span>&gt;</span><br><span class="line">            &lt;a class="buyLink" href="forebuyone?product.id=$&#123;product.id&#125;"&gt;&lt;button class="buyButton"&gt;立即购买&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" class="addCartLink"&gt;&lt;button class="addCartButton"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;加入购物车&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-16-productReview-jsp"><a class="header-anchor" href="#步骤-16-productReview-jsp">¶</a>步骤 16 : productReview.jsp</h3>
<p>暂时没有数据，所以看不到截图。 有数据的截图，请参考：[评价信息]<br>
借助c:forEach遍历request中的reviews</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5042.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewDiv"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewTopPart"</span>&gt;</span><br><span class="line">        &lt;a  href="#nowhere" class="productReviewTopPartSelectedLink"&gt;商品详情&lt;/a&gt;</span><br><span class="line">        &lt;a  href="#nowhere" class="selected"&gt;累计评价 &lt;span class="productReviewTopReviewLinkNumber"&gt;$&#123;p.reviewCount&#125;&lt;/span&gt; &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewContentPart"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;reviews&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewItem"</span>&gt;</span><br><span class="line">         </span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewItemDesc"</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewItemContent"</span>&gt;</span><br><span class="line">                    $&#123;r.content &#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class="productReviewItemDate"&gt;&lt;fmt:formatDate value="$&#123;r.createDate&#125;" pattern="yyyy-MM-dd"/&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productReviewItemUserInfo"</span>&gt;</span><br><span class="line">             </span><br><span class="line">                $&#123;r.user.anonymousName&#125;&lt;span class="userInfoGrayPart"&gt;（匿名）&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-17-productDetail-jsp"><a class="header-anchor" href="#步骤-17-productDetail-jsp">¶</a>步骤 17 : productDetail.jsp</h3>
<p>如图所示，productReview.jsp做了两件事</p>
<ol>
<li>显示属性值</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;propertyValues&#125;"</span> <span class="keyword">var</span>=<span class="string">"pv"</span>&gt;</span><br><span class="line">	&lt;span&gt;$&#123;pv.property.name&#125;:  $&#123;fn:substring(pv.value, 0, 10)&#125; &lt;/span&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>显示详情图片</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;product.productDetailImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">	&lt;img src=<span class="string">"img/productDetail/$&#123;pi.id&#125;.jpg"</span>&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productDetailDiv"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productDetailTopPart"</span>&gt;</span><br><span class="line">        &lt;a href="#nowhere" class="productDetailTopPartSelectedLink selected"&gt;商品详情&lt;/a&gt;</span><br><span class="line">        &lt;a href="#nowhere" class="productDetailTopReviewLink"&gt;累计评价 &lt;span class="productDetailTopReviewLinkNumber"&gt;$&#123;p.reviewCount&#125;&lt;/span&gt; &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productParamterPart"</span>&gt;</span><br><span class="line">        &lt;div class="productParamter"&gt;产品参数：&lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productParamterList"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;propertyValues&#125;"</span> <span class="keyword">var</span>=<span class="string">"pv"</span>&gt;</span><br><span class="line">                &lt;span&gt;$&#123;pv.property.name&#125;:  $&#123;fn:substring(pv.value, 0, 10)&#125; &lt;/span&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productDetailImagesPart"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;product.productDetailImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/productDetail/$&#123;pi.id&#125;.jpg"</span>&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="7、模态登录"><a class="header-anchor" href="#7、模态登录">¶</a>7、模态登录</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v16"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v16">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v14"><a class="header-anchor" href="#步骤-2-模仿和排错-v14">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面效果"><a class="header-anchor" href="#步骤-3-页面效果">¶</a>步骤 3 : 页面效果</h3>
<p>在未登录状态(如果已经登录就看不到这个效果了，需要先[退出],所以要先做[退出]教程，哈哈~ )，点击购买或者加入购物车就会弹出这个模态对话框</p>
<p>在这个模态对话框上可以进行登录操作，如果账号和密码出错会出现 “账号密码错误” 提示</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5062.png" alt></p>
<h3 id="步骤-4-imgAndInfo-jsp"><a class="header-anchor" href="#步骤-4-imgAndInfo-jsp">¶</a>步骤 4 : imgAndInfo.jsp</h3>
<p>立即购买和加入购物车这两个按钮的监听是放在[imgAndInfo.jsp]页面中</p>
<p>这两个按钮都会通过[JQuery的.get方法]，用异步ajax的方式访问forecheckLogin，获取当前是否登录状态<br>
如果返回的不是&quot;success&quot; 即表明是未登录状态，那么就会打开登录的模态窗口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);</span><br></pre></td></tr></table></figure>
<p>参考： [使用JS控制Bootstrap 模态窗口]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">".buyLink"</span>).click(function()&#123;</span><br><span class="line">    <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">    $.get(</span><br><span class="line">            page,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                    。。。略</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    );     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">".addCartLink"</span>).click(function()&#123;</span><br><span class="line">    <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">    $.get(</span><br><span class="line">            page,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                    。。。略                   </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    );     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line"> </span><br><span class="line">$(function()&#123;</span><br><span class="line">    <span class="keyword">var</span> stock = $&#123;product.stock&#125;;</span><br><span class="line">    $(<span class="string">".productNumberSetting"</span>).keyup(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        num = parseInt(num);</span><br><span class="line">        <span class="keyword">if</span>(isNaN(num))</span><br><span class="line">            num= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".increaseNumber"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        num++;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".decreaseNumber"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">        --num;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num=<span class="number">1</span>;</span><br><span class="line">        $(<span class="string">".productNumberSetting"</span>).val(num);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".addCartLink"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        <span class="keyword">var</span> pid = $&#123;product.id&#125;;</span><br><span class="line">                        <span class="keyword">var</span> num= $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">                        <span class="keyword">var</span> addCartpage = <span class="string">"foreaddCart"</span>;</span><br><span class="line">                        $.get(</span><br><span class="line">                                addCartpage,</span><br><span class="line">                                &#123;<span class="string">"product.id"</span>:pid,<span class="string">"num"</span>:num&#125;,</span><br><span class="line">                                function(result)&#123;</span><br><span class="line">                                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).html(<span class="string">"已加入购物车"</span>);</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).attr(<span class="string">"disabled"</span>,<span class="string">"disabled"</span>);</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"background-color"</span>,<span class="string">"lightgray"</span>)</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"border-color"</span>,<span class="string">"lightgray"</span>)</span><br><span class="line">                                        $(<span class="string">".addCartButton"</span>).css(<span class="string">"color"</span>,<span class="string">"black"</span>)</span><br><span class="line">                                         </span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">else</span>&#123;</span><br><span class="line">                                         </span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                        );                         </span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );     </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".buyLink"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"forecheckLogin"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        <span class="keyword">var</span> num = $(<span class="string">".productNumberSetting"</span>).val();</span><br><span class="line">                        location.href= $(<span class="string">".buyLink"</span>).attr(<span class="string">"href"</span>)+<span class="string">"&amp;num="</span>+num;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"#loginModal"</span>).modal(<span class="string">'show'</span>);                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );     </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"button.loginSubmitButton"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> name = $(<span class="string">"#name"</span>).val();</span><br><span class="line">        <span class="keyword">var</span> password = $(<span class="string">"#password"</span>).val();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==name.length||<span class="number">0</span>==password.length)&#123;</span><br><span class="line">            $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入账号密码"</span>);</span><br><span class="line">            $(<span class="string">"div.loginErrorMessageDiv"</span>).show();          </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> page = <span class="string">"foreloginAjax"</span>;</span><br><span class="line">        $.get(</span><br><span class="line">                page,</span><br><span class="line">                &#123;<span class="string">"user.name"</span>:name,<span class="string">"user.password"</span>:password&#125;,</span><br><span class="line">                function(result)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                        location.reload();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        $(<span class="string">"span.errorMessage"</span>).html(<span class="string">"账号密码错误"</span>);</span><br><span class="line">                        $(<span class="string">"div.loginErrorMessageDiv"</span>).show();                      </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );         </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"img.smallImage"</span>).mouseenter(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> bigImageURL = $(<span class="keyword">this</span>).attr(<span class="string">"bigImageURL"</span>);</span><br><span class="line">        $(<span class="string">"img.bigImg"</span>).attr(<span class="string">"src"</span>,bigImageURL);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"img.bigImg"</span>).load(</span><br><span class="line">        function()&#123;</span><br><span class="line">            $(<span class="string">"img.smallImage"</span>).each(function()&#123;</span><br><span class="line">                <span class="keyword">var</span> bigImageURL = $(<span class="keyword">this</span>).attr(<span class="string">"bigImageURL"</span>);</span><br><span class="line">                img = <span class="keyword">new</span> Image();</span><br><span class="line">                img.src = bigImageURL;</span><br><span class="line">                 </span><br><span class="line">                img.onload = function()&#123;</span><br><span class="line">                    console.log(bigImageURL);  </span><br><span class="line">                    $(<span class="string">"div.img4load"</span>).append($(img));</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);    </span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"imgAndInfo"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"imgInimgAndInfo"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/productSingle/$&#123;product.firstProductImage.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"bigImg"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"smallImageDiv"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;product.productSingleImages&#125;"</span> <span class="keyword">var</span>=<span class="string">"pi"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/productSingle_small/$&#123;pi.id&#125;.jpg"</span> bigImageURL=<span class="string">"img/productSingle/$&#123;pi.id&#125;.jpg"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"smallImage"</span>&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="img4load hidden" &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"infoInimgAndInfo"</span>&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productTitle"</span>&gt;</span><br><span class="line">            $&#123;product.name&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productSubTitle"</span>&gt;</span><br><span class="line">            $&#123;product.subTitle&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productPrice"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"juhuasuan"</span>&gt;</span><br><span class="line">                &lt;span class="juhuasuanBig" &gt;聚划算&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;此商品即将参加聚划算，&lt;span class="juhuasuanTime"&gt;1天19小时&lt;/span&gt;后开始，&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productPriceDiv"</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"gouwujuanDiv"</span>&gt;&lt;img height=<span class="string">"16px"</span> src=<span class="string">"img/site/gouwujuan.png"</span>&gt;</span><br><span class="line">                &lt;span&gt; 全天猫实物商品通用&lt;/span&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"originalDiv"</span>&gt;</span><br><span class="line">                    &lt;span class="originalPriceDesc"&gt;价格&lt;/span&gt;</span><br><span class="line">                    &lt;span class="originalPriceYuan"&gt;¥&lt;/span&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"originalPrice"</span>&gt;</span><br><span class="line">                     </span><br><span class="line">                        &lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.originalPrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;                 </span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"promotionDiv"</span>&gt;</span><br><span class="line">                    &lt;span class="promotionPriceDesc"&gt;促销价 &lt;/span&gt;</span><br><span class="line">                    &lt;span class="promotionPriceYuan"&gt;¥&lt;/span&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"promotionPrice"</span>&gt;</span><br><span class="line">                        &lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;product.promotePrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">                    &lt;/span&gt;              </span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productSaleAndReviewNumber"</span>&gt;</span><br><span class="line">            &lt;div&gt;销量 &lt;span class="redColor boldWord"&gt; $&#123;product.saleCount &#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;累计评价 &lt;span class="redColor boldWord"&gt; $&#123;product.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumber"</span>&gt;</span><br><span class="line">            &lt;span&gt;数量&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumberSettingSpan"</span>&gt;</span><br><span class="line">                &lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"productNumberSetting"</span> type=<span class="string">"text"</span> value=<span class="string">"1"</span>&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"arrow"</span>&gt;</span><br><span class="line">                    &lt;a href=<span class="string">"#nowhere"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"increaseNumber"</span>&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"updown"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/increase.png"</span>&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                     </span><br><span class="line">                    &lt;span class="updownMiddle"&gt; &lt;/span&gt;</span><br><span class="line">                    &lt;a href=<span class="string">"#nowhere"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"decreaseNumber"</span>&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"updown"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/decrease.png"</span>&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                     </span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                     </span><br><span class="line">            件&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;库存$&#123;product.stock&#125;件&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"serviceCommitment"</span>&gt;</span><br><span class="line">            &lt;span class="serviceCommitmentDesc"&gt;服务承诺&lt;/span&gt;</span><br><span class="line">            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"serviceCommitmentLink"</span>&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;正品保证&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;极速退款&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;赠运费险&lt;/a&gt;</span><br><span class="line">                &lt;a href="#nowhere"&gt;七天无理由退换&lt;/a&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;   </span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"buyDiv"</span>&gt;</span><br><span class="line">            &lt;a class="buyLink" href="forebuyone?product.id=$&#123;product.id&#125;"&gt;&lt;button class="buyButton"&gt;立即购买&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">            &lt;a href="#nowhere" class="addCartLink"&gt;&lt;button class="addCartButton"&gt;&lt;span class="glyphicon glyphicon-shopping-cart"&gt;&lt;/span&gt;加入购物车&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ForeAction-checkLogin"><a class="header-anchor" href="#步骤-5-ForeAction-checkLogin">¶</a>步骤 5 : ForeAction.checkLogin()</h3>
<p>在上一步的ajax访问路径/forecheckLogin会导致ForeAction.checkLogin()方法被调用。<br>
获取session中的&quot;user&quot;对象<br>
如果不为空，即表示已经登录，服务端跳转到 success.jsp<br>
如果不空，即表示未经登录，服务端跳转到 fail.jsp</p>
<p><strong>注：</strong> success.jsp里面就是一个success字符串<br>
<strong>注：</strong> fail.jsp里面就是一个fail字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-fail-jsp"><a class="header-anchor" href="#步骤-6-fail-jsp">¶</a>步骤 6 : fail.jsp</h3>
<p>success.jsp文件已经在[产品属性值的success.jsp]步骤中创建过了<br>
fail.jsp却不曾创建，所以这里需要手动创建一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-modal-jsp"><a class="header-anchor" href="#步骤-7-modal-jsp">¶</a>步骤 7 : modal.jsp</h3>
<p>modal.jsp 页面被 [footer.jsp] 所包含，所以每个页面都是加载了的。<br>
通过[imgAndInfo.jsp]页面中的购买按钮或者加入购物车按钮显示出来。<br>
点击登录按钮时，使用[imgAndInfo.jsp] 页面中的ajax代码进行登录验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"button.loginSubmitButton"</span>).click(function()&#123;</span><br><span class="line">	<span class="keyword">var</span> name = $(<span class="string">"#name"</span>).val();</span><br><span class="line">	<span class="keyword">var</span> password = $(<span class="string">"#password"</span>).val();</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">0</span>==name.length||<span class="number">0</span>==password.length)&#123;</span><br><span class="line">		$(<span class="string">"span.errorMessage"</span>).html(<span class="string">"请输入账号密码"</span>);</span><br><span class="line">		$(<span class="string">"div.loginErrorMessageDiv"</span>).show();			</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> page = <span class="string">"foreloginAjax"</span>;</span><br><span class="line">	$.get(</span><br><span class="line">            page,</span><br><span class="line">            &#123;<span class="string">"name"</span>:name,<span class="string">"password"</span>:password&#125;,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">            	<span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">            		location.reload();</span><br><span class="line">            	&#125;</span><br><span class="line">            	<span class="keyword">else</span>&#123;</span><br><span class="line">            		$(<span class="string">"span.errorMessage"</span>).html(<span class="string">"账号密码错误"</span>);</span><br><span class="line">            		$(<span class="string">"div.loginErrorMessageDiv"</span>).show();	            		</span><br><span class="line">            	&#125;</span><br><span class="line">            &#125;</span><br><span class="line">	);			</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal "</span> id=<span class="string">"loginModal"</span> tabindex=<span class="string">"-1"</span> role=<span class="string">"dialog"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-dialog loginDivInProductPageModalDiv"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-content"</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginDivInProductPage"</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginErrorMessageDiv"</span>&gt;</span><br><span class="line">                            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"alert alert-danger"</span> &gt;</span><br><span class="line">                              &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;</span><br><span class="line">                                &lt;span class="errorMessage"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                             </span><br><span class="line">                        &lt;div class="login_acount_text"&gt;账户登录&lt;/div&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                                &lt;span class=" glyphicon glyphicon-user"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"name"</span> name=<span class="string">"name"</span> placeholder=<span class="string">"手机/会员名/邮箱"</span> type=<span class="string">"text"</span>&gt;        </span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInput "</span> &gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"loginInputIcon "</span>&gt;</span><br><span class="line">                                &lt;span class=" glyphicon glyphicon-lock"&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;input id=<span class="string">"password"</span> name=<span class="string">"password"</span>  type=<span class="string">"password"</span> placeholder=<span class="string">"密码"</span> type=<span class="string">"text"</span>&gt;          </span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                                    &lt;span class="text-danger"&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">                        &lt;div&gt;</span><br><span class="line">                            &lt;a href="#nowhere"&gt;忘记登录密码&lt;/a&gt;</span><br><span class="line">                            &lt;a href="register.jsp" class="pull-right"&gt;免费注册&lt;/a&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div style=<span class="string">"margin-top:20px"</span>&gt;</span><br><span class="line">                            &lt;button class="btn btn-block redButton loginSubmitButton" type="submit"&gt;登录&lt;/button&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;   </span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal"</span> id=<span class="string">"deleteConfirmModal"</span> tabindex=<span class="string">"-1"</span> role=<span class="string">"dialog"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-dialog deleteConfirmModalDiv"</span>&gt;</span><br><span class="line">       &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-content"</span>&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-header"</span>&gt;</span><br><span class="line">            &lt;button data-dismiss="modal" class="close" type="button"&gt;&lt;span aria-hidden="true"&gt;×&lt;/span&gt;&lt;span class="sr-only"&gt;Close&lt;/span&gt;&lt;/button&gt;</span><br><span class="line">            &lt;h4 class="modal-title"&gt;确认删除？&lt;/h4&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"modal-footer"</span>&gt;</span><br><span class="line">            &lt;button data-dismiss="modal" class="btn btn-default" type="button"&gt;关闭&lt;/button&gt;</span><br><span class="line">            &lt;button class="btn btn-primary deleteConfirmButton" id="submit" type="button"&gt;确认&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-ForeAction-loginAjax"><a class="header-anchor" href="#步骤-8-ForeAction-loginAjax">¶</a>步骤 8 : ForeAction.loginAjax()</h3>
<p>在上一步[modal.jsp]中，点击了登录按钮之后，访问路径/foreloginAjax,导致ForeAction.loginAjax()方法被调用</p>
<ol>
<li>通过HtmlUtils.htmlEscape将账号转义，因为数据库里保存的是转义过后的</li>
<li>通过账号密码获取User对象<br>
2.1 如果User对象为空，那么就返回&quot;fail&quot;字符串。<br>
2.2 如果User对象不为空，那么就把User对象放在session中，并返回&quot;success&quot; 字符串</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">    User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">       </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">     </span><br><span class="line">    ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8、分类页"><a class="header-anchor" href="#8、分类页">¶</a>8、分类页</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v17"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v17">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v15"><a class="header-anchor" href="#步骤-2-模仿和排错-v15">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-页面效果-v2"><a class="header-anchor" href="#步骤-3-页面效果-v2">¶</a>步骤 3 : 页面效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5044.png" alt></p>
<h3 id="步骤-4-5个Comparator比较器"><a class="header-anchor" href="#步骤-4-5个Comparator比较器">¶</a>步骤 4 : 5个Comparator比较器</h3>
<p>分类这个页面有排序功能，所以在讲解ForeAction之前，先准备5个Comparator比较器</p>
<ol>
<li>ProductAllComparator 综合比较器<br>
把 销量x评价 高的放前面</li>
<li>ProductReviewComparator 人气比较器<br>
把 评价数量多的放前面</li>
<li>ProductDateComparator 新品比较器<br>
把 创建日期晚的放前面</li>
<li>ProductSaleCountComparator 销量比较器<br>
把 销量高的放前面</li>
<li>ProductPriceComparator 价格比较器<br>
把 价格低的放前面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tmall.comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAllComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Product p1, Product p2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p2.getReviewCount()*p2.getSaleCount()-p1.getReviewCount()*p1.getSaleCount();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tmall.comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDateComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Product p1, Product p2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p1.getCreateDate().compareTo(p2.getCreateDate());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tmall.comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductPriceComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Product p1, Product p2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (p1.getPromotePrice()-p2.getPromotePrice());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tmall.comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductReviewComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Product p1, Product p2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p2.getReviewCount()-p1.getReviewCount();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tmall.comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductSaleCountComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Product p1, Product p2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p2.getSaleCount()-p1.getSaleCount();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ForeAction-category"><a class="header-anchor" href="#步骤-5-ForeAction-category">¶</a>步骤 5 : ForeAction.category()</h3>
<ol>
<li>
<p>category指向持久化对象</p>
</li>
<li>
<p>为category填充产品</p>
</li>
<li>
<p>为产品填充销量和评价数据</p>
</li>
<li>
<p>获取参数sort<br>
4.1 如果sort==null，即不排序<br>
4.2 如果sort!=null，则根据sort的值，从[5个Comparator比较器]中选择一个对应的排序器进行排序</p>
</li>
<li>
<p>服务端跳转到 category.jsp<br>
<strong>注：</strong> 关于sort参数， 在[完整的Action4Parameter]中，进行了添加。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">    t2p(category);</span><br><span class="line">    productService.fill(category);</span><br><span class="line">    productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">    <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">            Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">            Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">              </span><br><span class="line">        <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">            Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">              </span><br><span class="line">        <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">            Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">              </span><br><span class="line">        <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">            Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-category-jsp"><a class="header-anchor" href="#步骤-6-category-jsp">¶</a>步骤 6 : category.jsp</h3>
<p>与 [register.jsp] 相仿，category.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。</p>
<p>中间是分类业务页面 [categoryPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/search.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/category/categoryPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-categoryPage-jsp"><a class="header-anchor" href="#步骤-7-categoryPage-jsp">¶</a>步骤 7 : categoryPage.jsp</h3>
<p>categoryPage.jsp 里有3个内容</p>
<ol>
<li>显示当前分类图片</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"img/category/$&#123;category.id&#125;.jpg"</span>&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>
<p>排序条[sortBar.jsp]</p>
</li>
<li>
<p>产品列表 [productsByCategory.jsp]</p>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;title&gt;模仿天猫官网-$&#123;category.name&#125;&lt;/title&gt; </span><br><span class="line">&lt;div id=<span class="string">"category"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"categoryPageDiv"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/category/$&#123;category.id&#125;.jpg"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"sortBar.jsp"</span>%&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"productsByCategory.jsp"</span>%&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-sortBar-jsp"><a class="header-anchor" href="#步骤-8-sortBar-jsp">¶</a>步骤 8 : sortBar.jsp</h3>
<p>sortBar.jsp 即排序条，做了如下几个与数据相关的事情</p>
<ol>
<li>根据sort参数判断哪个排序按钮高亮</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td &lt;c:if test="$&#123;'all'==param.sort||empty param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt; &gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=all"&gt;综合&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">			&lt;td &lt;c:if test="$&#123;'review'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt; &gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=review"&gt;人气&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">			&lt;td &lt;c:if test="$&#123;'date'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=date"&gt;新品&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">			&lt;td &lt;c:if test="$&#123;'saleCount'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=saleCount"&gt;销量&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">			&lt;td &lt;c:if test="$&#123;'price'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=price"&gt;价格&lt;span class="glyphicon glyphicon-resize-vertical"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>每个排序按钮提交到本页面，即/forecategory，并带上参数sort</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5050.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"input.sortBarPrice"</span>).keyup(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="keyword">this</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(num.length==<span class="number">0</span>)&#123;</span><br><span class="line">            $(<span class="string">"div.productUnit"</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">             </span><br><span class="line">        num = parseInt(num);</span><br><span class="line">        <span class="keyword">if</span>(isNaN(num))</span><br><span class="line">            num= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">        $(<span class="keyword">this</span>).val(num);      </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> begin = $(<span class="string">"input.beginPrice"</span>).val();</span><br><span class="line">        <span class="keyword">var</span> end = $(<span class="string">"input.endPrice"</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(!isNaN(begin) &amp;&amp; !isNaN(end))&#123;</span><br><span class="line">            console.log(begin);</span><br><span class="line">            console.log(end);</span><br><span class="line">            $(<span class="string">"div.productUnit"</span>).hide();</span><br><span class="line">            $(<span class="string">"div.productUnit"</span>).each(function()&#123;</span><br><span class="line">                <span class="keyword">var</span> price = $(<span class="keyword">this</span>).attr(<span class="string">"price"</span>);</span><br><span class="line">                price = <span class="keyword">new</span> Number(price);</span><br><span class="line">                 </span><br><span class="line">                <span class="keyword">if</span>(price&lt;=end &amp;&amp; price&gt;=begin)</span><br><span class="line">                    $(<span class="keyword">this</span>).show();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"categorySortBar"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"categorySortBarTable categorySortTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td &lt;c:if test="$&#123;'all'==param.sort||empty param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt; &gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=all"&gt;综合&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td &lt;c:if test="$&#123;'review'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt; &gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=review"&gt;人气&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td &lt;c:if test="$&#123;'date'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=date"&gt;新品&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td &lt;c:if test="$&#123;'saleCount'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=saleCount"&gt;销量&lt;span class="glyphicon glyphicon-arrow-down"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td &lt;c:if test="$&#123;'price'==param.sort&#125;"&gt;class="grayColumn"&lt;/c:if&gt;&gt;&lt;a href="?category.id=$&#123;category.id&#125;&amp;sort=price"&gt;价格&lt;span class="glyphicon glyphicon-resize-vertical"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"categorySortBarTable"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;input class="sortBarPrice beginPrice" type="text" placeholder="请输入"&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td class="grayColumn priceMiddleColumn"&gt;-&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input class="sortBarPrice endPrice" type="text" placeholder="请输入"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-productsByCategory-jsp"><a class="header-anchor" href="#步骤-9-productsByCategory-jsp">¶</a>步骤 9 : productsByCategory.jsp</h3>
<p>productsByCategory.jsp 显示当前分类下的所有产品</p>
<p>通过forEach遍历category.products集合里的每个产品，并把产品标题，价格，图片，评价数，成交数打印出来</p>
<p>解释下：categorycount，这个是用于测试的，在访问地址的时候加这个参数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/forecategory?category.id=74&amp;categorycount=2</span><br></pre></td></tr></table></figure>
<p>这样就只显示2个产品，仅供测试使用，未免有同学不理解，特拿出来讲解一下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">	&lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"100"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">	&lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"$&#123;param.categorycount&#125;"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5051.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">    &lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"100"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty param.categorycount&#125;"</span>&gt;</span><br><span class="line">    &lt;c:set <span class="keyword">var</span>=<span class="string">"categorycount"</span> scope=<span class="string">"page"</span> value=<span class="string">"$&#123;param.categorycount&#125;"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"categoryProducts"</span>&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;category.products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span> varStatus=<span class="string">"stc"</span>&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;stc.count&lt;=categorycount&#125;"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productUnit"</span> price=<span class="string">"$&#123;p.promotePrice&#125;"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productUnitFrame"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">                    &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"productImage"</span> src=<span class="string">"img/productSingle_middle/$&#123;p.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">                &lt;span class="productPrice"&gt;¥&lt;fmt:formatNumber type="number" value="$&#123;p.promotePrice&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">                &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"productLink"</span> href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">                 $&#123;fn:substring(p.name, <span class="number">0</span>, <span class="number">50</span>)&#125;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">                 </span><br><span class="line">                &lt;a  class="tmallLink" href="foreproduct?product.id=$&#123;p.id&#125;"&gt;天猫专卖&lt;/a&gt;</span><br><span class="line">     </span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"show1 productInfo"</span>&gt;</span><br><span class="line">                    &lt;span class="monthDeal "&gt;月成交 &lt;span class="productDealNumber"&gt;$&#123;p.saleCount&#125;笔&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;span class="productReview"&gt;评价&lt;span class="productReviewNumber"&gt;$&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"wangwang"</span>&gt;</span><br><span class="line">                    &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"wangwanglink"</span> href=<span class="string">"#nowhere"</span>&gt;</span><br><span class="line">                        &lt;img src=<span class="string">"img/site/wangwang.png"</span>&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                     </span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;/c:if&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="9、搜索"><a class="header-anchor" href="#9、搜索">¶</a>9、搜索</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v18"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v18">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v16"><a class="header-anchor" href="#步骤-2-模仿和排错-v16">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果-v3"><a class="header-anchor" href="#步骤-3-界面效果-v3">¶</a>步骤 3 : 界面效果</h3>
<h3 id="步骤-4-search-jsp以及simpleSearch-jsp"><a class="header-anchor" href="#步骤-4-search-jsp以及simpleSearch-jsp">¶</a><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5052.png" alt>步骤 4 : search.jsp以及simpleSearch.jsp</h3>
<p>每个页面都包含了搜索的jsp，首页和搜索结果页包含的是search.jsp，其他页面包含的是simpleSearch.jsp。</p>
<p>这两个页面都提供了一个form，提交数据keyword到foresearch这个路径</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchOutDiv"</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"logo"</span> src=<span class="string">"img/site/logo.gif"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"logo"</span>&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">    &lt;form action=<span class="string">"foresearch"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchDiv"</span>&gt;</span><br><span class="line">            &lt;input name=<span class="string">"keyword"</span> type=<span class="string">"text"</span> value=<span class="string">"$&#123;param.keyword&#125;"</span> placeholder=<span class="string">"时尚男鞋  太阳镜 "</span>&gt;</span><br><span class="line">            &lt;button  type="submit" class="searchButton"&gt;搜索&lt;/button&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchBelow"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;cs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&gt;=5 and st.count&lt;=8&#125;"</span>&gt;</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                                $&#123;c.name&#125;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count!=8&#125;"</span>&gt;             </span><br><span class="line">                                &lt;span&gt;|&lt;/span&gt;             </span><br><span class="line">                            &lt;/c:if&gt;</span><br><span class="line">                        &lt;/span&gt;          </span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;     </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;  </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleSearchOutDiv"</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"simpleLogo"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleLogo"</span> src=<span class="string">"img/site/simpleLogo.png"</span>&gt;   </span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;form action=<span class="string">"foresearch"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"simpleSearchDiv pull-right"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"平衡车 原汁机"</span>  value=<span class="string">"$&#123;param.keyword&#125;"</span> name=<span class="string">"keyword"</span>&gt;</span><br><span class="line">        &lt;button class="searchButton" type="submit"&gt;搜天猫&lt;/button&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchBelow"</span>&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;cs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&gt;=8 and st.count&lt;=11&#125;"</span>&gt;</span><br><span class="line">                    &lt;span&gt;</span><br><span class="line">                        &lt;a href=<span class="string">"forecategory?category.id=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                            $&#123;c.name&#125;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count!=11&#125;"</span>&gt;            </span><br><span class="line">                            &lt;span&gt;|&lt;/span&gt;             </span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                    &lt;/span&gt;          </span><br><span class="line">                &lt;/c:if&gt;</span><br><span class="line">            &lt;/c:forEach&gt;         </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ProductService-v2"><a class="header-anchor" href="#步骤-5-ProductService-v2">¶</a>步骤 5 : ProductService</h3>
<p>新增search方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">search</span><span class="params">(String keyword, <span class="keyword">int</span> start, <span class="keyword">int</span> count)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">search</span><span class="params">(String keyword, <span class="keyword">int</span> start, <span class="keyword">int</span> count)</span></span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-ProductServiceImpl-v2"><a class="header-anchor" href="#步骤-6-ProductServiceImpl-v2">¶</a>步骤 6 : ProductServiceImpl</h3>
<p>ProductServiceImpl增加对search方法的实现，其实就是模糊查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ReviewService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProductService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductImageService productImageService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ReviewService reviewService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">search</span><span class="params">(String keyword, <span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.like(<span class="string">"name"</span>, <span class="string">"%"</span>+keyword+<span class="string">"%"</span>));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc,start,count);</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> saleCount = orderItemService.total(product);</span><br><span class="line">        product.setSaleCount(saleCount);</span><br><span class="line">        <span class="keyword">int</span> reviewCount = reviewService.total(product);</span><br><span class="line">        product.setReviewCount(reviewCount);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleAndReviewNumber</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            setSaleAndReviewNumber(product);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            fill(category);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillByRow</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> productNumberEachRow = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">for</span> (Category category : categorys) &#123;</span><br><span class="line">            List&lt;Product&gt; products =  category.getProducts();</span><br><span class="line">            List&lt;List&lt;Product&gt;&gt; productsByRow =  <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; products.size(); i+=productNumberEachRow) &#123;</span><br><span class="line">                <span class="keyword">int</span> size = i+productNumberEachRow;</span><br><span class="line">                size= size&gt;products.size()?products.size():size;</span><br><span class="line">                List&lt;Product&gt; productsOfEachRow =products.subList(i, size);</span><br><span class="line">                productsByRow.add(productsOfEachRow);</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            category.setProductsByRow(productsByRow);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">        List&lt;Product&gt; products= listByParent(category);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);</span><br><span class="line">         </span><br><span class="line">        category.setProducts(products);</span><br><span class="line">         </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-ForeAction-search"><a class="header-anchor" href="#步骤-7-ForeAction-search">¶</a>步骤 7 : ForeAction.search()</h3>
<p>通过search.jsp或者simpleSearch.jsp提交数据到路径 /foresearch， 导致ForeAction.search()方法被调用</p>
<ol>
<li>获取参数keyword</li>
<li>根据keyword进行模糊查询，获取满足条件的前20个产品</li>
<li>为这些产品设置销量和评价数量</li>
<li>服务端跳转到 searchResult.jsp 页面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">    products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">    productService.setSaleAndReviewNumber(products);</span><br><span class="line">    <span class="keyword">for</span> (Product product : products)</span><br><span class="line">        productImageService.setFirstProdutImage(product);  </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-searchResult-jsp"><a class="header-anchor" href="#步骤-8-searchResult-jsp">¶</a>步骤 8 : searchResult.jsp</h3>
<p>与 [register.jsp] 相仿，searchResult.jsp 也包含了[header.jsp], [top.jsp], [search.jsp]， [footer.jsp] 等公共页面。<br>
中间是搜索结果业务页面 [searchResultPage.jsp]</p>
<p><strong>注：</strong> 在search.jsp中，又把参数keyword显示在输入框中</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=<span class="string">"keyword"</span> type=<span class="string">"text"</span> value=<span class="string">"$&#123;param.keyword&#125;"</span> placeholder=<span class="string">"时尚男鞋  太阳镜 "</span>&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/search.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/searchResultPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;a href=<span class="string">"$&#123;contextPath&#125;"</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">"logo"</span> src=<span class="string">"img/site/logo.gif"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"logo"</span>&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;form action=<span class="string">"foresearch"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchDiv"</span>&gt;</span><br><span class="line">            &lt;input name=<span class="string">"keyword"</span> type=<span class="string">"text"</span> value=<span class="string">"$&#123;param.keyword&#125;"</span> placeholder=<span class="string">"时尚男鞋  太阳镜 "</span>&gt;</span><br><span class="line">            &lt;button  type="submit" class="searchButton"&gt;搜索&lt;/button&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchBelow"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;cs&#125;"</span> <span class="keyword">var</span>=<span class="string">"c"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count&gt;=5 and st.count&lt;=8&#125;"</span>&gt;</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &lt;a href=<span class="string">"forecategory?cid=$&#123;c.id&#125;"</span>&gt;</span><br><span class="line">                                $&#123;c.name&#125;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count!=8&#125;"</span>&gt;             </span><br><span class="line">                                &lt;span&gt;|&lt;/span&gt;             </span><br><span class="line">                            &lt;/c:if&gt;</span><br><span class="line">                        &lt;/span&gt;          </span><br><span class="line">                    &lt;/c:if&gt;</span><br><span class="line">                &lt;/c:forEach&gt;     </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-searchResultPage-jsp"><a class="header-anchor" href="#步骤-9-searchResultPage-jsp">¶</a>步骤 9 : searchResultPage.jsp</h3>
<p>searchResultPage.jsp 本身没做什么。。。。 直接包含了 [productsBySearch.jsp]</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div id=<span class="string">"searchResult"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchResultDiv"</span>&gt;</span><br><span class="line">        &lt;%<span class="meta">@include</span> file=<span class="string">"productsBySearch.jsp"</span>%&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-productsBySearch-jsp"><a class="header-anchor" href="#步骤-10-productsBySearch-jsp">¶</a>步骤 10 : productsBySearch.jsp</h3>
<p>productsBySearch.jsp 显示产寻结果：</p>
<ol>
<li>遍历products，把每个产品的图片，价格，标题等信息显示出来</li>
<li>如果products为空，则显示 “没有满足条件的产品”</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchProducts"</span>&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;products&#125;"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productUnit"</span> price=<span class="string">"$&#123;p.promotePrice&#125;"</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">                &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"productImage"</span> src=<span class="string">"img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">            &lt;span class="productPrice"&gt;¥&lt;fmt:formatNumber type="number" value="$&#123;p.promotePrice&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">            &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"productLink"</span> href=<span class="string">"foreproduct?product.id=$&#123;p.id&#125;"</span>&gt;</span><br><span class="line">             $&#123;fn:substring(p.name, <span class="number">0</span>, <span class="number">50</span>)&#125;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;a class="tmallLink" href="foreproduct?product.id=$&#123;p.id&#125;"&gt;天猫专卖&lt;/a&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"show1 productInfo"</span>&gt;</span><br><span class="line">                &lt;span class="monthDeal "&gt;月成交 &lt;span class="productDealNumber"&gt;$&#123;p.saleCount&#125;笔&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span class="productReview"&gt;评价&lt;span class="productReviewNumber"&gt;$&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span class="wangwang"&gt;&lt;img src="img/site/wangwang.png"&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;empty ps&#125;"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"noMatch"</span>&gt;没有满足条件的产品&lt;div&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h1 id="十三、前台-需要登录"><a class="header-anchor" href="#十三、前台-需要登录">¶</a>十三、前台-需要登录</h1>
<h2 id="1、购物流程"><a class="header-anchor" href="#1、购物流程">¶</a>1、购物流程</h2>
<h3 id="步骤-1-概述"><a class="header-anchor" href="#步骤-1-概述">¶</a>步骤 1 : 概述</h3>
<p>接下来就是需要登录的前台功能，这些功能都是和购买支付流程息息相关的，所以我们先把购买的业务流程捋一捋</p>
<p>接着再把购物流程各个环节与表关系搞清楚，这个开发人员必须明白的部分，这个部分稀里糊涂，后面做出来的功能就会越来越乱</p>
<h3 id="步骤-2-购买的业务流程"><a class="header-anchor" href="#步骤-2-购买的业务流程">¶</a>步骤 2 : 购买的业务流程</h3>
<ol>
<li>登录</li>
<li>访问产品页</li>
<li>立即购买</li>
<li>进入结算页面</li>
<li>加入购物车</li>
<li>查看购物车</li>
<li>选中购物车中的商品</li>
<li>又到了第4步的结算页面</li>
<li>在结算页面生成订单</li>
<li>付款</li>
<li>确认收货</li>
<li>评价</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5069.png" alt></p>
<h3 id="步骤-3-购物流程环节与表关系"><a class="header-anchor" href="#步骤-3-购物流程环节与表关系">¶</a>步骤 3 : 购物流程环节与表关系</h3>
<p>接着再把购物流程各个环节与表关系搞清楚，这个开发人员必须明白的部分，这个部分稀里糊涂，后面做出来的功能就会越来越乱。</p>
<p>围绕购物流程最重要的两个表是OrderItem 和 Order表</p>
<p>关于OrderItem的业务行为</p>
<ol>
<li>
<p>立即购买 —— 新增 OrderItem</p>
</li>
<li>
<p>加入购物车 —— 新增 OrderItem</p>
</li>
<li>
<p>查看购物车 —— 显示未和Order关联的OrderItem</p>
</li>
<li>
<p>选中购物车中的商品 —— 选中OrderItem</p>
</li>
<li>
<p>结算页面 —— 显示选中的OrderItem</p>
</li>
<li>
<p>生成订单 —— 新增Order<br>
7 .付款 —— 修改Order状态</p>
</li>
<li>
<p>我的订单 —— 显示Order</p>
</li>
<li>
<p>确认收货 —— 修改Order状态</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5070.png" alt></p>
<h2 id="2、立即购买"><a class="header-anchor" href="#2、立即购买">¶</a>2、立即购买</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v19"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v19">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v17"><a class="header-anchor" href="#步骤-2-模仿和排错-v17">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-运行效果"><a class="header-anchor" href="#步骤-3-运行效果">¶</a>步骤 3 : 运行效果</h3>
<p>立即购买之后，在页面上会报错，因为截至目前的学习进度，购买成功之后跳转到的[结算页面]还没有开发，将在后续知识点开发。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP Status <span class="number">404</span> - /tmall_ssh/forebuy</span><br></pre></td></tr></table></figure>
<p>那么点击购买都做了什么事情呢？ 会在OrderItem表里插入一条数据，这条数据会表示:</p>
<ol>
<li>pid =844 购买的商品id</li>
<li>oid = null, 这个订单项还没有生成对应的订单，即还在购物车中</li>
<li>uid= 3，用户的id是3</li>
<li>number=3, 购买了3件产品</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5071.png" alt></p>
<h3 id="步骤-4-在产品页点击立即购买"><a class="header-anchor" href="#步骤-4-在产品页点击立即购买">¶</a>步骤 4 : 在产品页点击立即购买</h3>
<p>如果未登录，那么点击立即购买之前会弹出[模态登录窗口]，关于这个功能的详细介绍在[模态登录]，在此不做赘述。</p>
<p>登录之后，点击立即购买，会访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/forebuyone?product.id=844&amp;num=3</span><br></pre></td></tr></table></figure>
<p>并带上了产品id 844和购买数量3</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5073.png" alt></p>
<h3 id="步骤-5-ForeAction-buyone"><a class="header-anchor" href="#步骤-5-ForeAction-buyone">¶</a>步骤 5 : ForeAction.buyone()</h3>
<p>通过上个步骤访问的地址 /forebuyone 导致ForeAction.buyone()方法被调用<br>
首先从session中获取用户对象user</p>
<p>接下来就是新增订单项OrderItem， 新增订单项要考虑两个情况<br>
a. 如果已经存在这个产品对应的OrderItem，并且还没有生成订单，即还在购物车中。 那么就应该在对应的OrderItem基础上，调整数量<br>
a.1 基于用户对象user，查询没有生成订单的订单项集合<br>
a.2 遍历这个集合<br>
a.3 如果产品是一样的话，就进行数量追加<br>
a.4 获取这个订单项的 id</p>
<p>b. 如果不存在对应的OrderItem,那么就新增一个订单项OrderItem<br>
b.1 生成新的订单项<br>
b.2 设置数量，用户和产品<br>
b.3 插入到数据库<br>
b.4 获取这个订单项的 id</p>
<p>最后， 基于这个订单项id客户端跳转到[结算页面的 对应的/forebuy]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">    List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">        <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">            oi.setNumber(oi.getNumber()+num);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            found = <span class="keyword">true</span>;</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;      </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">        OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">        oi.setUser(user);</span><br><span class="line">        oi.setNumber(num);</span><br><span class="line">        oi.setProduct(product);</span><br><span class="line">        orderItemService.save(oi);</span><br><span class="line">        oiid = oi.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、结算页面"><a class="header-anchor" href="#3、结算页面">¶</a>3、结算页面</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v20"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v20">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v18"><a class="header-anchor" href="#步骤-2-模仿和排错-v18">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果-v4"><a class="header-anchor" href="#步骤-3-界面效果-v4">¶</a>步骤 3 : 界面效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5100.png" alt></p>
<h3 id="步骤-4-Action4Pojo"><a class="header-anchor" href="#步骤-4-Action4Pojo">¶</a>步骤 4 : Action4Pojo</h3>
<p>为Action4Pojo新增OrderItem和集合的getter, setter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.ProductImage;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Property;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.PropertyValue;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Review;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action4Pojo</span> <span class="keyword">extends</span> <span class="title">Action4Pagination</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> Category category;</span><br><span class="line">	<span class="keyword">protected</span> Property property;</span><br><span class="line">	<span class="keyword">protected</span> Product product;</span><br><span class="line">	<span class="keyword">protected</span> ProductImage productImage;</span><br><span class="line">	<span class="keyword">protected</span> PropertyValue propertyValue;</span><br><span class="line">	<span class="keyword">protected</span> User user;</span><br><span class="line">	<span class="keyword">protected</span> Order order;</span><br><span class="line">	<span class="keyword">protected</span> Review review;</span><br><span class="line">	<span class="keyword">protected</span> OrderItem orderItem;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> List&lt;Category&gt; categorys;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;Property&gt; propertys;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;Product&gt; products;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;ProductImage&gt; productSingleImages;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;ProductImage&gt; productDetailImages;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;PropertyValue&gt; propertyValues;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;User&gt; users;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;Order&gt; orders;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;Review&gt; reviews;</span><br><span class="line">	<span class="keyword">protected</span> List&lt;OrderItem&gt; orderItems;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> category;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.category = category;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getCategorys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> categorys;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategorys</span><span class="params">(List&lt;Category&gt; categorys)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.categorys = categorys;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Property <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> property;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(Property property)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.property = property;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Property&gt; <span class="title">getPropertys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> propertys;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertys</span><span class="params">(List&lt;Property&gt; propertys)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertys = propertys;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> product;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.product = product;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> products;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.products = products;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ProductImage <span class="title">getProductImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productImage;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductImage</span><span class="params">(ProductImage productImage)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productImage = productImage;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductSingleImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productSingleImages;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSingleImages</span><span class="params">(List&lt;ProductImage&gt; productSingleImages)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productSingleImages = productSingleImages;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;ProductImage&gt; <span class="title">getProductDetailImages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productDetailImages;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductDetailImages</span><span class="params">(List&lt;ProductImage&gt; productDetailImages)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productDetailImages = productDetailImages;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PropertyValue <span class="title">getPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> propertyValue;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(PropertyValue propertyValue)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;PropertyValue&gt; <span class="title">getPropertyValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> propertyValues;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValues</span><span class="params">(List&lt;PropertyValue&gt; propertyValues)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertyValues = propertyValues;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> users;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.users = users;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> order;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.order = order;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orders;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orders = orders;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-ForeAction-buy"><a class="header-anchor" href="#步骤-5-ForeAction-buy">¶</a>步骤 5 : ForeAction.buy()</h3>
<p>在上个知识点[立即购买]最后，客户端跳转到结算路径： <strong>“forebuy?oiid=”+oiid;</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/forebuy?oiid=1</span><br></pre></td></tr></table></figure>
<p>导致ForeAction.buy()方法被调用</p>
<ol>
<li>
<p>获取参数：数组 oiid<br>
为什么这里要用数组的方式试图获取多个oiid，而不是仅仅获取一个oiid? 因为根据[购物流程环节与表关系]，结算页面还需要显示在购物车里选中的多条OrderItem数据，所以为了兼容从购物车页面跳转过来的需求，要用一个int 数组来接受参数。</p>
</li>
<li>
<p>让orderItems 指向一个新的ArrayList</p>
</li>
<li>
<p>根据前面步骤获取的oiids，从数据库中取出OrderItem对象，并放入orderItems 集合中</p>
</li>
<li>
<p>累计这些ois的价格总数，赋值在total上</p>
</li>
<li>
<p>把订单项集合放在session的属性 “orderItems” 上，为什么要用session? 因为后续生成订单的时候，还会用到它。</p>
</li>
<li>
<p>服务端跳转到buy.jsp</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5102.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">        OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">        total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">        orderItems.add(oi);</span><br><span class="line">        productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-buy-jsp"><a class="header-anchor" href="#步骤-6-buy-jsp">¶</a>步骤 6 : buy.jsp</h3>
<p>与 [register.jsp]相仿，buy.jsp也包含了[header.jsp], [top.jsp], [footer.jsp] 等公共页面。</p>
<p>中间是结算业务页面 [buyPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/buyPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-buyPage-jsp"><a class="header-anchor" href="#步骤-7-buyPage-jsp">¶</a>步骤 7 : buyPage.jsp</h3>
<ol>
<li>
<p>从63行到101行 遍历出订单项集合 ois 中的订单项数据<br>
从[立即购买]跳转到结算页面来只会有一件产品</p>
</li>
<li>
<p>显示总金额</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5104.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"buyPageDiv"</span>&gt;</span><br><span class="line">  &lt;form action=<span class="string">"forecreateOrder"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">   </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"buyFlow"</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left"</span> src=<span class="string">"img/site/simpleLogo.png"</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-right"</span> src=<span class="string">"img/site/buyflow.png"</span>&gt;</span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"address"</span>&gt;</span><br><span class="line">        &lt;div class="addressTip"&gt;输入收货地址&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">         </span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"addressTable"</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td class="firstColumn"&gt;详细地址&lt;span class="redStar"&gt;*&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                     </span><br><span class="line">                    &lt;td&gt;&lt;textarea name="order.address" placeholder="建议您如实填写详细收货地址，例如接到名称，门牌好吗，楼层和房间号等信息"&gt;&lt;/textarea&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;邮政编码&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;input  name="order.post" placeholder="如果您不清楚邮递区号，请填写000000" type="text"&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;收货人姓名&lt;span class="redStar"&gt;*&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;input  name="order.receiver"  placeholder="长度不超过25个字符" type="text"&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;手机号码 &lt;span class="redStar"&gt;*&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;input name="order.mobile"  placeholder="请输入11位手机号码" type="text"&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">             </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"productList"</span>&gt;</span><br><span class="line">        &lt;div class="productListTip"&gt;确认订单信息&lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"productListTable"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th colspan=<span class="string">"2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"productListTableFirstColumn"</span>&gt;</span><br><span class="line">                        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"tmallbuy"</span> src=<span class="string">"img/site/tmallbuy.png"</span>&gt;</span><br><span class="line">                        &lt;a class="marketLink" href="#nowhere"&gt;店铺：天猫店铺&lt;/a&gt;</span><br><span class="line">                        &lt;a class="wangwanglink" href="#nowhere"&gt; &lt;span class="wangwangGif"&gt;&lt;/span&gt; &lt;/a&gt;</span><br><span class="line">                    &lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;单价&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;数量&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;小计&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;配送方式&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"rowborder"</span>&gt;</span><br><span class="line">                    &lt;td  colspan="2" &gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody <span class="class"><span class="keyword">class</span></span>=<span class="string">"productListTableTbody"</span>&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;orderItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span> varStatus=<span class="string">"st"</span> &gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemTR"</span>&gt;</span><br><span class="line">                        &lt;td class="orderItemFirstTD"&gt;&lt;img class="orderItemImg" src="img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemProductInfo"</span>&gt;</span><br><span class="line">                        &lt;a  href=<span class="string">"foreproduct?product.id=$&#123;oi.product.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemProductLink"</span>&gt;</span><br><span class="line">                            $&#123;oi.product.name&#125;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                         </span><br><span class="line">                            &lt;img src=<span class="string">"img/site/creditcard.png"</span> title=<span class="string">"支持信用卡支付"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/7day.png"</span> title=<span class="string">"消费者保障服务,承诺7天退货"</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">"img/site/promise.png"</span> title=<span class="string">"消费者保障服务,承诺如实描述"</span>&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;span class="orderItemProductPrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;oi.product.promotePrice&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                        &lt;span class="orderItemProductNumber"&gt;$&#123;oi.number&#125;&lt;/span&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemUnitSum"</span>&gt;</span><br><span class="line">                        ￥&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;oi.number*oi.product.promotePrice&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">                        &lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count==1&#125;"</span>&gt;</span><br><span class="line">                        &lt;td rowspan=<span class="string">"5"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemLastTD"</span>&gt;</span><br><span class="line">                        &lt;label <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemDeliveryLabel"</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">"radio"</span> value=<span class="string">""</span> checked=<span class="string">"checked"</span>&gt;</span><br><span class="line">                            普通配送</span><br><span class="line">                        &lt;/label&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;select <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemDeliverySelect"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control"</span>&gt;</span><br><span class="line">                            &lt;option&gt;快递 免邮费&lt;/option&gt;</span><br><span class="line">                        &lt;/select&gt;</span><br><span class="line"> </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;             </span><br><span class="line">                 </span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">             </span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemSumDiv"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left"</span>&gt;</span><br><span class="line">                &lt;span class="leaveMessageText"&gt;给卖家留言:&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;</span><br><span class="line">                    &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"leaveMessageImg"</span> src=<span class="string">"img/site/leaveMessage.png"</span>&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"leaveMessageTextareaSpan"</span>&gt;</span><br><span class="line">                    &lt;textarea name="order.userMessage" class="leaveMessageTextarea"&gt;&lt;/textarea&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;span&gt;还可以输入200个字符&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;span class="pull-right"&gt;店铺合计(含运费): ￥&lt;fmt:formatNumber type="number" value="$&#123;total&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemTotalSumDiv"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-right"</span>&gt;</span><br><span class="line">            &lt;span&gt;实付款：&lt;/span&gt;</span><br><span class="line">            &lt;span class="orderItemTotalSumSpan"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;total&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"submitOrderDiv"</span>&gt;</span><br><span class="line">            &lt;button type="submit" class="submitOrderButton"&gt;提交订单&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/form&gt;    </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="4、加入购物车-v2"><a class="header-anchor" href="#4、加入购物车-v2">¶</a>4、加入购物车</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v21"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v21">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v19"><a class="header-anchor" href="#步骤-2-模仿和排错-v19">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-运行效果-v2"><a class="header-anchor" href="#步骤-3-运行效果-v2">¶</a>步骤 3 : 运行效果</h3>
<p>在产品页面点击加入购物车的，除了得到像[立即购买运行效果]中在OrderItem表里插入一条数据外，把界面上的<strong>加入购物车</strong>按钮变成灰色并且不可点击</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5075.png" alt></p>
<h3 id="步骤-4-在产品页点击加入购物车"><a class="header-anchor" href="#步骤-4-在产品页点击加入购物车">¶</a>步骤 4 : 在产品页点击加入购物车</h3>
<p>如果未登录，那么点击加入购物车会弹出[模态登录窗口]，关于这个功能的详细介绍在[模态登录]，在此不做赘述。</p>
<p>登录之后，点击加入购物车，会使用Ajax一步访问地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/foreaddCart?pid=264&amp;num=4</span><br></pre></td></tr></table></figure>
<p>并带上了产品id 264和购买数量4</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5077.png" alt></p>
<h3 id="步骤-5-ForeAction-addCart"><a class="header-anchor" href="#步骤-5-ForeAction-addCart">¶</a>步骤 5 : ForeAction.addCart</h3>
<p>上一步访问地址/foreaddCart导致ForeAction.addCart()方法被调用<br>
addCart()方法和立即购买中的 [ForeAction.buyone()] 步骤做的事情是一样的，区别在于返回不一样<br>
首先 从session中获取用户对象user</p>
<p>接下来就是新增订单项OrderItem， 新增订单项要考虑两个情况<br>
a. 如果已经存在这个产品对应的OrderItem，并且还没有生成订单，即还在购物车中。 那么就应该在对应的OrderItem基础上，调整数量<br>
a.1 基于用户对象user，查询没有生成订单的订单项集合<br>
a.2 遍历这个集合<br>
a.3 如果产品是一样的话，就进行数量追加<br>
a.4 获取这个订单项的 id</p>
<p>b. 如果不存在对应的OrderItem,那么就新增一个订单项OrderItem<br>
b.1 生成新的订单项<br>
b.2 设置数量，用户和产品<br>
b.3 插入到数据库<br>
b.4 获取这个订单项的 id</p>
<p>与 [ForeAction.buyone()] 客户端跳转到[结算页面]不同的是， 最后返回字符串&quot;success&quot;，表示添加成功</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line"> </span><br><span class="line">    List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">        <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">            oi.setNumber(oi.getNumber()+num);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            found = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;      </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">        OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">        oi.setUser(user);</span><br><span class="line">        oi.setNumber(num);</span><br><span class="line">        oi.setProduct(product);</span><br><span class="line">        orderItemService.save(oi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5、查看购物车页面"><a class="header-anchor" href="#5、查看购物车页面">¶</a>5、查看购物车页面</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v22"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v22">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v20"><a class="header-anchor" href="#步骤-2-模仿和排错-v20">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果-v5"><a class="header-anchor" href="#步骤-3-界面效果-v5">¶</a>步骤 3 : 界面效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5105.png" alt></p>
<h3 id="步骤-4-ForeAction-cart"><a class="header-anchor" href="#步骤-4-ForeAction-cart">¶</a>步骤 4 : ForeAction.cart()</h3>
<p>访问地址/forecart导致ForeAction.cart()方法被调用</p>
<ol>
<li>通过session获取当前用户<br>
所以一定要登录才访问，否则拿不到用户对象</li>
<li>获取未这个用户关联的订单项集合 orderItems</li>
<li>服务端跳转到cart.jsp</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">        productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-cart-jsp"><a class="header-anchor" href="#步骤-5-cart-jsp">¶</a>步骤 5 : cart.jsp</h3>
<p>与 [register.jsp]相仿，cart.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]，</p>
<p>[footer.jsp] 等公共页面。<br>
中间是产品业务页面 [cartPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/cartPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-cartPage-jsp"><a class="header-anchor" href="#步骤-6-cartPage-jsp">¶</a>步骤 6 : cartPage.jsp</h3>
<ol>
<li>从238行到282行，遍历订单项集合ois<br>
没了~</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5109.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> deleteOrderItem = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">var</span> deleteOrderItemid = <span class="number">0</span>;</span><br><span class="line">$(function()&#123;</span><br><span class="line"> </span><br><span class="line">    $(<span class="string">"a.deleteOrderItem"</span>).click(function()&#123;</span><br><span class="line">        deleteOrderItem = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">var</span> oiid = $(<span class="keyword">this</span>).attr(<span class="string">"oiid"</span>)</span><br><span class="line">        deleteOrderItemid = oiid;</span><br><span class="line">        $(<span class="string">"#deleteConfirmModal"</span>).modal(<span class="string">'show'</span>);   </span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"button.deleteConfirmButton"</span>).click(function()&#123;</span><br><span class="line">        deleteOrderItem = <span class="keyword">true</span>;</span><br><span class="line">        $(<span class="string">"#deleteConfirmModal"</span>).modal(<span class="string">'hide'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">'#deleteConfirmModal'</span>).on(<span class="string">'hidden.bs.modal'</span>, function (e) &#123;</span><br><span class="line">        <span class="keyword">if</span>(deleteOrderItem)&#123;</span><br><span class="line">            <span class="keyword">var</span> page=<span class="string">"foredeleteOrderItem"</span>;</span><br><span class="line">            $.post(</span><br><span class="line">                    page,</span><br><span class="line">                    &#123;<span class="string">"orderItem.id"</span>:deleteOrderItemid&#125;,</span><br><span class="line">                    function(result)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                            $(<span class="string">"tr.cartProductItemTR[oiid="</span>+deleteOrderItemid+<span class="string">"]"</span>).hide();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span>&#123;</span><br><span class="line">                            location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) </span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"img.cartProductItemIfSelected"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> selectit = $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"selectit"</span>==selectit)&#123;</span><br><span class="line">            $(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartNotSelected.png"</span>);</span><br><span class="line">            $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>,<span class="string">"false"</span>)</span><br><span class="line">            $(<span class="keyword">this</span>).parents(<span class="string">"tr.cartProductItemTR"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#fff"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartSelected.png"</span>);</span><br><span class="line">            $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>,<span class="string">"selectit"</span>)</span><br><span class="line">            $(<span class="keyword">this</span>).parents(<span class="string">"tr.cartProductItemTR"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#FFF8E1"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        syncSelect();</span><br><span class="line">        syncCreateOrderButton();</span><br><span class="line">        calcCartSumPriceAndNumber();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">"img.selectAllItem"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> selectit = $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"selectit"</span>==selectit)&#123;</span><br><span class="line">            $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartNotSelected.png"</span>);</span><br><span class="line">            $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"selectit"</span>,<span class="string">"false"</span>)</span><br><span class="line">            $(<span class="string">".cartProductItemIfSelected"</span>).each(function()&#123;</span><br><span class="line">                $(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartNotSelected.png"</span>);</span><br><span class="line">                $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>,<span class="string">"false"</span>);</span><br><span class="line">                $(<span class="keyword">this</span>).parents(<span class="string">"tr.cartProductItemTR"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#fff"</span>);</span><br><span class="line">            &#125;);        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartSelected.png"</span>);</span><br><span class="line">            $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"selectit"</span>,<span class="string">"selectit"</span>)</span><br><span class="line">            $(<span class="string">".cartProductItemIfSelected"</span>).each(function()&#123;</span><br><span class="line">                $(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartSelected.png"</span>);</span><br><span class="line">                $(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>,<span class="string">"selectit"</span>);</span><br><span class="line">                $(<span class="keyword">this</span>).parents(<span class="string">"tr.cartProductItemTR"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#FFF8E1"</span>);</span><br><span class="line">            &#125;);            </span><br><span class="line">        &#125;</span><br><span class="line">        syncCreateOrderButton();</span><br><span class="line">        calcCartSumPriceAndNumber();</span><br><span class="line">         </span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".orderItemNumberSetting"</span>).keyup(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> pid=$(<span class="keyword">this</span>).attr(<span class="string">"pid"</span>);</span><br><span class="line">        <span class="keyword">var</span> stock= $(<span class="string">"span.orderItemStock[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">        <span class="keyword">var</span> price= $(<span class="string">"span.orderItemPromotePrice[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".orderItemNumberSetting[pid="</span>+pid+<span class="string">"]"</span>).val();</span><br><span class="line">        num = parseInt(num);</span><br><span class="line">        <span class="keyword">if</span>(isNaN(num))</span><br><span class="line">            num= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">         </span><br><span class="line">        syncPrice(pid,num,price);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    $(<span class="string">".numberPlus"</span>).click(function()&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> pid=$(<span class="keyword">this</span>).attr(<span class="string">"pid"</span>);</span><br><span class="line">        <span class="keyword">var</span> stock= $(<span class="string">"span.orderItemStock[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">        <span class="keyword">var</span> price= $(<span class="string">"span.orderItemPromotePrice[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".orderItemNumberSetting[pid="</span>+pid+<span class="string">"]"</span>).val();</span><br><span class="line"> </span><br><span class="line">        num++;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;stock)</span><br><span class="line">            num = stock;</span><br><span class="line">        syncPrice(pid,num,price);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">".numberMinus"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> pid=$(<span class="keyword">this</span>).attr(<span class="string">"pid"</span>);</span><br><span class="line">        <span class="keyword">var</span> stock= $(<span class="string">"span.orderItemStock[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">        <span class="keyword">var</span> price= $(<span class="string">"span.orderItemPromotePrice[pid="</span>+pid+<span class="string">"]"</span>).text();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> num= $(<span class="string">".orderItemNumberSetting[pid="</span>+pid+<span class="string">"]"</span>).val();</span><br><span class="line">        --num;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)</span><br><span class="line">            num=<span class="number">1</span>;</span><br><span class="line">        syncPrice(pid,num,price);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"button.createOrderButton"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> params = <span class="string">""</span>;</span><br><span class="line">        $(<span class="string">".cartProductItemIfSelected"</span>).each(function()&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"selectit"</span>==$(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>))&#123;</span><br><span class="line">                <span class="keyword">var</span> oiid = $(<span class="keyword">this</span>).attr(<span class="string">"oiid"</span>);</span><br><span class="line">                params += <span class="string">"&amp;oiids="</span>+oiid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        params = params.substring(<span class="number">1</span>);</span><br><span class="line">        location.href=<span class="string">"forebuy?"</span>+params;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="function">function <span class="title">syncCreateOrderButton</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> selectAny = <span class="keyword">false</span>;</span><br><span class="line">    $(<span class="string">".cartProductItemIfSelected"</span>).each(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"selectit"</span>==$(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>))&#123;</span><br><span class="line">            selectAny = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(selectAny)&#123;</span><br><span class="line">        $(<span class="string">"button.createOrderButton"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#C40000"</span>);</span><br><span class="line">        $(<span class="string">"button.createOrderButton"</span>).removeAttr(<span class="string">"disabled"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $(<span class="string">"button.createOrderButton"</span>).css(<span class="string">"background-color"</span>,<span class="string">"#AAAAAA"</span>);</span><br><span class="line">        $(<span class="string">"button.createOrderButton"</span>).attr(<span class="string">"disabled"</span>,<span class="string">"disabled"</span>);     </span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">syncSelect</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> selectAll = <span class="keyword">true</span>;</span><br><span class="line">    $(<span class="string">".cartProductItemIfSelected"</span>).each(function()&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"false"</span>==$(<span class="keyword">this</span>).attr(<span class="string">"selectit"</span>))&#123;</span><br><span class="line">            selectAll = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(selectAll)</span><br><span class="line">        $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartSelected.png"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        $(<span class="string">"img.selectAllItem"</span>).attr(<span class="string">"src"</span>,<span class="string">"img/site/cartNotSelected.png"</span>);</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">calcCartSumPriceAndNumber</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> totalNumber = <span class="number">0</span>;</span><br><span class="line">    $(<span class="string">"img.cartProductItemIfSelected[selectit='selectit']"</span>).each(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> oiid = $(<span class="keyword">this</span>).attr(<span class="string">"oiid"</span>);</span><br><span class="line">        <span class="keyword">var</span> price =$(<span class="string">".cartProductItemSmallSumPrice[oiid="</span>+oiid+<span class="string">"]"</span>).text();</span><br><span class="line">        price = price.replace(/,/g, <span class="string">""</span>);</span><br><span class="line">        price = price.replace(/￥/g, <span class="string">""</span>);</span><br><span class="line">        sum += <span class="keyword">new</span> Number(price);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">var</span> num =$(<span class="string">".orderItemNumberSetting[oiid="</span>+oiid+<span class="string">"]"</span>).val();</span><br><span class="line">        totalNumber += <span class="keyword">new</span> Number(num);</span><br><span class="line">         </span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"span.cartSumPrice"</span>).html(<span class="string">"￥"</span>+formatMoney(sum));</span><br><span class="line">    $(<span class="string">"span.cartTitlePrice"</span>).html(<span class="string">"￥"</span>+formatMoney(sum));</span><br><span class="line">    $(<span class="string">"span.cartSumNumber"</span>).html(totalNumber);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">syncPrice</span><span class="params">(pid,num,price)</span></span>&#123;</span><br><span class="line">    $(<span class="string">".orderItemNumberSetting[pid="</span>+pid+<span class="string">"]"</span>).val(num);</span><br><span class="line">    <span class="keyword">var</span> cartProductItemSmallSumPrice = formatMoney(num*price);</span><br><span class="line">    $(<span class="string">".cartProductItemSmallSumPrice[pid="</span>+pid+<span class="string">"]"</span>).html(<span class="string">"￥"</span>+cartProductItemSmallSumPrice);</span><br><span class="line">    calcCartSumPriceAndNumber();</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">var</span> page = <span class="string">"forechangeOrderItem"</span>;</span><br><span class="line">    $.post(</span><br><span class="line">            page,</span><br><span class="line">            &#123;<span class="string">"product.id"</span>:pid,<span class="string">"num"</span>:num&#125;,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"success"</span>!=result)&#123;</span><br><span class="line">                    location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;title&gt;购物车&lt;/title&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartTitle pull-right"</span>&gt;</span><br><span class="line">        &lt;span&gt;已选商品  (不含运费)&lt;/span&gt;</span><br><span class="line">        &lt;span class="cartTitlePrice"&gt;￥0.00&lt;/span&gt;</span><br><span class="line">        &lt;button class="createOrderButton" disabled="disabled"&gt;结 算&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductList"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductTable"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th <span class="class"><span class="keyword">class</span></span>=<span class="string">"selectAndImage"</span>&gt;</span><br><span class="line">                            &lt;img selectit=<span class="string">"false"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"selectAllItem"</span> src=<span class="string">"img/site/cartNotSelected.png"</span>&gt;              </span><br><span class="line">                    全选</span><br><span class="line">                     </span><br><span class="line">                    &lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;商品信息&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;单价&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;数量&lt;/th&gt;</span><br><span class="line">                    &lt;th width="120px"&gt;金额&lt;/th&gt;</span><br><span class="line">                    &lt;th class="operation"&gt;操作&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;orderItems &#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span>&gt;</span><br><span class="line">                    &lt;tr oiid=<span class="string">"$&#123;oi.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductItemTR"</span>&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;img selectit=<span class="string">"false"</span> oiid=<span class="string">"$&#123;oi.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductItemIfSelected"</span> src=<span class="string">"img/site/cartNotSelected.png"</span>&gt;</span><br><span class="line">                            &lt;a style="display:none" href="#nowhere"&gt;&lt;img src="img/site/cartSelected.png"&gt;&lt;/a&gt;</span><br><span class="line">                            &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductImg"</span>  src=<span class="string">"img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg"</span>&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductLinkOutDiv"</span>&gt;</span><br><span class="line">                                &lt;a href="foreproduct?product.id=$&#123;oi.product.id&#125;" class="cartProductLink"&gt;$&#123;oi.product.name&#125;&lt;/a&gt;</span><br><span class="line">                                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductLinkInnerDiv"</span>&gt;</span><br><span class="line">                                    &lt;img src=<span class="string">"img/site/creditcard.png"</span> title=<span class="string">"支持信用卡支付"</span>&gt;</span><br><span class="line">                                    &lt;img src=<span class="string">"img/site/7day.png"</span> title=<span class="string">"消费者保障服务,承诺7天退货"</span>&gt;</span><br><span class="line">                                    &lt;img src=<span class="string">"img/site/promise.png"</span> title=<span class="string">"消费者保障服务,承诺如实描述"</span>&gt;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                             </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;span class="cartProductItemOringalPrice"&gt;￥$&#123;oi.product.originalPrice&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;span  class="cartProductItemPromotionPrice"&gt;￥$&#123;oi.product.promotePrice&#125;&lt;/span&gt;</span><br><span class="line">                             </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                         </span><br><span class="line">                            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductChangeNumberDiv"</span>&gt;</span><br><span class="line">                                &lt;span class="hidden orderItemStock " pid="$&#123;oi.product.id&#125;"&gt;$&#123;oi.product.stock&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;span class="hidden orderItemPromotePrice " pid="$&#123;oi.product.id&#125;"&gt;$&#123;oi.product.promotePrice&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;a  pid="$&#123;oi.product.id&#125;" class="numberMinus" href="#nowhere"&gt;-&lt;/a&gt;</span><br><span class="line">                                &lt;input pid=<span class="string">"$&#123;oi.product.id&#125;"</span> oiid=<span class="string">"$&#123;oi.id&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemNumberSetting"</span> autocomplete=<span class="string">"off"</span> value=<span class="string">"$&#123;oi.number&#125;"</span>&gt;</span><br><span class="line">                                &lt;a  stock="$&#123;oi.product.stock&#125;" pid="$&#123;oi.product.id&#125;" class="numberPlus" href="#nowhere"&gt;+&lt;/a&gt;</span><br><span class="line">                            &lt;/div&gt;                   </span><br><span class="line">                         </span><br><span class="line">                         &lt;/td&gt;</span><br><span class="line">                        &lt;td &gt;</span><br><span class="line">                            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartProductItemSmallSumPrice"</span> oiid=<span class="string">"$&#123;oi.id&#125;"</span> pid=<span class="string">"$&#123;oi.product.id&#125;"</span> &gt;</span><br><span class="line">                            ￥&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;oi.product.promotePrice*oi.number&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                         </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;a class="deleteOrderItem" oiid="$&#123;oi.id&#125;"  href="#nowhere"&gt;删除&lt;/a&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;             </span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"cartFoot"</span>&gt;</span><br><span class="line">        &lt;img selectit=<span class="string">"false"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"selectAllItem"</span> src=<span class="string">"img/site/cartNotSelected.png"</span>&gt;</span><br><span class="line">        &lt;span&gt;全选&lt;/span&gt;</span><br><span class="line">&lt;!--         &lt;a href="#"&gt;删除&lt;/a&gt; --&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-right"</span>&gt;</span><br><span class="line">            &lt;span&gt;已选商品 &lt;span class="cartSumNumber" &gt;0&lt;/span&gt; 件&lt;/span&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;span&gt;合计 (不含运费): &lt;/span&gt;</span><br><span class="line">            &lt;span class="cartSumPrice" &gt;￥0.00&lt;/span&gt;</span><br><span class="line">            &lt;button class="createOrderButton" disabled="disabled" &gt;结  算&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="6、登录状态"><a class="header-anchor" href="#6、登录状态">¶</a>6、登录状态</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v23"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v23">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v21"><a class="header-anchor" href="#步骤-2-模仿和排错-v21">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果-v5"><a class="header-anchor" href="#步骤-3-效果-v5">¶</a>步骤 3 : 效果</h3>
<p>在未登录状态下，点击我的购物车，会跳转到登陆页面去</p>
<h3 id="步骤-4-查看购物车页面的问题"><a class="header-anchor" href="#步骤-4-查看购物车页面的问题">¶</a>步骤 4 : 查看购物车页面的问题</h3>
<p>[查看购物车页面]有个问题，必须建立在已经登录的状态之上。 如果没有登录，而访问地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/forecart</span></span><br></pre></td></tr></table></figure>
<p>就会看到空的购物车，而在业务上，在没有登陆之前，是不允许访问购物车的。</p>
<h3 id="步骤-5-解决思路"><a class="header-anchor" href="#步骤-5-解决思路">¶</a>步骤 5 : 解决思路</h3>
<p>所以在查看购物车之前，应该进行登录操作，但是又不能确保用户一定会记得登录，那么怎么办呢？<br>
准备一个拦截器，当访问那些需要登录才能做的页面的时候，进行是否登录的判断，如果不通过，那么就跳转到login.jsp页面去，提示用户登录。</p>
<p>哪些页面需要登录？哪些页面不需要呢？<br>
a. 不需要登录也可以访问的<br>
如：注册，登录，产品，首页，分类，查询等等<br>
b. 需要登录才能够访问的<br>
如：购买行为，加入购物车行为，查看购物车，查看我的订单等等</p>
<h3 id="步骤-6-AuthInterceptor"><a class="header-anchor" href="#步骤-6-AuthInterceptor">¶</a>步骤 6 : AuthInterceptor</h3>
<p>新建一个过滤器AuthInterceptor，根据[解决思路],哪些页面需要登录？哪些页面不需要呢？<br>
a. 不需要登录也可以访问的<br>
如：注册，登录，产品，首页，分类，查询等等<br>
b. 需要登录才能够访问的<br>
如：购买行为，加入购物车行为，查看购物车，查看我的订单等等<br>
不需要登录也可以访问的已经确定了，但是需要登录才能够访问，截止目前为止还不能确定，所以这个过滤器就判断如果不是注册，登录，产品这些，就进行登录校验</p>
<ol>
<li>
<p>准备字符串数组 noNeedAuthPage，存放哪些不需要登录也能访问的路径</p>
</li>
<li>
<p>获取contextPath： tmall_ssh</p>
</li>
<li>
<p>获取uri</p>
</li>
<li>
<p>去掉前缀/tmall_ssh</p>
</li>
<li>
<p>如果访问的地址是/fore开头<br>
4.1 取出fore后面的字符串，比如是forecart,那么就取出cart<br>
4.2 判断cart是否是在noNeedAuthPage<br>
4.2 如果不在，那么就需要进行是否登录验证<br>
4.3 从session中取出&quot;user&quot;对象<br>
4.4 如果user对象不存在，就客户端跳转到login.jsp<br>
4.5 否则就正常执行</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.interceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.StrutsStatics;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.AbstractInterceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthInterceptor</span>  <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService;         </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String[] noNeedAuthPage = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                <span class="string">"home"</span>,</span><br><span class="line">                <span class="string">"checkLogin"</span>,</span><br><span class="line">                <span class="string">"register"</span>,</span><br><span class="line">                <span class="string">"loginAjax"</span>,</span><br><span class="line">                <span class="string">"login"</span>,</span><br><span class="line">                <span class="string">"product"</span>,</span><br><span class="line">                <span class="string">"category"</span>,</span><br><span class="line">                <span class="string">"search"</span>&#125;;</span><br><span class="line">         </span><br><span class="line">        ActionContext ctx = invocation.getInvocationContext();</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) ctx.get(StrutsStatics.HTTP_REQUEST);</span><br><span class="line">        HttpServletResponse response= (HttpServletResponse) ctx.get(StrutsStatics.HTTP_RESPONSE);</span><br><span class="line">        ServletContext servletContext= (ServletContext) ctx.get(StrutsStatics.SERVLET_CONTEXT);</span><br><span class="line">        String contextPath = servletContext.getContextPath();</span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        uri =StringUtils.remove(uri, contextPath);</span><br><span class="line">        <span class="keyword">if</span>(uri.startsWith(<span class="string">"/fore"</span>))&#123;</span><br><span class="line">            String method = StringUtils.substringAfterLast(uri,<span class="string">"/fore"</span> );</span><br><span class="line">            <span class="keyword">if</span>(!Arrays.asList(noNeedAuthPage).contains(method))&#123;</span><br><span class="line">                User user = (User) ctx.getSession().get(<span class="string">"user"</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">null</span>==user)&#123;</span><br><span class="line">                    response.sendRedirect(<span class="string">"login.jsp"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  invocation.invoke();</span><br><span class="line">    &#125; </span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-struts-xml"><a class="header-anchor" href="#步骤-7-struts-xml">¶</a>步骤 7 : struts.xml</h3>
<p>在struts.xml中增加对AuthInterceptor的配置</p>
<p>如果对拦截器原理以及配置方式不熟悉，请学习相关教程： [拦截器]</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.objectFactory"</span> <span class="attr">value</span>=<span class="string">"spring"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"basicstruts"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.AuthInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!-- 拦截器栈 --&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> /&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span> /&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="7、搜索栏"><a class="header-anchor" href="#7、搜索栏">¶</a>7、搜索栏</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v24"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v24">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v22"><a class="header-anchor" href="#步骤-2-模仿和排错-v22">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v6"><a class="header-anchor" href="#步骤-3-效果截图-v6">¶</a>步骤 3 : 效果截图</h3>
<p>搜索栏下面出现4个分类名称，在此之前是不会出现这4个分类名称的</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5353.png" alt></p>
<h3 id="步骤-4-CategoryNamesBelowSearchInterceptor"><a class="header-anchor" href="#步骤-4-CategoryNamesBelowSearchInterceptor">¶</a>步骤 4 : CategoryNamesBelowSearchInterceptor</h3>
<p>因为在搜索栏下需要出现分类名称这个需求在很多页面都有，比如首页，分类页，搜索结果页，产品页等等<br>
为了避免开发的繁杂，所以也采用拦截器来处理，这样只需要一个拦截器就可以了，而且也不许对原有的代码进行改动。</p>
<ol>
<li>
<p>如果发现是以/fore开头的访问就进行处理</p>
</li>
<li>
<p>取出所有的分类对象</p>
</li>
<li>
<p>放在session的&quot;cs&quot;中</p>
</li>
<li>
<p>在[search.jsp]，[simpleSearch.jsp]中进行显示</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.interceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.StrutsStatics;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Category;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.AbstractInterceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryNamesBelowSearchInterceptor</span>  <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;           </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           </span><br><span class="line">        ActionContext ctx = invocation.getInvocationContext();</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) ctx.get(StrutsStatics.HTTP_REQUEST);</span><br><span class="line">        ServletContext servletContext= (ServletContext) ctx.get(StrutsStatics.SERVLET_CONTEXT);</span><br><span class="line">         </span><br><span class="line">        String contextPath = servletContext.getContextPath();</span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        uri =StringUtils.remove(uri, contextPath);</span><br><span class="line">        <span class="keyword">if</span>(uri.startsWith(<span class="string">"/fore"</span>))&#123;</span><br><span class="line">                List&lt;Category&gt; cs = categoryService.list();</span><br><span class="line">                ctx.getSession().put(<span class="string">"cs"</span>, cs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.invoke();</span><br><span class="line">    </span><br><span class="line">    &#125; </span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-struts-xml"><a class="header-anchor" href="#步骤-5-struts-xml">¶</a>步骤 5 : struts.xml</h3>
<p>在 struts.xml中添加categoryNamesBelowSearchInterceptor拦截器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.objectFactory"</span> <span class="attr">value</span>=<span class="string">"spring"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"basicstruts"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.AuthInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"categoryNamesBelowSearchInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.CategoryNamesBelowSearchInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!-- 拦截器栈 --&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> /&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"categoryNamesBelowSearchInterceptor"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span> /&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="8、购物总数"><a class="header-anchor" href="#8、购物总数">¶</a>8、购物总数</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v25"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v25">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v23"><a class="header-anchor" href="#步骤-2-模仿和排错-v23">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v7"><a class="header-anchor" href="#步骤-3-效果截图-v7">¶</a>步骤 3 : 效果截图</h3>
<p>右上角的购物车可以正确显示当前的购买数量</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5357.png" alt></p>
<h3 id="步骤-4-CartTotalItemNumberInterceptor"><a class="header-anchor" href="#步骤-4-CartTotalItemNumberInterceptor">¶</a>步骤 4 : CartTotalItemNumberInterceptor</h3>
<p>与[拦截器-搜索栏]类似的，显示购物车里数量的这个需求也是很多页面都需要，所以也通过拦截器来实现。</p>
<ol>
<li>
<p>判断是否是以/fore开头的访问</p>
</li>
<li>
<p>是否登陆<br>
2.1 如果登陆了，那么就把当前用户的<strong>未设置订单的订单项</strong>取出来，并累计其中的数量，然后放在session的&quot;cartTotalItemNumber&quot; 上<br>
2.2 如果未登陆，则把session的cartTotalItemNumber设置为0.</p>
</li>
</ol>
<p><strong>注：</strong> <strong>未设置订单的订单项</strong>就是那些购物车中的数据，否则就是订单里的数据了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.interceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.StrutsStatics;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.AbstractInterceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartTotalItemNumberInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderItemService orderItemService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         </span><br><span class="line">        ActionContext ctx = invocation.getInvocationContext();</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) ctx.get(StrutsStatics.HTTP_REQUEST);</span><br><span class="line">        ServletContext servletContext = (ServletContext) ctx.get(StrutsStatics.SERVLET_CONTEXT);</span><br><span class="line"> </span><br><span class="line">        String contextPath = servletContext.getContextPath();</span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        uri = StringUtils.remove(uri, contextPath);</span><br><span class="line">        <span class="keyword">if</span> (uri.startsWith(<span class="string">"/fore"</span>)) &#123;</span><br><span class="line">            User user = (User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != user) &#123;</span><br><span class="line">                <span class="keyword">int</span> cartTotalItemNumber = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> != user) &#123;</span><br><span class="line">                    List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>, user, <span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">for</span> (OrderItem oi : ois)</span><br><span class="line">                        cartTotalItemNumber += oi.getNumber();</span><br><span class="line">                &#125;</span><br><span class="line">                ctx.getSession().put(<span class="string">"cartTotalItemNumber"</span>, cartTotalItemNumber);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ctx.getSession().put(<span class="string">"cartTotalItemNumber"</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.invoke();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-struts-xml-v2"><a class="header-anchor" href="#步骤-5-struts-xml-v2">¶</a>步骤 5 : struts.xml</h3>
<p>struts.xml中增加对CartTotalItemNumberInterceptor的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.objectFactory"</span> <span class="attr">value</span>=<span class="string">"spring"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"basicstruts"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.AuthInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"categoryNamesBelowSearchInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.CategoryNamesBelowSearchInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"cartTotalItemNumberInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.how2java.tmall.interceptor.CartTotalItemNumberInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!-- 拦截器栈 --&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"authorityInterceptor"</span> /&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"categoryNamesBelowSearchInterceptor"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"cartTotalItemNumberInterceptor"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span> /&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"auth-default"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="9、购物车页面操作"><a class="header-anchor" href="#9、购物车页面操作">¶</a>9、购物车页面操作</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v26"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v26">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v24"><a class="header-anchor" href="#步骤-2-模仿和排错-v24">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-购物车页面操作"><a class="header-anchor" href="#步骤-3-购物车页面操作">¶</a>步骤 3 : 购物车页面操作</h3>
<p>购物车页面和服务端的交互主要是三个</p>
<ol>
<li>增加、减少某种产品的数量</li>
<li>删除某种产品</li>
<li>选中产品后，提交到结算页面</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5079.png" alt></p>
<h3 id="步骤-4-调整订单数量"><a class="header-anchor" href="#步骤-4-调整订单数量">¶</a>步骤 4 : 调整订单数量</h3>
<p>点击增加或者减少按钮后，根据 cartPage.jsp 中的js代码，会通过Ajax访问/forechangeOrderItem路径，导致ForeAction.changeOrderItem()方法被调用</p>
<ol>
<li>获取当前用户</li>
<li>遍历出用户当前所有的未生成订单的OrderItem</li>
<li>根据product.id找到匹配的OrderItem，并修改数量后更新到数据库</li>
<li>返回字符串&quot;success&quot;</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5081.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="string">"forechangeOrderItem"</span>;</span><br><span class="line">$.post(</span><br><span class="line">        page,</span><br><span class="line">        &#123;<span class="string">"product.id"</span>:pid,<span class="string">"num"</span>:num&#125;,</span><br><span class="line">        function(result)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"success"</span>!=result)&#123;</span><br><span class="line">                location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">        <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-删除订单项"><a class="header-anchor" href="#步骤-5-删除订单项">¶</a>步骤 5 : 删除订单项</h3>
<p>点击删除按钮后，根据 [cartPage.jsp] 中的js代码，会通过Ajax访问/foredeleteOrderItem路径，导致ForeAction.deleteOrderItem方法被调用</p>
<ol>
<li>删除OrderItem数据</li>
<li>返回字符串&quot;success&quot;</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5082.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(deleteOrderItem)&#123;</span><br><span class="line">    <span class="keyword">var</span> page=<span class="string">"foredeleteOrderItem"</span>;</span><br><span class="line">    $.post(</span><br><span class="line">            page,</span><br><span class="line">            &#123;<span class="string">"orderItem.id"</span>:deleteOrderItemid&#125;,</span><br><span class="line">            function(result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                    $(<span class="string">"tr.cartProductItemTR[oiid="</span>+deleteOrderItemid+<span class="string">"]"</span>).hide();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">    orderItemService.delete(orderItem);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-提交到结算页面"><a class="header-anchor" href="#步骤-6-提交到结算页面">¶</a>步骤 6 : 提交到结算页面</h3>
<p>在选中了购物车中的任意商品之后，结算按钮呈现可点击状态。<br>
点击之后，提交到[结算页面]，并带上(多个)被选中的OrderItem对象的id</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/tmall_ssh/forebuy?oiids=2&amp;oiids=1</span><br></pre></td></tr></table></figure>
<p>之后的流程就进入了前面讲解过的[结算页面]，在此不作赘述。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5083.png" alt></p>
<h2 id="10、订单状态图"><a class="header-anchor" href="#10、订单状态图">¶</a>10、订单状态图</h2>
<h3 id="步骤-1-订单状态图"><a class="header-anchor" href="#步骤-1-订单状态图">¶</a>步骤 1 : 订单状态图</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5121.png" alt></p>
<h3 id="步骤-2-订单状态讲解"><a class="header-anchor" href="#步骤-2-订单状态讲解">¶</a>步骤 2 : 订单状态讲解</h3>
<p>在开始实现订单相关功能之前，我们把订单的状态捋一捋，这样有助于代码思路更加清晰</p>
<ol>
<li>
<p>首先是创建订单，刚创建好之后，订单处于<strong>waitPay 待付款</strong>状态</p>
</li>
<li>
<p>接着是付款，付款后，订单处于<strong>waitDelivery 待发货</strong>状态</p>
</li>
<li>
<p>前两部都是前台用户操作导致的，接下来需要到后台做发货操作，发货后，订单处于<strong>waitConfirm 待确认收货</strong>状态</p>
</li>
<li>
<p>接着又是前台用户进行确认收货操作，操作之后，订单处于<strong>waitReview 待评价</strong>状态</p>
</li>
<li>
<p>最后进行评价，评价之后，订单处于<strong>finish 完成</strong>状态</p>
</li>
</ol>
<p>以上状态都是一个接一个的，不能跳状态进行。<br>
比较特殊的是，无论当前订单处于哪个状态，都可以进行删除操作。 像订单这样极其重要的业务数据，实际上是不运行真正从数据库中删除掉的，而是把状态标记为删除，以表示其被删掉了，所以在删除之后，订单处于 <strong>delete 已删除</strong>状态</p>
<h3 id="步骤-3-后续功能与订单状态的关系"><a class="header-anchor" href="#步骤-3-后续功能与订单状态的关系">¶</a>步骤 3 : 后续功能与订单状态的关系</h3>
<p>接下来的功能开发，其实就是创建订单，并且根据用户不同的操作，对其进行相应状态调整的一个过程。</p>
<h2 id="11、生成订单"><a class="header-anchor" href="#11、生成订单">¶</a>11、生成订单</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v27"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v27">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v25"><a class="header-anchor" href="#步骤-2-模仿和排错-v25">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-结算页操作"><a class="header-anchor" href="#步骤-3-结算页操作">¶</a>步骤 3 : 结算页操作</h3>
<p>首先通过[立即购买]或者[购物车的提交到结算页面] 进入[结算页面]，然后点击提交订单</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5084.png" alt></p>
<h3 id="步骤-4-运行效果"><a class="header-anchor" href="#步骤-4-运行效果">¶</a>步骤 4 : 运行效果</h3>
<p>提交订单后，在数据库中生成一条Order记录。<br>
不仅如此，订单项的oid字段也会被设置为这条Order记录的id</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5085.png" alt></p>
<h3 id="步骤-5-OrderService"><a class="header-anchor" href="#步骤-5-OrderService">¶</a>步骤 5 : OrderService</h3>
<p>在OrderService中增加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitPay = <span class="string">"waitPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitDelivery = <span class="string">"waitDelivery"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitConfirm = <span class="string">"waitConfirm"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitReview = <span class="string">"waitReview"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String finish = <span class="string">"finish"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String delete = <span class="string">"delete"</span>;  </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-OrderServiceImpl"><a class="header-anchor" href="#步骤-6-OrderServiceImpl">¶</a>步骤 6 : OrderServiceImpl</h3>
<p>在OrderServiceImpl中增加createOrder的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>把订单插入到数据库中</li>
<li>为每个OrderItem设置其订单</li>
<li>累计金额并返回</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> OrderItemService orderItemService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transactional</span>(propagation=Propagation.REQUIRED,rollbackForClassName=<span class="string">"Exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span> </span>&#123;</span><br><span class="line">        save(order);</span><br><span class="line">        <span class="keyword">float</span> total =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi: ois) &#123;</span><br><span class="line">            oi.setOrder(order);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            total+=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-对createOrder进行事务管理"><a class="header-anchor" href="#步骤-7-对createOrder进行事务管理">¶</a>步骤 7 : 对createOrder进行事务管理</h3>
<p>因为插入订单和修改订单项应该是要么都成功，要么都失败，所以在createOrder前加上了事务注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation=Propagation.REQUIRED,rollbackForClassName=<span class="string">"Exception"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation=Propagation.REQUIRED,rollbackForClassName=<span class="string">"Exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span> </span>&#123;</span><br><span class="line">        save(order);</span><br><span class="line">        <span class="keyword">float</span> total =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi: ois) &#123;</span><br><span class="line">            oi.setOrder(order);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            total+=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-ForeAction-createOrder"><a class="header-anchor" href="#步骤-8-ForeAction-createOrder">¶</a>步骤 8 : ForeAction.createOrder</h3>
<p>提交订单访问路径 /forecreateOrder, 导致ForeAction.createOrder 方法被调用</p>
<ol>
<li>
<p>从session获取订单项集合. ( 在[结算功能的ForeAction.buy() 32行],订单项集合被放到了session中 )</p>
</li>
<li>
<p>如果订单项集合是空，则跳转到登陆页面</p>
</li>
<li>
<p>从session中获取user对象</p>
</li>
<li>
<p>根据当前时间加上一个4位随机数生成订单号</p>
</li>
<li>
<p>根据上述参数，创建订单对象</p>
</li>
<li>
<p>把订单状态设置为等待支付</p>
</li>
<li>
<p>调用[OrderServiceImpl.createOrder()] 把订单插入到数据库，并设置每个订单项的Order属性，更新到数据库</p>
</li>
<li>
<p>获取本次订单的总金额</p>
</li>
<li>
<p>客户端跳转到确认支付页forealipay</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">    <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">  </span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">     </span><br><span class="line">    order.setOrderCode(orderCode);</span><br><span class="line">    order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">    order.setUser(user);</span><br><span class="line">    order.setStatus(OrderService.waitPay);</span><br><span class="line">     </span><br><span class="line">    total = orderService.createOrder(order, ois);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-9-确认支付页"><a class="header-anchor" href="#步骤-9-确认支付页">¶</a>步骤 9 : 确认支付页</h3>
<ol>
<li>
<p>在上一步客户端跳转到路径/forealipay方法，导致ForeAction.alipay()方法被调用。 alipay()没做什么事情，就是服务端跳转到了alipay.jsp页面。</p>
</li>
<li>
<p>alipay.jsp :<br>
与 [register.jsp] 相仿，alipay.jsp也包含了[header.jsp], [top.jsp]， [footer.jsp] 等公共页面。<br>
中间是确认支付业务页面 alipayPage.jsp</p>
</li>
<li>
<p>alipayPage.jsp:<br>
显示总金额，并且让确认支付按钮跳转到页面 /forepayed页面，并带上oid和金额</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5088.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">alipay</span><span class="params">(HttpActionRequest request, HttpActionResponse response, Page page)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/alipayPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"aliPayPageDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"aliPayPageLogo"</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left"</span> src=<span class="string">"img/site/simpleLogo.png"</span>&gt;</span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span class="confirmMoneyText"&gt;扫一扫付款（元）&lt;/span&gt;</span><br><span class="line">        &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmMoney"</span>&gt;</span><br><span class="line">        ￥&lt;fmt:formatNumber type="number" value="$&#123;param.total&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"aliPayImg"</span> src=<span class="string">"img/site/alipay2wei.png"</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;a href="forepayed?order.id=$&#123;order.id&#125;&amp;total=$&#123;param.total&#125;"&gt;&lt;button class="confirmPay"&gt;确认支付&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-10-支付成功页"><a class="header-anchor" href="#步骤-10-支付成功页">¶</a>步骤 10 : 支付成功页</h3>
<ol>
<li>
<p>在上一步确认访问按钮提交数据到/forepayed,导致ForeAction.payed方法被调用<br>
1.1 让order引用指向持久化对象<br>
1.2 修改订单对象的状态和支付时间<br>
1.3 更新这个订单对象到数据库<br>
1.4 服务端跳转到payed.jsp<br>
1.5 把这个订单对象放在request的属性&quot;o&quot;上</p>
</li>
<li>
<p>payed.jsp<br>
与 [register.jsp] 相仿，payed.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。<br>
中间是支付成功业务页面payedPage.jsp</p>
</li>
<li>
<p>payedPage.jsp<br>
显示订单中的地址，邮编，收货人，手机号码等等</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5089.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    order.setStatus(OrderService.waitDelivery);</span><br><span class="line">    order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">    orderService.update(order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/payedPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"payedDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"payedTextDiv"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/site/paySuccess.png"</span>&gt;</span><br><span class="line">        &lt;span&gt;您已成功付款&lt;/span&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"payedAddressInfo"</span>&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;收货地址：$&#123;order.address&#125; $&#123;order.receiver&#125; $&#123;order.mobile &#125;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;实付款：&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"payedInfoPrice"</span>&gt;</span><br><span class="line">            ￥&lt;fmt:formatNumber type=<span class="string">"number"</span> value=<span class="string">"$&#123;param.total&#125;"</span> minFractionDigits=<span class="string">"2"</span>/&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li&gt;预计08月08日送达    &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">                 </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"paedCheckLinkDiv"</span>&gt;</span><br><span class="line">            您可以</span><br><span class="line">            &lt;a class="payedCheckLink" href="forebought"&gt;查看已买到的宝贝&lt;/a&gt;</span><br><span class="line">            &lt;a class="payedCheckLink" href="forebought"&gt;查看交易详情 &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">             </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"payedSeperateLine"</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"warningDiv"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/site/warning.png"</span>&gt;</span><br><span class="line">        &lt;b&gt;安全提醒：&lt;/b&gt;下单后，&lt;span class="redColor boldWord"&gt;用QQ给您发送链接办理退款的都是骗子！&lt;/span&gt;天猫不存在系统升级，订单异常等问题，谨防假冒客服电话诈骗！</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12、我的订单页"><a class="header-anchor" href="#12、我的订单页">¶</a>12、我的订单页</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v28"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v28">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v26"><a class="header-anchor" href="#步骤-2-模仿和排错-v26">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-效果截图-v8"><a class="header-anchor" href="#步骤-3-效果截图-v8">¶</a>步骤 3 : 效果截图</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5090.png" alt></p>
<h3 id="步骤-4-OrderService"><a class="header-anchor" href="#步骤-4-OrderService">¶</a>步骤 4 : OrderService</h3>
<p>OrderService新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">listByUserWithoutDelete</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> <span class="keyword">extends</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitPay = <span class="string">"waitPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitDelivery = <span class="string">"waitDelivery"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitConfirm = <span class="string">"waitConfirm"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String waitReview = <span class="string">"waitReview"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String finish = <span class="string">"finish"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String delete = <span class="string">"delete"</span>;  </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">listByUserWithoutDelete</span><span class="params">(User user)</span></span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-OrderServiceImpl"><a class="header-anchor" href="#步骤-5-OrderServiceImpl">¶</a>步骤 5 : OrderServiceImpl</h3>
<p>OrderServiceImpl新增listByUserWithoutDelete的实现</p>
<ol>
<li>创建DetachedCriteria 对象</li>
<li>条件加上user</li>
<li>条件加上 status不等于delete</li>
<li>返回查询结果</li>
</ol>
<p><strong>注：</strong> 这里为什么不用[BaseService.list(Object …pairParms)的多条件查询]? 因为这里要用到非条件，所以要额外开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.service.impl;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderItemService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span>  <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> OrderItemService orderItemService;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Transactional</span>(propagation=Propagation.REQUIRED,rollbackForClassName=<span class="string">"Exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">createOrder</span><span class="params">(Order order, List&lt;OrderItem&gt; ois)</span> </span>&#123;</span><br><span class="line">        save(order);</span><br><span class="line">        <span class="keyword">float</span> total =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi: ois) &#123;</span><br><span class="line">            oi.setOrder(order);</span><br><span class="line">            orderItemService.update(oi);</span><br><span class="line">            total+=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">listByUserWithoutDelete</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        DetachedCriteria dc = DetachedCriteria.forClass(clazz);</span><br><span class="line">        dc.add(Restrictions.eq(<span class="string">"user"</span>, user));</span><br><span class="line">        dc.add(Restrictions.ne(<span class="string">"status"</span>, OrderService.delete));</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(dc);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-ForeAction-bought"><a class="header-anchor" href="#步骤-6-ForeAction-bought">¶</a>步骤 6 : ForeAction.bought()</h3>
<p>/forebought导致ForeAction.bought()方法被调用</p>
<ol>
<li>通过session获取用户user</li>
<li>查询user所有的状态不是&quot;delete&quot; 的订单集合os</li>
<li>为这些订单填充订单项</li>
<li>服务端跳转到bought.jsp</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">    orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">    orderItemService.fill(orders);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-bought-jsp"><a class="header-anchor" href="#步骤-7-bought-jsp">¶</a>步骤 7 : bought.jsp</h3>
<p>与 [register.jsp]相仿，bought.jsp 也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。<br>
中间是我的订单页面 [boughtPage.jsp]</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/boughtPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-8-boughtPage-jsp"><a class="header-anchor" href="#步骤-8-boughtPage-jsp">¶</a>步骤 8 : boughtPage.jsp</h3>
<p>在boughtPage.jsp中，从95行开始到176行，做二次遍历</p>
<ol>
<li>遍历订单集合orders<br>
取出每个订单，显示其创建日期，订单号，总数量和总金额等</li>
<li>遍历每个订单下的订单项集合o.orderItems<br>
显示每个订单项对应的产品的图片，标题，原始价格，优惠价格等</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5094.png" alt></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> deleteOrder = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">var</span> deleteOrderid = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">$(function()&#123;</span><br><span class="line">    $(<span class="string">"a[orderStatus]"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> orderStatus = $(<span class="keyword">this</span>).attr(<span class="string">"orderStatus"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'all'</span>==orderStatus)&#123;</span><br><span class="line">            $(<span class="string">"table[orderStatus]"</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">"table[orderStatus]"</span>).hide();</span><br><span class="line">            $(<span class="string">"table[orderStatus="</span>+orderStatus+<span class="string">"]"</span>).show();        </span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        $(<span class="string">"div.orderType div"</span>).removeClass(<span class="string">"selectedOrderType"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).parent(<span class="string">"div"</span>).addClass(<span class="string">"selectedOrderType"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"a.deleteOrderLink"</span>).click(function()&#123;</span><br><span class="line">        deleteOrderid = $(<span class="keyword">this</span>).attr(<span class="string">"oid"</span>);</span><br><span class="line">        deleteOrder = <span class="keyword">false</span>;</span><br><span class="line">        $(<span class="string">"#deleteConfirmModal"</span>).modal(<span class="string">"show"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">"button.deleteConfirmButton"</span>).click(function()&#123;</span><br><span class="line">        deleteOrder = <span class="keyword">true</span>;</span><br><span class="line">        $(<span class="string">"#deleteConfirmModal"</span>).modal(<span class="string">'hide'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">     </span><br><span class="line">    $(<span class="string">'#deleteConfirmModal'</span>).on(<span class="string">'hidden.bs.modal'</span>, function (e) &#123;</span><br><span class="line">        <span class="keyword">if</span>(deleteOrder)&#123;</span><br><span class="line">            <span class="keyword">var</span> page=<span class="string">"foredeleteOrder"</span>;</span><br><span class="line">            $.post(</span><br><span class="line">                    page,</span><br><span class="line">                    &#123;<span class="string">"order.id"</span>:deleteOrderid&#125;,</span><br><span class="line">                    function(result)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                            $(<span class="string">"table.orderListItemTable[oid="</span>+deleteOrderid+<span class="string">"]"</span>).hide();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span>&#123;</span><br><span class="line">                            location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)     </span><br><span class="line">     </span><br><span class="line">    $(<span class="string">".ask2delivery"</span>).click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> link = $(<span class="keyword">this</span>).attr(<span class="string">"link"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).hide();</span><br><span class="line">        page = link;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">               url: page,</span><br><span class="line">               success: function(result)&#123;</span><br><span class="line">                alert(<span class="string">"卖家已秒发，刷新当前页面，即可进行确认收货"</span>)</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">         </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"boughtDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderType"</span>&gt;</span><br><span class="line">        &lt;div class="selectedOrderType"&gt;&lt;a orderStatus="all" href="#nowhere"&gt;所有订单&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;a  orderStatus="waitPay" href="#nowhere"&gt;待付款&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;a  orderStatus="waitDelivery" href="#nowhere"&gt;待发货&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;a  orderStatus="waitConfirm" href="#nowhere"&gt;待收货&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;a  orderStatus="waitReview" href="#nowhere" class="noRightborder"&gt;待评价&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class="orderTypeLastOne"&gt;&lt;a class="noRightborder"&gt; &lt;/a&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListTitle"</span>&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListTitleTable"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;宝贝&lt;/td&gt;</span><br><span class="line">                &lt;td width="100px"&gt;单价&lt;/td&gt;</span><br><span class="line">                &lt;td width="100px"&gt;数量&lt;/td&gt;</span><br><span class="line">                &lt;td width="120px"&gt;实付款&lt;/td&gt;</span><br><span class="line">                &lt;td width="100px"&gt;交易操作&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItem"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;orders&#125;"</span> <span class="keyword">var</span>=<span class="string">"o"</span>&gt;</span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemTable"</span> orderStatus=<span class="string">"$&#123;o.status&#125;"</span> oid=<span class="string">"$&#123;o.id&#125;"</span>&gt;</span><br><span class="line">                &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemFirstTR"</span>&gt;</span><br><span class="line">                    &lt;td colspan=<span class="string">"2"</span>&gt;</span><br><span class="line">                    &lt;b&gt;&lt;fmt:formatDate value="$&#123;o.createDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/b&gt;</span><br><span class="line">                    &lt;span&gt;订单号: $&#123;o.orderCode&#125;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td  colspan="2"&gt;&lt;img width="13px" src="img/site/orderItemTmall.png"&gt;天猫商场&lt;/td&gt;</span><br><span class="line">                    &lt;td colspan=<span class="string">"1"</span>&gt;</span><br><span class="line">                        &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"wangwanglink"</span> href=<span class="string">"#nowhere"</span>&gt;</span><br><span class="line">                            &lt;div class="orderItemWangWangGif"&gt;&lt;/div&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemDeleteTD"</span>&gt;</span><br><span class="line">                        &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"deleteOrderLink"</span> oid=<span class="string">"$&#123;o.id&#125;"</span> href=<span class="string">"#nowhere"</span>&gt;</span><br><span class="line">                            &lt;span  class="orderListItemDelete glyphicon glyphicon-trash"&gt;&lt;/span&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                         </span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">"$&#123;o.orderItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span> varStatus=<span class="string">"st"</span>&gt;</span><br><span class="line">                    &lt;tr <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemProductInfoPartTR"</span> &gt;</span><br><span class="line">                        &lt;td class="orderItemProductInfoPartTD"&gt;&lt;img width="80" height="80" src="img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemProductInfoPartTD"</span>&gt;</span><br><span class="line">                            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemProductLinkOutDiv"</span>&gt;</span><br><span class="line">                                &lt;a href="foreproduct?product.id=$&#123;oi.product.id&#125;"&gt;$&#123;oi.product.name&#125;&lt;/a&gt;</span><br><span class="line">                                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemProductLinkInnerDiv"</span>&gt;</span><br><span class="line">                                            &lt;img src=<span class="string">"img/site/creditcard.png"</span> title=<span class="string">"支持信用卡支付"</span>&gt;</span><br><span class="line">                                            &lt;img src=<span class="string">"img/site/7day.png"</span> title=<span class="string">"消费者保障服务,承诺7天退货"</span>&gt;</span><br><span class="line">                                            &lt;img src=<span class="string">"img/site/promise.png"</span> title=<span class="string">"消费者保障服务,承诺如实描述"</span>&gt;                      </span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;td  <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderItemProductInfoPartTD"</span> width=<span class="string">"100px"</span>&gt;</span><br><span class="line">                         </span><br><span class="line">                            &lt;div class="orderListItemProductOriginalPrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;oi.product.originalPrice&#125;" minFractionDigits="2"/&gt;&lt;/div&gt;</span><br><span class="line">                            &lt;div class="orderListItemProductPrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;oi.product.promotePrice&#125;" minFractionDigits="2"/&gt;&lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                        &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;st.count==1&#125;"</span>&gt;</span><br><span class="line">                          </span><br><span class="line">                            &lt;td valign=<span class="string">"top"</span> rowspan=<span class="string">"$&#123;fn:length(o.orderItems)&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemNumberTD orderItemOrderInfoPartTD"</span> width=<span class="string">"100px"</span>&gt;</span><br><span class="line">                                &lt;span class="orderListItemNumber"&gt;$&#123;o.totalNumber&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td valign=<span class="string">"top"</span> rowspan=<span class="string">"$&#123;fn:length(o.orderItems)&#125;"</span> width=<span class="string">"120px"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemProductRealPriceTD orderItemOrderInfoPartTD"</span>&gt;</span><br><span class="line">                                &lt;div class="orderListItemProductRealPrice"&gt;￥&lt;fmt:formatNumber  minFractionDigits="2"  maxFractionDigits="2" type="number" value="$&#123;o.total&#125;"/&gt;&lt;/div&gt;</span><br><span class="line">                                &lt;div class="orderListItemPriceWithTransport"&gt;(含运费：￥0.00)&lt;/div&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td valign=<span class="string">"top"</span> rowspan=<span class="string">"$&#123;fn:length(o.orderItems)&#125;"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderListItemButtonTD orderItemOrderInfoPartTD"</span> width=<span class="string">"100px"</span>&gt;</span><br><span class="line">                                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitConfirm' &#125;"</span>&gt;</span><br><span class="line">                                    &lt;a href=<span class="string">"foreconfirmPay?order.id=$&#123;o.id&#125;"</span>&gt;</span><br><span class="line">                                        &lt;button class="orderListItemConfirm"&gt;确认收货&lt;/button&gt;</span><br><span class="line">                                    &lt;/a&gt;</span><br><span class="line">                                &lt;/c:if&gt;</span><br><span class="line">                                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitPay' &#125;"</span>&gt;</span><br><span class="line">                                    &lt;a href=<span class="string">"forealipay?order.id=$&#123;o.id&#125;&amp;total=$&#123;o.total&#125;"</span>&gt;</span><br><span class="line">                                        &lt;button class="orderListItemConfirm"&gt;付款&lt;/button&gt;</span><br><span class="line">                                    &lt;/a&gt;                             </span><br><span class="line">                                &lt;/c:if&gt;</span><br><span class="line">                                 </span><br><span class="line">                                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitDelivery' &#125;"</span>&gt;</span><br><span class="line">                                    &lt;span&gt;待发货&lt;/span&gt;</span><br><span class="line">                                     </span><br><span class="line">&lt;%--                                     &lt;button class="btn btn-info btn-sm ask2delivery" link="admin_order_delivery?order.id=$&#123;o.id&#125;"&gt;催卖家发货&lt;/button&gt; --%&gt;</span><br><span class="line">                                     </span><br><span class="line">                                &lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">                                &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;o.status=='waitReview' &#125;"</span>&gt;</span><br><span class="line">                                    &lt;a href=<span class="string">"forereview?order.id=$&#123;o.id&#125;"</span>&gt;</span><br><span class="line">                                        &lt;button  class="orderListItemReview"&gt;评价&lt;/button&gt;</span><br><span class="line">                                    &lt;/a&gt;</span><br><span class="line">                                &lt;/c:if&gt;</span><br><span class="line">                            &lt;/td&gt;                    </span><br><span class="line">                        &lt;/c:if&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;     </span><br><span class="line">                 </span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="13、我的订单页操作"><a class="header-anchor" href="#13、我的订单页操作">¶</a>13、我的订单页操作</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v29"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v29">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v27"><a class="header-anchor" href="#步骤-2-模仿和排错-v27">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-我的订单页面操作"><a class="header-anchor" href="#步骤-3-我的订单页面操作">¶</a>步骤 3 : 我的订单页面操作</h3>
<p>在我的订单页面，根据订单的不同状态，可以做出如下不同的操作：</p>
<ol>
<li>
<p>付款 —— 已经生成，但是未付款</p>
</li>
<li>
<p>确认收货 —— 通过 [后台发货]后</p>
</li>
<li>
<p>评价 —— 确认收货后, 讲在[评价产品]知识点讲解，这里只是提到</p>
</li>
<li>
<p>删除 —— 任意状态下</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5110.png" alt></p>
<h3 id="步骤-4-付款"><a class="header-anchor" href="#步骤-4-付款">¶</a>步骤 4 : 付款</h3>
<p>点击付款按钮直接跳转到在[生成订单]中的[确认支付页]环节，属于已经开发的功能，在此不作赘述。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5112.png" alt></p>
<h3 id="步骤-5-确认收货"><a class="header-anchor" href="#步骤-5-确认收货">¶</a>步骤 5 : 确认收货</h3>
<ol>
<li>
<p>点击确认收货后，访问地址/foreconfirmPay</p>
</li>
<li>
<p>ForeAction.confirmPay()方法被调用<br>
2.1 order指向持久化对象<br>
2.2 为订单对象填充订单项<br>
2.3 服务端跳转到 confirmPay.jsp</p>
</li>
<li>
<p>confirmPay.jsp<br>
与 [register.jsp] 相仿，confirmPay.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。<br>
中间是订单确认业务页面 confirmPayPage.jsp</p>
</li>
<li>
<p>confirmPayPage.jsp<br>
显示订单的创建时间，付款时间和发货时间，以及订单号，收款人信息等<br>
遍历订单项集合，显示其中的产品图片，产品标题，价格，数量，小计，总结信息<br>
最后提供<strong>确认支付</strong>按钮，提交到/foreorderconfirmed路径</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5113.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    orderItemService.fill(order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/confirmPayPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayPageDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayImageDiv"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/site/comformPayFlow.png"</span>&gt;</span><br><span class="line">        &lt;div  <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayTime1"</span>&gt;</span><br><span class="line">            &lt;fmt:formatDate value=<span class="string">"$&#123;order.createDate&#125;"</span> pattern=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div  <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayTime2"</span>&gt;</span><br><span class="line">            &lt;fmt:formatDate value=<span class="string">"$&#123;order.payDate&#125;"</span> pattern=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayTime3"</span>&gt;</span><br><span class="line">            yyyy-MM-dd HH:mm:ss</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderInfoDiv"</span>&gt;</span><br><span class="line">        &lt;div class="confirmPayOrderInfoText"&gt;我已收到货，同意支付宝付款&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderItemDiv"</span>&gt;</span><br><span class="line">        &lt;div class="confirmPayOrderItemText"&gt;订单信息&lt;/div&gt;</span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderItemTable"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;th colspan="2"&gt;宝贝&lt;/th&gt;    </span><br><span class="line">                &lt;th width="120px"&gt;单价&lt;/th&gt;      </span><br><span class="line">                &lt;th width="120px"&gt;数量&lt;/th&gt;      </span><br><span class="line">                &lt;th width="120px"&gt;商品总价 &lt;/th&gt;       </span><br><span class="line">                &lt;th width="120px"&gt;运费&lt;/th&gt;      </span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">"$&#123;order.orderItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"oi"</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;&lt;img width="50px" src="img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg"&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderItemProductLink"</span>&gt;</span><br><span class="line">                        &lt;a href="#nowhere"&gt;$&#123;oi.product.name&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;oi.product.originalPrice&#125;" minFractionDigits="2"/&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;1&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;span class="conformPayProductPrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;oi.product.promotePrice&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;span&gt;快递 ： 0.00 &lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderItemText pull-right"</span>&gt;</span><br><span class="line">            实付款： &lt;span class="confirmPayOrderItemSumPrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;order.total&#125;" minFractionDigits="2"/&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderDetailDiv"</span>&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayOrderDetailTable"</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;订单编号：&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;order.orderCode&#125; &lt;img width="23px" src="img/site/confirmOrderTmall.png"&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;卖家昵称：&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;天猫商铺 &lt;span class="confirmPayOrderDetailWangWangGif"&gt;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;收货信息： &lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;order.address&#125;，$&#123;order.receiver&#125;， $&#123;order.mobile&#125;，$&#123;order.post&#125; &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;成交时间：&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;fmt:formatDate value="$&#123;order.createDate&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">         </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"confirmPayButtonDiv"</span>&gt;</span><br><span class="line">        &lt;div class="confirmPayWarning"&gt;请收到货后，再确认收货！否则您可能钱货两空！&lt;/div&gt;</span><br><span class="line">        &lt;a href="foreorderConfirmed?order.id=$&#123;order.id&#125;"&gt;&lt;button class="confirmPayButton"&gt;确认支付&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-6-确认收货成功"><a class="header-anchor" href="#步骤-6-确认收货成功">¶</a>步骤 6 : 确认收货成功</h3>
<p>通过上一步最后的<strong>确认支付</strong>按钮，提交到路径/foreorderConfirmed，导致ForeAction.orderConfirmed()方法被调用</p>
<ol>
<li>
<p>ForeAction.orderConfirmed() 方法<br>
1.1 order指向持久化对象<br>
1.2 修改对象o的状态为等待评价，修改其确认支付时间<br>
1.3 更新到数据库<br>
1.4 服务端跳转到orderConfirmed.jsp页面</p>
</li>
<li>
<p>orderConfirmed.jsp<br>
与 [register.jsp] 相仿，orderConfirmed.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]， [footer.jsp] 等公共页面。<br>
中间是确认收货成功业务页面 orderConfirmedPage.jsp</p>
</li>
<li>
<p>orderConfirmedPage.jsp<br>
显示&quot;交易已经成功，卖家将收到您的货款。&quot;</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foreorderConfirmed"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">orderConfirmed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    order.setStatus(OrderService.waitReview);</span><br><span class="line">    order.setConfirmDate(<span class="keyword">new</span> Date());</span><br><span class="line">    orderService.update(order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"orderConfirmed.jsp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/orderConfirmedPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderFinishDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"orderFinishTextDiv"</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">"img/site/orderFinish.png"</span>&gt;</span><br><span class="line">        &lt;span&gt;交易已经成功，卖家将收到您的货款。&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreorderConfirmed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderConfirmed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitReview);</span><br><span class="line">        order.setConfirmDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"orderConfirmed.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-7-评价"><a class="header-anchor" href="#步骤-7-评价">¶</a>步骤 7 : 评价</h3>
<p>点击评价按钮，跳转到路径/forereview,这部分单独开了个知识点[评价产品]进行讲解。</p>
<h3 id="步骤-8-删除"><a class="header-anchor" href="#步骤-8-删除">¶</a>步骤 8 : 删除</h3>
<p>在[我的订单页] 上点击删除按钮，根据 [boughtPage.jsp] 中的ajax操作，会访问路径/foredeleteOrder，导致ForeAction.deleteOrder方法被调用</p>
<ol>
<li>
<p>ForeAction.deleteOrder()<br>
1.1 order引用指向持久化对象<br>
1.2 修改状态<br>
1.3 更新到数据库<br>
1.4 返回字符串&quot;success&quot;</p>
</li>
<li>
<p>[boughtPage.jsp] 中的javascript代码获取返回字符串是success的时候，隐藏掉当前这行订单数据。</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5116.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page=<span class="string">"foredeleteOrder"</span>;</span><br><span class="line">$.post(</span><br><span class="line">        page,</span><br><span class="line">        &#123;<span class="string">"order.id"</span>:deleteOrderid&#125;,</span><br><span class="line">        function(result)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"success"</span>==result)&#123;</span><br><span class="line">                $(<span class="string">"table.orderListItemTable[oid="</span>+deleteOrderid+<span class="string">"]"</span>).hide();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                location.href=<span class="string">"login.jsp"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foredeleteOrder"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    order.setStatus(OrderService.delete);</span><br><span class="line">    orderService.update(order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.delete);</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreorderConfirmed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderConfirmed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitReview);</span><br><span class="line">        order.setConfirmDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"orderConfirmed.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14、评价产品"><a class="header-anchor" href="#14、评价产品">¶</a>14、评价产品</h2>
<h3 id="步骤-1-先运行，看到效果，再学习-v30"><a class="header-anchor" href="#步骤-1-先运行，看到效果，再学习-v30">¶</a>步骤 1 : 先运行，看到效果，再学习</h3>
<p>老规矩，先下载右上角的可运行项目，配置运行起来，确认可用之后，再学习做了哪些步骤以达到这样的效果。<br>
下载右侧的tmall_ssh.rar，解压到e:\project\tmall_ssh，刷新项目后，重启tomcat 。</p>
<p>**注：**这个tmall_ssh.rar压缩包是不包含产品图片的(否则会有200m大小) 。<br>
如果当前项目里没有1777张产品图片，请到[图片资源]下载 。<br>
这1777张产品图片对应的sql语句，请到[首页数据所需SQL语句]下载 。</p>
<h3 id="步骤-2-模仿和排错-v28"><a class="header-anchor" href="#步骤-2-模仿和排错-v28">¶</a>步骤 2 : 模仿和排错</h3>
<p>在确保可运行项目能够正确无误地运行之后，再严格照着教程的步骤，对代码模仿一遍。<br>
模仿过程难免代码有出入，导致无法得到期望的运行结果，此时此刻通过比较<strong>正确答案</strong> ( 可运行项目 ) 和自己的代码，来定位问题所在。<br>
采用这种方式，<strong>学习有效果，排错有效率</strong>，可以较为明显地提升学习速度，跨过学习路上的各个槛。</p>
<p>推荐使用diffmerge软件，进行文件夹比较。把你自己做的项目文件夹，和我的可运行项目文件夹进行比较。<br>
这个软件很牛逼的，可以知道文件夹里哪两个文件不对，并且很明显地标记出来<br>
这里提供了绿色安装和使用教程：[diffmerge 下载和使用教程]</p>
<h3 id="步骤-3-界面效果-v6"><a class="header-anchor" href="#步骤-3-界面效果-v6">¶</a>步骤 3 : 界面效果</h3>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5117.png" alt></p>
<h3 id="步骤-4-评价产品页面"><a class="header-anchor" href="#步骤-4-评价产品页面">¶</a>步骤 4 : 评价产品页面</h3>
<p>通过点击评价按钮，来到路径/forereview，导致ForeAction.review()方法被调用</p>
<ol>
<li>
<p>ForeAction.review()<br>
1.1 让order引用指向持久化对象<br>
1.2 为订单对象填充订单项<br>
1.3 获取第一个订单项对应的产品,因为在评价页面需要显示一个产品图片，那么就使用这第一个产品的图片了<br>
1.4 获取这个产品的评价集合<br>
1.5 为产品设置评价数量和销量<br>
1.6 服务端跳转到 review.jsp</p>
</li>
<li>
<p>review.jsp<br>
与 [register.jsp] 相仿，review.jsp也包含了[header.jsp], [top.jsp], [simpleSearch.jsp]，<br>
[footer.jsp]等公共页面。<br>
中间是产品业务页面 reviewPage.jsp</p>
</li>
<li>
<p>reviewPage.jsp<br>
在reviewPage.jsp中显示产品图片，产品标题，价格，产品销量，产品评价数量，以及订单信息等。<br>
同时还显示出了该产品所有的评价，但是默认是隐藏的</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5119.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"forereview"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">review</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    orderItemService.fill(order);</span><br><span class="line">    product = order.getOrderItems().get(<span class="number">0</span>).getProduct();</span><br><span class="line">    reviews = reviewService.listByParent(product);</span><br><span class="line">    productService.setSaleAndReviewNumber(product);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"review.jsp"</span>;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/header.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/top.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/simpleSearch.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/cart/reviewPage.jsp"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"include/footer.jsp"</span>%&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> isELIgnored=<span class="string">"false"</span>%&gt;</span><br><span class="line">     </span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewDiv"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoDiv"</span>&gt;</span><br><span class="line">        &lt;div class="reviewProductInfoImg"&gt;&lt;img width="400px" height="400px" src="img/productSingle/$&#123;product.firstProductImage.id&#125;.jpg"&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoRightDiv"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoRightText"</span>&gt;</span><br><span class="line">                $&#123;product.name&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoTable"</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td width="75px"&gt;价格:&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;span class="reviewProductInfoTablePrice"&gt;￥&lt;fmt:formatNumber type="number" value="$&#123;product.originalPrice&#125;" minFractionDigits="2"/&gt;&lt;/span&gt; 元 &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;配送&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;快递:  0.00&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;月销量:&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;span class="reviewProductInfoTableSellNumber"&gt;$&#123;product.saleCount&#125;&lt;/span&gt; 件&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoRightBelowDiv"</span>&gt;</span><br><span class="line">                &lt;span class="reviewProductInfoRightBelowImg"&gt;&lt;img1 src="img/site/reviewLight.png"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewProductInfoRightBelowText"</span> &gt;现在查看的是 您所购买商品的信息</span><br><span class="line">于&lt;fmt:formatDate value="$&#123;order.createDate&#125;" pattern="yyyy年MM月dd"/&gt;下单购买了此商品 &lt;/span&gt;</span><br><span class="line">             </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style="clear:both"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewStasticsDiv"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewStasticsLeft"</span>&gt;</span><br><span class="line">                &lt;div class="reviewStasticsLeftTop"&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class="reviewStasticsLeftContent"&gt;累计评价 &lt;span class="reviewStasticsNumber"&gt; $&#123;product.reviewCount&#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class="reviewStasticsLeftFoot"&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewStasticsRight"</span>&gt;</span><br><span class="line">            &lt;div class="reviewStasticsRightEmpty"&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class="reviewStasticsFoot"&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;       </span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;param.showonly==true&#125;"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewDivlistReviews"</span>&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">"$&#123;reviews&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewDivlistReviewsEach"</span>&gt;</span><br><span class="line">                &lt;div class="reviewDate"&gt;&lt;fmt:formatDate value="$&#123;r.createDate&#125;" pattern="yyyy-MM-dd"/&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class="reviewContent"&gt;$&#123;r.content&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div class="reviewUserInfo pull-right"&gt;$&#123;r.user.anonymousName&#125;&lt;span class="reviewUserInfoAnonymous"&gt;(匿名)&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;param.showonly!=true&#125;"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"makeReviewDiv"</span>&gt;</span><br><span class="line">        &lt;form method=<span class="string">"post"</span> action=<span class="string">"foredoreview"</span>&gt;</span><br><span class="line">            &lt;div class="makeReviewText"&gt;其他买家，需要你的建议哦！&lt;/div&gt;</span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"makeReviewTable"</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td class="makeReviewTableFirstTD"&gt;评价商品&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;&lt;textarea name="review.content"&gt;&lt;/textarea&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"makeReviewButtonDiv"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"order.id"</span> value=<span class="string">"$&#123;order.id&#125;"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"product.id"</span> value=<span class="string">"$&#123;product.id&#125;"</span>&gt;</span><br><span class="line">                &lt;button type="submit"&gt;提交评价&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;   </span><br><span class="line">    &lt;/c:if&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forereview"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">review</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        product = order.getOrderItems().get(<span class="number">0</span>).getProduct();</span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"review.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.delete);</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreorderConfirmed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderConfirmed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitReview);</span><br><span class="line">        order.setConfirmDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"orderConfirmed.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="步骤-5-提交评价"><a class="header-anchor" href="#步骤-5-提交评价">¶</a>步骤 5 : 提交评价</h3>
<p>在[评价产品页面]点击提交评价，就把数据提交到了/foredoreview路径，导致ForeAction.doreview方法被调用</p>
<ol>
<li>
<p>ForeAction.doreview()<br>
1.1 让order引用指向持久化对象<br>
1.2 让product引用指向持久化对象<br>
1.3 修改订单对象状态<br>
1.4 更新订单对象到数据库<br>
1.5 获取参数content (评价信息)<br>
1.6 对评价信息进行转义，道理同[ForeAction.register()]<br>
1.7 从session中获取当前用户<br>
1.8 创建评价对象review<br>
1.9 为评价对象review设置 评价信息，产品，时间，用户<br>
1.10 增加到数据库<br>
1.11.客户端跳转到/forereview： [评价产品页面]，并带上参数showonly=true</p>
</li>
<li>
<p>reviewPage.jsp<br>
在reviewPage.jsp中，当参数showonly==true，那么就显示当前产品的所有评价信息</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5120.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action</span>(<span class="string">"foredoreview"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doreview</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    t2p(order);</span><br><span class="line">    t2p(product);</span><br><span class="line">     </span><br><span class="line">    order.setStatus(OrderService.finish);</span><br><span class="line">     </span><br><span class="line">    String content = review.getContent();</span><br><span class="line">    content = HtmlUtils.htmlEscape(content);    </span><br><span class="line">    User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);     </span><br><span class="line">    review.setContent(content);</span><br><span class="line">    review.setProduct(product);</span><br><span class="line">    review.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">    review.setUser(user);</span><br><span class="line">     </span><br><span class="line">    reviewService.saveReviewAndUpdateOrderStatus(review,order);</span><br><span class="line">      </span><br><span class="line">    showonly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"reviewPage"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;param.showonly==true&#125;"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewDivlistReviews"</span>&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">"$&#123;reviews&#125;"</span> <span class="keyword">var</span>=<span class="string">"r"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reviewDivlistReviewsEach"</span>&gt;</span><br><span class="line">            &lt;div class="reviewDate"&gt;&lt;fmt:formatDate value="$&#123;r.createDate&#125;" pattern="yyyy-MM-dd"/&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class="reviewContent"&gt;$&#123;r.content&#125;&lt;/div&gt;</span><br><span class="line">            &lt;div class="reviewUserInfo pull-right"&gt;$&#123;r.user.anonymousName&#125;&lt;span class="reviewUserInfoAnonymous"&gt;(匿名)&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.how2java.tmall.action;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.xwork.math.RandomUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductAllComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductDateComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductPriceComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductReviewComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.comparator.ProductSaleCountComparator;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.how2java.tmall.service.ProductImageService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeAction</span> <span class="keyword">extends</span> <span class="title">Action4Result</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredoreview"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doreview</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        t2p(product);</span><br><span class="line">         </span><br><span class="line">        order.setStatus(OrderService.finish);</span><br><span class="line">         </span><br><span class="line">        String content = review.getContent();</span><br><span class="line">        content = HtmlUtils.htmlEscape(content);</span><br><span class="line">        review.setContent(content);</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">         </span><br><span class="line">        review.setContent(content);</span><br><span class="line">        review.setProduct(product);</span><br><span class="line">        review.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        review.setUser(user);</span><br><span class="line">         </span><br><span class="line">        reviewService.saveReviewAndUpdateOrderStatus(review,order);</span><br><span class="line">          </span><br><span class="line">        showonly = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"reviewPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forereview"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">review</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        product = order.getOrderItems().get(<span class="number">0</span>).getProduct();</span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"review.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.delete);</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreorderConfirmed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderConfirmed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitReview);</span><br><span class="line">        order.setConfirmDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"orderConfirmed.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreconfirmPay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">confirmPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        orderItemService.fill(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"confirmPay.jsp"</span>;       </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebought"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bought</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orders= orderService.listByUserWithoutDelete(user);</span><br><span class="line">        orderItemService.fill(orders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"bought.jsp"</span>;       </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forepayed"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">payed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(order);</span><br><span class="line">        order.setStatus(OrderService.waitDelivery);</span><br><span class="line">        order.setPayDate(<span class="keyword">new</span> Date());</span><br><span class="line">        orderService.update(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"payed.jsp"</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forealipay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">forealipay</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipay.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecreateOrder"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) ActionContext.getContext().getSession().get(<span class="string">"orderItems"</span>);</span><br><span class="line">        <span class="keyword">if</span>(ois.isEmpty())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">      </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        String orderCode = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssSSS"</span>).format(<span class="keyword">new</span> Date()) +RandomUtils.nextInt(<span class="number">10000</span>);</span><br><span class="line">         </span><br><span class="line">        order.setOrderCode(orderCode);</span><br><span class="line">        order.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setStatus(OrderService.waitPay);</span><br><span class="line">         </span><br><span class="line">        total = orderService.createOrder(order, ois);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"alipayPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foredeleteOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteOrderItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">        orderItemService.delete(orderItem);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forechangeOrderItem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changeOrderItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">              </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        orderItems = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem orderItem : orderItems)</span><br><span class="line">            productImageService.setFirstProdutImage(orderItem.getProduct());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cart.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreaddCart"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> oiid : oiids) &#123;</span><br><span class="line">            OrderItem oi= (OrderItem) orderItemService.get(oiid);</span><br><span class="line">            total +=oi.getProduct().getPromotePrice()*oi.getNumber();</span><br><span class="line">            orderItems.add(oi);</span><br><span class="line">            productImageService.setFirstProdutImage(oi.getProduct());</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"orderItems"</span>, orderItems);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buy.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forebuyone"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        List&lt;OrderItem&gt; ois = orderItemService.list(<span class="string">"user"</span>,user,<span class="string">"order"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem oi : ois) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oi.getProduct().getId()==product.getId())&#123;</span><br><span class="line">                oi.setNumber(oi.getNumber()+num);</span><br><span class="line">                orderItemService.update(oi);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                oiid = oi.getId();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;      </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            OrderItem oi = <span class="keyword">new</span> OrderItem();</span><br><span class="line">            oi.setUser(user);</span><br><span class="line">            oi.setNumber(num);</span><br><span class="line">            oi.setProduct(product);</span><br><span class="line">            orderItemService.save(oi);</span><br><span class="line">            oiid = oi.getId();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"buyPage"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foresearch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">search</span><span class="params">()</span></span>&#123;</span><br><span class="line">        products= productService.search(keyword,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        productService.setSaleAndReviewNumber(products);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products)</span><br><span class="line">            productImageService.setFirstProdutImage(product);  </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"searchResult.jsp"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecategory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">category</span><span class="params">()</span></span>&#123;</span><br><span class="line">        t2p(category);</span><br><span class="line">        productService.fill(category);</span><br><span class="line">        productService.setSaleAndReviewNumber(category.getProducts());      </span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=sort)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(sort)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"review"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductReviewComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"date"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductDateComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"saleCount"</span> :</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductSaleCountComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductPriceComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">"all"</span>:</span><br><span class="line">                Collections.sort(category.getProducts(),<span class="keyword">new</span> ProductAllComparator());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"category.jsp"</span>;         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreloginAjax"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginAjax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">           </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">         </span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forecheckLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u =(User) ActionContext.getContext().getSession().get(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==u)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail.jsp"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreproduct"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        t2p(product);</span><br><span class="line">          </span><br><span class="line">        productImageService.setFirstProdutImage(product);</span><br><span class="line">        productSingleImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_single);</span><br><span class="line">        productDetailImages = productImageService.list(<span class="string">"product"</span>,product,<span class="string">"type"</span>, ProductImageService.type_detail);</span><br><span class="line">        product.setProductSingleImages(productSingleImages);</span><br><span class="line">        product.setProductDetailImages(productDetailImages);</span><br><span class="line">          </span><br><span class="line">        propertyValues = propertyValueService.listByParent(product);      </span><br><span class="line">      </span><br><span class="line">        reviews = reviewService.listByParent(product);</span><br><span class="line">         </span><br><span class="line">        productService.setSaleAndReviewNumber(product);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"product.jsp"</span>;          </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActionContext.getContext().getSession().remove(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forelogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        User user_session = userService.get(user.getName(),user.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==user_session)&#123;</span><br><span class="line">            msg= <span class="string">"账号密码错误"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login.jsp"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ActionContext.getContext().getSession().put(<span class="string">"user"</span>, user_session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"homePage"</span>;     </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"foreregister"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        user.setName(HtmlUtils.htmlEscape(user.getName()));</span><br><span class="line">        <span class="keyword">boolean</span> exist = userService.isExist(user.getName());</span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">             msg = <span class="string">"用户名已经被使用,不能使用"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="string">"register.jsp"</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         userService.save(user);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"registerSuccessPage"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">"forehome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        categorys = categoryService.list();</span><br><span class="line">        productService.fill(categorys);</span><br><span class="line">        productService.fillByRow(categorys);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十四、总结"><a class="header-anchor" href="#十四、总结">¶</a>十四、总结</h1>
<h2 id="一、项目总结"><a class="header-anchor" href="#一、项目总结">¶</a>一、项目总结</h2>
<p>到这里，项目功能开发就做得差不多了，接下来我们将进行对项目的总结，为的是更好的消化和吸收项目期间运用到的知识和技能，转换为自己的能力。</p>
<h3 id="步骤-1-项目结构"><a class="header-anchor" href="#步骤-1-项目结构">¶</a>步骤 1 : 项目结构</h3>
<ol>
<li>
<p>项目名称 tmall_ssh</p>
</li>
<li>
<p>java源代码包结构<br>
tmall_ssh.saction action<br>
tmall_ssh.comparator 比较器<br>
tmall_ssh.dao.impl DAO实现类<br>
tmall_ssh.interceptor 拦截器<br>
tmall_ssh.pojo 实体类<br>
tmall_ssh.service 服务接口<br>
tmall_ssh.service.impl 服务实现类<br>
tmall_ssh.test 测试类<br>
tmall_ssh.util 工具类</p>
</li>
<li>
<p>webContent目录<br>
admin 后台管理用到的jsp文件<br>
css css文件<br>
img 图片资源<br>
js js文件<br>
include 被包含的jsp文件</p>
</li>
</ol>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/4947.png" alt></p>
<h3 id="步骤-2-典型场景"><a class="header-anchor" href="#步骤-2-典型场景">¶</a>步骤 2 : 典型场景</h3>
<p>经过这个项目，我们都完成了如下的一系列典型场景功能</p>
<ol>
<li>
<p>购物车<br>
[立即购买] [加入购物车] [查看购物车页面] [购物车页面操作]</p>
</li>
<li>
<p>订单状态流转<br>
[生成订单] [确认支付] [后台发货] [确认收货] [评价]</p>
</li>
<li>
<p>CRUD<br>
[后台各种功能]</p>
</li>
<li>
<p>分页<br>
[后台各种功能]</p>
</li>
<li>
<p>一类产品多属性配置<br>
[属性管理]</p>
</li>
<li>
<p>一款产品多图片维护<br>
[产品图片管理]</p>
</li>
<li>
<p>产品展示<br>
[前台首页] [前台产品页]</p>
</li>
<li>
<p>搜索查询<br>
[搜索]</p>
</li>
<li>
<p>登录、注册<br>
[注册] [登录] [退出]</p>
</li>
<li>
<p>登录验证<br>
[拦截器-登录状态]</p>
</li>
<li>
<p>事务管理<br>
[对createOrder进行事务管理]</p>
</li>
</ol>
<p>等等 。。。</p>
<h3 id="步骤-3-设计模式"><a class="header-anchor" href="#步骤-3-设计模式">¶</a>步骤 3 : 设计模式</h3>
<ol>
<li>
<p>MVC<br>
[MVC设计模式]贯穿于整个后台与前台功能开发始末</p>
</li>
<li>
<p>重构<br>
通过发现问题，分析问题，解决问题的三部曲，进行了各种角度的重构。经历这样一个重构过程将对软件思想有较大的提升。<br>
[Service重构-抽象], [Service重构-委派], [Service重构-总结], [Action重构], [Service重构-关系], [Service重构-多条件查询], [Action重构-参数]</p>
</li>
<li>
<p>统一的分页查询简化开发<br>
所有的后台都使用同一个[分页]机制，仅仅需要一份[简化的adminPage.jsp]即满足了各种分页功能的需求，简化了开发，提升了开发速度。</p>
</li>
<li>
<p>模块化JSP设计<br>
从大的JSP文件中，通过[JSP包含关系]抽象出多个公共文件，并把业务JSP按照功能，设计为多个小的JSP文件，便于维护和理解</p>
</li>
</ol>
<p>还有很多设计思想和细节都在代码之中，经过这个这个项目的历练，相信就可以潜移默化地学习和掌握到这些设计思想。</p>
<h2 id="二、改进练习"><a class="header-anchor" href="#二、改进练习">¶</a>二、改进练习</h2>
<p>还有些功能可以继续完善。</p>
<ol>
<li>后台管理员登陆模块</li>
<li>产品图片排序</li>
<li>前台分类下显示产品，提供分页功能<br>
等等</li>
</ol>
<p>学习是为了提高能力，去完成复杂和更有挑战的任务，这些功能就交由同学们自己完成了</p>
<h1 id="十五、下载"><a class="header-anchor" href="#十五、下载">¶</a>十五、下载</h1>
<h2 id="一、完整项目下载"><a class="header-anchor" href="#一、完整项目下载">¶</a>一、完整项目下载</h2>
<p><strong>注</strong> 源代码仅仅是为了演示效果，并非为了学习使用。 因为页面很多，涉及太多类，方法，类之间的关系，复杂的调用关系，页面包含关系，不应该直接基于如此复杂的源代码进行，只会导致学习效率低下，应该<strong>按照教程节奏</strong>，一步一步由浅入深地进行，方能事半功倍。</p>
<h3 id="步骤-1-JDK1-8"><a class="header-anchor" href="#步骤-1-JDK1-8">¶</a>步骤 1 : JDK1.8</h3>
<p>因为天猫SSH 版本使用了挺多的JDK1.8的新特性，为了正常运行，请务必确认当前java环境是JDK1.8以及以上版本<br>
在命令行中输入<strong>java -version</strong>进行校验</p>
<p>参考JDK下载以及配置办法： [JDK1.8以及更高版本下载和环境变量配置]</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5374.png" alt></p>
<h3 id="步骤-2-导入数据"><a class="header-anchor" href="#步骤-2-导入数据">¶</a>步骤 2 : 导入数据</h3>
<p>tmall_ssh.rar只包含了项目必须的代码，但是没有数据，为了看到运行效果，还必须导入数据。</p>
<p>在右侧下载 sql 文件，然后使用如下的 命令行方式导入。如果没有安装mysql,可以参考[安装mysql-server]<br>
<strong>注：</strong> 不要用 navicat,mysql-front 等工具导入，因为数据量大，这些工具处理不了，会报奇奇怪怪的错误。</p>
<p><strong>本tmall_ssh.sql 包含17个分类，每种分类下5个产品，总计85件产品。 每个产品下有20余张图片，总计1777张图片，以及属性和属性值等信息。</strong><br>
<strong>注:</strong> 在导入数据之前，需要mysql服务器上存在tmall_ssh这个数据库，如果没有请执行以下sql语句：<br>
先登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe"</span> -u root -padmin</span><br></pre></td></tr></table></figure>
<p>然后执行创建数据库的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE tmall_ssh DEFAULT CHARACTER SET utf8;</span><br></pre></td></tr></table></figure>
<p>然后在当前 mysql 环境下输入 <strong>exit 退出 mysql 环境</strong>，才能进行下面的在cmd环境下的导入<br>
考虑到要导入的tmall_ssh.sql文件比较大，通过工具如mysql-front导入的时候，可能会出错导致失败，建议使用命令行导入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe"</span> -u root -padmin --<span class="keyword">default</span>-character-set=utf8 tmall_ssh &lt; d:\tmall_ssh.sql</span><br></pre></td></tr></table></figure>
<p><strong>注:</strong> 账号密码是root，admin，导入数据以及项目运行所使用的账号密码都是这个，如果不是，请将mysql的root账号密码修改为admin,参考 [修改root密码]<br>
<strong>注:</strong> D:\tools\MYSQL\mysql-5.1.57-win32\bin\mysql.exe 这个路径是我的mysql.exe的路径，根据实际情况换成自己的mysql运行路径<br>
<strong>注:</strong> tmall_ssh.sql下载后，放在 d:\tmall_ssh.sql 这个位置<br>
<strong>注:</strong> tmall_ssh.sql 总计有14700行，所以导入是比较耗时的，预计3-5分钟左右, 视机器配置而定<br>
**注：**导入过程中，有可能提示的 Unknown table engine ‘InnoDB’， 这是因为当前数据库未支持InnoDB。 解决办法请参考[启动MySQL InnoDB模式]</p>
<h3 id="步骤-3-下载项目"><a class="header-anchor" href="#步骤-3-下载项目">¶</a>步骤 3 : 下载项目</h3>
<ol>
<li>
<p>下载右上角的tmall_ssh.rar</p>
</li>
<li>
<p>解压到<strong>e:/project/tmall_ssh</strong></p>
</li>
</ol>
<p><strong>注：</strong> 一定要解压到<strong>e:/project/tmall_ssh</strong>,因为其路径依赖是居于这个目录的，倘若放在其他目录，会导致项目jar包导入路径异常<br>
<strong>注：</strong> 这个项目里包含了所有的源代码</p>
<h3 id="步骤-4-导入Web动态项目"><a class="header-anchor" href="#步骤-4-导入Web动态项目">¶</a>步骤 4 : 导入Web动态项目</h3>
<p>本项目是按照Web动态项目的风格创建，如果不熟悉，请事先学习相关教程： [创建]。</p>
<p>因为是已经存在的Web动态项目，所以不能通过创建一个新的Web动态项目 tmall_ssh来是用它，只能通过导入的方式。</p>
<p>导入办法：<br>
菜单-&gt; File-&gt;Import-&gt;General-&gt;Existing Projects into Workspace-&gt;Brower-&gt;粘贴路径&quot;E:\project\tmall_ssh&quot; -&gt;Finish。</p>
<p><strong>注：</strong> 假如是直接把路径“E:\project\tmall_ssh” 粘贴在&quot;Select root directory:&quot; 对应的输入框里，会导致如图所示的Finish按钮不可点击。 这个时候，点一下Brower按钮即可。</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5377.png" alt></p>
<h3 id="步骤-5-启动Tomcat"><a class="header-anchor" href="#步骤-5-启动Tomcat">¶</a>步骤 5 : 启动Tomcat</h3>
<p>启动Tomcat办法：<br>
过程较多，如果不熟悉的同学，请参考：[通过Eclipse启动Tomcat-Run On Server]，里面有如何配置，经测试可以使用的tomcat下载等关键步骤和信息。</p>
<p><strong>注意：</strong> 用eclipse内的Tomcat启动本项目，第一次会比较花时间，因为它要把200多兆的图片文件复制到另一个目录下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\project\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\tmall_ssh</span><br></pre></td></tr></table></figure>
<p>在eclipse的右下角，将看到如图所示的进度条，请耐心等待</p>
<p><img src="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/5378.png" alt></p>
<h3 id="步骤-6-访问"><a class="header-anchor" href="#步骤-6-访问">¶</a>步骤 6 : 访问</h3>
<p>Tomcat启动成功之后</p>
<ol>
<li>访问前台页面</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>访问后台页面</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://127.0.0.1:8080/tmall_ssh/admin</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    <div>
     
         <div>
 
  <div style="text-align:center;color:#bfbfbf;font-size:16px;">
   <span>-------- 本文结束 </span>
   <i class="fa fa-paw"></i>
   <span> 感谢阅读 --------</span>
  </div>
 
</div>
     
    </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="潇 卟 甸 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="潇 卟 甸 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <!-- JS库 clipboard 拷贝内容到粘贴板-->
<script src="https://cdn.bootcss.com/clipboard.js/2.0.1/clipboard.min.js"></script>

<!-- JS库 sweetalert 显示提示信息-->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<ul class="post-copyright">
<!-- 本文标题 -->
<li>
  <strong>本文标题： </strong>
  Java实践-天猫整站SSH
</li>

<!-- 本文作者 -->
<li class="post-copyright-author">
  <strong>本文作者： </strong>
  
</li>

<!-- 创建时间 -->
<li>
  <strong>创建时间： </strong>
  2020年06月23日 - 22时06分
</li>

<!-- 修改时间 -->
<li>
  <strong>修改时间： </strong>
  2020年10月10日 - 15时10分
</li>

<!-- 引用链接 -->
<li class="post-copyright-link">
  <strong>本文链接：</strong>
  <a href="http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/" title="Java实践-天猫整站SSH"
    >http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/</a
  >
  <span class="copy-path" title="点击复制引用链接"
    ><i
      style="cursor: pointer"
      class="fa fa-clipboard"
      data-clipboard-text="['s Blog | Java实践-天猫整站SSH](http://yoursite.com/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSH/)"
      aria-label="复制成功"
    ></i
  ></span>
</li>

<!-- 版权声明 -->
<li class="post-copyright-license">
  <strong
    >版权声明：
  </strong>
  本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
</li>
</ul>

<script>
var clipboard = new ClipboardJS(".fa-clipboard");
clipboard.on("success", function(target) {
  var message = document.createElement("div");
  message.innerHTML =
    '<i class="fa fa-check-circle message-icon"></i><span class="message-content">' +
    target.trigger.getAttribute("aria-label") +
    "</span>";
  swal({
    content: message,
    className: "copy-success-message",
    timer: 1000,
    button: false
  });
});
</script>
      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 编程</a>
          
            <a href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag"><i class="fa fa-tag"></i> 源代码</a>
          
            <a href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag"><i class="fa fa-tag"></i> Java实践</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99J2EE/" rel="next" title="Java实践-天猫整站J2EE">
                <i class="fa fa-chevron-left"></i> Java实践-天猫整站J2EE
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/23/Java%E5%AE%9E%E8%B7%B5-%E5%A4%A9%E7%8C%AB%E6%95%B4%E7%AB%99SSM/" rel="prev" title="Java实践-天猫整站SSM">
                Java实践-天猫整站SSM <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <a href="/">
              <img class="site-author-image" itemprop="image"
                src="/uploads/picture.jpg"
                alt="潇 卟 甸" />
              </a>
            
              <p class="site-author-name" itemprop="name">潇 卟 甸</p>
              <p class="site-description motion-element" itemprop="description">总结自己一些知识，一些事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

			
				<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
				<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
				<div class="widget-wrap">
					<div id="myCanvasContainer" class="widget tagcloud">
						<canvas width="250" height="250" id="resCanvas" style="width=100%">
							<ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%AE%9E%E8%B7%B5/" rel="tag">Java实践</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/b%E7%AB%99%E8%A7%86%E9%A2%91/" rel="tag">b站视频</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E7%BA%A7/" rel="tag">中级</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85/" rel="tag">喜马拉雅</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E8%AF%AD/" rel="tag">日语</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/" rel="tag">源代码</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">电子书</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a><span class="tag-list-count">45</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BE%8E%E5%8C%96/" rel="tag">美化</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD/" rel="tag">英语</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" rel="tag">计算机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E6%8E%A8%E8%8D%90/" rel="tag">读书推荐</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E9%98%B6/" rel="tag">进阶</a><span class="tag-list-count">4</span></li></ul>
						</canvas>
					</div>
				</div>
			

          </nav>

          

          
		  
		  <!-- 添加近期文章 -->
			
				<div class="links-of-blogroll motion-element links-of-blogroll-block">
				<div class="links-of-blogroll-title">
				<!-- modify icon to fire by szw -->
				<i class="fa fa-history fa-" aria-hidden="true"></i>
				近期文章
				</div>
				<ul class="links-of-blogroll-list">
				
				
					<li>
					<a href="/2021/07/01/%E5%B0%9A%E7%A1%85%E8%B0%B7-MyBatis%E6%95%99%E7%A8%8B/" title="尚硅谷-MyBatis教程" target="_blank">尚硅谷-MyBatis教程</a>
					</li>
				
					<li>
					<a href="/2021/06/29/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringMVC%E6%95%99%E7%A8%8B/" title="尚硅谷-SpringMVC教程" target="_blank">尚硅谷-SpringMVC教程</a>
					</li>
				
					<li>
					<a href="/2021/06/11/%E5%B0%9A%E7%A1%85%E8%B0%B7-JavaWeb%E6%95%99%E7%A8%8B/" title="尚硅谷-JavaWeb教程" target="_blank">尚硅谷-JavaWeb教程</a>
					</li>
				
					<li>
					<a href="/2021/06/11/%E5%B0%9A%E7%A1%85%E8%B0%B7-Spring5%E6%95%99%E7%A8%8B/" title="尚硅谷-Spring5教程" target="_blank">尚硅谷-Spring5教程</a>
					</li>
				
					<li>
					<a href="/2021/06/08/%E5%B0%9A%E7%A1%85%E8%B0%B7-JDBC%E6%95%99%E7%A8%8B/" title="尚硅谷-JDBC教程" target="_blank">尚硅谷-JDBC教程</a>
					</li>
				
				</ul>
			</div>
			

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sushan102.top/posts/1410804403/" title="博客搭建" target="_blank">博客搭建</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://how2j.cn?p=154642" title="HOW2J" target="_blank">HOW2J</a>
                  </li>
                
              </ul>
            </div>
          
		  
		  
			
		  
		  <div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>


        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、基础"><span class="nav-text">一、基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、项目简介"><span class="nav-text">1、项目简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、功能一览-前台"><span class="nav-text">2、功能一览-前台</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-首页"><span class="nav-text">步骤 1 : 首页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-分类页"><span class="nav-text">步骤 2 : 分类页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-查询结果页"><span class="nav-text">步骤 3 : 查询结果页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-产品页"><span class="nav-text">步骤 4 : 产品页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-结算页面"><span class="nav-text">步骤 5 : 结算页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-支付页面"><span class="nav-text">步骤 6 : 支付页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-支付成功页面"><span class="nav-text">步骤 7 : 支付成功页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-购物车页面"><span class="nav-text">步骤 8 : 购物车页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-我的订单页面"><span class="nav-text">步骤 9 : 我的订单页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-确认收货页面"><span class="nav-text">步骤 10 : 确认收货页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-确认收货成功页面"><span class="nav-text">步骤 11 : 确认收货成功页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-进行评价页面"><span class="nav-text">步骤 12 : 进行评价页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-登录页面"><span class="nav-text">步骤 13 : 登录页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-注册页面"><span class="nav-text">步骤 14 : 注册页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、功能一览-后台"><span class="nav-text">3、功能一览-后台</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分类管理"><span class="nav-text">步骤 1 : 分类管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-分类属性管理"><span class="nav-text">步骤 2 : 分类属性管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-产品管理"><span class="nav-text">步骤 3 : 产品管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-产品属性设置"><span class="nav-text">步骤 4 : 产品属性设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-产品图片管理"><span class="nav-text">步骤 5 : 产品图片管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-用户管理"><span class="nav-text">步骤 6 : 用户管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-订单管理"><span class="nav-text">步骤 7 : 订单管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、本地演示"><span class="nav-text">4、本地演示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-下载并运行"><span class="nav-text">步骤 1 : 下载并运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-访问地址"><span class="nav-text">步骤 2 : 访问地址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、下载并配置运行"><span class="nav-text">5、下载并配置运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-请观看视频"><span class="nav-text">步骤 1 : 请观看视频</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-JDK1-8"><span class="nav-text">步骤 2 : JDK1.8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-导入数据"><span class="nav-text">步骤 3 : 导入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-下载项目"><span class="nav-text">步骤 4 : 下载项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-导入Web动态项目"><span class="nav-text">步骤 5 : 导入Web动态项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-启动Tomcat"><span class="nav-text">步骤 6 : 启动Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-访问"><span class="nav-text">步骤 7 : 访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-idea"><span class="nav-text">步骤 8 : idea</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、开发流程"><span class="nav-text">6、开发流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-技术准备"><span class="nav-text">步骤 1 : 技术准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-开发流程"><span class="nav-text">步骤 2 : 开发流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、各个版本区别"><span class="nav-text">7、各个版本区别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-各个版本区别"><span class="nav-text">步骤 1 : 各个版本区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、需求分析-展示"><span class="nav-text">二、需求分析-展示</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、首页"><span class="nav-text">2、首页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在横向导航栏上提供4个分类连接"><span class="nav-text">步骤 1 : 在横向导航栏上提供4个分类连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-在纵向导航栏上提供全部17个分类连接"><span class="nav-text">步骤 2 : 在纵向导航栏上提供全部17个分类连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品"><span class="nav-text">步骤 3 : 当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-按照每种分类显示5个商品的方式，显示所有17种分类"><span class="nav-text">步骤 4 : 按照每种分类显示5个商品的方式，显示所有17种分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-先看整体效果"><span class="nav-text">步骤 5 : 先看整体效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、产品页"><span class="nav-text">3、产品页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示分辨率为950x100的当前商品对应的分类图片"><span class="nav-text">步骤 1 : 显示分辨率为950x100的当前商品对应的分类图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-显示本商品的5个单独图片"><span class="nav-text">步骤 2 : 显示本商品的5个单独图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等"><span class="nav-text">步骤 3 : 商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-商品详情"><span class="nav-text">步骤 4 : 商品详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-评价信息"><span class="nav-text">步骤 5 : 评价信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-5张商品详细图片"><span class="nav-text">步骤 6 : 5张商品详细图片</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、分类页"><span class="nav-text">4、分类页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示分辨率为950x100的当前分类图片"><span class="nav-text">步骤 1 : 显示分辨率为950x100的当前分类图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-显示本分类下的所有产品"><span class="nav-text">步骤 2 : 显示本分类下的所有产品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、搜索结果页"><span class="nav-text">5、搜索结果页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示满足查询条件的商品"><span class="nav-text">步骤 1 : 显示满足查询条件的商品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、购物车查看页"><span class="nav-text">6、购物车查看页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在购物车中显示订单项"><span class="nav-text">步骤 1 : 在购物车中显示订单项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、结算页"><span class="nav-text">7、结算页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在结算页面显示被选中的订单项"><span class="nav-text">步骤 1 : 在结算页面显示被选中的订单项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、确认支付页"><span class="nav-text">8、确认支付页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-确认支付页面显示本次订单的金额总数"><span class="nav-text">步骤 1 : 确认支付页面显示本次订单的金额总数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、支付成功页"><span class="nav-text">9、支付成功页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-付款成功时，显示本次付款金额"><span class="nav-text">步骤 1 : 付款成功时，显示本次付款金额</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、我的订单页"><span class="nav-text">10、我的订单页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示所有订单，以及对应的订单项"><span class="nav-text">步骤 1 : 显示所有订单，以及对应的订单项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、确认收货页"><span class="nav-text">11、确认收货页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示订单项内容"><span class="nav-text">步骤 1 : 显示订单项内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-显示订单信息，收货人地址等"><span class="nav-text">步骤 2 : 显示订单信息，收货人地址等</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、评价页"><span class="nav-text">12、评价页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-显示要评价的商品信息，商品当前的总评价数"><span class="nav-text">步骤 1 : 显示要评价的商品信息，商品当前的总评价数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-评价成功后，显示当前商品所有的评价信息"><span class="nav-text">步骤 2 : 评价成功后，显示当前商品所有的评价信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、页头信息展示"><span class="nav-text">13、页头信息展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-未登录状态"><span class="nav-text">步骤 1 : 未登录状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-已登录状态"><span class="nav-text">步骤 2 : 已登录状态</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、需求分析-交互"><span class="nav-text">三、需求分析-交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v2"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、分类页排序"><span class="nav-text">2、分类页排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-按照综合，人气，新品，销量，价格排序"><span class="nav-text">步骤 1 : 按照综合，人气，新品，销量，价格排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-进行价格筛选，这个不算，这个是做在浏览器端的，并不是和服务器端的交互"><span class="nav-text">步骤 2 : 进行价格筛选，这个不算，这个是做在浏览器端的，并不是和服务器端的交互</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、立即购买"><span class="nav-text">3、立即购买</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在产品页，未登录状态时候，点击立即购买"><span class="nav-text">步骤 1 : 在产品页，未登录状态时候，点击立即购买</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-在产品页，如果已经登录，点击购买"><span class="nav-text">步骤 2 : 在产品页，如果已经登录，点击购买</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、加入购物车"><span class="nav-text">4、加入购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在未登录状态，点击加入购物车"><span class="nav-text">步骤 1 : 在未登录状态，点击加入购物车</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-在已登录状态，点击加入购物车"><span class="nav-text">步骤 2 : 在已登录状态，点击加入购物车</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、调整订单项数量"><span class="nav-text">5、调整订单项数量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在购物车页面，调整订单项数量"><span class="nav-text">步骤 1 : 在购物车页面，调整订单项数量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、删除订单项"><span class="nav-text">6、删除订单项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在购物车页面，删除订单项"><span class="nav-text">步骤 1 : 在购物车页面，删除订单项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、生成订单"><span class="nav-text">7、生成订单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-在结算页面，提交订单"><span class="nav-text">步骤 1 : 在结算页面，提交订单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、订单页功能"><span class="nav-text">8、订单页功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-我的订单页面"><span class="nav-text">步骤 1 : 我的订单页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、确认付款"><span class="nav-text">9、确认付款</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-确认付款"><span class="nav-text">步骤 1 : 确认付款</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、确认收货"><span class="nav-text">10、确认收货</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-确认收货"><span class="nav-text">步骤 1 : 确认收货</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、提交评价信息"><span class="nav-text">11、提交评价信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-评价页面，提交评价信息"><span class="nav-text">步骤 1 : 评价页面，提交评价信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、登录"><span class="nav-text">12、登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-登录页面"><span class="nav-text">步骤 1 : 登录页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、注册"><span class="nav-text">13、注册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-注册页面"><span class="nav-text">步骤 1 : 注册页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14、退出"><span class="nav-text">14、退出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-退出"><span class="nav-text">步骤 1 : 退出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15、搜索"><span class="nav-text">15、搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-搜索"><span class="nav-text">步骤 1 : 搜索</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16、前台需求列表"><span class="nav-text">16、前台需求列表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-前端页面需求列表清单"><span class="nav-text">步骤 1 : 前端页面需求列表清单</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四、需求分析-后台"><span class="nav-text">四、需求分析-后台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v3"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、分类管理"><span class="nav-text">2、分类管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分页查询"><span class="nav-text">步骤 1 : 分页查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-新增分类"><span class="nav-text">步骤 2 : 新增分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-编辑修改"><span class="nav-text">步骤 3 : 编辑修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-删除"><span class="nav-text">步骤 4 : 删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、属性管理"><span class="nav-text">3、属性管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-属性概念"><span class="nav-text">步骤 1 : 属性概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-分页查询"><span class="nav-text">步骤 2 : 分页查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-新增属性"><span class="nav-text">步骤 3 : 新增属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-编辑修改"><span class="nav-text">步骤 4 : 编辑修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-删除"><span class="nav-text">步骤 5 : 删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、产品管理"><span class="nav-text">4、产品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分页查询-v2"><span class="nav-text">步骤 1 : 分页查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-新增产品"><span class="nav-text">步骤 2 : 新增产品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-编辑修改-v2"><span class="nav-text">步骤 3 : 编辑修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-删除-v2"><span class="nav-text">步骤 4 : 删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、产品图片管理"><span class="nav-text">5、产品图片管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-产品图片概念"><span class="nav-text">步骤 1 : 产品图片概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-产品图片管理"><span class="nav-text">步骤 2 : 产品图片管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、产品属性设置"><span class="nav-text">6、产品属性设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-产品属性值设置"><span class="nav-text">步骤 1 : 产品属性值设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、用户管理"><span class="nav-text">7、用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分页查询-v3"><span class="nav-text">步骤 1 : 分页查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、订单管理"><span class="nav-text">8、订单管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-订单分页查询"><span class="nav-text">步骤 1 : 订单分页查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-查看详情"><span class="nav-text">步骤 2 : 查看详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-发货"><span class="nav-text">步骤 3 : 发货</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、后台需求列表"><span class="nav-text">9、后台需求列表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-后台需求列表清单"><span class="nav-text">步骤 1 : 后台需求列表清单</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、表结构设计"><span class="nav-text">五、表结构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v4"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、数据库"><span class="nav-text">2、数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-数据库tmall-ssh"><span class="nav-text">步骤 1 : 数据库tmall_ssh</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、表与表关系"><span class="nav-text">3、表与表关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-表关系图"><span class="nav-text">步骤 1 : 表关系图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-表"><span class="nav-text">步骤 2 : 表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-正确的分析表与表之间的关系的方法"><span class="nav-text">步骤 3 : 正确的分析表与表之间的关系的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-表关系"><span class="nav-text">步骤 4 : 表关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、建表SQL语句"><span class="nav-text">4、建表SQL语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-建表顺序"><span class="nav-text">步骤 1 : 建表顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-用户表"><span class="nav-text">步骤 2 : 用户表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-分类表"><span class="nav-text">步骤 3 : 分类表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-属性表"><span class="nav-text">步骤 4 : 属性表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-产品表"><span class="nav-text">步骤 5 : 产品表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-属性值表"><span class="nav-text">步骤 6 : 属性值表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-产品图片表"><span class="nav-text">步骤 7 : 产品图片表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-评价表"><span class="nav-text">步骤 8 : 评价表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-订单表"><span class="nav-text">步骤 9 : 订单表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-订单项表"><span class="nav-text">步骤 10 : 订单项表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、表与页面"><span class="nav-text">5、表与页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-表与页面"><span class="nav-text">步骤 1 : 表与页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-用户表-v2"><span class="nav-text">步骤 2 : 用户表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-分类表-v2"><span class="nav-text">步骤 3 : 分类表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-属性表-v2"><span class="nav-text">步骤 4 : 属性表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-产品表-v2"><span class="nav-text">步骤 5 : 产品表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-属性值表-v2"><span class="nav-text">步骤 6 : 属性值表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-产品图片表-v2"><span class="nav-text">步骤 7 : 产品图片表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-评价表-v2"><span class="nav-text">步骤 8 : 评价表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-订单表-v2"><span class="nav-text">步骤 9 : 订单表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-订单项表-v2"><span class="nav-text">步骤 10 : 订单项表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、整理在一起"><span class="nav-text">6、整理在一起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-tmall-ssh-sql"><span class="nav-text">步骤 1 : tmall_ssh.sql</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六、原型-后端"><span class="nav-text">六、原型-后端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v5"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、分类管理-v2"><span class="nav-text">2、分类管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、属性管理-v2"><span class="nav-text">3、属性管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v2"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、产品管理-v2"><span class="nav-text">4、产品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v3"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、产品图片管理-v2"><span class="nav-text">5、产品图片管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v4"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、产品属性设置-v2"><span class="nav-text">6、产品属性设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v5"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、用户管理-v2"><span class="nav-text">7、用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v6"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、订单管理-v2"><span class="nav-text">8、订单管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v7"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七、后台-分类管理"><span class="nav-text">七、后台-分类管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v6"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、可运行的项目"><span class="nav-text">2、可运行的项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-可运行项目"><span class="nav-text">步骤 1 : 可运行项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-动态Web-Project方式运行"><span class="nav-text">步骤 2 : 动态Web Project方式运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-启动Tomcat并观察效果"><span class="nav-text">步骤 3 : 启动Tomcat并观察效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、静态资源"><span class="nav-text">3、静态资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-图片资源"><span class="nav-text">步骤 1 : 图片资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-css"><span class="nav-text">步骤 2 : css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-js"><span class="nav-text">步骤 3 : js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-jars"><span class="nav-text">步骤 4 : jars</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、开发思路"><span class="nav-text">4、开发思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、查询"><span class="nav-text">5、查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-新建项目"><span class="nav-text">步骤 3 : 新建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-jar包"><span class="nav-text">步骤 4 : jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-Category类"><span class="nav-text">步骤 5 : Category类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-dao-impl"><span class="nav-text">步骤 6 : dao.impl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-service"><span class="nav-text">步骤 7 : service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-service-impl"><span class="nav-text">步骤 8 : service.impl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-action"><span class="nav-text">步骤 9 : action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-index-jsp"><span class="nav-text">步骤 10 : index.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-listCategory-jsp"><span class="nav-text">步骤 11 : listCategory.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-静态资源"><span class="nav-text">步骤 12 : 静态资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-web-xml"><span class="nav-text">步骤 13 : web.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-applicationContext-xml"><span class="nav-text">步骤 14 : applicationContext.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-struts-xml"><span class="nav-text">步骤 15 : struts.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-测试数据"><span class="nav-text">步骤 16 : 测试数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-启动tomcat"><span class="nav-text">步骤 17 : 启动tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-18-访问测试地址"><span class="nav-text">步骤 18 : 访问测试地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-19-思路图"><span class="nav-text">步骤 19 : 思路图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-20-可运行项目"><span class="nav-text">步骤 20 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、JSP包含关系"><span class="nav-text">6、JSP包含关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分类查询对应的JSP文件"><span class="nav-text">步骤 1 : 分类查询对应的JSP文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-adminHeader-jsp"><span class="nav-text">步骤 2 : adminHeader.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-adminNavigator-jsp"><span class="nav-text">步骤 3 : adminNavigator.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-adminPage-jsp"><span class="nav-text">步骤 4 : adminPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-adminFooter-jsp"><span class="nav-text">步骤 5 : adminFooter.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、分页"><span class="nav-text">7、分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v2"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v2"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Page-java"><span class="nav-text">步骤 4 : Page.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-CategoryService"><span class="nav-text">步骤 5 : CategoryService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryServiceImpl"><span class="nav-text">步骤 6 : CategoryServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-CategoryAction"><span class="nav-text">步骤 7 : CategoryAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-listCategory-jsp"><span class="nav-text">步骤 8 : listCategory.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-为了便于理解，先来一个简化了的adminPage-jsp"><span class="nav-text">步骤 9 : 为了便于理解，先来一个简化了的adminPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-完整版的adminPage-jsp"><span class="nav-text">步骤 10 : 完整版的adminPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-自己做一遍"><span class="nav-text">步骤 11 : 自己做一遍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、增加"><span class="nav-text">8、增加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v3"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v3"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-页面"><span class="nav-text">步骤 4 : 页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-为空判断"><span class="nav-text">步骤 5 : 为空判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryService"><span class="nav-text">步骤 6 : CategoryService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-CategoryServiceImpl"><span class="nav-text">步骤 7 : CategoryServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-ImageUtil"><span class="nav-text">步骤 8 : ImageUtil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-CategoryAction"><span class="nav-text">步骤 9 : CategoryAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-中文问题"><span class="nav-text">步骤 10 : 中文问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、删除"><span class="nav-text">9、删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v4"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v4"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果-v2"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-用于删除的超链"><span class="nav-text">步骤 4 : 用于删除的超链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-删除前的确认操作"><span class="nav-text">步骤 5 : 删除前的确认操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryService-v2"><span class="nav-text">步骤 6 : CategoryService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-CategoryServiceImpl-v2"><span class="nav-text">步骤 7 : CategoryServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-CategoryAction"><span class="nav-text">步骤 8 : CategoryAction</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、编辑"><span class="nav-text">10、编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v5"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v5"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果-v3"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-CategoryService"><span class="nav-text">步骤 4 : CategoryService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-CategoryServiceImpl"><span class="nav-text">步骤 5 : CategoryServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryAction"><span class="nav-text">步骤 6 : CategoryAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-editCategory-jsp"><span class="nav-text">步骤 7 : editCategory.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、修改"><span class="nav-text">11、修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v6"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v6"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果-v4"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-编辑页面提交数据"><span class="nav-text">步骤 4 : 编辑页面提交数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-CategoryService-v2"><span class="nav-text">步骤 5 : CategoryService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryServiceImpl-v2"><span class="nav-text">步骤 6 : CategoryServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-CategoryAction-v2"><span class="nav-text">步骤 7 : CategoryAction</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、做一遍"><span class="nav-text">12、做一遍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#八、项目重构"><span class="nav-text">八、项目重构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、存在的问题"><span class="nav-text">1、存在的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-分类管理完成"><span class="nav-text">步骤 1 : 分类管理完成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-Service层的问题"><span class="nav-text">步骤 2 : Service层的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-Action的问题"><span class="nav-text">步骤 3 : Action的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-解决办法"><span class="nav-text">步骤 4 : 解决办法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、SERVICE重构-抽象"><span class="nav-text">2、SERVICE重构-抽象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-重构完成之后的效果"><span class="nav-text">步骤 1 : 重构完成之后的效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-重申Service层存在的重构需求"><span class="nav-text">步骤 2 : 重申Service层存在的重构需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-Service层-的重构行为"><span class="nav-text">步骤 3 : Service层 的重构行为</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-父接口-BaseService"><span class="nav-text">步骤 4 : 父接口 BaseService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-父接口实现类-BaseServiceImpl"><span class="nav-text">步骤 5 : 父接口实现类 BaseServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-CategoryService接口继承BaseService"><span class="nav-text">步骤 6 : CategoryService接口继承BaseService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-CategoryServiceImpl继承BaseServiceImpl"><span class="nav-text">步骤 7 : CategoryServiceImpl继承BaseServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Clazz对象的处理"><span class="nav-text">步骤 8 : Clazz对象的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-CategoryAction的调整"><span class="nav-text">步骤 9 : CategoryAction的调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-Service重构-抽象带来的好处"><span class="nav-text">步骤 10 : Service重构-抽象带来的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-可运行项目"><span class="nav-text">步骤 11 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、SERVICE重构-委派"><span class="nav-text">3、SERVICE重构-委派</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先看委派重构实现之后的好处"><span class="nav-text">步骤 1 : 先看委派重构实现之后的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-ServiceDelegateDAO"><span class="nav-text">步骤 2 : ServiceDelegateDAO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-ServiceDelegateDAO的快速生成技巧"><span class="nav-text">步骤 3 : ServiceDelegateDAO的快速生成技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-BaseServiceImpl继承ServiceDelegateDAO"><span class="nav-text">步骤 4 : BaseServiceImpl继承ServiceDelegateDAO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-关于save方法的返回类型"><span class="nav-text">步骤 5 : 关于save方法的返回类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-委派模式的好处"><span class="nav-text">步骤 6 : 委派模式的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-可运行项目"><span class="nav-text">步骤 7 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、SERVICE重构-总结"><span class="nav-text">4、SERVICE重构-总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-好处"><span class="nav-text">步骤 1 : 好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-Service层类关系图"><span class="nav-text">步骤 2 : Service层类关系图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、ACTION重构"><span class="nav-text">5、ACTION重构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-重申Action层存在的问题"><span class="nav-text">步骤 1 : 重申Action层存在的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-重构后的效果"><span class="nav-text">步骤 2 : 重构后的效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-重构思路"><span class="nav-text">步骤 3 : 重构思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-上传专用-Action4Upload"><span class="nav-text">步骤 4 : 上传专用 Action4Upload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-分页专用-Action4Pagination"><span class="nav-text">步骤 5 : 分页专用 Action4Pagination</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-对象和集合-Action4Pojo"><span class="nav-text">步骤 6 : 对象和集合 Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-注入服务专用-Action4Service"><span class="nav-text">步骤 7 : 注入服务专用 Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Service新加一个方法t2p"><span class="nav-text">步骤 8 : Action4Service新加一个方法t2p()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-定义返回页面的-Action4Result"><span class="nav-text">步骤 9 : 定义返回页面的 Action4Result</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-完整版的Action4Result"><span class="nav-text">步骤 10 : 完整版的Action4Result</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-CategoryAction"><span class="nav-text">步骤 11 : CategoryAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-可运行项目"><span class="nav-text">步骤 12 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、项目重构总结"><span class="nav-text">6、项目重构总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-短期看复杂-长期看收益高"><span class="nav-text">步骤 1 : 短期看复杂-长期看收益高</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-重构没有结束"><span class="nav-text">步骤 2 : 重构没有结束</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#九、后台-其他管理"><span class="nav-text">九、后台-其他管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、后台其他页面"><span class="nav-text">1、后台其他页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、SERVICE重构-关系"><span class="nav-text">2、SERVICE重构-关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-PropertyService"><span class="nav-text">步骤 1 : PropertyService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-BaseService"><span class="nav-text">步骤 2 : BaseService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-BaseServiceImpl"><span class="nav-text">步骤 3 : BaseServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-List-listByParent-Object-parent"><span class="nav-text">步骤 4 : List listByParent(Object parent);</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-list-Page-page-Object-parent"><span class="nav-text">步骤 5 : list(Page page, Object parent);</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-int-total-Object-parentObject"><span class="nav-text">步骤 6 : int total(Object parentObject);</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-PropertyService"><span class="nav-text">步骤 7 : PropertyService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-PropertyServiceImpl"><span class="nav-text">步骤 8 : PropertyServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-PropertyAction"><span class="nav-text">步骤 9 : PropertyAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-可运行项目"><span class="nav-text">步骤 10 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、属性管理-v3"><span class="nav-text">3、属性管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v7"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v7"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-页面截图"><span class="nav-text">步骤 3 : 页面截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Property"><span class="nav-text">步骤 4 : Property</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-PropertyService"><span class="nav-text">步骤 5 : PropertyService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-PropertyServiceImpl"><span class="nav-text">步骤 6 : PropertyServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-Action4Pojo"><span class="nav-text">步骤 7 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Service"><span class="nav-text">步骤 8 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-PropertyAction-v2"><span class="nav-text">步骤 9 : PropertyAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-listProperty-jsp-editProperty-jsp"><span class="nav-text">步骤 10 : listProperty.jsp+editProperty.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-查询功能讲解"><span class="nav-text">步骤 11 : 查询功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-增加功能讲解"><span class="nav-text">步骤 12 : 增加功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-编辑功能讲解"><span class="nav-text">步骤 13 : 编辑功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-修改功能讲解"><span class="nav-text">步骤 14 : 修改功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-删除功能讲解"><span class="nav-text">步骤 15 : 删除功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-其他-面包屑导航"><span class="nav-text">步骤 16 : 其他-面包屑导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-其他-分页"><span class="nav-text">步骤 17 : 其他-分页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、产品管理-v3"><span class="nav-text">4、产品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v8"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-页面截图"><span class="nav-text">步骤 2 : 页面截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-模仿和排错"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Product"><span class="nav-text">步骤 4 : Product</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ProductService"><span class="nav-text">步骤 5 : ProductService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-ProductServiceImpl"><span class="nav-text">步骤 6 : ProductServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-Action4Pojo-v2"><span class="nav-text">步骤 7 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Service-v2"><span class="nav-text">步骤 8 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-ProductAction"><span class="nav-text">步骤 9 : ProductAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-listProduct-jsp-editProduct-jsp"><span class="nav-text">步骤 10 : listProduct.jsp+editProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-查询功能讲解-v2"><span class="nav-text">步骤 11 : 查询功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-增加功能讲解-v2"><span class="nav-text">步骤 12 : 增加功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-编辑功能讲解-v2"><span class="nav-text">步骤 13 : 编辑功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-修改功能讲解-v2"><span class="nav-text">步骤 14 : 修改功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-删除功能讲解-v2"><span class="nav-text">步骤 15 : 删除功能讲解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、产品图片管理-v3"><span class="nav-text">5、产品图片管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v9"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-效果截图"><span class="nav-text">步骤 2 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-模仿和排错-v2"><span class="nav-text">步骤 3 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-ProductImage"><span class="nav-text">步骤 4 : ProductImage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-Product"><span class="nav-text">步骤 5 : Product</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-ProductImageService"><span class="nav-text">步骤 6 : ProductImageService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-ProductImageServiceImpl"><span class="nav-text">步骤 7 : ProductImageServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Pojo"><span class="nav-text">步骤 8 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-Action4Service"><span class="nav-text">步骤 9 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-ProductImageAction"><span class="nav-text">步骤 10 : ProductImageAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-listProductImage-jsp"><span class="nav-text">步骤 11 : listProductImage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-查询功能讲解"><span class="nav-text">步骤 12 : 查询功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-增加功能讲解"><span class="nav-text">步骤 13 : 增加功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-删除功能讲解"><span class="nav-text">步骤 14 : 删除功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-编辑和修改"><span class="nav-text">步骤 15 : 编辑和修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-ProductAction"><span class="nav-text">步骤 16 : ProductAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-listProduct-jsp"><span class="nav-text">步骤 17 : listProduct.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-18-产品缩略图效果"><span class="nav-text">步骤 18 : 产品缩略图效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、SERVICE重构-多条件查询"><span class="nav-text">6、SERVICE重构-多条件查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-ProductImageService"><span class="nav-text">步骤 1 : ProductImageService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-BaseService-v2"><span class="nav-text">步骤 2 : BaseService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-BaseServiceImpl-v2"><span class="nav-text">步骤 3 : BaseServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-ProductImageServiceImpl"><span class="nav-text">步骤 4 : ProductImageServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-可运行项目"><span class="nav-text">步骤 5 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、产品属性值设置"><span class="nav-text">7、产品属性值设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v10"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v8"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v2"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-PropertyValue"><span class="nav-text">步骤 4 : PropertyValue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-PropertyValueService"><span class="nav-text">步骤 5 : PropertyValueService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-PropertyValueServiceImpl"><span class="nav-text">步骤 6 : PropertyValueServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-Action4Pojo-v3"><span class="nav-text">步骤 7 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Service-v3"><span class="nav-text">步骤 8 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-PropertyValueAction"><span class="nav-text">步骤 9 : PropertyValueAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-editProductValue-jsp"><span class="nav-text">步骤 10 : editProductValue.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-success-jsp"><span class="nav-text">步骤 11 : success.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-编辑功能讲解"><span class="nav-text">步骤 12 : 编辑功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-修改功能讲解"><span class="nav-text">步骤 13 : 修改功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-删除，增加功能不需要"><span class="nav-text">步骤 14 : 删除，增加功能不需要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-欠缺"><span class="nav-text">步骤 15 : 欠缺</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、用户管理"><span class="nav-text">8、用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-准备数据"><span class="nav-text">步骤 1 : 准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-先运行，看到效果，再学习"><span class="nav-text">步骤 2 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v3"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-模仿和排错"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-User"><span class="nav-text">步骤 5 : User</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-UserService"><span class="nav-text">步骤 6 : UserService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-UserServiceImpl"><span class="nav-text">步骤 7 : UserServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Pojo-v2"><span class="nav-text">步骤 8 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-Action4Service-v2"><span class="nav-text">步骤 9 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-UserAction"><span class="nav-text">步骤 10 : UserAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-listUser-jsp"><span class="nav-text">步骤 11 : listUser.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-查询功能讲解-v2"><span class="nav-text">步骤 12 : 查询功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-增加，删除，修改功能"><span class="nav-text">步骤 13 : 增加，删除，修改功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、订单管理"><span class="nav-text">9、订单管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-准备数据SQL"><span class="nav-text">步骤 1 : 准备数据SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-效果截图-v2"><span class="nav-text">步骤 2 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-先运行，看到效果，再学习"><span class="nav-text">步骤 3 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-模仿和排错-v2"><span class="nav-text">步骤 4 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-Order"><span class="nav-text">步骤 5 : Order</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-OrderItem"><span class="nav-text">步骤 6 : OrderItem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-OrderService"><span class="nav-text">步骤 7 : OrderService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-OrderServiceImpl"><span class="nav-text">步骤 8 : OrderServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-OrderItemService"><span class="nav-text">步骤 9 : OrderItemService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-OrderItemServiceImpl"><span class="nav-text">步骤 10 : OrderItemServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-Action4Pojo"><span class="nav-text">步骤 11 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-Action4Service"><span class="nav-text">步骤 12 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-OrderAction"><span class="nav-text">步骤 13 : OrderAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-14-listOrder-jsp"><span class="nav-text">步骤 14 : listOrder.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-查询功能讲解"><span class="nav-text">步骤 15 : 查询功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-发货功能讲解"><span class="nav-text">步骤 16 : 发货功能讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-增加，修改，删除功能"><span class="nav-text">步骤 17 : 增加，修改，删除功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十、原型-前端"><span class="nav-text">十、原型-前端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v7"><span class="nav-text">1、概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-真正开发的时候会直接使用这些前端页面吗？"><span class="nav-text">步骤 1 : 真正开发的时候会直接使用这些前端页面吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-homePage-jsp-又由多个子jsp文件组成"><span class="nav-text">步骤 2 : homePage.jsp 又由多个子jsp文件组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-这些前端原型的作用"><span class="nav-text">步骤 3 : 这些前端原型的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、首页-v2"><span class="nav-text">2、首页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v8"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、分类页"><span class="nav-text">3、分类页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v9"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、产品页面"><span class="nav-text">4、产品页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v10"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、购物车页面"><span class="nav-text">5、购物车页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v11"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、我的订单页面"><span class="nav-text">6、我的订单页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v12"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、结算页面"><span class="nav-text">7、结算页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v13"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、查询结果页"><span class="nav-text">8、查询结果页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v14"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、支付页面"><span class="nav-text">9、支付页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v15"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、支付成功页面"><span class="nav-text">10、支付成功页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v16"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、确认收货页面"><span class="nav-text">11、确认收货页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v17"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、收货成功页面"><span class="nav-text">12、收货成功页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v18"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、评价页面"><span class="nav-text">13、评价页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v19"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14、登录页面"><span class="nav-text">14、登录页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-效果-v20"><span class="nav-text">步骤 1 : 效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十一、前台-首页"><span class="nav-text">十一、前台-首页</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v8"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、可运行项目"><span class="nav-text">2、可运行项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v11"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v9"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v4"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-可运行项目"><span class="nav-text">步骤 4 : 可运行项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-导入SQL语句"><span class="nav-text">步骤 5 : 导入SQL语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-限制性"><span class="nav-text">步骤 6 : 限制性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、静态资源-v2"><span class="nav-text">3、静态资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-图片资源-site目录"><span class="nav-text">步骤 1 : 图片资源-site目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-图片资源-轮播图片"><span class="nav-text">步骤 2 : 图片资源-轮播图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-图片资源-分类图片"><span class="nav-text">步骤 3 : 图片资源-分类图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-图片资源-产品图片"><span class="nav-text">步骤 4 : 图片资源-产品图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-css"><span class="nav-text">步骤 5 : css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-js"><span class="nav-text">步骤 6 : js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-img-rar"><span class="nav-text">步骤 7 : img.rar</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、FOREACTION"><span class="nav-text">4、FOREACTION</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-后台模块与Action对应关系"><span class="nav-text">步骤 1 : 后台模块与Action对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-前台模块与Action对应关系"><span class="nav-text">步骤 2 : 前台模块与Action对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-ForeAction方法一览"><span class="nav-text">步骤 3 : ForeAction方法一览</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、FOREACTION-HOME"><span class="nav-text">5、FOREACTION.HOME()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-明确需求-首页需要什么数据？"><span class="nav-text">步骤 1 : 明确需求,首页需要什么数据？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-Category"><span class="nav-text">步骤 2 : Category</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-ProductService"><span class="nav-text">步骤 3 : ProductService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-ProductServiceImpl"><span class="nav-text">步骤 4 : ProductServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-home-方法"><span class="nav-text">步骤 5 : ForeAction.home()方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、HOME-JSP"><span class="nav-text">6、HOME.JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-前台页面的特点"><span class="nav-text">步骤 1 : 前台页面的特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-home-jsp-所包含页面"><span class="nav-text">步骤 2 : home.jsp 所包含页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-header-jsp"><span class="nav-text">步骤 3 : header.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-top-jsp"><span class="nav-text">步骤 4 : top.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-search-jsp"><span class="nav-text">步骤 5 : search.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-homePage-jsp"><span class="nav-text">步骤 6 : homePage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-footer-jsp"><span class="nav-text">步骤 7 : footer.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、HOMEPAGE-JSP"><span class="nav-text">7、HOMEPAGE.JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-homePage-jsp-的复杂性"><span class="nav-text">步骤 1 : homePage.jsp 的复杂性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-homePage-jsp-所包含页面关系"><span class="nav-text">步骤 2 : homePage.jsp 所包含页面关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-categoryAndcarousel-jsp"><span class="nav-text">步骤 3 : categoryAndcarousel.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-categoryMenu-jsp"><span class="nav-text">步骤 4 : categoryMenu.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-productsAsideCategorys-jsp"><span class="nav-text">步骤 5 : productsAsideCategorys.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-carousel-jsp"><span class="nav-text">步骤 6 : carousel.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-homepageCategoryProducts-jsp"><span class="nav-text">步骤 7 : homepageCategoryProducts.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-总结"><span class="nav-text">步骤 8 : 总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十二、前台-无需登录"><span class="nav-text">十二、前台-无需登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、概述-v9"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、注册"><span class="nav-text">2、注册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v12"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v10"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v5"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-register-jsp"><span class="nav-text">步骤 4 : register.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-simpleSearch-jsp"><span class="nav-text">步骤 5 : simpleSearch.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-registerPage-jsp"><span class="nav-text">步骤 6 : registerPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-UserService"><span class="nav-text">步骤 7 : UserService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-UserServiceImpl"><span class="nav-text">步骤 8 : UserServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-ForeAction-register"><span class="nav-text">步骤 9 : ForeAction.register()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-registerSuccess-jsp"><span class="nav-text">步骤 10 : registerSuccess.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-registerSuccessPage-jsp"><span class="nav-text">步骤 11 : registerSuccessPage.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、ACTION重构-参数"><span class="nav-text">3、ACTION重构-参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-ForeAction中的参数msg"><span class="nav-text">步骤 1 : ForeAction中的参数msg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-新建Action4Parameter"><span class="nav-text">步骤 2 : 新建Action4Parameter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-Action4Result继承Action4Parameter"><span class="nav-text">步骤 3 : Action4Result继承Action4Parameter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Action继承关系"><span class="nav-text">步骤 4 : Action继承关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-完整的Action4Parameter"><span class="nav-text">步骤 5 : 完整的Action4Parameter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-可运行项目"><span class="nav-text">步骤 6 : 可运行项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、登录"><span class="nav-text">4、登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v13"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v11"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-login-jsp"><span class="nav-text">步骤 4 : login.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-loginPage-jsp"><span class="nav-text">步骤 5 : loginPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-UserService-v2"><span class="nav-text">步骤 6 : UserService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-UserServiceImpl-v2"><span class="nav-text">步骤 7 : UserServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-ForeAction-login"><span class="nav-text">步骤 8 : ForeAction.login()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、退出"><span class="nav-text">5、退出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v14"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v12"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-关于退出"><span class="nav-text">步骤 3 : 关于退出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-ForeAction-logout"><span class="nav-text">步骤 4 : ForeAction.logout()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、产品页"><span class="nav-text">6、产品页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v15"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v13"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果-v2"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Product-v2"><span class="nav-text">步骤 4 : Product</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-Review"><span class="nav-text">步骤 5 : Review</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-ReviewService"><span class="nav-text">步骤 6 : ReviewService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-ReviewServiceImpl"><span class="nav-text">步骤 7 : ReviewServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-Action4Pojo-v3"><span class="nav-text">步骤 8 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-Action4Service-v3"><span class="nav-text">步骤 9 : Action4Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-ProductService"><span class="nav-text">步骤 10 : ProductService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-11-ProductServiceImpl"><span class="nav-text">步骤 11 : ProductServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-12-ForeAction"><span class="nav-text">步骤 12 : ForeAction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-13-product-jsp"><span class="nav-text">步骤 13 : product.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-15-imgAndInfo-jsp"><span class="nav-text">步骤 15 : imgAndInfo.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-16-productReview-jsp"><span class="nav-text">步骤 16 : productReview.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-17-productDetail-jsp"><span class="nav-text">步骤 17 : productDetail.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、模态登录"><span class="nav-text">7、模态登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v16"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v14"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-页面效果"><span class="nav-text">步骤 3 : 页面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-imgAndInfo-jsp"><span class="nav-text">步骤 4 : imgAndInfo.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-checkLogin"><span class="nav-text">步骤 5 : ForeAction.checkLogin()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-fail-jsp"><span class="nav-text">步骤 6 : fail.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-modal-jsp"><span class="nav-text">步骤 7 : modal.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-ForeAction-loginAjax"><span class="nav-text">步骤 8 : ForeAction.loginAjax()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、分类页"><span class="nav-text">8、分类页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v17"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v15"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-页面效果-v2"><span class="nav-text">步骤 3 : 页面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-5个Comparator比较器"><span class="nav-text">步骤 4 : 5个Comparator比较器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-category"><span class="nav-text">步骤 5 : ForeAction.category()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-category-jsp"><span class="nav-text">步骤 6 : category.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-categoryPage-jsp"><span class="nav-text">步骤 7 : categoryPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-sortBar-jsp"><span class="nav-text">步骤 8 : sortBar.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-productsByCategory-jsp"><span class="nav-text">步骤 9 : productsByCategory.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、搜索"><span class="nav-text">9、搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v18"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v16"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果-v3"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-search-jsp以及simpleSearch-jsp"><span class="nav-text">步骤 4 : search.jsp以及simpleSearch.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ProductService-v2"><span class="nav-text">步骤 5 : ProductService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-ProductServiceImpl-v2"><span class="nav-text">步骤 6 : ProductServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-ForeAction-search"><span class="nav-text">步骤 7 : ForeAction.search()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-searchResult-jsp"><span class="nav-text">步骤 8 : searchResult.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-searchResultPage-jsp"><span class="nav-text">步骤 9 : searchResultPage.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-productsBySearch-jsp"><span class="nav-text">步骤 10 : productsBySearch.jsp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十三、前台-需要登录"><span class="nav-text">十三、前台-需要登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、购物流程"><span class="nav-text">1、购物流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-概述"><span class="nav-text">步骤 1 : 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-购买的业务流程"><span class="nav-text">步骤 2 : 购买的业务流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-购物流程环节与表关系"><span class="nav-text">步骤 3 : 购物流程环节与表关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、立即购买"><span class="nav-text">2、立即购买</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v19"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v17"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-运行效果"><span class="nav-text">步骤 3 : 运行效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-在产品页点击立即购买"><span class="nav-text">步骤 4 : 在产品页点击立即购买</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-buyone"><span class="nav-text">步骤 5 : ForeAction.buyone()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、结算页面"><span class="nav-text">3、结算页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v20"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v18"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果-v4"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-Action4Pojo"><span class="nav-text">步骤 4 : Action4Pojo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-buy"><span class="nav-text">步骤 5 : ForeAction.buy()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-buy-jsp"><span class="nav-text">步骤 6 : buy.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-buyPage-jsp"><span class="nav-text">步骤 7 : buyPage.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、加入购物车-v2"><span class="nav-text">4、加入购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v21"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v19"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-运行效果-v2"><span class="nav-text">步骤 3 : 运行效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-在产品页点击加入购物车"><span class="nav-text">步骤 4 : 在产品页点击加入购物车</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-ForeAction-addCart"><span class="nav-text">步骤 5 : ForeAction.addCart</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、查看购物车页面"><span class="nav-text">5、查看购物车页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v22"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v20"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果-v5"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-ForeAction-cart"><span class="nav-text">步骤 4 : ForeAction.cart()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-cart-jsp"><span class="nav-text">步骤 5 : cart.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-cartPage-jsp"><span class="nav-text">步骤 6 : cartPage.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、登录状态"><span class="nav-text">6、登录状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v23"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v21"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果-v5"><span class="nav-text">步骤 3 : 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-查看购物车页面的问题"><span class="nav-text">步骤 4 : 查看购物车页面的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-解决思路"><span class="nav-text">步骤 5 : 解决思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-AuthInterceptor"><span class="nav-text">步骤 6 : AuthInterceptor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-struts-xml"><span class="nav-text">步骤 7 : struts.xml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、搜索栏"><span class="nav-text">7、搜索栏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v24"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v22"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v6"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-CategoryNamesBelowSearchInterceptor"><span class="nav-text">步骤 4 : CategoryNamesBelowSearchInterceptor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-struts-xml"><span class="nav-text">步骤 5 : struts.xml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、购物总数"><span class="nav-text">8、购物总数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v25"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v23"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v7"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-CartTotalItemNumberInterceptor"><span class="nav-text">步骤 4 : CartTotalItemNumberInterceptor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-struts-xml-v2"><span class="nav-text">步骤 5 : struts.xml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、购物车页面操作"><span class="nav-text">9、购物车页面操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v26"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v24"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-购物车页面操作"><span class="nav-text">步骤 3 : 购物车页面操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-调整订单数量"><span class="nav-text">步骤 4 : 调整订单数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-删除订单项"><span class="nav-text">步骤 5 : 删除订单项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-提交到结算页面"><span class="nav-text">步骤 6 : 提交到结算页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、订单状态图"><span class="nav-text">10、订单状态图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-订单状态图"><span class="nav-text">步骤 1 : 订单状态图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-订单状态讲解"><span class="nav-text">步骤 2 : 订单状态讲解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-后续功能与订单状态的关系"><span class="nav-text">步骤 3 : 后续功能与订单状态的关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、生成订单"><span class="nav-text">11、生成订单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v27"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v25"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-结算页操作"><span class="nav-text">步骤 3 : 结算页操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-运行效果"><span class="nav-text">步骤 4 : 运行效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-OrderService"><span class="nav-text">步骤 5 : OrderService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-OrderServiceImpl"><span class="nav-text">步骤 6 : OrderServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-对createOrder进行事务管理"><span class="nav-text">步骤 7 : 对createOrder进行事务管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-ForeAction-createOrder"><span class="nav-text">步骤 8 : ForeAction.createOrder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-9-确认支付页"><span class="nav-text">步骤 9 : 确认支付页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-10-支付成功页"><span class="nav-text">步骤 10 : 支付成功页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、我的订单页"><span class="nav-text">12、我的订单页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v28"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v26"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-效果截图-v8"><span class="nav-text">步骤 3 : 效果截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-OrderService"><span class="nav-text">步骤 4 : OrderService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-OrderServiceImpl"><span class="nav-text">步骤 5 : OrderServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-ForeAction-bought"><span class="nav-text">步骤 6 : ForeAction.bought()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-bought-jsp"><span class="nav-text">步骤 7 : bought.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-boughtPage-jsp"><span class="nav-text">步骤 8 : boughtPage.jsp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、我的订单页操作"><span class="nav-text">13、我的订单页操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v29"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v27"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-我的订单页面操作"><span class="nav-text">步骤 3 : 我的订单页面操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-付款"><span class="nav-text">步骤 4 : 付款</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-确认收货"><span class="nav-text">步骤 5 : 确认收货</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-确认收货成功"><span class="nav-text">步骤 6 : 确认收货成功</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-7-评价"><span class="nav-text">步骤 7 : 评价</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-8-删除"><span class="nav-text">步骤 8 : 删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14、评价产品"><span class="nav-text">14、评价产品</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-先运行，看到效果，再学习-v30"><span class="nav-text">步骤 1 : 先运行，看到效果，再学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-模仿和排错-v28"><span class="nav-text">步骤 2 : 模仿和排错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-界面效果-v6"><span class="nav-text">步骤 3 : 界面效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-评价产品页面"><span class="nav-text">步骤 4 : 评价产品页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-提交评价"><span class="nav-text">步骤 5 : 提交评价</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十四、总结"><span class="nav-text">十四、总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、项目总结"><span class="nav-text">一、项目总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-项目结构"><span class="nav-text">步骤 1 : 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-典型场景"><span class="nav-text">步骤 2 : 典型场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-设计模式"><span class="nav-text">步骤 3 : 设计模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、改进练习"><span class="nav-text">二、改进练习</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十五、下载"><span class="nav-text">十五、下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、完整项目下载"><span class="nav-text">一、完整项目下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1-JDK1-8"><span class="nav-text">步骤 1 : JDK1.8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2-导入数据"><span class="nav-text">步骤 2 : 导入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-3-下载项目"><span class="nav-text">步骤 3 : 下载项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-4-导入Web动态项目"><span class="nav-text">步骤 4 : 导入Web动态项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-5-启动Tomcat"><span class="nav-text">步骤 5 : 启动Tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-6-访问"><span class="nav-text">步骤 6 : 访问</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script
  async
  src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"
></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潇 卟 甸</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
     我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
  

  
    <span class="site-pv">
     历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz',
        appKey: 'NMGzUaGqmpzSiSItkHBQGUaA',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("w1mVK8MFY7n2fWIKlq2t9EJn-gzGzoHsz", "NMGzUaGqmpzSiSItkHBQGUaA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  


  

 <script src="/js/src/activate-power-mode.js"></script>
 <script>
   POWERMODE.colorful = true;
   POWERMODE.shake = false;
   document.body.addEventListener('input', POWERMODE);
 </script>




<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20200610,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span style="color:#1890ff">$&</span>');
    div.innerHTML = `我已在此等候你 ${ages}`;
  }
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>




<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>


  
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
<!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
